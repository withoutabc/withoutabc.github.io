{
    "version": "https://jsonfeed.org/version/1",
    "title": "镜玄的博客",
    "subtitle": "某个INTJ的领域",
    "icon": "https://withoutabc.github.io/images/favicon.ico",
    "description": "",
    "home_page_url": "https://withoutabc.github.io",
    "items": [
        {
            "id": "https://withoutabc.github.io/2024/02/19/%E8%B0%83%E7%94%A8api%E6%8E%A5%E5%8F%A3%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5/",
            "url": "https://withoutabc.github.io/2024/02/19/%E8%B0%83%E7%94%A8api%E6%8E%A5%E5%8F%A3%E5%BF%AB%E9%80%9F%E7%94%9F%E6%88%90%E5%9B%BE%E7%89%87%E9%93%BE%E6%8E%A5/",
            "title": "调用api接口快速生成图片链接",
            "date_published": "2024-02-19T12:13:42.000Z",
            "content_html": "<h1 id=\"登录\"><a class=\"anchor\" href=\"#登录\">#</a> 登录</h1>\n<p>以 sm 图床为例：<span class=\"exturl\" data-url=\"aHR0cHM6Ly9zbS5tcy8=\">https://sm.ms/</span></p>\n<p>用接口测试工具发送一个如下请求：</p>\n<p><img data-src=\"https://s2.loli.net/2024/02/19/PzQFM5OhgHaNjLX.png\" alt=\"2024-02-19 22:34:45\" /></p>\n<p>获取一个 token，保存下来。</p>\n<blockquote>\n<p>多次请求可能会造成不能登录的情况，token 保存后等到失效再换，期间不用重复登录。</p>\n</blockquote>\n<h1 id=\"上传图片\"><a class=\"anchor\" href=\"#上传图片\">#</a> 上传图片</h1>\n<p>这里我们想写一个程序快速给图片批量上传图床。</p>\n<figure class=\"highlight python\"><figcaption data-lang=\"python\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">import</span> os</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> requests</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">from</span> datetime <span class=\"token keyword\">import</span> datetime</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">from</span> PIL <span class=\"token keyword\">import</span> Image</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">def</span> <span class=\"token function\">upload_file</span><span class=\"token punctuation\">(</span>folder_path<span class=\"token punctuation\">:</span> <span class=\"token builtin\">str</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token comment\"># 获取当前时间并格式化为字符串</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    time <span class=\"token operator\">=</span> datetime<span class=\"token punctuation\">.</span>now<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span>strftime<span class=\"token punctuation\">(</span><span class=\"token string\">\"%Y-%m-%d %H:%M:%S\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token comment\"># 获取文件夹中的所有一级文件</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    files <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>listdir<span class=\"token punctuation\">(</span>folder_path<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\"># 遍历文件</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">for</span> <span class=\"token builtin\">file</span> <span class=\"token keyword\">in</span> files<span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token comment\"># 构建文件的完整路径</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        file_path <span class=\"token operator\">=</span> os<span class=\"token punctuation\">.</span>path<span class=\"token punctuation\">.</span>join<span class=\"token punctuation\">(</span>folder_path<span class=\"token punctuation\">,</span> <span class=\"token builtin\">file</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\"># 检查文件是否为图片</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token keyword\">try</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token comment\"># 尝试打开图片文件</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            img <span class=\"token operator\">=</span> Image<span class=\"token punctuation\">.</span><span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>file_path<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            img<span class=\"token punctuation\">.</span>close<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token keyword\">except</span> <span class=\"token punctuation\">(</span>IOError<span class=\"token punctuation\">,</span> OSError<span class=\"token punctuation\">)</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token comment\"># 如果文件不是图片文件，则忽略该文件</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token keyword\">pass</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token comment\"># 上传请求的 URL</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        url <span class=\"token operator\">=</span> <span class=\"token string\">\"https://sm.ms/api/v2/upload\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token comment\"># 请求的参数</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        payload <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token comment\"># 要上传的文件</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        files <span class=\"token operator\">=</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token punctuation\">(</span><span class=\"token string\">'smfile'</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">(</span>time <span class=\"token operator\">+</span> <span class=\"token string\">'.png'</span><span class=\"token punctuation\">,</span> <span class=\"token builtin\">open</span><span class=\"token punctuation\">(</span>file_path<span class=\"token punctuation\">,</span> <span class=\"token string\">'rb'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'image/png'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\"># 请求头</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>        headers <span class=\"token operator\">=</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            <span class=\"token string\">'User-Agent'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'Apifox/1.0.0 (https://apifox.com)'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>            <span class=\"token string\">'Authorization'</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'...'</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token comment\"># 发起 POST 请求，上传文件</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>        response <span class=\"token operator\">=</span> requests<span class=\"token punctuation\">.</span>request<span class=\"token punctuation\">(</span><span class=\"token string\">\"POST\"</span><span class=\"token punctuation\">,</span> url<span class=\"token punctuation\">,</span> headers<span class=\"token operator\">=</span>headers<span class=\"token punctuation\">,</span> data<span class=\"token operator\">=</span>payload<span class=\"token punctuation\">,</span> files<span class=\"token operator\">=</span>files<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token comment\"># 处理上传响应</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>        resp <span class=\"token operator\">=</span> response<span class=\"token punctuation\">.</span>json<span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>        <span class=\"token keyword\">if</span> resp<span class=\"token punctuation\">[</span><span class=\"token string\">'success'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token boolean\">False</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token keyword\">if</span> resp<span class=\"token punctuation\">[</span><span class=\"token string\">'code'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token string\">'image_repeated'</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token comment\"># 图片重复上传，获取已存在的图片链接并打印</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                url <span class=\"token operator\">=</span> resp<span class=\"token punctuation\">[</span><span class=\"token string\">'images'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'![</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>time<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">](</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>url<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">)'</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>            <span class=\"token keyword\">else</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token comment\"># 上传失败，打印响应</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span>resp<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>        <span class=\"token keyword\">if</span> resp<span class=\"token punctuation\">[</span><span class=\"token string\">'success'</span><span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token boolean\">True</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>            <span class=\"token comment\"># 上传成功，获取图片链接并打印</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>            url <span class=\"token operator\">=</span> resp<span class=\"token punctuation\">[</span><span class=\"token string\">'url'</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>            <span class=\"token keyword\">print</span><span class=\"token punctuation\">(</span><span class=\"token string-interpolation\"><span class=\"token string\">f'![</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>time<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">](</span><span class=\"token interpolation\"><span class=\"token punctuation\">&#123;</span>url<span class=\"token punctuation\">&#125;</span></span><span class=\"token string\">)'</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre></pre></td></tr><tr><td data-num=\"65\"></td><td><pre></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token comment\"># 调用 upload_file 函数，传入要上传的图片文件夹的路径</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>upload_file<span class=\"token punctuation\">(</span><span class=\"token string\">'/home/ros/Documents/数电实验/excalidraw'</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><ul>\n<li><code>upload_file</code>  函数：传入要上传的图片文件夹的路径</li>\n<li><code>Authorization</code>  字段：填入登录获得的 token</li>\n</ul>\n<blockquote>\n<p>免费版有限制：每分钟 20 次，每小时 100 次。</p>\n<p>建议一次放十几张图片，比较合适。</p>\n</blockquote>\n",
            "tags": [
                "tools"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2024/02/13/%E5%90%8E%E7%AB%AF/viper/",
            "url": "https://withoutabc.github.io/2024/02/13/%E5%90%8E%E7%AB%AF/viper/",
            "title": "viper",
            "date_published": "2024-02-12T16:46:49.000Z",
            "content_html": "<h1 id=\"安装-viper\"><a class=\"anchor\" href=\"#安装-viper\">#</a> 安装 viper</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>go get github.com/spf13/viper</pre></td></tr></table></figure><h1 id=\"读取配置\"><a class=\"anchor\" href=\"#读取配置\">#</a> 读取配置</h1>\n<h2 id=\"直接读取\"><a class=\"anchor\" href=\"#直接读取\">#</a> 直接读取</h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># config.yaml</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">app_name</span><span class=\"token punctuation\">:</span> My Go App</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">app_port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">debug_mode</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr></table></figure><figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> main</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token string\">\"fmt\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token string\">\"github.com/spf13/viper\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">// 设置配置文件的名称和路径（可选）</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    viper<span class=\"token punctuation\">.</span><span class=\"token function\">SetConfigName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"config\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    viper<span class=\"token punctuation\">.</span><span class=\"token function\">SetConfigType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yaml\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    viper<span class=\"token punctuation\">.</span><span class=\"token function\">AddConfigPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// 读取配置文件</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    err <span class=\"token operator\">:=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">ReadInConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Errorf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to read config file: %s\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// 读取配置项</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    appName <span class=\"token operator\">:=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">GetString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"app_name\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    appPort <span class=\"token operator\">:=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">GetInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"app_port\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    debugMode <span class=\"token operator\">:=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">GetBool</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"debug_mode\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">// 使用读取到的配置项</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"App Name:\"</span><span class=\"token punctuation\">,</span> appName<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"App Port:\"</span><span class=\"token punctuation\">,</span> appPort<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Debug Mode:\"</span><span class=\"token punctuation\">,</span> debugMode<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>App Name: My Go App</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>App Port: 8080</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>Debug Mode: true</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>*/</span></pre></td></tr></table></figure><h2 id=\"结构体映射\"><a class=\"anchor\" href=\"#结构体映射\">#</a> 结构体映射</h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># config.yaml</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> My Go App</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">debug_mode</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">database</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> localhost</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">username</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token key atrule\">password</span><span class=\"token punctuation\">:</span> password</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">dbname</span><span class=\"token punctuation\">:</span> mydb</pre></td></tr></table></figure><figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> main</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"fmt\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"github.com/spf13/viper\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">type</span> Config <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tApp      AppConfig      <span class=\"token string\">`mapstructure:\"app\"`</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tDatabase DatabaseConfig <span class=\"token string\">`mapstructure:\"database\"`</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">type</span> AppConfig <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tName      <span class=\"token builtin\">string</span> <span class=\"token string\">`mapstructure:\"name\"`</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tPort      <span class=\"token builtin\">int</span>    <span class=\"token string\">`mapstructure:\"port\"`</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tDebugMode <span class=\"token builtin\">bool</span>   <span class=\"token string\">`mapstructure:\"debug_mode\"`</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">type</span> DatabaseConfig <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tHost     <span class=\"token builtin\">string</span> <span class=\"token string\">`mapstructure:\"host\"`</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tPort     <span class=\"token builtin\">int</span>    <span class=\"token string\">`mapstructure:\"port\"`</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tUsername <span class=\"token builtin\">string</span> <span class=\"token string\">`mapstructure:\"username\"`</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tPassword <span class=\"token builtin\">string</span> <span class=\"token string\">`mapstructure:\"password\"`</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tDBName   <span class=\"token builtin\">string</span> <span class=\"token string\">`mapstructure:\"dbname\"`</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t<span class=\"token comment\">// 设置配置文件的名称和路径（可选）</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tviper<span class=\"token punctuation\">.</span><span class=\"token function\">SetConfigName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"config\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\tviper<span class=\"token punctuation\">.</span><span class=\"token function\">SetConfigType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yaml\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tviper<span class=\"token punctuation\">.</span><span class=\"token function\">AddConfigPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t<span class=\"token comment\">// 读取配置文件</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\terr <span class=\"token operator\">:=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">ReadInConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t<span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Errorf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to read config file: %s\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t<span class=\"token comment\">// 解析配置文件到结构体</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t<span class=\"token keyword\">var</span> config Config</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\terr <span class=\"token operator\">=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">Unmarshal</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>config<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t\t<span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Errorf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to unmarshal config: %s\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t<span class=\"token comment\">// 使用解析后的结构体</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"App Name:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>App<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"App Port:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>App<span class=\"token punctuation\">.</span>Port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Debug Mode:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>App<span class=\"token punctuation\">.</span>DebugMode<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Database Host:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>Database<span class=\"token punctuation\">.</span>Host<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Database Port:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>Database<span class=\"token punctuation\">.</span>Port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Database Username:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>Database<span class=\"token punctuation\">.</span>Username<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Database Password:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>Database<span class=\"token punctuation\">.</span>Password<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Database Name:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>Database<span class=\"token punctuation\">.</span>DBName<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>App Name: My Go App</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>App Port: 8080</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>Debug Mode: true</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>Database Host: localhost</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>Database Port: 3306</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>Database Username: root</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>Database Password: password</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>Database Name: mydb</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>*/</span></pre></td></tr></table></figure><h2 id=\"配置中心读取-content\"><a class=\"anchor\" href=\"#配置中心读取-content\">#</a> 配置中心读取 content</h2>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> main</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"fmt\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"github.com/spf13/viper\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">type</span> Config <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tApp      AppConfig      <span class=\"token string\">`mapstructure:\"app\"`</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tDatabase DatabaseConfig <span class=\"token string\">`mapstructure:\"database\"`</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">type</span> AppConfig <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tName      <span class=\"token builtin\">string</span> <span class=\"token string\">`mapstructure:\"name\"`</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tPort      <span class=\"token builtin\">int</span>    <span class=\"token string\">`mapstructure:\"port\"`</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tDebugMode <span class=\"token builtin\">bool</span>   <span class=\"token string\">`mapstructure:\"debug_mode\"`</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token keyword\">type</span> DatabaseConfig <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tHost     <span class=\"token builtin\">string</span> <span class=\"token string\">`mapstructure:\"host\"`</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tPort     <span class=\"token builtin\">int</span>    <span class=\"token string\">`mapstructure:\"port\"`</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tUsername <span class=\"token builtin\">string</span> <span class=\"token string\">`mapstructure:\"username\"`</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tPassword <span class=\"token builtin\">string</span> <span class=\"token string\">`mapstructure:\"password\"`</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\tDBName   <span class=\"token builtin\">string</span> <span class=\"token string\">`mapstructure:\"dbname\"`</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t<span class=\"token comment\">// 假设已经从配置中心获取了配置文件内容，并将其保存在 content 变量中</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tcontent <span class=\"token operator\">:=</span> <span class=\"token string\">`</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>app:</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  name: My Go App</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  port: 8080</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  debug_mode: true</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>database:</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  host: localhost</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  port: 3306</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  username: root</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  password: password</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  dbname: mydb</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>`</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t<span class=\"token comment\">// 使用 viper.ReadConfigFromReader 来解析配置文件字符串</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\tviper<span class=\"token punctuation\">.</span><span class=\"token function\">SetConfigType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yaml\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\terr <span class=\"token operator\">:=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">ReadConfig</span><span class=\"token punctuation\">(</span>strings<span class=\"token punctuation\">.</span><span class=\"token function\">NewReader</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\t<span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Errorf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to read config: %s\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t<span class=\"token comment\">// 解析配置文件到结构体</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t<span class=\"token keyword\">var</span> config Config</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\terr <span class=\"token operator\">=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">Unmarshal</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>config<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\t<span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Errorf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to unmarshal config: %s\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\t<span class=\"token comment\">// 使用解析后的结构体</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"App Name:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>App<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"App Port:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>App<span class=\"token punctuation\">.</span>Port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Debug Mode:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>App<span class=\"token punctuation\">.</span>DebugMode<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Database Host:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>Database<span class=\"token punctuation\">.</span>Host<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Database Port:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>Database<span class=\"token punctuation\">.</span>Port<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Database Username:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>Database<span class=\"token punctuation\">.</span>Username<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Database Password:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>Database<span class=\"token punctuation\">.</span>Password<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Database Name:\"</span><span class=\"token punctuation\">,</span> config<span class=\"token punctuation\">.</span>Database<span class=\"token punctuation\">.</span>DBName<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre></pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"68\"></td><td><pre>App Name: My Go App</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>App Port: 8080</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>Debug Mode: true</pre></td></tr><tr><td data-num=\"71\"></td><td><pre>Database Host: localhost</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>Database Port: 3306</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>Database Username: root</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>Database Password: password</pre></td></tr><tr><td data-num=\"75\"></td><td><pre>Database Name: mydb</pre></td></tr><tr><td data-num=\"76\"></td><td><pre>*/</span></pre></td></tr></table></figure><h2 id=\"多环境支持\"><a class=\"anchor\" href=\"#多环境支持\">#</a> 多环境支持</h2>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> main</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"fmt\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"github.com/spf13/viper\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token string\">\"os\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token keyword\">var</span> value <span class=\"token builtin\">string</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Scan</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">// 设置环境变量</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tos<span class=\"token punctuation\">.</span><span class=\"token function\">Setenv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"env\"</span><span class=\"token punctuation\">,</span> value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token comment\">// 获取设置的环境变量的值</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tenv <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span><span class=\"token function\">Getenv</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"env\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token comment\">// 设置配置文件的名称和路径（可选）</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tviper<span class=\"token punctuation\">.</span><span class=\"token function\">SetConfigName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"config\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tviper<span class=\"token punctuation\">.</span><span class=\"token function\">SetConfigType</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"yaml\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tviper<span class=\"token punctuation\">.</span><span class=\"token function\">AddConfigPath</span><span class=\"token punctuation\">(</span><span class=\"token string\">\".\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token comment\">// 根据不同的环境加载不同的配置文件</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tviper<span class=\"token punctuation\">.</span><span class=\"token function\">SetConfigName</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"config_\"</span> <span class=\"token operator\">+</span> env<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token comment\">// 读取配置文件</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\terr <span class=\"token operator\">:=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">ReadInConfig</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token function\">panic</span><span class=\"token punctuation\">(</span>fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Errorf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"failed to read config file: %s\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t<span class=\"token comment\">// 读取配置项</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\tappName <span class=\"token operator\">:=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">GetString</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"app.name\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tappPort <span class=\"token operator\">:=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">GetInt</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"app.port\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\tdebugMode <span class=\"token operator\">:=</span> viper<span class=\"token punctuation\">.</span><span class=\"token function\">GetBool</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"app.debug_mode\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token comment\">// 使用读取到的配置项</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"App Name:\"</span><span class=\"token punctuation\">,</span> appName<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"App Port:\"</span><span class=\"token punctuation\">,</span> appPort<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Debug Mode:\"</span><span class=\"token punctuation\">,</span> debugMode<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "后端",
                "viper"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2024/02/13/%E5%90%8E%E7%AB%AF/Sentinel/",
            "url": "https://withoutabc.github.io/2024/02/13/%E5%90%8E%E7%AB%AF/Sentinel/",
            "title": "Sentinel",
            "date_published": "2024-02-12T16:46:42.000Z",
            "content_html": "<h1 id=\"启动配置\"><a class=\"anchor\" href=\"#启动配置\">#</a> 启动配置</h1>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> Entity <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">// Version 表示配置的格式版本。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tVersion <span class=\"token builtin\">string</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token comment\">// Sentinel 表示 Sentinel 的配置信息。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tSentinel SentinelConfig</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// SentinelConfig 表示 Sentinel 的一般配置。</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">type</span> SentinelConfig <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tApp <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t<span class=\"token comment\">// Name 表示当前运行的服务的名称。</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\tName <span class=\"token builtin\">string</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token comment\">// Type 表示服务的分类（例如：web 服务、API 网关等）。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\tType <span class=\"token builtin\">int32</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token comment\">// Log 表示与日志记录相关的配置项。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tLog LogConfig</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token comment\">// Stat 表示与统计相关的配置项。</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tStat StatConfig</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token comment\">// UseCacheTime 表示是否缓存时间（以毫秒为单位）。</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tUseCacheTime <span class=\"token builtin\">bool</span> <span class=\"token string\">`yaml:\"useCacheTime\"`</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\">// LogConfig 表示 Sentinel 中的日志配置。</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">type</span> LogConfig <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token comment\">// Logger 表示是否使用日志记录器替代默认的日志记录。</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token comment\">// 如果用户期望使用自定义的 Logger 去覆盖 Sentinel 默认的 logger，需要指定这个对象，如果指定了，Sentinel 就会使用这个对象打日志</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\tLogger logging<span class=\"token punctuation\">.</span>Logger</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token comment\">// Dir 表示日志文件的存储目录路径。</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\tDir <span class=\"token builtin\">string</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t<span class=\"token comment\">// UsePid 表示日志文件名是否以进程 ID（PID）结尾。</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\tUsePid <span class=\"token builtin\">bool</span> <span class=\"token string\">`yaml:\"usePid\"`</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t<span class=\"token comment\">// Metric 表示指标日志的配置项。</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\tMetric MetricLogConfig</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\">// MetricLogConfig 表示指标日志的配置项。</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token keyword\">type</span> MetricLogConfig <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token comment\">// 监控日志单个文件大小上限 50MB</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\tSingleFileMaxSize <span class=\"token builtin\">uint64</span> <span class=\"token string\">`yaml:\"singleFileMaxSize\"`</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token comment\">// 监控日志最大文件数目 8</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\tMaxFileCount      <span class=\"token builtin\">uint32</span> <span class=\"token string\">`yaml:\"maxFileCount\"`</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token comment\">// 监控日志聚合和刷盘的时间频率 1s</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\tFlushIntervalSec  <span class=\"token builtin\">uint32</span> <span class=\"token string\">`yaml:\"flushIntervalSec\"`</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre></pre></td></tr><tr><td data-num=\"48\"></td><td><pre><span class=\"token comment\">// StatConfig 表示统计相关的配置项。</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre><span class=\"token keyword\">type</span> StatConfig <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>\t<span class=\"token comment\">// GlobalStatisticSampleCountTotal 和 GlobalStatisticIntervalMsTotal 是每个资源的全局默认统计滑动窗口配置。</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\tGlobalStatisticSampleCountTotal <span class=\"token builtin\">uint32</span> <span class=\"token string\">`yaml:\"globalStatisticSampleCountTotal\"`</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\tGlobalStatisticIntervalMsTotal  <span class=\"token builtin\">uint32</span> <span class=\"token string\">`yaml:\"globalStatisticIntervalMsTotal\"`</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t<span class=\"token comment\">// MetricStatisticSampleCount 和 MetricStatisticIntervalMs 是每个资源的默认只读指标统计配置。</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t<span class=\"token comment\">// 这个默认的只读指标统计必须基于全局统计。</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\tMetricStatisticSampleCount <span class=\"token builtin\">uint32</span> <span class=\"token string\">`yaml:\"metricStatisticSampleCount\"`</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\tMetricStatisticIntervalMs  <span class=\"token builtin\">uint32</span> <span class=\"token string\">`yaml:\"metricStatisticIntervalMs\"`</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\tSystem SystemStatConfig <span class=\"token string\">`yaml:\"system\"`</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token comment\">// SystemStatConfig 表示系统统计的配置项。</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre><span class=\"token keyword\">type</span> SystemStatConfig <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>\t<span class=\"token comment\">// CollectIntervalMs 表示系统指标收集器的采集间隔。</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>\tCollectIntervalMs <span class=\"token builtin\">uint32</span> <span class=\"token string\">`yaml:\"collectIntervalMs\"`</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>支持配置方式</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>api<span class=\"token punctuation\">.</span><span class=\"token function\">InitDefault</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">// 默认配置</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>api<span class=\"token punctuation\">.</span><span class=\"token function\">InitWithConfig</span><span class=\"token punctuation\">(</span>confEntity <span class=\"token operator\">*</span>config<span class=\"token punctuation\">.</span>Entity<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 自定义</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>api<span class=\"token punctuation\">.</span><span class=\"token function\">InitWithConfigFile</span><span class=\"token punctuation\">(</span>configPath <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token comment\">//yaml 文件</span></pre></td></tr></table></figure><h1 id=\"定义资源\"><a class=\"anchor\" href=\"#定义资源\">#</a> 定义资源</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9zZW50aW5lbGd1YXJkLmlvL3poLWNuL2RvY3MvZ29sYW5nL2Jhc2ljLWFwaS11c2FnZS5odG1s\">https://sentinelguard.io/zh-cn/docs/golang/basic-api-usage.html</span></p>\n<p>使用 Sentinel 的 Entry API 将业务逻辑封装起来，这一步称为 “埋点”。每个埋点都有一个资源名称（resource），代表触发了这个资源的调用或访问。</p>\n<p>埋点 API 位于  <code>api</code>  包中：</p>\n<ul>\n<li><code>Entry(resource string, opts ...Option) (*base.SentinelEntry, *base.BlockError)</code></li>\n</ul>\n<p>其中  <code>resource</code>  代表埋点资源名，  <code>opts</code>  代表埋点配置。这里需要注意的是，返回值参数列表的第一个和第二个参数是互斥的，也就是说，如果 Entry 执行 pass，那么 Sentinel 会返回 (*base.SentinelEntry, nil)；如果 Entry 执行 blocked，那么 Sentinel 会返回 (nil, *base.BlockError)。</p>\n<p>目前支持以下埋点配置：</p>\n<ul>\n<li><code>WithTrafficType(entryType base.TrafficType)</code> ：标记该埋点资源的流量类型，其中 Inbound 代表入口流量，Outbound 代表出口流量。若不指定，默认为 Outbound。</li>\n<li><code>WithResourceType(resourceType base.ResourceType)</code> ：标记该埋点资源的分类。</li>\n<li><code>WithAcquireCount(acquireCount uint32)</code> ：标记每次触发该埋点计为几次调用（可以理解为 batch count）。若不指定，默认为 1。</li>\n<li><code>WithArgs(args ...interface&#123;&#125;)</code> ：埋点携带的参数列表，为热点参数统计预留。</li>\n<li><code>WithSlotChain(chain *base.SlotChain)</code> ：埋点执行的检查的 slotchain，若不指定，默认使用全局 slotchain</li>\n</ul>\n<h1 id=\"流量控制\"><a class=\"anchor\" href=\"#流量控制\">#</a> 流量控制</h1>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> Rule <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">// ID represents the unique ID of the rule (optional).</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tID <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"id,omitempty\"`</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// 资源名，即规则的作用目标。</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tResource               <span class=\"token builtin\">string</span>                 <span class=\"token string\">`json:\"resource\"`</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// 当前流量控制器的 Token 计算策略。Direct 表示直接使用字段 Threshold 作为阈值；WarmUp 表示使用预热方式计算 Token 的阈值。</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tTokenCalculateStrategy TokenCalculateStrategy <span class=\"token string\">`json:\"tokenCalculateStrategy\"`</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// 表示流量控制器的控制策略；Reject 表示超过阈值直接拒绝，Throttling 表示匀速排队。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tControlBehavior        ControlBehavior        <span class=\"token string\">`json:\"controlBehavior\"`</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token comment\">// 表示流控阈值；如果字段 StatIntervalInMs 是 1000 (也就是 1 秒)，那么 Threshold 就表示 QPS，流量控制器也就会依据资源的 QPS 来做流控。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tThreshold         <span class=\"token builtin\">float64</span>          <span class=\"token string\">`json:\"threshold\"`</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">// 调用关系限流策略，CurrentResource 表示使用当前规则的 resource 做流控；AssociatedResource 表示使用关联的 resource 做流控，关联的 resource 在字段 RefResource 定义</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tRelationStrategy  RelationStrategy <span class=\"token string\">`json:\"relationStrategy\"`</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// 关联的 resource</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tRefResource       <span class=\"token builtin\">string</span>           <span class=\"token string\">`json:\"refResource\"`</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token comment\">// 匀速排队的最大等待时间，该字段仅仅对 Throttling ControlBehavior 生效</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tMaxQueueingTimeMs <span class=\"token builtin\">uint32</span>           <span class=\"token string\">`json:\"maxQueueingTimeMs\"`</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token comment\">// 预热的时间长度，该字段仅仅对 WarmUp 的 TokenCalculateStrategy 生效</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tWarmUpPeriodSec   <span class=\"token builtin\">uint32</span>           <span class=\"token string\">`json:\"warmUpPeriodSec\"`</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token comment\">// 预热的因子，默认是 3，该值的设置会影响预热的速度，该字段仅仅对 WarmUp 的 TokenCalculateStrategy 生效</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\tWarmUpColdFactor  <span class=\"token builtin\">uint32</span>           <span class=\"token string\">`json:\"warmUpColdFactor\"`</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token comment\">// 规则对应的流量控制器的独立统计结构的统计周期。如果 StatIntervalInMs 是 1000，也就是统计 QPS。</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\tStatIntervalInMs <span class=\"token builtin\">uint32</span> <span class=\"token string\">`json:\"statIntervalInMs\"`</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>这里特别强调一下  <code>StatIntervalInMs</code>  和  <code>Threshold</code>  这两个字段，这两个字段决定了流量控制器的灵敏度。以 Direct + Reject 的流控策略为例，流量控制器的行为就是在  <code>StatIntervalInMs</code>  周期内，允许的最大请求数量是  <code>Threshold</code>  。比如如果  <code>StatIntervalInMs</code>  是 10000，  <code>Threshold</code>  是 10000，那么流量控制器的行为就是控制该资源 10s 内运行最多 10000 次访问。</p>\n<h1 id=\"熔断降级\"><a class=\"anchor\" href=\"#熔断降级\">#</a> 熔断降级</h1>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> Rule <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">// 表示 Sentinel 规则的全局唯一 ID，可选项。</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tId <span class=\"token builtin\">string</span> <span class=\"token string\">`json:\"id,omitempty\"`</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token comment\">// 熔断器规则生效的埋点资源的名称</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tResource <span class=\"token builtin\">string</span>   <span class=\"token string\">`json:\"resource\"`</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">// 熔断策略，目前支持 SlowRequestRatio、ErrorRatio、ErrorCount 三种</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tStrategy Strategy <span class=\"token string\">`json:\"strategy\"`</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">// 即熔断触发后持续的时间（单位为 ms）。资源进入熔断状态后，在配置的熔断时长内，请求都会快速失败。熔断结束后进入探测恢复模式（HALF-OPEN）</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tRetryTimeoutMs <span class=\"token builtin\">uint32</span> <span class=\"token string\">`json:\"retryTimeoutMs\"`</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token comment\">// 静默数量，如果当前统计周期内对资源的访问数量小于静默数量，那么熔断器就处于静默期。换言之，也就是触发熔断的最小请求数目，若当前统计周期内的请求数小于此值，即使达到熔断条件规则也不会触发。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tMinRequestAmount <span class=\"token builtin\">uint64</span> <span class=\"token string\">`json:\"minRequestAmount\"`</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token comment\">// 统计的时间窗口长度（单位为 ms）。</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tStatIntervalMs <span class=\"token builtin\">uint32</span> <span class=\"token string\">`json:\"statIntervalMs\"`</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token comment\">// 仅对慢调用熔断策略生效，MaxAllowedRtMs 是判断请求是否是慢调用的临界值，也就是如果请求的 response time 小于或等于 MaxAllowedRtMs，那么就不是慢调用；如果 response time 大于 MaxAllowedRtMs，那么当前请求就属于慢调用。</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tMaxAllowedRtMs <span class=\"token builtin\">uint64</span> <span class=\"token string\">`json:\"maxAllowedRtMs\"`</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token comment\">// 对于慢调用熔断策略，Threshold 表示是慢调用比例的阈值 (小数表示，比如 0.1 表示 10%)，也就是如果当前资源的慢调用比例如果高于 Threshold，那么熔断器就会断开；否则保持闭合状态。 对于错误比例策略，Threshold 表示的是错误比例的阈值 (小数表示，比如 0.1 表示 10%)。对于错误数策略，Threshold 是错误计数的阈值。</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tThreshold <span class=\"token builtin\">float64</span> <span class=\"token string\">`json:\"threshold\"`</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">// 选择以慢调用比例 (SlowRequestRatio) 作为阈值，需要设置允许的最大响应时间（MaxAllowedRtMs），请求的响应时间大于该值则统计为慢调用。通过 Threshold 字段设置触发熔断的慢调用比例，取值范围为 [0.0, 1.0]。规则配置后，在单位统计时长内请求数目大于设置的最小请求数目，并且慢调用的比例大于阈值，则接下来的熔断时长内请求会自动被熔断。经过熔断时长后熔断器会进入探测恢复状态，若接下来的一个请求响应时间小于设置的最大 RT 则结束熔断，若大于设置的最大 RT 则会再次被熔断。</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">// 选择以错误比例 (ErrorRatio) 作为阈值，需要设置触发熔断的异常比例（Threshold），取值范围为 [0.0, 1.0]。规则配置后，在单位统计时长内请求数目大于设置的最小请求数目，并且异常的比例大于阈值，则接下来的熔断时长内请求会自动被熔断。经过熔断时长后熔断器会进入探测恢复状态，若接下来的一个请求没有错误则结束熔断，否则会再次被熔断。代码中可以通过 api.TraceError (entry, err) 函数来记录 error。</span></pre></td></tr></table></figure><p>一些补充说明：</p>\n<ul>\n<li>\n<p>Resource、Strategy、RetryTimeoutMs、MinRequestAmount、StatIntervalMs、Threshold 每个规则都必设的字段，MaxAllowedRtMs 是慢调用比例熔断规则必设的字段。</p>\n</li>\n<li>\n<p>MaxAllowedRtMs 字段仅仅对<strong>慢调用比例</strong> (SlowRequestRatio) 策略有效，对其余策略均属于无效字段。</p>\n</li>\n<li>\n<p>StatIntervalMs 表示熔断器的统计周期，单位是毫秒，这个值我们不建议设置的太大或则太小，一般情况下设置 10 秒左右都 OK，当然也要根据实际情况来适当调整。</p>\n</li>\n<li>\n<p>RetryTimeoutMs 的设置需要根据实际情况设置探测周期，一般情况下设置 10 秒左右都 OK，当然也要根据实际情况来适当调整。</p>\n</li>\n</ul>\n<h2 id=\"降级\"><a class=\"anchor\" href=\"#降级\">#</a> 降级</h2>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//stateChangeTestListener 是一个用于监视断路器状态变化的监听器</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">type</span> stateChangeTestListener <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// OnTransformToClosed 当从其他状态转换为关闭状态时触发</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">*</span>stateChangeTestListener<span class=\"token punctuation\">)</span> <span class=\"token function\">OnTransformToClosed</span><span class=\"token punctuation\">(</span>prev circuitbreaker<span class=\"token punctuation\">.</span>State<span class=\"token punctuation\">,</span> rule circuitbreaker<span class=\"token punctuation\">.</span>Rule<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rule.strategy: %+v, 从 %s 转换为关闭状态, 时间: %d\\n\"</span><span class=\"token punctuation\">,</span> rule<span class=\"token punctuation\">.</span>Strategy<span class=\"token punctuation\">,</span> prev<span class=\"token punctuation\">.</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> util<span class=\"token punctuation\">.</span><span class=\"token function\">CurrentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// OnTransformToOpen 当从其他状态转换为打开状态时触发</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">*</span>stateChangeTestListener<span class=\"token punctuation\">)</span> <span class=\"token function\">OnTransformToOpen</span><span class=\"token punctuation\">(</span>prev circuitbreaker<span class=\"token punctuation\">.</span>State<span class=\"token punctuation\">,</span> rule circuitbreaker<span class=\"token punctuation\">.</span>Rule<span class=\"token punctuation\">,</span> snapshot <span class=\"token keyword\">interface</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rule.strategy: %+v, 从 %s 转换为打开状态, 快照: %.2f, 时间: %d\\n\"</span><span class=\"token punctuation\">,</span> rule<span class=\"token punctuation\">.</span>Strategy<span class=\"token punctuation\">,</span> prev<span class=\"token punctuation\">.</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> snapshot<span class=\"token punctuation\">,</span> util<span class=\"token punctuation\">.</span><span class=\"token function\">CurrentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">// OnTransformToHalfOpen 当从其他状态转换为半开状态时触发</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>s <span class=\"token operator\">*</span>stateChangeTestListener<span class=\"token punctuation\">)</span> <span class=\"token function\">OnTransformToHalfOpen</span><span class=\"token punctuation\">(</span>prev circuitbreaker<span class=\"token punctuation\">.</span>State<span class=\"token punctuation\">,</span> rule circuitbreaker<span class=\"token punctuation\">.</span>Rule<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"rule.strategy: %+v, 从 %s 转换为半开状态, 时间: %d\\n\"</span><span class=\"token punctuation\">,</span> rule<span class=\"token punctuation\">.</span>Strategy<span class=\"token punctuation\">,</span> prev<span class=\"token punctuation\">.</span><span class=\"token function\">String</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> util<span class=\"token punctuation\">.</span><span class=\"token function\">CurrentTimeMillis</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"监控日志\"><a class=\"anchor\" href=\"#监控日志\">#</a> 监控日志</h1>\n<figure class=\"highlight log\"><figcaption data-lang=\"log\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">1529573107000</span><span class=\"token operator\">|</span><span class=\"token date number\">2018-06-21</span> <span class=\"token time number\">17:25:07</span><span class=\"token operator\">|</span>foo<span class=\"token operator\">-</span>service<span class=\"token operator\">|</span><span class=\"token number\">10</span><span class=\"token operator\">|</span><span class=\"token number\">3601</span><span class=\"token operator\">|</span><span class=\"token number\">10</span><span class=\"token operator\">|</span><span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">27</span><span class=\"token operator\">|</span><span class=\"token number\">0</span><span class=\"token operator\">|</span><span class=\"token number\">5</span><span class=\"token operator\">|</span><span class=\"token number\">1</span></pre></td></tr></table></figure><p>日志字段说明：</p>\n<table>\n<thead>\n<tr>\n<th>index</th>\n<th>例子</th>\n<th>说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>1</td>\n<td><code>1529573107000</code></td>\n<td>时间戳</td>\n</tr>\n<tr>\n<td>2</td>\n<td><code>2018-06-21 17:25:07</code></td>\n<td>日期</td>\n</tr>\n<tr>\n<td>3</td>\n<td><code>foo-service</code></td>\n<td>资源名称</td>\n</tr>\n<tr>\n<td>4</td>\n<td><code>10</code></td>\n<td>这一秒通过的资源请求个数 (pass)</td>\n</tr>\n<tr>\n<td>5</td>\n<td><code>3601</code></td>\n<td>这一秒资源被拦截的个数 (block)</td>\n</tr>\n<tr>\n<td>6</td>\n<td><code>10</code></td>\n<td>这一秒完成调用的资源个数 (complete)，包括正常结束和异常结束的情况</td>\n</tr>\n<tr>\n<td>7</td>\n<td><code>0</code></td>\n<td>这一秒资源的异常个数 (error)</td>\n</tr>\n<tr>\n<td>8</td>\n<td><code>27</code></td>\n<td>资源平均响应时间（ms）</td>\n</tr>\n<tr>\n<td>9</td>\n<td><code>0</code></td>\n<td>预留字段</td>\n</tr>\n<tr>\n<td>10</td>\n<td><code>5</code></td>\n<td>该秒的最大并发，预留用</td>\n</tr>\n<tr>\n<td>11</td>\n<td><code>1</code></td>\n<td>资源分类</td>\n</tr>\n</tbody>\n</table>\n<h1 id=\"官方指南\"><a class=\"anchor\" href=\"#官方指南\">#</a> 官方指南</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9naXRodWIuY29tL2FsaWJhYmEvc2VudGluZWwtZ29sYW5nL3dpa2k=\">https://github.com/alibaba/sentinel-golang/wiki</span></p>\n",
            "tags": [
                "后端",
                "sentinel"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2024/02/13/%E8%BF%90%E7%BB%B4/Kubernetes%E5%9F%BA%E7%A1%80/",
            "url": "https://withoutabc.github.io/2024/02/13/%E8%BF%90%E7%BB%B4/Kubernetes%E5%9F%BA%E7%A1%80/",
            "title": "Kubernetes基础",
            "date_published": "2024-02-12T16:38:55.000Z",
            "content_html": "<h1 id=\"pod-收纳仓\"><a class=\"anchor\" href=\"#pod-收纳仓\">#</a> Pod-&quot;收纳仓&quot;</h1>\n<ul>\n<li>从 Pod 开始，扩展出了 Kubernetes 里的一些重要 API 对象</li>\n</ul>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/41zp8kE6UmAoscu.png\" alt=\"pod.png\" /></p>\n<ul>\n<li>\n<p><code>apiVersion</code>  和  <code>kind</code>  这两个字段很简单，对于 Pod 来说分别是固定的值  <code>v1</code>  和  <code>Pod</code>  ，而一般来说，“metadata” 里应该有 <code>name</code>  和 <code>labels</code>  这两个字段。</p>\n</li>\n<li>\n<p>但在 Kubernetes 里，Pod 必须要有一个名字。这也是 Kubernetes 里所有资源对象的一个约定。 一般加上  <code>pod</code>  后缀</p>\n</li>\n<li>\n<p><code>name</code>  只是一个基本的标识，信息有限，所以  <code>labels</code>  字段就派上了用处。它可以添加任意数量的 Key-Value，给 Pod “贴” 上归类的标签，结合  <code>name</code>  就更方便识别和管理了。</p>\n</li>\n</ul>\n<p>根据运行环境，  <code>env=dev/test/prod</code></p>\n<p>根据所在的数据中心，使用标签  <code>region: north/south</code></p>\n<p>根据应用在系统中的层次，使用  <code>tier=front/middle/back</code></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> busy<span class=\"token punctuation\">-</span>pod</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">owner</span><span class=\"token punctuation\">:</span> chrono</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span> demo</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">region</span><span class=\"token punctuation\">:</span> north</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">tier</span><span class=\"token punctuation\">:</span> back</pre></td></tr></table></figure><h2 id=\"container\"><a class=\"anchor\" href=\"#container\">#</a> container</h2>\n<p>“containers” 是一个数组，里面的每一个元素又是一个 container 对象，也就是容器。</p>\n<ul>\n<li>container 对象也必须要有一个  <code>name</code>  表示名字，然后当然还要有一个  <code>image</code>  字段来说明它使用的镜像，这两个字段是必须要有的 。</li>\n</ul>\n<h3 id=\"字段\"><a class=\"anchor\" href=\"#字段\">#</a> 字段</h3>\n<ul>\n<li>\n<p><strong>ports</strong>：列出容器对外暴露的端口，和 Docker 的 <code>-p</code>  参数有点像。</p>\n</li>\n<li>\n<p><strong>imagePullPolicy</strong>：指定镜像的拉取策略，可以是  <code>Always</code>  /  <code>Never</code>  /  <code>IfNotPresent</code>  ，一般默认是  <code>IfNotPresent</code>  ，也就是说只有本地不存在才会远程拉取镜像，可以减少网络消耗。</p>\n</li>\n<li>\n<p><strong>env</strong>：定义 Pod 的环境变量，和 Dockerfile 里的  <code>ENV</code>  指令有点类似，但它是运行时指定的，更加灵活可配置。</p>\n</li>\n<li>\n<p><strong>command</strong>：定义容器启动时要执行的命令，相当于 Dockerfile 里的  <code>ENTRYPOINT</code>  指令。</p>\n</li>\n<li>\n<p><strong>args</strong>：它是 command 运行时的参数，相当于 Dockerfile 里的  <code>CMD</code>  指令，这两个命令和 Docker 的含义不同，要特别注意。</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox<span class=\"token punctuation\">:</span>latest</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> busy</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> os</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"ubuntu\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> debug</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"on\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">-</span> /bin/echo</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"$(os), $(debug)\"</span></pre></td></tr></table></figure><h2 id=\"复制和执行命令\"><a class=\"anchor\" href=\"#复制和执行命令\">#</a> 复制和执行命令</h2>\n<p>比如我有一个 “a.txt” 文件，那么就可以使用  <code>kubectl cp</code>  拷贝进 Pod 的 “/tmp” 目录里：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token string\">'aaa'</span> <span class=\"token operator\">></span> a.txt</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl <span class=\"token function\">cp</span> a.txt ngx-pod:/tmp</pre></td></tr></table></figure><p>不过  <code>kubectl exec</code>  的命令格式与 Docker 有一点小差异，需要在 Pod 后面加上  <code>--</code>  ，把 kubectl 的命令与 Shell 命令分隔开：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> ngx-pod -- <span class=\"token function\">sh</span></pre></td></tr></table></figure><h1 id=\"job-临时任务\"><a class=\"anchor\" href=\"#job-临时任务\">#</a> Job-&quot;临时任务&quot;</h1>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> batch/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Job</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> echo<span class=\"token punctuation\">-</span>job</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token key atrule\">restartPolicy</span><span class=\"token punctuation\">:</span> OnFailure</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> echo<span class=\"token punctuation\">-</span>job</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/bin/echo\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"world\"</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><ul>\n<li><code>spec</code>  字段里，多了一个  <code>template</code>  字段，然后又是一个  <code>spec</code></li>\n<li><code>template</code>  字段定义了一个 “<strong>应用模板</strong>” ，里面嵌入了一个 Pod，这样 Job 就可以从这个模板来创建出 Pod。</li>\n</ul>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/QWlv94pOTYCabKH.png\" alt=\"job.jpg\" /></p>\n<ul>\n<li>\n<p>这里的 Pod 工作非常简单，在  <code>containers</code>  里写好名字和镜像，  <code>command</code>  执行  <code>/bin/echo</code>  ，输出 “hello world”。</p>\n</li>\n<li>\n<p>不过，因为 Job 业务的特殊性，所以我们还要在  <code>spec</code>  里多加一个字段  <code>restartPolicy</code>  ，确定 Pod 运行失败时的策略，  <code>OnFailure</code>  是失败原地重启容器，而  <code>Never</code>  则是不重启容器，让 Job 去重新调度生成一个新的 Pod。</p>\n</li>\n</ul>\n<p>再创建一个 Job 对象，名字叫 “sleep-job”，它随机睡眠一段时间再退出，模拟运行时间较长的作业（比如 MapReduce）。Job 的参数设置成 15 秒超时，最多重试 2 次，总共需要运行完 4 个 Pod，但同一时刻最多并发 2 个 Pod：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> batch/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Job</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sleep<span class=\"token punctuation\">-</span>job</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">activeDeadlineSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">15</span> <span class=\"token comment\"># 设置 Pod 运行的超时时间</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">backoffLimit</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span> <span class=\"token comment\"># 设置 Pod 的失败重试次数</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">completions</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4</span> <span class=\"token comment\"># Job 完成需要运行多少个 Pod，默认是 1 个</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">parallelism</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span> <span class=\"token comment\"># 它与 completions 相关，表示允许并发运行的 Pod 数量，避免过多占用资源。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 这 4 个字段并不在 template 字段下，而是在 spec 字段下，所以它们是属于 Job 级别的，用来控制模板里的 Pod 对象。</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">restartPolicy</span><span class=\"token punctuation\">:</span> OnFailure <span class=\"token comment\"># 失败原地重启容器</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> echo<span class=\"token punctuation\">-</span>job</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>          <span class=\"token punctuation\">-</span> sh</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>          <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>c</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>          <span class=\"token punctuation\">-</span> sleep $(($RANDOM % 10 + 1)) <span class=\"token important\">&amp;&amp;</span> echo done</pre></td></tr></table></figure><h1 id=\"cronjob-定时任务\"><a class=\"anchor\" href=\"#cronjob-定时任务\">#</a> CronJob-&quot;定时任务&quot;</h1>\n<ul>\n<li>简写  <code>cj</code></li>\n<li><code>CronJob</code>  需要定时运行，所以我们在命令行里还需要指定参数  <code>--schedule</code></li>\n</ul>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> batch/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> CronJob</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> echo<span class=\"token punctuation\">-</span>cj</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">schedule</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'*/1 * * * *'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">jobTemplate</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>          <span class=\"token key atrule\">restartPolicy</span><span class=\"token punctuation\">:</span> OnFailure</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>          <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>          <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> echo<span class=\"token punctuation\">-</span>cj</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/bin/echo\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"hello\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"world\"</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p>连续三个 spec 嵌套：</p>\n<ul>\n<li>第一个  <code>spec</code>  是 CronJob 自己的对象规格声明</li>\n<li>第二个  <code>spec</code>  从属于 “jobTemplate”，它定义了一个 Job 对象。</li>\n<li>第三个  <code>spec</code>  从属于 “template”，它定义了 Job 里运行的 Pod。</li>\n</ul>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/vQ2K7jHtxh4WzBy.png\" alt=\"cj.png\" /></p>\n<ul>\n<li>除了定义 Job 对象的 “<strong>jobTemplate</strong>” 字段之外，CronJob 还有一个新字段就是 “<strong>schedule</strong>”，用来定义任务周期运行的规则。</li>\n</ul>\n<h1 id=\"configmapsecret\"><a class=\"anchor\" href=\"#configmapsecret\">#</a> ConfigMap/Secret</h1>\n<p>数据安全的角度来看可以分成两类：</p>\n<ul>\n<li>\n<p>一类是明文配置，也就是不保密，可以任意查询修改，比如服务端口、运行参数、文件路径等等。</p>\n</li>\n<li>\n<p>另一类则是机密配置，由于涉及敏感信息需要保密，不能随便查看，比如密码、密钥、证书等等。</p>\n</li>\n</ul>\n<p><strong>ConfigMap</strong> 用来保存明文配置，<strong>Secret</strong> 用来保存秘密配置 。</p>\n<h2 id=\"configmap\"><a class=\"anchor\" href=\"#configmap\">#</a> ConfigMap</h2>\n<h3 id=\"样板\"><a class=\"anchor\" href=\"#样板\">#</a> 样板</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> info</pre></td></tr></table></figure><ul>\n<li>\n<p>没有  <code>spec</code>  字段</p>\n</li>\n<li>\n<p>存储配置数据，不是容器，是静态的字符串</p>\n</li>\n</ul>\n<h3 id=\"data-字段\"><a class=\"anchor\" href=\"#data-字段\">#</a> data 字段</h3>\n<p>生成带有 “data” 字段的 YAML 样板：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl create cm info --from-literal<span class=\"token operator\">=</span>k<span class=\"token operator\">=</span>v <span class=\"token variable\">$out</span></pre></td></tr></table></figure><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> info</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">count</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'10'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">debug</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'on'</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'/etc/systemd'</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">greeting</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    say hello to kubernetes.</span></pre></td></tr></table></figure><p><strong>执行</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl apply <span class=\"token parameter variable\">-f</span> cm.yml</pre></td></tr></table></figure><p>用  <code>kubectl get</code>  、  <code>kubectl describe</code>  来查看 ConfigMap 的状态：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl get cm</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl describe cm info</pre></td></tr></table></figure><h2 id=\"secret\"><a class=\"anchor\" href=\"#secret\">#</a> Secret</h2>\n<p>它和 ConfigMap 的结构和用法很类似，不过在 Kubernetes 里 Secret 对象又细分出很多类，比如：</p>\n<ul>\n<li>\n<p>访问私有镜像仓库的认证信息</p>\n</li>\n<li>\n<p>身份识别的凭证信息</p>\n</li>\n<li>\n<p>HTTPS 通信的证书和私钥</p>\n</li>\n<li>\n<p>一般的机密信息（格式由用户自行解释）</p>\n</li>\n</ul>\n<h3 id=\"样板-2\"><a class=\"anchor\" href=\"#样板-2\">#</a> 样板</h3>\n<p>创建 YAML 样板：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl create secret generic user --from-literal<span class=\"token operator\">=</span>name<span class=\"token operator\">=</span>root <span class=\"token variable\">$out</span></pre></td></tr></table></figure><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Secret</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> user</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm9vdA==</pre></td></tr></table></figure><ul>\n<li>name 后面不是 root，而是乱码，实际上经过了 base64 加密。</li>\n</ul>\n<p>也可以自己加密，写成 yaml 文件：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token parameter variable\">-n</span> <span class=\"token string\">\"123456\"</span> <span class=\"token operator\">|</span> base64</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>MTIzNDU2</pre></td></tr></table></figure><ul>\n<li><code>-n</code>  用于去掉隐藏的换行符</li>\n</ul>\n<p>创建和查看：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl apply  <span class=\"token parameter variable\">-f</span> secret.yml</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl get secret</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>kubectl describe secret user</pre></td></tr></table></figure><h2 id=\"如何使用\"><a class=\"anchor\" href=\"#如何使用\">#</a> 如何使用</h2>\n<p>因为 ConfigMap 和 Secret 只是一些存储在 etcd 里的字符串，所以如果想要在运行时产生效果，就必须要以某种方式 “注入” 到 Pod 里，让应用去读取。</p>\n<h3 id=\"环境变量\"><a class=\"anchor\" href=\"#环境变量\">#</a> 环境变量</h3>\n<p><code>containers</code>  里有一个  <code>env</code>  , 除了可以使用简单的  <code>value</code>  , 还可以使用  <code>valueFrom</code></p>\n<ul>\n<li>\n<p>“<strong>valueFrom</strong>” 字段指定了环境变量值的来源，可以是 “<strong>configMapKeyRef</strong>” 或者 “<strong>secretKeyRef</strong>”，然后你要再进一步指定应用的 <strong>ConfigMap/Secret</strong> 的 “<strong>name</strong>” 和它里面的 “<strong>key</strong>”。</p>\n</li>\n<li>\n<p>要当心的是这个 “name” 字段是 API 对象的名字，而不是 Key-Value 的名字。</p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> env<span class=\"token punctuation\">-</span>pod</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> COUNT</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>          <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> info</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> count</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> GREETING</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>          <span class=\"token key atrule\">configMapKeyRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> info</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> greeting</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> USERNAME</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>          <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> user</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> name</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PASSWORD</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token key atrule\">valueFrom</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token key atrule\">secretKeyRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> user</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> pwd</pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> busy</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/bin/sleep\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"300\"</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p><img data-src=\"https://s2.loli.net/2024/02/17/vnkFKwBHqEN3iZD.png\" alt=\"cm.png\" /></p>\n<p>弄清楚了环境变量的注入方式之后，让我们用  <code>kubectl apply</code>  创建 Pod，再用  <code>kubectl exec</code>  进入 Pod，验证环境变量是否生效：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl apply <span class=\"token parameter variable\">-f</span> env-pod.yml</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl get pod</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> env-pod -- <span class=\"token function\">sh</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$COUNT</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$GREETING</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>say hello to kubernetes</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token builtin class-name\">echo</span> <span class=\"token variable\">$USERNAME</span> <span class=\"token variable\">$PASSWORD</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>root <span class=\"token number\">123456</span></pre></td></tr></table></figure><h3 id=\"volume-存储卷\"><a class=\"anchor\" href=\"#volume-存储卷\">#</a> Volume - 存储卷</h3>\n<p>如果把 Pod 理解成是一个虚拟机，那么 Volume 就相当于是虚拟机里的磁盘。 我们可以为 Pod“挂载（mount）” 多个 Volume，里面存放供 Pod 访问的数据 。</p>\n<ul>\n<li>只需要在  <code>spec</code>  里增加一个  <code>volumes</code>  字段</li>\n</ul>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> vol<span class=\"token punctuation\">-</span>pod</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>vol</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">configMap</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> info</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sec<span class=\"token punctuation\">-</span>vol</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">secret</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token key atrule\">secretName</span><span class=\"token punctuation\">:</span> user</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /tmp/cm<span class=\"token punctuation\">-</span>items <span class=\"token comment\"># 指定挂载路径</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> cm<span class=\"token punctuation\">-</span>vol <span class=\"token comment\"># 指定 volume 名称</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /tmp/sec<span class=\"token punctuation\">-</span>items</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> sec<span class=\"token punctuation\">-</span>vol</pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> busybox</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> busy</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"/bin/sleep\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"300\"</span><span class=\"token punctuation\">]</span></pre></td></tr></table></figure><p><img data-src=\"https://s2.loli.net/2024/02/17/kw9MJHrBy3AVe6q.png\" alt=\"\" /></p>\n<p>进去看看：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl apply <span class=\"token parameter variable\">-f</span> vol-pod.yml</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl get pod</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>kubectl <span class=\"token builtin class-name\">exec</span> <span class=\"token parameter variable\">-it</span> vol-pod -- <span class=\"token function\">sh</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>/ <span class=\"token comment\"># ls /tmp/cm-items/</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>count debug greeting path</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>/ <span class=\"token comment\"># cat /tmp/cm-items/greeting</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>say hello to kubernetes.</pre></td></tr></table></figure><h2 id=\"总结\"><a class=\"anchor\" href=\"#总结\">#</a> 总结</h2>\n<p>ConfigMap 和 Secret 对存储数据的大小没有限制，但小数据用环境变量比较适合，大数据应该用存储卷，可根据具体场景灵活应用。</p>\n<h1 id=\"deployment\"><a class=\"anchor\" href=\"#deployment\">#</a> Deployment</h1>\n<p>能够创建任意多个的 Pod 实例，并且维护这些 Pod 的正常运行，保证应用始终处于可用状态。</p>\n<h2 id=\"样板-3\"><a class=\"anchor\" href=\"#样板-3\">#</a> 样板</h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>alpine</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx</pre></td></tr></table></figure><ul>\n<li>它的 “spec” 部分多了  <code>replicas</code>  、  <code>selector</code>  这两个新字段</li>\n</ul>\n<h2 id=\"字段-2\"><a class=\"anchor\" href=\"#字段-2\">#</a> 字段</h2>\n<h3 id=\"replicas\"><a class=\"anchor\" href=\"#replicas\">#</a> replicas</h3>\n<p>万一有 Pod 发生意外消失了，数量不满足 “期望状态”，它就会通过 apiserver、scheduler 等核心组件去选择新的节点，创建出新的 Pod，直至数量与 “期望状态” 一致。</p>\n<h3 id=\"selector\"><a class=\"anchor\" href=\"#selector\">#</a> selector</h3>\n<p>通过标签这种设计，Kubernetes 就解除了 Deployment 和模板里 Pod 的强绑定，把组合关系变成了 “弱引用”。</p>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/FUoZQCGB47LvMwS.png\" alt=\"dep.png\" /></p>\n<h3 id=\"应用伸缩\"><a class=\"anchor\" href=\"#应用伸缩\">#</a> 应用伸缩</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl scale <span class=\"token parameter variable\">--replicas</span><span class=\"token operator\">=</span><span class=\"token number\">5</span> deploy ngx-dep</pre></td></tr></table></figure><h1 id=\"daemonset\"><a class=\"anchor\" href=\"#daemonset\">#</a> DaemonSet</h1>\n<p>但是有一些业务比较特殊，它们不是完全独立于系统运行的，而是与主机存在 “绑定” 关系，必须要依附于节点才能产生价值，比如说：</p>\n<ul>\n<li>\n<p>网络应用（如 kube-proxy），必须每个节点都运行一个 Pod，否则节点就无法加入 Kubernetes 网络。</p>\n</li>\n<li>\n<p>监控应用（如 Prometheus），必须每个节点都有一个 Pod 用来监控节点的状态，实时上报信息。</p>\n</li>\n<li>\n<p>日志应用（如 Fluentd），必须在每个节点上运行一个 Pod，才能够搜集容器运行时产生的日志数据。</p>\n</li>\n<li>\n<p>安全应用，同样的，每个节点都要有一个 Pod 来执行安全审计、入侵检查、漏洞扫描等工作。</p>\n</li>\n</ul>\n<h2 id=\"样板-4\"><a class=\"anchor\" href=\"#样板-4\">#</a> 样板</h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> DaemonSet</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>ds</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>ds</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>ds</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>ds</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">:</span>5<span class=\"token punctuation\">-</span>alpine</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span></pre></td></tr></table></figure><ul>\n<li>没有 replicas</li>\n</ul>\n<h2 id=\"污点和容忍度\"><a class=\"anchor\" href=\"#污点和容忍度\">#</a> 污点和容忍度</h2>\n<h3 id=\"查看-master-和-worker-的状态\"><a class=\"anchor\" href=\"#查看-master-和-worker-的状态\">#</a> 查看 Master 和 Worker 的状态</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl describe <span class=\"token function\">node</span></pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl describe <span class=\"token function\">node</span> master</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>Name:     master</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>Roles:    control-plane,master</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>Taints:   node-role.kubernetes.io/master:NoSchedule</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>kubectl describe <span class=\"token function\">node</span> worker</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>Name:     worker</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>Roles:    <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>Taints:   <span class=\"token operator\">&lt;</span>none<span class=\"token operator\">></span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">..</span>.</pre></td></tr></table></figure><p>Master 节点默认有一个  <code>taint</code>  ，名字是 <code>node-role.kubernetes.io/master</code> ，它的效果是  <code>NoSchedule</code>  ，也就是说这个污点会拒绝 Pod 调度到本节点上运行，而 Worker 节点的  <code>taint</code>  字段则是空的。</p>\n<h2 id=\"怎么让-daemonset-在-master-节点或者任意其他节点上运行了\"><a class=\"anchor\" href=\"#怎么让-daemonset-在-master-节点或者任意其他节点上运行了\">#</a> 怎么让 DaemonSet 在 Master 节点（或者任意其他节点）上运行了？</h2>\n<h3 id=\"去除污点\"><a class=\"anchor\" href=\"#去除污点\">#</a> 去除污点</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl taint <span class=\"token function\">node</span> master node-role.kubernetes.io/master:NoSchedule-node/master untainted</pre></td></tr></table></figure><h3 id=\"添加-pod-字段-tolerations\"><a class=\"anchor\" href=\"#添加-pod-字段-tolerations\">#</a> 添加 pod 字段 tolerations</h3>\n<p>如果我们想让 DaemonSet 里的 Pod 能够在 Master 节点上运行，就要写出这样的一个  <code>tolerations</code>  ，容忍节点的  <code>node-role.kubernetes.io/master:NoSchedule</code>  这个污点：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">tolerations</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">key</span><span class=\"token punctuation\">:</span> node<span class=\"token punctuation\">-</span>role.kubernetes.io/master</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">effect</span><span class=\"token punctuation\">:</span> NoSchedule</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">operator</span><span class=\"token punctuation\">:</span> Exists</pre></td></tr></table></figure><h3 id=\"添加污点\"><a class=\"anchor\" href=\"#添加污点\">#</a> (添加污点)</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl taint <span class=\"token function\">node</span> master node-role.kubernetes.io/master:NoSchedule</pre></td></tr></table></figure><h1 id=\"service\"><a class=\"anchor\" href=\"#service\">#</a> Service</h1>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/QrpTktueWZ2gVcn.png\" alt=\"service.png\" /></p>\n<p><strong>虽然它可以自动创建 YAML 样板，但不是用命令</strong>  <code>kubectl create</code>  ，<strong>而是另外一个命令</strong>  <code>kubectl expose</code>  ，也许 Kubernetes 认为 “expose” 能够更好地表达 Service “暴露” 服务地址的意思吧。</p>\n<ul>\n<li><code>kubectl expose</code>  支持从多种对象创建服务，Pod、Deployment、DaemonSet 都可以。</li>\n</ul>\n<p>使用  <code>kubectl expose</code>  指令时还需要用参数  <code>--port</code>  和  <code>--target-port</code>  分别指定映射端口和容器端口，而 Service 自己的 IP 地址和后端 Pod 的 IP 地址可以自动生成 。</p>\n<h2 id=\"样板-5\"><a class=\"anchor\" href=\"#样板-5\">#</a> 样板</h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>svc</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span> <span class=\"token comment\"># 外部端口</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span> <span class=\"token comment\"># 内部端口</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP <span class=\"token comment\"># 使用的协议</span></pre></td></tr></table></figure><p><img data-src=\"https://s2.loli.net/2024/02/17/tAlPzc4NL6iVMFm.png\" alt=\"service1.png\" /></p>\n<h2 id=\"以域名的方式使用-service\"><a class=\"anchor\" href=\"#以域名的方式使用-service\">#</a> 以域名的方式使用 service</h2>\n<p>查看命名空间</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl get ns</pre></td></tr></table></figure><p>Service 对象的域名完全形式是 “<strong>对象。名字空间.svc.cluster.local</strong>”，但很多时候也可以省略后面的部分，直接写 “<strong>对象。名字空间</strong>” 甚至 “<strong>对象名</strong>” 就足够了，默认会使用对象所在的名字空间 。</p>\n<h2 id=\"让-service-对外暴露\"><a class=\"anchor\" href=\"#让-service-对外暴露\">#</a> 让 Service 对外暴露</h2>\n<p>Service 对象有一个关键字段 <strong>“type”</strong>，表示 Service 是哪种类型的负载均衡。前面我们看到的用法都是对集群内部 Pod 的负载均衡，所以这个字段的值就是默认的 <strong>“ClusterIP”</strong>，Service 的静态 IP 地址只能在集群内访问。</p>\n<p>如果我们在使用命令  <code>kubectl expose</code>  的时候加上参数  <code>--type=NodePort</code>  ，或者在 YAML 里添加字段  <code>type:NodePort</code>  ，那么 Service 除了会对后端的 Pod 做负载均衡之外，还会在集群里的每个节点上创建一个独立的端口，用这个端口对外提供服务，这也正是 “NodePort” 这个名字的由来。</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">...</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token punctuation\">...</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort</pre></td></tr></table></figure><p><img data-src=\"https://s2.loli.net/2024/02/17/soa4nCl3FArhYJE.png\" alt=\"service2.png\" /></p>\n<h1 id=\"ingressingress-class\"><a class=\"anchor\" href=\"#ingressingress-class\">#</a> Ingress/Ingress Class</h1>\n<h2 id=\"ingress\"><a class=\"anchor\" href=\"#ingress\">#</a> Ingress</h2>\n<h3 id=\"样板-6\"><a class=\"anchor\" href=\"#样板-6\">#</a> 样板</h3>\n<p>两个附加参数：</p>\n<ul>\n<li>\n<p><code>--class</code>  ，指定 Ingress 从属的 Ingress Class 对象。</p>\n</li>\n<li>\n<p><code>--rule</code>  ，指定路由规则，基本形式是 “URI=Service”，也就是说是访问 HTTP 路径就转发到对应的 Service 对象，再由 Service 对象转发给后端的 Pod。</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">export</span> <span class=\"token assign-left variable\">out</span><span class=\"token operator\">=</span><span class=\"token string\">\"--dry-run=client -o yaml\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl create ing ngx-ing <span class=\"token parameter variable\">--rule</span><span class=\"token operator\">=</span><span class=\"token string\">\"ngx.test/=ngx-svc:80\"</span> <span class=\"token parameter variable\">--class</span><span class=\"token operator\">=</span>ngx-ink <span class=\"token variable\">$out</span></pre></td></tr></table></figure><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>ing</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">ingressClassName</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>ink</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  </pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> ngx.test</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> Exact <span class=\"token comment\"># 路径的匹配方式 Exact 精确匹配 Prefix 前缀匹配</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>          <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>svc</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>              <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr></table></figure><h2 id=\"ingress-class\"><a class=\"anchor\" href=\"#ingress-class\">#</a> Ingress Class</h2>\n<h3 id=\"样板-7\"><a class=\"anchor\" href=\"#样板-7\">#</a> 样板</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> IngressClass</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>ink</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">controller</span><span class=\"token punctuation\">:</span> nginx.org/ingress<span class=\"token punctuation\">-</span>controller</pre></td></tr></table></figure><p><code>spec</code>  里只有一个必需的字段  <code>controller</code>  ，表示要使用哪个 Ingress Controller，具体的名字就要看实现文档了。</p>\n<p>比如，如果我要用 Nginx 开发的 Ingress Controller，那么就要用名字  <code>nginx.org/ingress-controller</code></p>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/TWDyuRnOANkSgVz.png\" alt=\"ingress.png\" /></p>\n<h2 id=\"使用\"><a class=\"anchor\" href=\"#使用\">#</a> 使用</h2>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/QN86ZvV49WCmcGz.png\" alt=\"ingress0.png\" /></p>\n<h1 id=\"wordpress-部署\"><a class=\"anchor\" href=\"#wordpress-部署\">#</a> WordPress 部署</h1>\n<h2 id=\"部署-mariadb\"><a class=\"anchor\" href=\"#部署-mariadb\">#</a> 部署 MariaDB</h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> maria<span class=\"token punctuation\">-</span>cm</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">DATABASE</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'db'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">USER</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'wp'</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'123'</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'123'</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\"># 先要用 ConfigMap 定义数据库的环境变量，有 DATABASE、USER、PASSWORD、ROOT_PASSWORD</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> maria<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> maria<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> maria<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> maria<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mariadb<span class=\"token punctuation\">:</span><span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> mariadb</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token key atrule\">envFrom</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">prefix</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'MARIADB_'</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>          <span class=\"token key atrule\">configMapRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> maria<span class=\"token punctuation\">-</span>cm</pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\"># 为 MariaDB 定义一个 Service 对象，映射端口 3306</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token comment\"># 让其他应用不再关心 IP 地址，直接用 Service 对象的名字来访问数据库服务</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service</pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> maria<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> maria<span class=\"token punctuation\">-</span>svc</pre></td></tr><tr><td data-num=\"51\"></td><td><pre></pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3306</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> maria<span class=\"token punctuation\">-</span>dep</pre></td></tr></table></figure><h3 id=\"部署-wordpress\"><a class=\"anchor\" href=\"#部署-wordpress\">#</a> 部署 WordPress</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 因为刚才创建了 MariaDB 的 Service，所以在写 ConfigMap 配置的时候 “HOST” 就不应该是 IP 地址了，而应该是 DNS 域名，也就是 Service 的名字 maria-svc，这点需要特别注意</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>cm</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">HOST</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'maria-svc'</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">USER</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'wp'</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'123'</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token key atrule\">NAME</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'db'</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># WordPress 的 Deployment 写法和 MariaDB 也是一样的，给 Pod 套一个 Deployment 的 “外壳”，replicas 设置成 2 个，用字段 “envFrom” 配置环境变量。</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> wordpress<span class=\"token punctuation\">:</span><span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wordpress</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token key atrule\">envFrom</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">prefix</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'WORDPRESS_DB_'</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>          <span class=\"token key atrule\">configMapRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>cm</pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token comment\"># 然后我们仍然要为 WordPress 创建 Service 对象，这里我使用了 “NodePort” 类型，并且手工指定了端口号 “30088”（必须在 30000~32767 之间）</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>svc</pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> http80</pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>    <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</pre></td></tr><tr><td data-num=\"56\"></td><td><pre>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token key atrule\">nodePort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">30088</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> NodePort</pre></td></tr></table></figure><h3 id=\"部署-nginx-ingress-controller\"><a class=\"anchor\" href=\"#部署-nginx-ingress-controller\">#</a> 部署 Nginx Ingress Controller</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 首先我们需要定义 Ingress Class，名字就叫 “wp-ink”</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> IngressClass</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>ink</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">controller</span><span class=\"token punctuation\">:</span> nginx.org/ingress<span class=\"token punctuation\">-</span>controller</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\"># kubectl create ing wp-ing --rule=\"wp.test/=wp-svc:80\" --class=wp-ink $out</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> networking.k8s.io/v1</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Ingress</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>ing</pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>  <span class=\"token key atrule\">ingressClassName</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>ink</pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">host</span><span class=\"token punctuation\">:</span> wp.test</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">http</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token key atrule\">paths</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token key atrule\">pathType</span><span class=\"token punctuation\">:</span> Prefix</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token key atrule\">backend</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>          <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>svc</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>              <span class=\"token key atrule\">number</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\"># 接下来就是最关键的 Ingress Controller 对象了，它仍然需要从 Nginx 项目的示例 YAML 修改而来，要改动名字、标签，还有参数里的 Ingress Class。</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\"># 在之前讲基本架构的时候我说过了，这个 Ingress Controller 不使用 Service，而是给它的 Pod 加上一个特殊字段 hostNetwork，让 Pod 能够使用宿主机的网络，相当于另一种形式的 NodePort。</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>kic<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>ingress</pre></td></tr><tr><td data-num=\"39\"></td><td><pre></pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>kic<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"45\"></td><td><pre></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> wp<span class=\"token punctuation\">-</span>kic<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>      <span class=\"token key atrule\">serviceAccountName</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>ingress</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>      </pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token key atrule\">hostNetwork</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx/nginx<span class=\"token punctuation\">-</span>ingress<span class=\"token punctuation\">:</span>2.2<span class=\"token punctuation\">-</span>alpine</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">-</span>ingress</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>        <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>          <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span>ingress<span class=\"token punctuation\">-</span>class=wp<span class=\"token punctuation\">-</span>ink</pre></td></tr></table></figure><h1 id=\"数据持久化\"><a class=\"anchor\" href=\"#数据持久化\">#</a> 数据持久化</h1>\n<h2 id=\"persistentvolume\"><a class=\"anchor\" href=\"#persistentvolume\">#</a> PersistentVolume</h2>\n<ul>\n<li>由于临时存储，pod 销毁后数据会丢失</li>\n<li><code>PersistentVolume</code>  对象，它专门用来表示持久存储设备，但隐藏了存储的底层实现</li>\n<li>PV 属于集群的系统资源，是和 Node 平级的一种对象，Pod 对它没有管理权，只有使用权</li>\n</ul>\n<h2 id=\"persistentvolumeclaim\"><a class=\"anchor\" href=\"#persistentvolumeclaim\">#</a> PersistentVolumeClaim</h2>\n<p><code>PersistentVolumeClaim</code>  ，简称 PVC，从名字上看比较好理解，就是用来向 Kubernetes 申请存储资源的。PVC 是给 Pod 使用的对象，它相当于是 Pod 的代理，代表 Pod 向系统申请 PV。一旦资源申请成功，Kubernetes 就会把 PV 和 PVC 关联在一起，这个动作叫做 <strong>“绑定”</strong>（bind）。</p>\n<h2 id=\"storageclass\"><a class=\"anchor\" href=\"#storageclass\">#</a> StorageClass</h2>\n<p>它抽象了特定类型的存储系统（比如 Ceph、NFS），在 PVC 和 PV 之间充当 “协调人” 的角色，帮助 PVC 找到合适的 PV。也就是说它可以简化 Pod 挂载 “虚拟盘” 的过程，让 Pod 看不到 PV 的实现细节。</p>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/BwKCOmptfjrGNou.png\" alt=\"\" /></p>\n<h2 id=\"描述-pv\"><a class=\"anchor\" href=\"#描述-pv\">#</a> 描述 PV</h2>\n<h3 id=\"样板-8\"><a class=\"anchor\" href=\"#样板-8\">#</a> 样板</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolume</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> host<span class=\"token punctuation\">-</span>10m<span class=\"token punctuation\">-</span>pv</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> host<span class=\"token punctuation\">-</span>test</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">-</span> ReadWriteOnce</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">capacity</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 10Mi</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">hostPath</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /tmp/host<span class=\"token punctuation\">-</span>10m<span class=\"token punctuation\">-</span>pv/</pre></td></tr></table></figure><p>因为 Pod 会在集群的任意节点上运行，所以首先，我们要作为系统管理员在每个节点上创建一个目录，它将会作为本地存储卷挂载到 Pod 里。</p>\n<h3 id=\"字段解释\"><a class=\"anchor\" href=\"#字段解释\">#</a> 字段解释</h3>\n<ul>\n<li>\n<p><strong>storageClassName</strong> 对存储类型的抽象  <code>StorageClass</code></p>\n</li>\n<li>\n<p><strong>accessModes</strong> 定义了存储设备的访问模式，简单来说就是虚拟盘的读写权限，和 Linux 的文件访问模式差不多，目前 Kubernetes 里有 3 种：</p>\n<ul>\n<li>ReadWriteOnce：存储卷可读可写，但只能被一个节点上的 Pod 挂载。</li>\n<li>ReadOnlyMany：存储卷只读不可写，可以被任意节点上的 Pod 多次挂载。</li>\n<li>ReadWriteMany：存储卷可读可写，也可以被任意节点上的 Pod 多次挂载。</li>\n</ul>\n<p>这 3 种访问模式限制的对象是节点而不是 Pod</p>\n<p>显然，本地目录只能是在本机使用，所以这个 PV 使用了  <code>ReadWriteOnce</code></p>\n</li>\n<li>\n<p><strong>capacity 表示存储设备的容量</strong>（Kubernetes 里定义存储容量使用的是国际标准，我们日常习惯使用的 KB/MB/GB 的基数是 1024，<strong>要写成 Ki/Mi/Gi</strong>，一定要小心不要写错了，否则单位不一致实际容量就会对不上。）</p>\n</li>\n<li>\n<p><strong>hostPath</strong> 指定了存储卷的本地路径，也就是我们在节点上创建的目录。</p>\n</li>\n</ul>\n<h2 id=\"描述-pvc\"><a class=\"anchor\" href=\"#描述-pvc\">#</a> 描述 PVC</h2>\n<h3 id=\"样板-9\"><a class=\"anchor\" href=\"#样板-9\">#</a> 样板</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> host<span class=\"token punctuation\">-</span>5m<span class=\"token punctuation\">-</span>pvc</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> host<span class=\"token punctuation\">-</span>test</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">-</span> ReadWriteOnce</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 5Mi</pre></td></tr></table></figure><h3 id=\"字段解释-2\"><a class=\"anchor\" href=\"#字段解释-2\">#</a> 字段解释</h3>\n<p>PVC 的内容与 PV 很像，但它不表示实际的存储，而是一个 “申请” 或者 “声明”，spec 里的字段描述的是对存储的 “期望状态”</p>\n<ul>\n<li>\n<p><code>storageClassName</code>   <code>accessModes</code>    <code>capacity</code>  和 PV 一样没有 <code>capacity</code></p>\n</li>\n<li>\n<p><strong>resources.request</strong> 表示希望要有多大的容量</p>\n</li>\n</ul>\n<p>这样，Kubernetes 就会根据 PVC 里的描述，去找能够匹配 StorageClass 和容量的 PV，然后把 PV 和 PVC “绑定” 在一起，实现存储的分配 。</p>\n<h2 id=\"使用-2\"><a class=\"anchor\" href=\"#使用-2\">#</a> 使用</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 创建 PV 对象</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl apply <span class=\"token parameter variable\">-f</span> host-path-pv.yml</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 查看状态</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>kubectl get <span class=\"token function\">pv</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 创建 PVC 对象，申请储存资源</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>kubectl apply <span class=\"token parameter variable\">-f</span> host-path-pvc.yml</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>kubectl get pvc</pre></td></tr></table></figure><p>一旦 PVC 对象创建成功，Kubernetes 就会立即通过 StorageClass、resources 等条件在集群里查找符合要求的 PV，如果找到合适的存储对象就会把它俩 <strong>“绑定”</strong> 在一起。</p>\n<h2 id=\"为-pod-挂载-pv\"><a class=\"anchor\" href=\"#为-pod-挂载-pv\">#</a> 为 Pod 挂载 PV</h2>\n<ul>\n<li>\n<p>先要在  <code>spec.volumes</code>  定义存储卷，然后在  <code>containers.volumeMounts</code>  挂载进容器</p>\n</li>\n<li>\n<p><strong>要在 volumes 里用字段 persistentVolumeClaim 指定 PVC 的名字</strong></p>\n</li>\n</ul>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> host<span class=\"token punctuation\">-</span>pvc<span class=\"token punctuation\">-</span>pod</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> host<span class=\"token punctuation\">-</span>pvc<span class=\"token punctuation\">-</span>vol</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">persistentVolumeClaim</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">claimName</span><span class=\"token punctuation\">:</span> host<span class=\"token punctuation\">-</span>5m<span class=\"token punctuation\">-</span>pvc <span class=\"token comment\"># 指定 PVC 名字</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>pvc<span class=\"token punctuation\">-</span>pod</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>alpine</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> host<span class=\"token punctuation\">-</span>pvc<span class=\"token punctuation\">-</span>vol</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /tmp <span class=\"token comment\"># 挂载路径</span></pre></td></tr></table></figure><p><img data-src=\"https://s2.loli.net/2024/02/17/359FpSt8QGqcMXk.png\" alt=\"pv.png\" /></p>\n<p>因为 Pod 产生的数据已经通过 PV 存在了磁盘上，所以如果 Pod 删除后再重新创建，挂载存储卷时会依然使用这个目录，数据保持不变，也就实现了持久化存储。</p>\n<h2 id=\"缺点\"><a class=\"anchor\" href=\"#缺点\">#</a> 缺点</h2>\n<ul>\n<li>因为这个 PV 是 HostPath 类型，只在本节点存储，如果 Pod 重建时被调度到了其他节点上，那么即使加载了本地目录，也不会是之前的存储位置，持久化功能也就失效了</li>\n<li>所以，HostPath 类型的 PV 一般用来做测试，或者是用于 DaemonSet 这样与节点关系比较密切的应用</li>\n</ul>\n<h2 id=\"总结-2\"><a class=\"anchor\" href=\"#总结-2\">#</a> 总结</h2>\n<ol>\n<li>\n<p>PersistentVolume 简称为 PV，是 Kubernetes 对存储设备的抽象，由系统管理员维护，需要描述清楚存储设备的类型、访问模式、容量等信息。</p>\n</li>\n<li>\n<p>PersistentVolumeClaim 简称为 PVC，代表 Pod 向系统<strong>申请存储资源</strong>，它声明对存储的要求，Kubernetes 会查找<strong>最合适</strong>的 PV 然后绑定。</p>\n</li>\n<li>\n<p>StorageClass 抽象特定类型的存储系统，归类分组 PV 对象，用来<strong>简化 PV/PVC 的绑定过程</strong>。</p>\n</li>\n<li>\n<p>HostPath 是<strong>最简单</strong>的一种 PV，数据存储在节点本地，速度快但<strong>不能跟随 Pod 迁移</strong>。</p>\n</li>\n</ol>\n<h1 id=\"pvnfs-网络共享存储\"><a class=\"anchor\" href=\"#pvnfs-网络共享存储\">#</a> PV+NFS - 网络共享存储</h1>\n<h2 id=\"安装-nfs-服务器和客户端\"><a class=\"anchor\" href=\"#安装-nfs-服务器和客户端\">#</a> 安装 NFS 服务器和客户端</h2>\n<p>详见同一类别下另一篇</p>\n<h2 id=\"使用-nfs-存储卷\"><a class=\"anchor\" href=\"#使用-nfs-存储卷\">#</a> 使用 NFS 存储卷</h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># nfs-static-pv.yml</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolume</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>1g<span class=\"token punctuation\">-</span>pv</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> nfs</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">-</span> ReadWriteMany</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">capacity</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 1Gi</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">nfs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /tmp/nfs/1g<span class=\"token punctuation\">-</span>pv <span class=\"token comment\"># 共享目录名，路径须提前在服务端创建好</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span> 192.168.10.104 <span class=\"token comment\"># 服务端主机</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\"># 注意：不需要挂载本机目录</span></pre></td></tr></table></figure><ul>\n<li>\n<p>需要指定  <code>storageClassName</code>  是  <code>nfs</code>  ，而  <code>accessModes</code>  可以设置成  <code>ReadWriteMany</code>  ，这是由  <code>NFS</code>  的特性决定的，它支持多个节点同时访问一个共享目录</p>\n</li>\n<li>\n<p>因为这个存储卷是  <code>NFS</code>  系统，所以我们还需要在  <code>YAML</code>  里添加  <code>nfs</code>  字段，指定  <code>NFS</code>  服务器的  <code>IP</code>  地址和共享目录名</p>\n</li>\n<li>\n<p>这里在  <code>NFS</code>  服务器的  <code>/tmp/nfs</code>  目录里又创建了一个新的目录  <code>1g-pv</code>  ，表示分配了 1GB 的可用存储空间，相应的，  <code>PV</code>  里的  <code>capacity</code>  也要设置成同样的数值，也就是 1Gi</p>\n</li>\n</ul>\n<p><strong>用 pvc 申请储存</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># nfs-static-pvc.yml</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>static<span class=\"token punctuation\">-</span>pvc</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> nfs</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">-</span> ReadWriteMany</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 1Gi</pre></td></tr></table></figure><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># nfs-static-pod.yml</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>static<span class=\"token punctuation\">-</span>pod</pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>pvc<span class=\"token punctuation\">-</span>vol</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">persistentVolumeClaim</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">claimName</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>static<span class=\"token punctuation\">-</span>pvc</pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>pvc<span class=\"token punctuation\">-</span>test</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>alpine</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>pvc<span class=\"token punctuation\">-</span>vol</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>          <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /tmp <span class=\"token comment\"># 把 pod 的 /tmp 目录挂载到 nfs 服务端   即 /tmp/ 数据会写入共享目录</span></pre></td></tr></table></figure><p><img data-src=\"https://s2.loli.net/2024/02/17/83VlJ472AcjsnGN.png\" alt=\"pvc.png\" /></p>\n<h2 id=\"部署-nfs-动态存储卷\"><a class=\"anchor\" href=\"#部署-nfs-动态存储卷\">#</a> 部署 NFS 动态存储卷</h2>\n<h2 id=\"使用-nfs-动态存储卷\"><a class=\"anchor\" href=\"#使用-nfs-动态存储卷\">#</a> 使用 NFS 动态存储卷</h2>\n<p>因为有了  <code>Provisioner</code>  ，我们就不再需要手工定义  <code>PV</code>  对象了，只需要在  <code>PVC</code>  里指定  <code>StorageClass</code>  对象，它再关联到  <code>Provisioner</code></p>\n<p>我们来看一下 NFS 默认的  <code>StorageClass</code>  定义：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> storage.k8s.io/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StorageClass</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">provisioner</span><span class=\"token punctuation\">:</span> k8s<span class=\"token punctuation\">-</span>sigs.io/nfs<span class=\"token punctuation\">-</span>subdir<span class=\"token punctuation\">-</span>external<span class=\"token punctuation\">-</span>provisioner </pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">parameters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">archiveOnDelete</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"false\"</span></pre></td></tr></table></figure><p>YAML 里的关键字段是 provisioner，它指定了应该使用哪个 Provisioner。另一个字段 parameters 是调节 Provisioner 运行的参数，需要参考文档来确定具体值，在这里的  <code>archiveOnDelete: &quot;false&quot;</code>  就是自动回收存储空间。</p>\n<p>你也可以不使用默认的 StorageClass，而是根据自己的需求，任意定制具有不同存储特性的 StorageClass，比如添加字段 onDelete: &quot;retain&quot; 暂时保留分配的存储，之后再手动删除：</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> storage.k8s.io/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StorageClass</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>retained</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">provisioner</span><span class=\"token punctuation\">:</span> k8s<span class=\"token punctuation\">-</span>sigs.io/nfs<span class=\"token punctuation\">-</span>subdir<span class=\"token punctuation\">-</span>external<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">parameters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">onDelete</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"retain\"</span></pre></td></tr></table></figure><p>接下来我们定义一个  <code>PVC</code>  ，向系统申请 10MB 的存储空间，使用的  <code>StorageClass</code>  是默认的  <code>nfs-client</code></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> PersistentVolumeClaim</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>dyn<span class=\"token punctuation\">-</span>10m<span class=\"token punctuation\">-</span>pvc</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">-</span> ReadWriteMany</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 10Mi</pre></td></tr></table></figure><p>写好了  <code>PVC</code>  ，我们还是在  <code>Pod</code>  里用  <code>volumes</code>  和  <code>volumeMounts</code>  挂载，然后  <code>Kubernetes</code>  就会自动找到  <code>NFS Provisioner</code>  ，在  <code>NFS</code>  的共享目录上创建出合适的  <code>PV</code>  对象</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>dyn<span class=\"token punctuation\">-</span>pod</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>dyn<span class=\"token punctuation\">-</span>10m<span class=\"token punctuation\">-</span>vol</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">persistentVolumeClaim</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">claimName</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>dyn<span class=\"token punctuation\">-</span>10m<span class=\"token punctuation\">-</span>pvcSnipaste_2024<span class=\"token punctuation\">-</span>02<span class=\"token punctuation\">-</span>13_18<span class=\"token punctuation\">-</span>04<span class=\"token punctuation\">-</span><span class=\"token number\">00</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>dyn<span class=\"token punctuation\">-</span>test</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>alpine</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>dyn<span class=\"token punctuation\">-</span>10m<span class=\"token punctuation\">-</span>vol</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>          <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /tmp</pre></td></tr></table></figure><p><img data-src=\"https://s2.loli.net/2024/02/17/Mlvc1brNP5dwoLG.png\" alt=\"\" /></p>\n<h2 id=\"总结-3\"><a class=\"anchor\" href=\"#总结-3\">#</a> 总结</h2>\n<p>本节我们引入了网络存储系统，以 NFS 为例研究了静态存储卷和动态存储卷的用法，其中的核心对象是 StorageClass 和 Provisioner。</p>\n<ol>\n<li>\n<p>在 Kubernetes 集群里，网络存储系统更适合数据持久化，NFS 是最容易使用的一种网络存储系统，要事先安装好服务端和客户端。</p>\n</li>\n<li>\n<p>可以编写 PV 手工定义 NFS 静态存储卷，要指定 NFS 服务器的 IP 地址和共享目录名。</p>\n</li>\n<li>\n<p>使用 NFS 动态存储卷<strong>必须要部署相应的 Provisioner</strong>，在 YAML 里正确配置 NFS 服务器。</p>\n</li>\n<li>\n<p>动态存储卷不需要手工定义 PV，而是要定义 StorageClass，<strong>由关联的 Provisioner 自动创建 PV 完成绑定</strong>。</p>\n</li>\n<li>\n<p>StorageClass 里面的 OnDelete 、 archiveOnDelete 源自 PV 的存储回收策略，指定 PV 被销毁时数据是保留 Retain 还是 删除 Delete。</p>\n</li>\n</ol>\n<h2 id=\"storageclass-的作用\"><a class=\"anchor\" href=\"#storageclass-的作用\">#</a> StorageClass 的作用</h2>\n<p>StorageClass 作用是帮助指定特定类型的 provisioner，这决定了你要使用的具体<strong>某种类型的存储插件</strong>；另外它还<strong>限定了 PV 和 PVC 的绑定关系</strong>，只有从属于同一 StorageClass 的 PV 和 PVC 才能做绑定动作，比如指定 GlusterFS 类型的 PVC 对象不能绑定到另外一个 PVC 定义的 NFS 类型的 StorageClass 模版创建出的 Volume 的 PV 对象上面去。</p>\n<p>StorageClass 应证了 “所有问题都可以通过增加一层来解决”。作用是解决了特定底层存储与 K8S 上资源的解耦问题，通过 SC 统一接口，具体厂商负责具体的存储实现。</p>\n<p>因为存储它涉及到了对物理机文件系统绑定的操作，因此 K8S 做了一系列抽象。PV 在这个抽象里，其实就指代了主机文件系统的路径，当然至于再往实现层面走，是网络文件系统还是主机文件系统，这就全由 PV 的绑定类型决定。而往抽象层走，作为 K8S 的核心系统，K8S 想尽可能屏蔽掉底层，也就是主机文件系统的概念，所以它抽象了 StorageClass ，用来统一指代 / 管理 PV 。至此，K8S 持久化存储就可以分两个部分：</p>\n<p>第一部分是由 <strong>主机文件系统 + PV+StorageClass</strong> 组成的，用来将抽象对象绑定到真实文件系统的生产者部分；</p>\n<p>第二部分就是 <strong>Volume+PVC+StorageClass</strong>，完全被抽象为 K8S 核心业务的消费者部分，而 StorageClass，可以看作是两部分连接的桥梁。</p>\n<h1 id=\"statefulset-管理有状态的应用\"><a class=\"anchor\" href=\"#statefulset-管理有状态的应用\">#</a> StatefulSet - 管理有状态的应用</h1>\n<p>对于 “有状态应用”（如 mysql,redis），多个实例之间可能存在依赖关系，比如 master/slave、active/passive，需要<strong>依次启动</strong>才能保证应用正常运行，外界的客户端也可能要使用固定的网络标识来访问实例，而且这些信息还必须要保证在 Pod 重启后不变 。</p>\n<ul>\n<li>StatefulSet 也可以看做是 Deployment 的一个特例</li>\n</ul>\n<h2 id=\"样板-10\"><a class=\"anchor\" href=\"#样板-10\">#</a> 样板</h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StatefulSet</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>sts</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>svc</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>sts</pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>sts</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">:</span>5<span class=\"token punctuation\">-</span>alpine</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span></pre></td></tr></table></figure><ul>\n<li>\n<p><code>spec</code>  里多出  <code>serviceName</code></p>\n</li>\n<li>\n<p>其余和  <code>deployment</code>  相同</p>\n</li>\n</ul>\n<h2 id=\"使用-statefulset\"><a class=\"anchor\" href=\"#使用-statefulset\">#</a> 使用 StatefulSet</h2>\n<p>写 service，metadata.name 必须和 StatefulSet 里的 serviceName 相同，selector 里的标签也必须和 StatefulSet 里的一致 。</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>svc</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>sts</pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span></pre></td></tr></table></figure><ul>\n<li>Service 自己会有一个域名，格式是 “<strong>对象名。名字空间</strong>”</li>\n<li>Service 发现这些 Pod 不是一般的应用，而是有状态应用，需要有稳定的网络标识，所以就会为 Pod 再多创建出一个新的域名，格式是 <strong>“Pod 名。服务名。名字空间.svc.cluster.local”</strong>。当然，这个域名也可以简写成 <strong>“Pod 名。服务名”</strong>。</li>\n</ul>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/rKXqyGgMiHL4uT2.png\" alt=\"sts.png\" /></p>\n<h2 id=\"statefulset-的数据持久化\"><a class=\"anchor\" href=\"#statefulset-的数据持久化\">#</a> StatefulSet 的数据持久化</h2>\n<p>为了强调持久化存储与 StatefulSet 的一对一绑定关系，Kubernetes 为 StatefulSet 专门定义了一个字段 <strong>“volumeClaimTemplates”</strong>，直接把 PVC 定义嵌入 StatefulSet 的 YAML 文件里。这样能保证创建 StatefulSet 的同时，就会为每个 Pod 自动创建 PVC，让 StatefulSet 的可用性更高。</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StatefulSet</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>sts</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">serviceName</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>svc</pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">volumeClaimTemplates</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># pvc</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>100m<span class=\"token punctuation\">-</span>pvc</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token key atrule\">storageClassName</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">accessModes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token punctuation\">-</span> ReadWriteMany</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>          <span class=\"token key atrule\">storage</span><span class=\"token punctuation\">:</span> 100Mi</pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>sts <span class=\"token comment\"># 对应 svc 的名字</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span> </pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>pv<span class=\"token punctuation\">-</span>sts</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">:</span>5<span class=\"token punctuation\">-</span>alpine</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">6379</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> redis<span class=\"token punctuation\">-</span>100m<span class=\"token punctuation\">-</span>pvc</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>          <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /data</pre></td></tr></table></figure><p><img data-src=\"https://s2.loli.net/2024/02/17/vmfzyEXkgb4ULac.png\" alt=\"sts1.png\" /></p>\n<h2 id=\"总结-4\"><a class=\"anchor\" href=\"#总结-4\">#</a> 总结</h2>\n<p>我们学习了专门部署 “有状态应用” 的 API 对象 StatefulSet，它与 Deployment 非常相似，区别是由它管理的 Pod 会有<strong>固定的名字、启动顺序和网络标识</strong>，这些特性对于在集群里实施有主从、主备等关系的应用非常重要。</p>\n<ol>\n<li>\n<p>StatefulSet 的 YAML 描述和 Deployment 几乎完全相同，<strong>只是多了一个关键字段</strong>  <code>serviceName</code>  。</p>\n</li>\n<li>\n<p>要为 StatefulSet 里的 Pod 生成<strong>稳定的域名</strong>，需要定义 Service 对象，它的名字必须和 StatefulSet 里的  <code>serviceName</code>  一致。</p>\n</li>\n<li>\n<p>访问 StatefulSet 应该使用每个 Pod 的单独域名，形式是 “Pod 名。服务名”，<strong>不应该使用 Service 的负载均衡功能</strong>。</p>\n</li>\n<li>\n<p>在 StatefulSet 里可以用字段 “volumeClaimTemplates” <strong>直接定义 PVC</strong>，让 Pod 实现数据持久化存储。</p>\n</li>\n</ol>\n<h1 id=\"滚动更新-平滑的应用升级\"><a class=\"anchor\" href=\"#滚动更新-平滑的应用升级\">#</a> 滚动更新 - 平滑的应用升级</h1>\n<p>在 Kubernetes 里应用都是以 Pod 的形式运行的，而 Pod 通常又会被 Deployment 等对象来管理，<strong>所以应用的 “版本更新” 实际上更新的是整个 Pod。</strong></p>\n<h2 id=\"滚动更新条件\"><a class=\"anchor\" href=\"#滚动更新条件\">#</a> 滚动更新条件</h2>\n<ul>\n<li>镜像版本更新</li>\n<li>镜像名称不变（可以再创建一个 yaml 文件）</li>\n</ul>\n<h2 id=\"常用命令\"><a class=\"anchor\" href=\"#常用命令\">#</a> 常用命令</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 查看应用更新的状态</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl rollout status deploy mysql-dep-test</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 查看 pod 变化情况</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>kubectl describe deploy mysql-dep-test</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 暂停更新</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>kubectl rollout pause deploy mysql-dep-test</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 继续更新</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>kubectl rollout resume deploy mysql-dep-test</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\"># 查看更新历史</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>kubectl rollout <span class=\"token function\">history</span> deploy mysql-dep-test</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\"># 查看每个版本详细信息</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>kubectl rollout <span class=\"token function\">history</span> deploy  mysql-dep-test <span class=\"token parameter variable\">--revision</span><span class=\"token operator\">=</span><span class=\"token number\">4</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\"># 回退版本</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>kubectl rollout undo deploy mysql-dep-test</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\"># 回退版本 - 指定版本</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>kubectl rollout undo deploy mysql-dep-test --to-revision<span class=\"token operator\">=</span><span class=\"token number\">2</span></pre></td></tr></table></figure><h2 id=\"添加更新描述\"><a class=\"anchor\" href=\"#添加更新描述\">#</a> 添加更新描述</h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">kubernetes.io/change-cause</span><span class=\"token punctuation\">:</span> v1<span class=\"token punctuation\">,</span> ngx=1.21</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">...</span> <span class=\"token punctuation\">...</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">kubernetes.io/change-cause</span><span class=\"token punctuation\">:</span> update to v2<span class=\"token punctuation\">,</span> ngx=1.22</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">...</span> <span class=\"token punctuation\">...</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token key atrule\">annotations</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">kubernetes.io/change-cause</span><span class=\"token punctuation\">:</span> update to v3<span class=\"token punctuation\">,</span> change name</pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token punctuation\">...</span> <span class=\"token punctuation\">...</span></pre></td></tr></table></figure><ul>\n<li><code>annotations</code>  里的值可以任意写，Kubernetes 会自动忽略不理解的 Key-Value，但要编写更新说明就需要使用特定的字段  <code>kubernetes.io/change-cause</code></li>\n</ul>\n<h1 id=\"健康运行\"><a class=\"anchor\" href=\"#健康运行\">#</a> 健康运行</h1>\n<h2 id=\"容器资源配额\"><a class=\"anchor\" href=\"#容器资源配额\">#</a> 容器资源配额</h2>\n<p><strong>只要在 Pod 容器的描述部分添加一个新字段 resources 即可</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>pod<span class=\"token punctuation\">-</span>resources</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>alpine</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx</pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 10m</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 100Mi</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 20m</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 200Mi</pre></td></tr></table></figure><ul>\n<li>\n<p>“<strong>requests</strong>”，意思是容器要申请的资源，也就是说要求 Kubernetes 在创建 Pod 的时候必须分配这里列出的资源，否则容器就无法运行。</p>\n</li>\n<li>\n<p>“<strong>limits</strong>”，意思是容器使用资源的上限，不能超过设定值，否则就有可能被强制停止运行。</p>\n</li>\n</ul>\n<p>而 CPU 因为在计算机中数量有限，非常宝贵，所以 Kubernetes 允许容器精细分割 CPU，即可以 1 个、2 个地完整使用 CPU，也可以用小数 0.1、0.2 的方式来部分使用 CPU。这其实是效仿了 UNIX “时间片” 的用法，意思是进程最多可以占用多少 CPU 时间。</p>\n<p>不过 CPU 时间也不能无限分割，<strong>Kubernetes 里 CPU 的最小使用单位是 0.001，为了方便表示用了一个特别的单位 m</strong>，也就是 “milli”“毫” 的意思，比如说 500m 就相当于 0.5。</p>\n<p>现在我们再来看这个 YAML，你就应该明白了，它向系统<strong>申请</strong>的是 <strong>1% 的 CPU 时间和 100MB 的内存</strong>，运行时的<strong>资源上限</strong>是 <strong>2% CPU 时间和 200MB</strong> 内存。</p>\n<p>如果 Pod 不写 <code>resources</code>  字段，Kubernetes 会如何处理呢？</p>\n<p>这就意味着 Pod 对运行的资源要求 “既没有下限，也没有上限”，Kubernetes 不用管 CPU 和内存是否足够，可以把 Pod 调度到任意的节点上，而且后续 Pod 运行时也可以无限制地使用 CPU 和内存。</p>\n<h2 id=\"容器状态探针\"><a class=\"anchor\" href=\"#容器状态探针\">#</a> 容器状态探针</h2>\n<p>Kubernetes 为检查应用状态定义了三种探针，它们分别对应容器不同的状态：</p>\n<ul>\n<li>\n<p><strong>Startup</strong>，启动探针，用来检查应用是否已经启动成功，适合那些有大量初始化工作要做，启动很慢的应用。</p>\n</li>\n<li>\n<p><strong>Liveness</strong>，存活探针，用来检查应用是否正常运行，是否存在死锁、死循环。</p>\n</li>\n<li>\n<p><strong>Readiness</strong>，就绪探针，用来检查应用是否可以接收流量，是否能够对外提供服务。</p>\n</li>\n</ul>\n<p>这三种探针是递进的关系：应用程序先启动，加载完配置文件等基本的初始化数据就进入了 Startup 状态，之后如果没有什么异常就是 Liveness 存活状态，但可能有一些准备工作没有完成，还不一定能对外提供服务，只有到最后的 Readiness 状态才是一个容器最健康可用的状态。</p>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/T9NSDE4tuFOrVa6.png\" alt=\"probe.png\" /></p>\n<p>如果一个 Pod 里的容器配置了探针，<strong>Kubernetes 在启动容器后就会不断地调用探针来检查容器的状态</strong>：</p>\n<ul>\n<li>\n<p>如果 Startup 探针失败，Kubernetes 会认为容器没有正常启动，就会尝试<strong>反复重启</strong>，当然其后面的 Liveness 探针和 Readiness 探针也不会启动。</p>\n</li>\n<li>\n<p>如果 Liveness 探针失败，Kubernetes 就会认为容器发生了异常，也会<strong>重启容器</strong>。</p>\n</li>\n<li>\n<p>如果 Readiness 探针失败，Kubernetes 会认为容器虽然在运行，但内部有错误，不能正常提供服务，就会把容器从 Service 对象的<strong>负载均衡集合中排除，不会给它分配流量</strong>。</p>\n</li>\n</ul>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/5OGVFavEDe1klbo.png\" alt=\"probe1.png\" /></p>\n<h2 id=\"如何使用容器状态探针\"><a class=\"anchor\" href=\"#如何使用容器状态探针\">#</a> 如何使用容器状态探针</h2>\n<p>startupProbe、livenessProbe、readinessProbe 这三种探针的配置方式都是一样的，关键字段有这么几个：</p>\n<ul>\n<li><strong>periodSeconds</strong>，执行探测动作的<strong>时间间隔</strong>，默认是 10 秒探测一次。</li>\n<li><strong>timeoutSeconds</strong>，探测动作的<strong>超时时间</strong>，如果超时就认为探测失败，默认是 1 秒。</li>\n<li><strong>successThreshold</strong>，<strong>连续几次探测成功</strong>才认为是正常，对于 startupProbe 和 livenessProbe 来说它只能是 1。</li>\n<li><strong>failureThreshold</strong>，<strong>连续探测失败几次</strong>才认为是真正发生了异常，默认是 3 次。</li>\n</ul>\n<p>至于<strong>探测方式</strong>，Kubernetes 支持 3 种：Shell、TCP Socket、HTTP GET，它们也需要在探针里配置：</p>\n<ul>\n<li><strong>exec</strong>，执行一个 Linux 命令，比如 ps、cat 等等，和 container 的 command 字段很类似。</li>\n<li><strong>tcpSocket</strong>，使用 TCP 协议尝试连接容器的指定端口。</li>\n<li><strong>httpGet</strong>，连接端口并发送 HTTP GET 请求。</li>\n</ul>\n<h3 id=\"示例\"><a class=\"anchor\" href=\"#示例\">#</a> 示例</h3>\n<p><strong>ConfigMap</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ConfigMap</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>conf</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">data</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">default.conf</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">|</span><span class=\"token scalar string\"></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    server &#123;</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      listen 80;</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      location = /ready &#123;</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        return 200 'I am ready';</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      &#125;</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    &#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\"># 启用了 80 端口，然后用 location 指令定义了 HTTP 路径 /ready，它作为对外暴露的 “检查口”，用来检测就绪状态，返回简单的 200 状态码和一个字符串表示工作正常。</span></pre></td></tr></table></figure><p><strong>Pod</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>pod<span class=\"token punctuation\">-</span>probe</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>conf<span class=\"token punctuation\">-</span>vol</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">configMap</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>conf</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>alpine</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /etc/nginx/conf.d</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>conf<span class=\"token punctuation\">-</span>vol</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">startupProbe</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token key atrule\">exec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"cat\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"/var/run/nginx.pid\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\"># StartupProbe 使用了 Shell 方式，使用 cat 命令检查 Nginx 存在磁盘上的进程号文件（/var/run/nginx.pid），如果存在就认为是启动成功，它的执行频率是每秒探测一次。</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>    <span class=\"token key atrule\">livenessProbe</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token key atrule\">tcpSocket</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>        <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\"># LivenessProbe 使用了 TCP Socket 方式，尝试连接 Nginx 的 80 端口，每 10 秒探测一次。</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token key atrule\">readinessProbe</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token key atrule\">httpGet</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>        <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /ready</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre><span class=\"token comment\"># ReadinessProbe 使用的是 HTTP GET 方式，访问容器的 /ready 路径，每 5 秒发一次请求。</span></pre></td></tr></table></figure><h1 id=\"名字空间\"><a class=\"anchor\" href=\"#名字空间\">#</a> 名字空间</h1>\n<p>**Kubernetes 的名字空间并不是一个实体对象，只是一个逻辑上的概念。** 它可以把集群切分成一个个彼此独立的区域，然后我们把对象放到这些区域里，就实现了类似容器技术里 namespace 的隔离效果，应用只能在自己的名字空间里分配资源和运行，不会干扰到其他名字空间里的应用。</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 创建名字空间</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl create ns test-ns </pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 获取名字空间</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>kubectl get ns</pre></td></tr></table></figure><p><strong>也可以这样创建名字空间</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Namespace</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>ns</pre></td></tr></table></figure><p><strong>想要把一个对象放入特定的名字空间，需要在它的 metadata 里添加一个 namespace 字段</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Pod</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> test<span class=\"token punctuation\">-</span>ns</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>alpine</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx</pre></td></tr></table></figure><p><strong>想要操作其他名字空间的对象必须要用 -n 参数明确指定</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl get pod <span class=\"token parameter variable\">-n</span> test-ns</pre></td></tr></table></figure><p><strong>一旦名字空间被删除，它里面的所有对象也都会消失</strong></p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>kubectl delete ns test-ns</pre></td></tr></table></figure><h2 id=\"资源配额-resourcequota\"><a class=\"anchor\" href=\"#资源配额-resourcequota\">#</a> 资源配额 - ResourceQuota</h2>\n<p>有了名字空间，我们就可以像管理容器一样，给名字空间设定配额，把整个集群的计算资源分割成不同的大小，按需分配给团队或项目使用</p>\n<p><strong>名字空间的资源配额需要使用一个专门的 API 对象，叫做 ResourceQuota，简称是 quota</strong></p>\n<p>ResourceQuota 对象的使用方式比较灵活，既可以限制整个名字空间的配额，也可以只限制某些类型的对象（使用 scopeSelector），今天我们看第一种，它需要在 <code>spec</code>  里使用 <code>hard</code>  字段，意思就是 <strong>“硬性全局限制”</strong>。</p>\n<h3 id=\"样板-11\"><a class=\"anchor\" href=\"#样板-11\">#</a> 样板</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ResourceQuota</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>qt</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>ns</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">hard</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\"># 所有 Pod 的需求总量最多是 10 个 CPU 和 10GB 的内存，上限总量是 10 个 CPU 和 20GB 的内存</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">requests.cpu</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">requests.memory</span><span class=\"token punctuation\">:</span> 10Gi</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">limits.cpu</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">limits.memory</span><span class=\"token punctuation\">:</span> 20Gi</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\"># 只能创建 100 个 PVC 对象，使用 100GB 的持久化存储空间</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">requests.storage</span><span class=\"token punctuation\">:</span> 100Gi</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">persistentvolumeclaims</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\"># 只能创建 100 个 Pod，100 个 ConfigMap，100 个 Secret，10 个 Service</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">pods</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">configmaps</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">secrets</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\"># 只能创建 1 个 Job，1 个 CronJob，1 个 Deployment</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token key atrule\">count/jobs.batch</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">count/cronjobs.batch</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">count/deployments.apps</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr></table></figure><h3 id=\"字段解释-3\"><a class=\"anchor\" href=\"#字段解释-3\">#</a> 字段解释</h3>\n<ul>\n<li>\n<p>CPU 和内存配额，使用  <code>request.*</code>  、  <code>limits.*</code>  ，这是和容器资源限制是一样的。</p>\n</li>\n<li>\n<p>存储容量配额，使  <code>requests.storage</code>  限制的是 PVC 的存储总量，也可以用  <code>persistentvolumeclaims</code>  限制 PVC 的个数。</p>\n</li>\n<li>\n<p>核心对象配额，使用对象的名字（英语复数形式），比如  <code>pods</code>  、  <code>configmaps</code>  、  <code>secrets</code>  、  <code>services</code>  。</p>\n</li>\n<li>\n<p>其他 API 对象配额，使用  <code>count/name.group</code>  的形式，比如  <code>count/jobs.batch</code>  、 <code>count/deployments.apps</code>  。</p>\n</li>\n</ul>\n<h3 id=\"使用资源配额\"><a class=\"anchor\" href=\"#使用资源配额\">#</a> 使用资源配额</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 部署 quota</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl apply <span class=\"token parameter variable\">-f</span> quota-ns.yml</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 查看对象</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>kubectl get <span class=\"token function\">quota</span> <span class=\"token parameter variable\">-n</span> dev-ns</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 查看对象（更清晰）</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>kubectl describe <span class=\"token function\">quota</span> <span class=\"token parameter variable\">-n</span> dev-ns</pre></td></tr></table></figure><h2 id=\"limitrange\"><a class=\"anchor\" href=\"#limitrange\">#</a> LimitRange</h2>\n<ul>\n<li>自动为 Pod 加上资源限制</li>\n</ul>\n<p><strong>很小但很有用的辅助对象了 —— LimitRange，简称是 limits，它能为 API 对象添加默认的资源配额限制。</strong></p>\n<h3 id=\"样板-12\"><a class=\"anchor\" href=\"#样板-12\">#</a> 样板</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> LimitRange</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>limits</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> dev<span class=\"token punctuation\">-</span>ns</pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Container</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">defaultRequest</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 200m</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 50Mi</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token comment\"># 每个容器默认申请 0.2 的 CPU 和 50MB 内存</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">default</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 500m</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 100Mi</pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token comment\"># 容器的资源上限是 0.5 的 CPU 和 100MB 内存</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Pod</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">max</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 800m</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 200Mi</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token comment\"># 每个 Pod 的最大使用量是 0.8 的 CPU 和 200MB 内存</span></pre></td></tr></table></figure><h3 id=\"字段解释-4\"><a class=\"anchor\" href=\"#字段解释-4\">#</a> 字段解释</h3>\n<ul>\n<li>\n<p><code>spec.limits</code>  是它的核心属性，描述了默认的资源限制。</p>\n</li>\n<li>\n<p><code>type</code>  是要限制的对象类型，可以是  <code>Container</code>  、   <code>Pod</code>  、  <code>PersistentVolumeClaim</code>  。</p>\n</li>\n<li>\n<p><code>default</code>  是默认的资源上限，对应容器里的  <code>resources.limits</code>  ，只适用于  <code>Container</code>  。</p>\n</li>\n<li>\n<p><code>defaultRequest</code>  默认申请的资源，对应容器里的  <code>resources.requests</code>  ，同样也只适用于  <code>Container</code>  。</p>\n</li>\n<li>\n<p><code>max</code>  、  <code>min</code>  是对象能使用的资源的最大最小值。</p>\n</li>\n</ul>\n<h2 id=\"总结-5\"><a class=\"anchor\" href=\"#总结-5\">#</a> 总结</h2>\n<p>在生产环境里会有很多用户共同使用 Kubernetes，必然会有对资源的竞争，为了公平起见，避免某些用户过度消耗资源，就非常有必要用名字空间做好集群的资源规划了。</p>\n<ol>\n<li>\n<p>名字空间是一个逻辑概念，没有实体，它的目标是为资源和对象划分出一个逻辑边界，避免冲突。</p>\n</li>\n<li>\n<p>ResourceQuota 对象可以为名字空间添加资源配额，限制全局的 CPU、内存和 API 对象数量。</p>\n</li>\n<li>\n<p>LimitRange 对象可以为容器或者 Pod 添加默认的资源配额，简化对象的创建工作。</p>\n</li>\n</ol>\n<h1 id=\"系统监控\"><a class=\"anchor\" href=\"#系统监控\">#</a> 系统监控</h1>\n<h2 id=\"metric-server\"><a class=\"anchor\" href=\"#metric-server\">#</a> metric-server</h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># components.yaml</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span>  </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">rbac.authorization.k8s.io/aggregate-to-admin</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">rbac.authorization.k8s.io/aggregate-to-edit</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">rbac.authorization.k8s.io/aggregate-to-view</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"true\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> system<span class=\"token punctuation\">:</span>aggregated<span class=\"token punctuation\">-</span>metrics<span class=\"token punctuation\">-</span>reader</pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">-</span> metrics.k8s.io</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  <span class=\"token punctuation\">-</span> pods</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">-</span> nodes</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token punctuation\">-</span> get</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">-</span> list</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token punctuation\">-</span> watch</pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole</pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> system<span class=\"token punctuation\">:</span>metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token punctuation\">-</span> nodes/metrics</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token punctuation\">-</span> get</pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token string\">\"\"</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>  <span class=\"token punctuation\">-</span> pods</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token punctuation\">-</span> nodes</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token punctuation\">-</span> get</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token punctuation\">-</span> list</pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token punctuation\">-</span> watch</pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"54\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> RoleBinding</pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">-</span>auth<span class=\"token punctuation\">-</span>reader</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Role</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> extension<span class=\"token punctuation\">-</span>apiserver<span class=\"token punctuation\">-</span>authentication<span class=\"token punctuation\">-</span>reader</pre></td></tr><tr><td data-num=\"64\"></td><td><pre><span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"68\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRoleBinding</pre></td></tr><tr><td data-num=\"71\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">:</span>system<span class=\"token punctuation\">:</span>auth<span class=\"token punctuation\">-</span>delegator</pre></td></tr><tr><td data-num=\"75\"></td><td><pre><span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io</pre></td></tr><tr><td data-num=\"77\"></td><td><pre>  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole</pre></td></tr><tr><td data-num=\"78\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> system<span class=\"token punctuation\">:</span>auth<span class=\"token punctuation\">-</span>delegator</pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"81\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"82\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"85\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRoleBinding</pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"89\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> system<span class=\"token punctuation\">:</span>metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"90\"></td><td><pre><span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io</pre></td></tr><tr><td data-num=\"92\"></td><td><pre>  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole</pre></td></tr><tr><td data-num=\"93\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> system<span class=\"token punctuation\">:</span>metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"94\"></td><td><pre><span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre><span class=\"token punctuation\">-</span> <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"96\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"97\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"98\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"100\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service</pre></td></tr><tr><td data-num=\"101\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"104\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"105\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"106\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> https</pre></td></tr><tr><td data-num=\"109\"></td><td><pre>    <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">443</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre>    <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</pre></td></tr><tr><td data-num=\"111\"></td><td><pre>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> https</pre></td></tr><tr><td data-num=\"112\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"114\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"116\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"117\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"120\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"121\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"122\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>      <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"126\"></td><td><pre>  <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre>    <span class=\"token key atrule\">rollingUpdate</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"128\"></td><td><pre>      <span class=\"token key atrule\">maxUnavailable</span><span class=\"token punctuation\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre>        <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"133\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">args</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>cert<span class=\"token punctuation\">-</span>dir=/tmp</pre></td></tr><tr><td data-num=\"137\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>secure<span class=\"token punctuation\">-</span>port=4443</pre></td></tr><tr><td data-num=\"138\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>kubelet<span class=\"token punctuation\">-</span>preferred<span class=\"token punctuation\">-</span>address<span class=\"token punctuation\">-</span>types=InternalIP<span class=\"token punctuation\">,</span>ExternalIP<span class=\"token punctuation\">,</span>Hostname</pre></td></tr><tr><td data-num=\"139\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>kubelet<span class=\"token punctuation\">-</span>use<span class=\"token punctuation\">-</span>node<span class=\"token punctuation\">-</span>status<span class=\"token punctuation\">-</span>port</pre></td></tr><tr><td data-num=\"140\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>metric<span class=\"token punctuation\">-</span>resolution=15s</pre></td></tr><tr><td data-num=\"141\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>kubelet<span class=\"token punctuation\">-</span>insecure<span class=\"token punctuation\">-</span>tls  <span class=\"token comment\"># important</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>        <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> registry.aliyuncs.com/google_containers/metrics<span class=\"token punctuation\">-</span>server<span class=\"token punctuation\">:</span>v0.6.1</pre></td></tr><tr><td data-num=\"143\"></td><td><pre>        <span class=\"token key atrule\">imagePullPolicy</span><span class=\"token punctuation\">:</span> IfNotPresent</pre></td></tr><tr><td data-num=\"144\"></td><td><pre>        <span class=\"token key atrule\">livenessProbe</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>          <span class=\"token key atrule\">failureThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>          <span class=\"token key atrule\">httpGet</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>            <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /livez</pre></td></tr><tr><td data-num=\"148\"></td><td><pre>            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> https</pre></td></tr><tr><td data-num=\"149\"></td><td><pre>            <span class=\"token key atrule\">scheme</span><span class=\"token punctuation\">:</span> HTTPS</pre></td></tr><tr><td data-num=\"150\"></td><td><pre>          <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"152\"></td><td><pre>        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">4443</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> https</pre></td></tr><tr><td data-num=\"155\"></td><td><pre>          <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</pre></td></tr><tr><td data-num=\"156\"></td><td><pre>        <span class=\"token key atrule\">readinessProbe</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>          <span class=\"token key atrule\">failureThreshold</span><span class=\"token punctuation\">:</span> <span class=\"token number\">3</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>          <span class=\"token key atrule\">httpGet</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>            <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /readyz</pre></td></tr><tr><td data-num=\"160\"></td><td><pre>            <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> https</pre></td></tr><tr><td data-num=\"161\"></td><td><pre>            <span class=\"token key atrule\">scheme</span><span class=\"token punctuation\">:</span> HTTPS</pre></td></tr><tr><td data-num=\"162\"></td><td><pre>          <span class=\"token key atrule\">initialDelaySeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">20</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre>          <span class=\"token key atrule\">periodSeconds</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>          <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>            <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 100m</pre></td></tr><tr><td data-num=\"167\"></td><td><pre>            <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 200Mi</pre></td></tr><tr><td data-num=\"168\"></td><td><pre>        <span class=\"token key atrule\">securityContext</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>          <span class=\"token key atrule\">allowPrivilegeEscalation</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">false</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>          <span class=\"token key atrule\">readOnlyRootFilesystem</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre>          <span class=\"token key atrule\">runAsNonRoot</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre>          <span class=\"token key atrule\">runAsUser</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1000</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre>        <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /tmp</pre></td></tr><tr><td data-num=\"175\"></td><td><pre>          <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> tmp<span class=\"token punctuation\">-</span>dir</pre></td></tr><tr><td data-num=\"176\"></td><td><pre>      <span class=\"token key atrule\">nodeSelector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre>        <span class=\"token key atrule\">kubernetes.io/os</span><span class=\"token punctuation\">:</span> linux</pre></td></tr><tr><td data-num=\"178\"></td><td><pre>      <span class=\"token key atrule\">priorityClassName</span><span class=\"token punctuation\">:</span> system<span class=\"token punctuation\">-</span>cluster<span class=\"token punctuation\">-</span>critical</pre></td></tr><tr><td data-num=\"179\"></td><td><pre>      <span class=\"token key atrule\">serviceAccountName</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"180\"></td><td><pre>      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">emptyDir</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> tmp<span class=\"token punctuation\">-</span>dir</pre></td></tr><tr><td data-num=\"183\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apiregistration.k8s.io/v1</pre></td></tr><tr><td data-num=\"185\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> APIService</pre></td></tr><tr><td data-num=\"186\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>    <span class=\"token key atrule\">k8s-app</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"189\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> v1beta1.metrics.k8s.io</pre></td></tr><tr><td data-num=\"190\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>  <span class=\"token key atrule\">group</span><span class=\"token punctuation\">:</span> metrics.k8s.io</pre></td></tr><tr><td data-num=\"192\"></td><td><pre>  <span class=\"token key atrule\">groupPriorityMinimum</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>  <span class=\"token key atrule\">insecureSkipTLSVerify</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre>  <span class=\"token key atrule\">service</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> metrics<span class=\"token punctuation\">-</span>server</pre></td></tr><tr><td data-num=\"196\"></td><td><pre>    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"197\"></td><td><pre>  <span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> v1beta1</pre></td></tr><tr><td data-num=\"198\"></td><td><pre>  <span class=\"token key atrule\">versionPriority</span><span class=\"token punctuation\">:</span> <span class=\"token number\">100</span></pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 查看集群里的节点</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>kubectl <span class=\"token function\">top</span> <span class=\"token function\">node</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 查看 pod 状态</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>kubectl <span class=\"token function\">top</span> pod <span class=\"token parameter variable\">-n</span> kube-system</pre></td></tr></table></figure><h2 id=\"horizontalpodautoscaler\"><a class=\"anchor\" href=\"#horizontalpodautoscaler\">#</a> HorizontalPodAutoscaler</h2>\n<p>它是专门用来自动伸缩 Pod 数量的对象，适用于 Deployment 和 StatefulSet，但不能用于 DaemonSet 。</p>\n<p>HorizontalPodAutoscaler 的能力完全基于 Metrics Server，它从 Metrics Server 获取当前应用的运行指标，主要是 CPU 使用率，再依据预定的策略增加或者减少 Pod 的数量。</p>\n<p><strong>1. 首先定义 nginx 的 deploy 和 svc</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>hpa<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>hpa<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>hpa<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> nginx<span class=\"token punctuation\">:</span>alpine</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nginx</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">containerPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token key atrule\">requests</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 50m</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>            <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 10Mi</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token key atrule\">limits</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token key atrule\">cpu</span><span class=\"token punctuation\">:</span> 100m</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token key atrule\">memory</span><span class=\"token punctuation\">:</span> 20Mi</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre></pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Service</pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>hpa<span class=\"token punctuation\">-</span>svc</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">port</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> TCP</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token key atrule\">targetPort</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>hpa<span class=\"token punctuation\">-</span>dep</pre></td></tr></table></figure><p><strong>注意在它的</strong>  <code>spec</code>  <strong>里一定要用 resources 字段写清楚资源配额</strong>，否则 HorizontalPodAutoscaler 会无法获取 Pod 的指标，也就无法实现自动化扩缩容。</p>\n<p><strong>2. 创建 hpa</strong></p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> autoscaling/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> HorizontalPodAutoscaler</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>hpa</pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">maxReplicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">10</span> <span class=\"token comment\"># Pod 数量的最大值，也就是扩容的上限</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">minReplicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">2</span> <span class=\"token comment\"># Pod 数量的最小值，也就是缩容的下限</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">scaleTargetRef</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 以下参数对应上面的 deployment</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> ngx<span class=\"token punctuation\">-</span>hpa<span class=\"token punctuation\">-</span>dep</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">targetCPUUtilizationPercentage</span><span class=\"token punctuation\">:</span> <span class=\"token number\">5</span> <span class=\"token comment\"># CPU 使用率指标，当大于这个值时扩容，小于这个值时缩容</span></pre></td></tr></table></figure><h2 id=\"prometheus\"><a class=\"anchor\" href=\"#prometheus\">#</a> Prometheus</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">wget</span> https://github.com/prometheus-operator/kube-prometheus/archive/refs/tags/v0.11.0.tar.gz</pre></td></tr></table></figure><h1 id=\"网络通信\"><a class=\"anchor\" href=\"#网络通信\">#</a> 网络通信</h1>\n",
            "tags": [
                "运维",
                "k8s"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2024/02/13/%E8%BF%90%E7%BB%B4/NFS%E9%85%8D%E7%BD%AE/",
            "url": "https://withoutabc.github.io/2024/02/13/%E8%BF%90%E7%BB%B4/NFS%E9%85%8D%E7%BD%AE/",
            "title": "NFS配置",
            "date_published": "2024-02-12T16:38:35.000Z",
            "content_html": "<h1 id=\"nfs-配置\"><a class=\"anchor\" href=\"#nfs-配置\">#</a> NFS 配置</h1>\n<h2 id=\"服务端\"><a class=\"anchor\" href=\"#服务端\">#</a> 服务端</h2>\n<h3 id=\"安装-nfs-服务\"><a class=\"anchor\" href=\"#安装-nfs-服务\">#</a> 安装 NFS 服务</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># centos</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> yum <span class=\"token function\">install</span> nfs-utils</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># ubuntu</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">apt</span> <span class=\"token function\">install</span> nfs-kernel-server</pre></td></tr></table></figure><h3 id=\"创建网络共享目录\"><a class=\"anchor\" href=\"#创建网络共享目录\">#</a> 创建网络共享目录</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /data/nfs</pre></td></tr></table></figure><h3 id=\"编写配置文件\"><a class=\"anchor\" href=\"#编写配置文件\">#</a> 编写配置文件</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vim</span> /etc/exports</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 192.168.10.104 为 nfs 服务端机器的 ip</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/data/nfs <span class=\"token number\">192.168</span>.10.104/24<span class=\"token punctuation\">(</span>rw,sync,no_subtree_check,no_root_squash,insecure<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"使配置生效\"><a class=\"anchor\" href=\"#使配置生效\">#</a> 使配置生效</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> exportfs <span class=\"token parameter variable\">-ra</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\"># 验证效果</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sudo</span> exportfs <span class=\"token parameter variable\">-v</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>/data/nfs     \t<span class=\"token number\">192.168</span>.10.104/24<span class=\"token punctuation\">(</span>sync,wdelay,hide,no_subtree_check,sec<span class=\"token operator\">=</span>sys,rw,insecure,no_root_squash,no_all_squash<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"启动-nfs-服务\"><a class=\"anchor\" href=\"#启动-nfs-服务\">#</a> 启动 NFS 服务</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> systemctl start nfs-server</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">sudo</span> systemctl <span class=\"token builtin class-name\">enable</span> nfs-server</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token function\">sudo</span> systemctl status nfs-server</pre></td></tr></table></figure><h3 id=\"检查网络挂载情况\"><a class=\"anchor\" href=\"#检查网络挂载情况\">#</a> 检查网络挂载情况</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>showmount <span class=\"token parameter variable\">-e</span> <span class=\"token number\">127.0</span>.0.1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>Export list <span class=\"token keyword\">for</span> <span class=\"token number\">127.0</span>.0.1:</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>/data/nfs <span class=\"token number\">192.168</span>.10.104/24</pre></td></tr></table></figure><h3 id=\"重启-nfs-服务\"><a class=\"anchor\" href=\"#重启-nfs-服务\">#</a> 重启 nfs 服务</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">service</span> nfs-kernel-server restart</pre></td></tr></table></figure><h3 id=\"常用命令\"><a class=\"anchor\" href=\"#常用命令\">#</a> 常用命令</h3>\n<h4 id=\"查看本机共享的文件或目录\"><a class=\"anchor\" href=\"#查看本机共享的文件或目录\">#</a> 查看本机共享的文件或目录</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> exportfs <span class=\"token parameter variable\">-rv</span></pre></td></tr></table></figure><h4 id=\"使修改的配置文件生效\"><a class=\"anchor\" href=\"#使修改的配置文件生效\">#</a> 使修改的配置文件生效</h4>\n<p>如果我们在启动了  <code>NFS</code>  之后又修改了  <code>/etc/exports</code>  ，我们不需要重启  <code>NFS</code>  服务，可以用  <code>exportfs</code>  命令来使改动立刻生效，该命令格式如下：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>exportfs <span class=\"token punctuation\">[</span>-aruv<span class=\"token punctuation\">]</span></pre></td></tr></table></figure><ul>\n<li>\n<p>-a 全部挂载或卸载 /etc/exports 中的内容</p>\n</li>\n<li>\n<p>-r 重新读取 /etc/exports 中的信息 ，并同步更新 /etc/exports、/var/lib/nfs/xtab</p>\n</li>\n<li>\n<p>-u 卸载单一目录（和 - a 一起使用为卸载所有 /etc/exports 文件中的目录）</p>\n</li>\n<li>\n<p>-v 在 export 的时候，将详细的信息输出到屏幕上。</p>\n</li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>exportfs <span class=\"token parameter variable\">-au</span> <span class=\"token comment\"># 卸载所有共享目录</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>exportfs <span class=\"token parameter variable\">-rv</span> <span class=\"token comment\"># 重新共享所有目录并输出详细信息</span></pre></td></tr></table></figure><h4 id=\"查看-nfs-的运行状态\"><a class=\"anchor\" href=\"#查看-nfs-的运行状态\">#</a> 查看  <code>NFS</code>  的运行状态</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> nfsstat</pre></td></tr></table></figure><h4 id=\"查看-rpc-执行信息\"><a class=\"anchor\" href=\"#查看-rpc-执行信息\">#</a> 查看  <code>rpc</code>  执行信息</h4>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> rpcinfo</pre></td></tr></table></figure><h2 id=\"客户端\"><a class=\"anchor\" href=\"#客户端\">#</a> 客户端</h2>\n<h3 id=\"安装-nfs-服务-2\"><a class=\"anchor\" href=\"#安装-nfs-服务-2\">#</a> 安装 NFS 服务</h3>\n<h3 id=\"查看-nfs-服务器上的共享目录\"><a class=\"anchor\" href=\"#查看-nfs-服务器上的共享目录\">#</a> 查看 NFS 服务器上的共享目录</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> showmount <span class=\"token parameter variable\">-e</span> <span class=\"token number\">192.168</span>.10.104</pre></td></tr></table></figure><h3 id=\"创建本地挂载目录\"><a class=\"anchor\" href=\"#创建本地挂载目录\">#</a> 创建本地挂载目录</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /mnt/data</pre></td></tr></table></figure><h3 id=\"挂载共享目录\"><a class=\"anchor\" href=\"#挂载共享目录\">#</a> 挂载共享目录</h3>\n<p>将 NFS 服务器 192.168.3.1 上的 /data 目录，挂载到本地的 /mnt/ 目录下</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">mount</span> <span class=\"token parameter variable\">-t</span> nfs <span class=\"token number\">192.168</span>.3.1:/data /mnt/data</pre></td></tr></table></figure><p>采用这种方式挂载，系统重启之后不会自动挂载</p>\n<h3 id=\"卸载共享目录\"><a class=\"anchor\" href=\"#卸载共享目录\">#</a> 卸载共享目录</h3>\n<p>卸载客户端的挂载目录，在客户端执行以下命令</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">umount</span> /mnt/</pre></td></tr></table></figure><h3 id=\"共享目录的自动挂载\"><a class=\"anchor\" href=\"#共享目录的自动挂载\">#</a> 共享目录的自动挂载</h3>\n<p>把挂载信息写入到 /etc/fstab 文件中</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">vim</span> /etc/fstab</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">192.168</span>.10.104:/data  /nfs nfs auto,nofail,noatime,nolock,intr,tcp,actimeo<span class=\"token operator\">=</span><span class=\"token number\">1800</span> <span class=\"token number\">0</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 或者</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">192.168</span>.10.104:/data  /nfs nfs defaults <span class=\"token number\">0</span> <span class=\"token number\">0</span></pre></td></tr></table></figure><h3 id=\"更新挂载\"><a class=\"anchor\" href=\"#更新挂载\">#</a> 更新挂载</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">sudo</span> <span class=\"token function\">mount</span> <span class=\"token parameter variable\">-a</span></pre></td></tr></table></figure><h2 id=\"参考文章\"><a class=\"anchor\" href=\"#参考文章\">#</a> 参考文章</h2>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3dvaHUxMTA0L2FydGljbGUvZGV0YWlscy8xMjEwNTE1MjY=\">https://blog.csdn.net/wohu1104/article/details/121051526</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuY25ibG9ncy5jb20vam9leHUwMS9wLzE2ODM2NDgyLmh0bWw=\">https://www.cnblogs.com/joexu01/p/16836482.html</span></p>\n",
            "tags": [
                "运维",
                "k8s"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2024/02/13/%E8%BF%90%E7%BB%B4/NFS%E5%8A%A8%E6%80%81%E5%8D%B7%E9%83%A8%E7%BD%B2yaml%E6%96%87%E4%BB%B6/",
            "url": "https://withoutabc.github.io/2024/02/13/%E8%BF%90%E7%BB%B4/NFS%E5%8A%A8%E6%80%81%E5%8D%B7%E9%83%A8%E7%BD%B2yaml%E6%96%87%E4%BB%B6/",
            "title": "NFS动态卷部署yaml文件",
            "date_published": "2024-02-12T16:38:20.000Z",
            "content_html": "<h1 id=\"部署-nfs-动态存储卷\"><a class=\"anchor\" href=\"#部署-nfs-动态存储卷\">#</a> 部署 NFS 动态存储卷</h1>\n<h2 id=\"注释版\"><a class=\"anchor\" href=\"#注释版\">#</a> 注释版</h2>\n<h3 id=\"rabcyaml\"><a class=\"anchor\" href=\"#rabcyaml\">#</a> rabc.yaml</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># rbac.yml</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token comment\"># replace with namespace where provisioner is deployed</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner<span class=\"token punctuation\">-</span>runner</pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"nodes\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"persistentvolumes\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"persistentvolumeclaims\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"update\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"storage.k8s.io\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"storageclasses\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"events\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"update\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"patch\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRoleBinding</pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> run<span class=\"token punctuation\">-</span>nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token comment\"># replace with namespace where provisioner is deployed</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner<span class=\"token punctuation\">-</span>runner</pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io</pre></td></tr><tr><td data-num=\"44\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Role</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"47\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> leader<span class=\"token punctuation\">-</span>locking<span class=\"token punctuation\">-</span>nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token comment\"># replace with namespace where provisioner is deployed</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"endpoints\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"update\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"patch\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> RoleBinding</pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> leader<span class=\"token punctuation\">-</span>locking<span class=\"token punctuation\">-</span>nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>  <span class=\"token comment\"># replace with namespace where provisioner is deployed</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token comment\"># replace with namespace where provisioner is deployed</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"67\"></td><td><pre><span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Role</pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> leader<span class=\"token punctuation\">-</span>locking<span class=\"token punctuation\">-</span>nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"70\"></td><td><pre>  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io</pre></td></tr></table></figure><h3 id=\"deploymentyaml\"><a class=\"anchor\" href=\"#deploymentyaml\">#</a> deployment.yaml</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># deployment.yml</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token comment\"># replace with namespace where provisioner is deployed</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Recreate</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token key atrule\">serviceAccountName</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#          image: k8s.gcr.io/sig-storage/nfs-subdir-external-provisioner:v4.0.2</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> chronolaw/nfs<span class=\"token punctuation\">-</span>subdir<span class=\"token punctuation\">-</span>external<span class=\"token punctuation\">-</span>provisioner<span class=\"token punctuation\">:</span>v4.0.2</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>root</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /persistentvolumes</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROVISIONER_NAME</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> k8s<span class=\"token punctuation\">-</span>sigs.io/nfs<span class=\"token punctuation\">-</span>subdir<span class=\"token punctuation\">-</span>external<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> NFS_SERVER</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> 172.16.19.54</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> NFS_PATH</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> /home/dev/multipass/k8s/data</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>root</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>          <span class=\"token key atrule\">nfs</span><span class=\"token punctuation\">:</span> <span class=\"token comment\"># 记得改成自己 nfs 服务端的目录和 ip</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span> 172.16.19.54 </pre></td></tr><tr><td data-num=\"42\"></td><td><pre>            <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /home/dev/multipass/k8s/data</pre></td></tr></table></figure><h3 id=\"classyaml\"><a class=\"anchor\" href=\"#classyaml\">#</a> class.yaml</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># class.yml</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> storage.k8s.io/v1</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StorageClass</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">provisioner</span><span class=\"token punctuation\">:</span> k8s<span class=\"token punctuation\">-</span>sigs.io/nfs<span class=\"token punctuation\">-</span>subdir<span class=\"token punctuation\">-</span>external<span class=\"token punctuation\">-</span>provisioner <span class=\"token comment\"># or choose another name, must match deployment's env PROVISIONER_NAME'</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">parameters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">archiveOnDelete</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"false\"</span></pre></td></tr></table></figure><h2 id=\"删除注释版\"><a class=\"anchor\" href=\"#删除注释版\">#</a> 删除注释版</h2>\n<h3 id=\"rbacyaml\"><a class=\"anchor\" href=\"#rbacyaml\">#</a> rbac.yaml</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner<span class=\"token punctuation\">-</span>runner</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"nodes\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"persistentvolumes\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"delete\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"persistentvolumeclaims\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"update\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"storage.k8s.io\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"storageclasses\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"events\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"update\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"patch\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRoleBinding</pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> run<span class=\"token punctuation\">-</span>nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"32\"></td><td><pre><span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"36\"></td><td><pre><span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ClusterRole</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner<span class=\"token punctuation\">-</span>runner</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io</pre></td></tr><tr><td data-num=\"40\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Role</pre></td></tr><tr><td data-num=\"42\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> leader<span class=\"token punctuation\">-</span>locking<span class=\"token punctuation\">-</span>nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token key atrule\">rules</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">apiGroups</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token key atrule\">resources</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"endpoints\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>    <span class=\"token key atrule\">verbs</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"get\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"list\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"watch\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"create\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"update\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"patch\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">---</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> RoleBinding</pre></td></tr><tr><td data-num=\"52\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io/v1</pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> leader<span class=\"token punctuation\">-</span>locking<span class=\"token punctuation\">-</span>nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"55\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"56\"></td><td><pre><span class=\"token key atrule\">subjects</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>  <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> ServiceAccount</pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"59\"></td><td><pre>    <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token key atrule\">roleRef</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>  <span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Role</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> leader<span class=\"token punctuation\">-</span>locking<span class=\"token punctuation\">-</span>nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"63\"></td><td><pre>  <span class=\"token key atrule\">apiGroup</span><span class=\"token punctuation\">:</span> rbac.authorization.k8s.io</pre></td></tr></table></figure><h3 id=\"deploymentyaml-2\"><a class=\"anchor\" href=\"#deploymentyaml-2\">#</a> deployment.yaml</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> apps/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> Deployment</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">namespace</span><span class=\"token punctuation\">:</span> kube<span class=\"token punctuation\">-</span>system</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>  <span class=\"token key atrule\">replicas</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token key atrule\">strategy</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">type</span><span class=\"token punctuation\">:</span> Recreate</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">selector</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">matchLabels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  <span class=\"token key atrule\">template</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token key atrule\">app</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">spec</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token key atrule\">serviceAccountName</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token key atrule\">containers</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>          <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> chronolaw/nfs<span class=\"token punctuation\">-</span>subdir<span class=\"token punctuation\">-</span>external<span class=\"token punctuation\">-</span>provisioner<span class=\"token punctuation\">:</span>v4.0.2</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>          <span class=\"token key atrule\">volumeMounts</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>root</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>              <span class=\"token key atrule\">mountPath</span><span class=\"token punctuation\">:</span> /persistentvolumes</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>          <span class=\"token key atrule\">env</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> PROVISIONER_NAME</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> k8s<span class=\"token punctuation\">-</span>sigs.io/nfs<span class=\"token punctuation\">-</span>subdir<span class=\"token punctuation\">-</span>external<span class=\"token punctuation\">-</span>provisioner</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> NFS_SERVER</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> 192.168.10.104</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> NFS_PATH</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>              <span class=\"token key atrule\">value</span><span class=\"token punctuation\">:</span> /data/nfs</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client<span class=\"token punctuation\">-</span>root</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>          <span class=\"token key atrule\">nfs</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            <span class=\"token key atrule\">server</span><span class=\"token punctuation\">:</span> 192.168.10.104</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>            <span class=\"token key atrule\">path</span><span class=\"token punctuation\">:</span> /data/nfs</pre></td></tr></table></figure><h3 id=\"classyaml-2\"><a class=\"anchor\" href=\"#classyaml-2\">#</a> class.yaml</h3>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">apiVersion</span><span class=\"token punctuation\">:</span> storage.k8s.io/v1</pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">kind</span><span class=\"token punctuation\">:</span> StorageClass</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">metadata</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">name</span><span class=\"token punctuation\">:</span> nfs<span class=\"token punctuation\">-</span>client</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token key atrule\">provisioner</span><span class=\"token punctuation\">:</span> k8s<span class=\"token punctuation\">-</span>sigs.io/nfs<span class=\"token punctuation\">-</span>subdir<span class=\"token punctuation\">-</span>external<span class=\"token punctuation\">-</span>provisioner </pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token key atrule\">parameters</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token key atrule\">archiveOnDelete</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"false\"</span></pre></td></tr></table></figure>",
            "tags": [
                "运维",
                "k8s"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2024/02/12/%E5%90%8E%E7%AB%AF/Rabbitmq/",
            "url": "https://withoutabc.github.io/2024/02/12/%E5%90%8E%E7%AB%AF/Rabbitmq/",
            "title": "Rabbitmq",
            "date_published": "2024-02-12T11:36:01.000Z",
            "content_html": "<h2 id=\"rabbitmq常用函数\"><a class=\"anchor\" href=\"#rabbitmq常用函数\">#</a> RabbitMq 常用函数</h2>\n<p>rabbitmq 这里使用以下这个包：</p>\n<p><code>&quot;github.com/rabbitmq/amqp091-go&quot;</code></p>\n<h3 id=\"连接-rabbitmq\"><a class=\"anchor\" href=\"#连接-rabbitmq\">#</a> 连接 rabbitmq</h3>\n<p><code>func Dial(url string) (*Connection, error)</code></p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">InitRabbitMq</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>amqp<span class=\"token punctuation\">.</span>Connection<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token comment\">//connect to rabbit rabbitmq</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   conn<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> amqp<span class=\"token punctuation\">.</span><span class=\"token function\">Dial</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"amqp://guest:guest@localhost:5672/\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      log<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to connect to RabbitMQ\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span> err</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">return</span> conn<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>调用完后关闭连接</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">defer</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h3 id=\"创建管道\"><a class=\"anchor\" href=\"#创建管道\">#</a> 创建管道</h3>\n<p><code>func (c *Connection) Channel() (Channel, error)</code></p>\n<p>用于从连接（Connection）中创建一个通道（Channel）对象</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ch<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> conn<span class=\"token punctuation\">.</span><span class=\"token function\">Channel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Failed to open a channel\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">defer</span> ch<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr></table></figure><p>在使用 RabbitMQ 时，我们通常会先创建一个连接对象，然后通过该连接对象创建一个或多个通道对象，使用通道对象来进行交互。通过通道对象，我们可以声明队列和交换机、绑定队列和交换机、发送和接收消息等操作。通常情况下，我们在使用完通道对象后需要手动将其关闭，以释放资源和避免连接泄漏。</p>\n<h3 id=\"声明队列\"><a class=\"anchor\" href=\"#声明队列\">#</a> 声明队列</h3>\n<p><code>func (ch *Channel) QueueDeclare(name string, durable bool, autoDelete bool, exclusive bool, noWait bool, args Table) (Queue, error)</code></p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">QueueDeclare</span><span class=\"token punctuation\">(</span>channel <span class=\"token operator\">*</span>amqp091<span class=\"token punctuation\">.</span>Channel<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span>amqp091<span class=\"token punctuation\">.</span>Queue<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   q<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> channel<span class=\"token punctuation\">.</span><span class=\"token function\">QueueDeclare</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>      <span class=\"token string\">\"name\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// name</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>       <span class=\"token comment\">// durable</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\">// delete when unused</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\">// exclusive</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\">// no-wait</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span>        <span class=\"token comment\">// arguments</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token keyword\">return</span> q<span class=\"token punctuation\">,</span> err</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ol>\n<li><code>name string</code> : 表示要声明的队列名称，即消息将要发送到哪个队列。在 RabbitMQ 中，队列名称是一个字符串，可以由字母、数字、下划线和短横线组成，长度不超过 255 个字符。</li>\n<li><code>durable bool</code> : 表示队列是否持久化。如果设置为 true，则表示该队列会在服务器重启后仍然存在；如果设置为 false，则表示该队列仅在当前连接有效，服务器重启后会被删除。</li>\n<li><code>autoDelete bool</code> : 表示队列是否自动删除。如果设置为 true，则表示该队列在所有消费者断开连接后会自动删除；如果设置为 false，则表示该队列会一直存在，直到被显式删除或服务器重启。</li>\n<li><code>exclusive bool</code> : 表示队列是否独占。如果设置为 true，则表示只有当前连接可以使用该队列，其他连接无法使用；如果设置为 false，则表示该队列可以被多个连接使用。</li>\n<li><code>noWait bool</code> : 表示是否需要等待服务器响应。如果设置为 true，则表示不需要等待服务器响应；如果设置为 false，则表示需要等待服务器响应。</li>\n<li><code>args Table</code> : 表示一些额外的参数。通常情况下，我们可以将该参数设置为 nil，表示不需要额外的参数。</li>\n</ol>\n<h4 id=\"quality-of-service\"><a class=\"anchor\" href=\"#quality-of-service\">#</a>  <code>Quality of Service</code></h4>\n<p><code>Quality of Service</code>  用于设置通道的 QoS（Quality of Service）参数。</p>\n<p><code>func (ch *Channel) Qos(prefetchCount int, prefetchSize int, global bool) error</code></p>\n<p>下面是每个参数的含义解释：</p>\n<ul>\n<li>\n<p><code>prefetchCount int</code>  表示每个消费者最多只能获取 n 条未确认的消息。这里的 &quot;未确认&quot; 是指消费者还没有发送 ack 回执确认收到这条消息。</p>\n</li>\n<li>\n<p><code>prefetchSize int</code> 0 表示每条消息的大小不做限制。如果需要限制每条消息的大小，可以设置一个正整数，表示最大的消息大小。</p>\n</li>\n<li>\n<p><code>global bool</code> : 表示这个 QoS 设置只对当前通道有效，而不会影响到全局范围内的所有连接。如果设置为 true，则表示这个 QoS 设置对所有连接都有效。</p>\n</li>\n</ul>\n<p>总之，该函数的作用是设置通道的 QoS 参数，以便控制消费者接收消息的速度和数量。通过设置 QoS 参数，我们可以控制每个消费者最多获取多少条未确认的消息，以及每条消息的大小限制等。这样可以避免因为一次性获取过多的消息导致消费者处理不过来的问题，从而保证消息系统的稳定性和可靠性。</p>\n<h3 id=\"消费者\"><a class=\"anchor\" href=\"#消费者\">#</a> 消费者</h3>\n<p><code>func (ch *Channel) Consume(queue string, consumer string, autoAck bool, exclusive bool, noLocal bool, noWait bool, args Table) (&lt;-chan Delivery, error)</code></p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>msgs<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> ch<span class=\"token punctuation\">.</span><span class=\"token function\">Consume</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token string\">\"queue\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// queue</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token string\">\"consumer\"</span><span class=\"token punctuation\">,</span>     <span class=\"token comment\">// consumer</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span>       <span class=\"token comment\">// auto-ack</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\">// exclusive</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\">// no-local</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>      <span class=\"token comment\">// no-wait</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token boolean\">nil</span><span class=\"token punctuation\">,</span>        <span class=\"token comment\">// args</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"register consume err:%v\\n\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>\n<p><code>queue string</code> : 表示要消费的队列名称，即从哪个队列中接收消息。</p>\n</li>\n<li>\n<p><code>consumer string</code> : 表示消费者的名称，即标识当前消费者身份的字符串。如果有多个消费者同时消费同一个队列，那么每个消费者的名称应该是唯一的。</p>\n</li>\n<li>\n<p><code>autoAck bool</code> : 表示是否自动确认消息。如果设置为 true，则表示消费者接收到消息后会自动发送确认消息给服务器；如果设置为 false，则表示消费者需要手动确认消息。手动确认消息可以确保消息只被消费一次，避免了因为消费者异常退出而导致消息重复消费的问题，但是也会增加消息处理的复杂度。</p>\n</li>\n<li>\n<p><code>exclusive bool</code> : 表示是否独占队列。如果设置为 true，则表示只有当前连接可以使用该队列，其他连接无法使用；如果设置为 false，则表示该队列可以被多个连接使用。</p>\n</li>\n<li>\n<p><code>noLocal bool</code> : 表示是否禁止消费者收到自己发送的消息。如果设置为 true，则表示消费者不会收到自己发送的消息；如果设置为 false，则表示消费者可以收到自己发送的消息。</p>\n</li>\n<li>\n<p><code>noWait bool</code> : 表示是否需要等待服务器响应。如果设置为 true，则表示不需要等待服务器响应；如果设置为 false，则表示需要等待服务器响应。</p>\n</li>\n<li>\n<p><code>args Table</code> : 表示一些额外的参数。通常情况下，我们可以将该参数设置为 nil，表示不需要额外的参数。</p>\n</li>\n</ul>\n<p>总之，该函数的作用是从名为 &quot;queue&quot; 的队列中消费消息，并根据参数的不同来控制消费者的身份、消息确认方式、队列独占等属性。 消费者可以通过通道对象（Channel）来接收消息，每次接收到一条消息后，将会生成一个消息对象，我们可以从该对象中获取消息的内容和属性。消息的处理通常需要放在一个无限循环中，消费者会一直等待新消息的到来。</p>\n<h4 id=\"消息确认\"><a class=\"anchor\" href=\"#消息确认\">#</a> 消息确认</h4>\n<p><code>func (d Delivery) Ack(multiple bool) error</code></p>\n<p>用于向 RabbitMQ 服务器确认消费者已经成功处理并接收到了某条消息。</p>\n<h5 id=\"自动确认\"><a class=\"anchor\" href=\"#自动确认\">#</a> 自动确认</h5>\n<ul>\n<li>\n<p>消费者在接收到消息后，如果在自动确认的情况下，由于网络问题、程序错误等原因没有正确地处理该消息，那么消息就会丢失。因为 RabbitMQ 服务器会认为该消息已经被正确消费，将其标记为已经确认，从而将该消息从队列中删除，如果消费者没有正确地处理该消息，那么该消息就会永久丢失。</p>\n</li>\n<li>\n<p>在高并发的情况下，消费者在接收到消息后，如果在自动确认的情况下，由于消费者的处理能力不足，不能够及时地处理完所有的消息，那么就会出现消息堆积的情况。当消息堆积到一定程度时，就会导致消费者宕机或者出现性能问题，从而导致消息消费的延迟和丢失。</p>\n</li>\n</ul>\n<h5 id=\"手动确认\"><a class=\"anchor\" href=\"#手动确认\">#</a> 手动确认</h5>\n<ul>\n<li>\n<p><code>consume</code>  函数中设置 <code>autoAck bool</code>  为 <code>false</code></p>\n</li>\n<li>\n<p><code>Ack</code>  表示确认消费者已经成功处理并接收到了某条消息。</p>\n</li>\n<li>\n<p><code>multiple bool</code> : 表示是否批量确认。如果设置为 true，则表示将当前 Delivery 之前所有未确认的消息一起确认，否则只确认当前 Delivery 消息。</p>\n</li>\n</ul>\n<h3 id=\"发送消息\"><a class=\"anchor\" href=\"#发送消息\">#</a> 发送消息</h3>\n<p><code>func (ch *Channel) PublishWithContext(ctx context.Context, exchange string, key string, mandatory bool, immediate bool, msg Publishing) error</code></p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>ctx<span class=\"token punctuation\">,</span> cancel <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">WithTimeout</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token operator\">*</span>time<span class=\"token punctuation\">.</span>Second<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">defer</span> <span class=\"token function\">cancel</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>body<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> json<span class=\"token punctuation\">.</span><span class=\"token function\">Marshal</span><span class=\"token punctuation\">(</span><span class=\"token operator\">&amp;</span>user<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"encoding error:%v\\n\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>err <span class=\"token operator\">=</span> <span class=\"token keyword\">chan</span><span class=\"token punctuation\">.</span><span class=\"token function\">PublishWithContext</span><span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   ctx<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token string\">\"\"</span><span class=\"token punctuation\">,</span>     <span class=\"token comment\">// exchange</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   q<span class=\"token punctuation\">.</span>Name<span class=\"token punctuation\">,</span> <span class=\"token comment\">// routing key</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// mandatory</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span>  <span class=\"token comment\">// immediate</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   amqp<span class=\"token punctuation\">.</span>Publishing<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      ContentType<span class=\"token punctuation\">:</span> <span class=\"token string\">\"application/json\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      Body<span class=\"token punctuation\">:</span>        body<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>   log<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\" err:%v\\n\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li><code>context.Context</code> : 上下文对象，用于控制消息发送的超时时间和取消机制。在该代码中，我们使用了一个带有超时时间的上下文对象 ctx 来控制消息发送的超时时间为 5 秒，如果在 5 秒内没有成功发送消息，则会自动取消消息发送。</li>\n<li><code>exchange string</code> : 表示不需要指定交换机，即直接将消息发送到队列中。</li>\n<li><code>key string</code> : 表示消息的路由键，即消息要发送到哪个队列中。</li>\n<li><code>mandatory bool</code> : 表示是否强制要求消息必须发送到队列中。如果设置为 true，则表示如果没有找到匹配的队列，则会返回一个错误；如果设置为 false，则表示如果没有找到匹配的队列，则会将消息丢弃。</li>\n<li><code>immediate bool</code> : 表示是否立即发送消息。如果设置为 true，则表示如果没有找到匹配的消费者，则会将消息立即返回；如果设置为 false，则表示如果没有找到匹配的消费者，则会将消息保存在队列中，等待消费者连接后再发送。</li>\n<li><code>msg Publishing</code> : 表示要发送的消息对象，该对象包含了消息的各种属性和内容。在该代码中，我们设置了消息的类型（ContentType）和消息内容（Body）等属性，以便消费者在接收到消息后能够正确地处理它。</li>\n</ul>\n<p>总之，该函数的作用是向名为  <code>chan</code>  的通道中发送一条消息，并根据参数的不同来控制消息发送的目标队列、消息内容和属性等。发送者可以通过该函数将消息发送到队列中，然后由消费者来接收和处理。其中，  <code>ctx</code>  参数用于控制发送消息的超时时间和取消机制，可以避免因为网络等原因导致的长时间等待和阻塞。</p>\n<h4 id=\"msg-publishing\"><a class=\"anchor\" href=\"#msg-publishing\">#</a>  <code>msg Publishing</code></h4>\n<p><code>msg Publishing</code>  需要传入 <code>amqp.Publishing&#123;&#125;</code>  结构体类型，用于表示 AMQP 协议中的消息。在使用 AMQP 客户端发送消息时，我们可以通过 <code>amqp.Publishing&#123;&#125;</code>  来设置消息的各种属性和内容，例如：</p>\n<ol>\n<li>\n<p><code>ContentType</code> : 表示消息的内容类型，例如 &quot;text/plain&quot; 、 &quot;application/json&quot; 等。</p>\n</li>\n<li>\n<p><code>Body</code> : 表示消息的内容，通常是一个字节数组。</p>\n</li>\n<li>\n<p><code>Headers</code> : 表示消息的头部信息，可以是一个键值对的映射。</p>\n</li>\n<li>\n<p><code>DeliveryMode</code> : 表示消息的传输模式，例如 Persistent 模式表示持久化消息， Transient 模式表示非持久化消息。</p>\n</li>\n<li>\n<p><code>Priority</code> : 表示消息的优先级，用于控制消息的发送顺序。</p>\n</li>\n<li>\n<p><code>CorrelationId</code> : 表示消息的关联 ID，用于关联一组相关的消息。</p>\n</li>\n<li>\n<p><code>ReplyTo</code> : 表示消息的回复队列，用于指定回复消息的目标队列。</p>\n</li>\n<li>\n<p><code>Expiration</code> : 表示消息的有效期，用于控制消息的过期时间。</p>\n</li>\n<li>\n<p><code>MessageId</code> : 表示消息的唯一 ID，用于识别一条特定的消息。</p>\n</li>\n<li>\n<p><code>Timestamp</code> : 表示消息的时间戳，用于记录消息的创建时间。</p>\n</li>\n<li>\n<p><code>Type</code> : 表示消息的类型，用于指定不同类型的消息。</p>\n</li>\n<li>\n<p><code>UserId</code> : 表示消息的用户 ID，用于指定发送消息的用户身份。</p>\n</li>\n<li>\n<p><code>AppId</code> : 表示消息的应用程序 ID，用于指定发送消息的应用程序身份。</p>\n</li>\n</ol>\n<p>总之， <code>amqp.Publishing&#123;&#125;</code>  可以用于设置消息的各种属性和内容，以便消费者在接收到消息后能够正确地处理它。一般来说，我们至少需要设置 <code>ContentType</code>  和 <code>Body</code>  属性，以确保消息的内容得到正确传递。其他的属性则可以根据具体的需求来设置。</p>\n",
            "tags": [
                "后端",
                "rabbitmq"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2024/02/07/%E5%90%8E%E7%AB%AF/ELK%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "url": "https://withoutabc.github.io/2024/02/07/%E5%90%8E%E7%AB%AF/ELK%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "title": "ELK部署及使用",
            "date_published": "2024-02-06T16:55:21.000Z",
            "content_html": "<h1 id=\"eskibanalogstash部署\"><a class=\"anchor\" href=\"#eskibanalogstash部署\">#</a> ES+Kibana+Logstash 部署</h1>\n<h2 id=\"部署文件\"><a class=\"anchor\" href=\"#部署文件\">#</a> 部署文件</h2>\n<p>先创建容器网络（也可以不创建，把 networks 相关的都删了，会自动创建）</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> network create elk</pre></td></tr></table></figure><p>一定要一次性弄完再 up, 不然会出现神奇的 bug。。。</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">elasticsearch</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> elasticsearch<span class=\"token punctuation\">:</span>7.13.1</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> elasticsearch</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./elasticsearch_data:/bitnami/elasticsearch\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9200:9200\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9300:9300\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">-</span> discovery.type=single<span class=\"token punctuation\">-</span>node</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"ES_JAVA_OPTS=-Xms512m -Xmx512m\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token key atrule\">privileged</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">ulimits</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">nofile</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        <span class=\"token key atrule\">soft</span><span class=\"token punctuation\">:</span> <span class=\"token number\">65536</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token key atrule\">hard</span><span class=\"token punctuation\">:</span> <span class=\"token number\">65536</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">-</span> elk</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>  <span class=\"token key atrule\">kibana</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> kibana<span class=\"token punctuation\">:</span>7.13.1</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> kibana</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token punctuation\">-</span> elasticsearch.hosts=http<span class=\"token punctuation\">:</span>//elasticsearch<span class=\"token punctuation\">:</span><span class=\"token number\">9200</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token punctuation\">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5601:5601\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./kibana_data:/bitnami/kibana\"</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token punctuation\">-</span> elasticsearch</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token punctuation\">-</span> elk</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token key atrule\">logstash</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> docker.elastic.co/logstash/logstash<span class=\"token punctuation\">:</span>7.13.1</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> logstash</pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./logstash.conf:/usr/share/logstash/pipeline/logstash.conf\"</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"/home/elk/log.log:/home/elk/log.log\"</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"XPACK_MONITORING_ENABLED=false\"</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token punctuation\">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token punctuation\">-</span> elasticsearch</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token punctuation\">-</span> elk</pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token key atrule\">elk</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token key atrule\">external</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr></table></figure><ul>\n<li>将要挂载的宿主机目录设置为<strong>最高权限</strong></li>\n</ul>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">chmod</span> <span class=\"token number\">777</span> 目录名</pre></td></tr></table></figure><h2 id=\"重要说明\"><a class=\"anchor\" href=\"#重要说明\">#</a> 重要说明</h2>\n<ul>\n<li>\n<p><code>elasticsearch</code>  和 <code>kibana</code>  的宿主机挂载目录都是任意指定的，建议使用一个路径而不是匿名卷（否则重启容器可能出现各种 bug）</p>\n</li>\n<li>\n<p><code>container_name</code>  字段不可省略，否则 <code>kibana</code>  和 <code>logstash</code>  可能会找不到 <code>elasticsearch</code> ，因为自动创建的容器名称自带前缀</p>\n</li>\n<li>\n<p><code>logstash</code>  的 <code>volumes</code>  字段里，第一个用于指定 <code>logstash.conf</code>  的位置，第二个用于确定日志搜集路径</p>\n</li>\n</ul>\n<p><strong>（可以先部署前两个，搞定了再把第三个加进来，结合后面的 logstash 说明）</strong></p>\n<h2 id=\"验证\"><a class=\"anchor\" href=\"#验证\">#</a> 验证</h2>\n<ul>\n<li>访问 <code>http://localhost:9200</code></li>\n</ul>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/Ri3p1YgFPqBX8sc.png\" alt=\"9200.png\" /></p>\n<ul>\n<li>访问 <code>http://localhost:5601</code></li>\n</ul>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/cDQs8yZhm1LuK2x.png\" alt=\"5601.png\" /></p>\n<p>验证部署成功</p>\n<h1 id=\"什么是elasticsearch\"><a class=\"anchor\" href=\"#什么是elasticsearch\">#</a> 什么是 Elasticsearch?</h1>\n<blockquote>\n<p>Elasticsearch is a real-time, distributed storage, search, and analytics engine.</p>\n</blockquote>\n<p>Elasticsearch 是一个<strong>实时</strong>的<strong>分布式存储、搜索、分析</strong>的引擎。</p>\n<p>相对于数据库，Elasticsearch 的强大之处就是可以<strong>模糊查询</strong>。</p>\n<p>数据库的模糊查询：</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">select</span> <span class=\"token operator\">*</span> <span class=\"token keyword\">from</span> <span class=\"token keyword\">user</span> <span class=\"token keyword\">where</span> name <span class=\"token operator\">like</span> <span class=\"token string\">'%something%'</span></pre></td></tr></table></figure><p>但这样是不通过<strong>索引</strong>查询的，意味着：只要数据库的量很大（1 亿条），查询肯定会是<strong>秒</strong>级别的。</p>\n<p>而且，即便给你从数据库根据<strong>模糊匹配</strong>查出相应的记录了，那往往会返回<strong>大量的数据</strong>给你，往往你需要的数据量并没有这么多，可能 50 条记录就足够了。</p>\n<p>还有一个就是：用户输入的内容往往并没有这么的<strong>精确</strong>，比如我从 Google 输入 <code>ElastcSeach</code> （打错字），但是 Google 还是能估算我想输入的是 <code>Elasticsearch</code></p>\n<p>而 Elasticsearch 是专门做<strong>搜索</strong>的，就是为了解决上面所讲的问题而生的，换句话说：</p>\n<ul>\n<li>Elasticsearch 对模糊搜索非常擅长（搜索速度很快）</li>\n<li>从 Elasticsearch 搜索到的数据可以根据<strong>评分</strong>过滤掉大部分的，只要返回评分高的给用户就好了（原生就支持排序）</li>\n<li>没有那么准确的关键字也能搜出相关的结果（能匹配有相关性的记录）</li>\n</ul>\n<h1 id=\"elasticsearch的术语和架构\"><a class=\"anchor\" href=\"#elasticsearch的术语和架构\">#</a> Elasticsearch 的术语和架构</h1>\n<p><strong>Index</strong>：Elasticsearch 的 Index 相当于数据库的 Table</p>\n<p><strong>Type</strong>：这个在新的 Elasticsearch 版本已经废除（在以前的 Elasticsearch 版本，一个 Index 下支持多个 Type–有点类似于消息队列一个 topic 下多个 group 的概念）</p>\n<p><strong>Document</strong>：Document 相当于数据库的一行记录</p>\n<p><strong>Field</strong>：相当于数据库的 Column 的概念</p>\n<p><strong>Mapping</strong>：相当于数据库的 Schema 的概念</p>\n<p><strong>DSL</strong>：相当于数据库的 SQL（给我们读取 Elasticsearch 数据的 API）</p>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/7sXcYbSpDazMB3P.png\" alt=\"cmp.png\" /></p>\n<p>一个 Elasticsearch 集群会有多个 Elasticsearch 节点，所谓节点实际上就是运行着 Elasticsearch 进程的机器。</p>\n<p>在众多的节点中，其中会有一个 <code>Master Node</code> ，它主要负责维护索引元数据、负责切换主分片和副本分片身份等工作（后面会讲到分片的概念），如果主节点挂了，会选举出一个新的主节点。</p>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/xrOVw14XczYo7Sy.png\" alt=\"struct.png\" /></p>\n<h1 id=\"倒排索引\"><a class=\"anchor\" href=\"#倒排索引\">#</a> 倒排索引</h1>\n<h2 id=\"正排索引传统\"><a class=\"anchor\" href=\"#正排索引传统\">#</a> 正排索引（传统）</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">id</th>\n<th style=\"text-align:center\">content</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">1001</td>\n<td style=\"text-align:center\">my name is zhang san</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">1002</td>\n<td style=\"text-align:center\">my name is li si</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"倒排索引-2\"><a class=\"anchor\" href=\"#倒排索引-2\">#</a> 倒排索引</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">keyword</th>\n<th style=\"text-align:center\">id</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">name</td>\n<td style=\"text-align:center\">1001,1002</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">zhang</td>\n<td style=\"text-align:center\">1001</td>\n</tr>\n</tbody>\n</table>\n<p>Elasticsearch 是面向文档型数据库，一条数据在这里就是一个文档。 为了方便大家理解，我们将 Elasticsearch 里存储文档数据和关系型数据库 MySQL 存储数据的概念进行一个类比：</p>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/9XLnyV1WYgmNjOh.png\" alt=\"map.png\" /></p>\n<p>ES 里的 Index 可以看做一个库，而 Types 相当于表， Documents 则相当于表的行。这里 Types 的概念已经被逐渐弱化， Elasticsearch 6.X 中，一个 index 下已经只能包含一个 type， Elasticsearch7.X 中，Type 的概念已经被删除了。</p>\n<h1 id=\"es-api\"><a class=\"anchor\" href=\"#es-api\">#</a> ES API</h1>\n<h2 id=\"创建索引\"><a class=\"anchor\" href=\"#创建索引\">#</a> 创建索引</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> PUT <span class=\"token number\">192.168</span>.10.100:9200/www</pre></td></tr></table></figure><p>输出:</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"acknowledged\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 响应结果</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"shards_acknowledged\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 分片结果</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"www\"</span><span class=\"token comment\">// 索引名称</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>重复发送：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"error\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"root_cause\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"resource_already_exists_exception\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                <span class=\"token property\">\"reason\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index [shopping/J0WlEhh4R7aDrfIc3AkwWQ] already exists\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token property\">\"index_uuid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"J0WlEhh4R7aDrfIc3AkwWQ\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"resource_already_exists_exception\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token property\">\"reason\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"index [shopping/J0WlEhh4R7aDrfIc3AkwWQ] already exists\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"index_uuid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"J0WlEhh4R7aDrfIc3AkwWQ\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token property\">\"status\"</span><span class=\"token operator\">:</span> <span class=\"token number\">400</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"查看健康状态\"><a class=\"anchor\" href=\"#查看健康状态\">#</a> 查看健康状态</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> GET <span class=\"token number\">192.168</span>.10.100:9200/_cat/health?v</pre></td></tr></table></figure><h2 id=\"查询所有索引\"><a class=\"anchor\" href=\"#查询所有索引\">#</a> 查询所有索引</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> GET <span class=\"token number\">192.168</span>.10.100:9200/_cat/indices?v</pre></td></tr></table></figure><p>这里请求路径中的_cat 表示查看的意思， indices 表示索引，所以整体含义就是查看当前 ES 服务器中的所有索引，就好像 MySQL 中的 show tables 的感觉，服务器响应结果如下 :</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>health status index                           uuid                   pri rep docs.count docs.deleted store.size pri.store.size</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>green  open   .kibana_task_manager_7.13.1_001 Jp6kivOgSlS3msJfLPptaA   1   0         10            3    119.6kb        119.6kb</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>green  open   .apm-custom-link                lZ8SB-tfT-CZfY6g9aVePA   1   0          0            0       208b           208b</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>yellow open   fund                            kVUWo0J8SEqPe7M4qWBalQ   1   1          0            0       208b           208b</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>yellow open   www                             YcZKzL2hRDiI0RVtdTLj0w   1   1          0            0       208b           208b</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>green  open   .apm-agent-configuration        YBy232SXQKCCBqdPHZhFKw   1   0          0            0       208b           208b</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>green  open   .kibana-event-log-7.13.1-000001 WfHlPuubRJytriWq8ld3mA   1   0          1            0      5.6kb          5.6kb</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>green  open   .kibana_7.13.1_001              Ox-zOiolQ-Wc0StQe9G89A   1   0         10            1      2.1mb          2.1mb</pre></td></tr></table></figure><table>\n<thead>\n<tr>\n<th>表头</th>\n<th>含义</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>health</td>\n<td>当前服务器健康状态：green (集群完整) yellow (单点正常、集群不完整) red (单点不正常)</td>\n</tr>\n<tr>\n<td>status</td>\n<td>索引打开、关闭状态</td>\n</tr>\n<tr>\n<td>index</td>\n<td>索引统一编号</td>\n</tr>\n<tr>\n<td>pri</td>\n<td>主分片数量</td>\n</tr>\n<tr>\n<td>rep</td>\n<td>副本数量</td>\n</tr>\n<tr>\n<td>docs.count</td>\n<td>可用文档数量</td>\n</tr>\n<tr>\n<td>docs.deleted</td>\n<td>文档删除状态（逻辑删除）</td>\n</tr>\n<tr>\n<td>store.size</td>\n<td>主分片和副分片整体占空间大小</td>\n</tr>\n<tr>\n<td>pri.store.size</td>\n<td>主分片占空间大小</td>\n</tr>\n</tbody>\n</table>\n<h2 id=\"查看单个索引\"><a class=\"anchor\" href=\"#查看单个索引\">#</a> 查看单个索引</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> GET <span class=\"token number\">192.168</span>.10.100:9200/www</pre></td></tr></table></figure><p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"shopping\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// 索引名</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"aliases\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 别名</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 映射</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"settings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// 设置</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// 设置 - 索引</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token property\">\"creation_date\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1617861426847\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 设置 - 索引 - 创建时间</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token property\">\"number_of_shards\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 设置 - 索引 - 主分片数量</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token property\">\"number_of_replicas\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 设置 - 索引 - 主分片数量</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token property\">\"uuid\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"J0WlEhh4R7aDrfIc3AkwWQ\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 设置 - 索引 - 主分片数量</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token property\">\"version\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// 设置 - 索引 - 主分片数量</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                    <span class=\"token property\">\"created\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"7080099\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token property\">\"provided_name\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token comment\">// 设置 - 索引 - 主分片数量</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"创建文档\"><a class=\"anchor\" href=\"#创建文档\">#</a> 创建文档</h2>\n<p>假设索引已经创建好了，接下来我们来创建文档，并添加数据。这里的文档可以类比为关系型数据库中的表数据，添加的数据格式为 JSON 格式</p>\n<p>在 Postman 中，向 ES 服务器发 POST 请求 :  <code>http://192.168.10.100:9200/shopping/_doc</code> ，请求体 JSON 内容为：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span><span class=\"token number\">3999.00</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>注意，此处发送请求的方式必须为 POST，不能是 PUT，否则会发生错误 。</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 索引</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 类型 - 文档</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ANQqsHgBaKNfVnMbhZYU\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 唯一标识，可以类比为 MySQL 中的主键，随机生成</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 版本</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"result\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"created\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 结果，这里的 create 表示创建成功</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token comment\">//</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 分片 - 总数</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 分片 - 总数</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token comment\">// 分片 - 总数</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token property\">\"_seq_no\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token property\">\"_primary_term\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>上面的数据创建后，由于没有指定数据唯一性标识（ID），默认情况下， ES 服务器会随机生成一个。</p>\n<p>如果想要自定义唯一性标识，需要在创建时指定：  <code>http://192.168.10.100:9200/shopping/_doc/1</code> ，请求体 JSON 内容为：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span><span class=\"token number\">3999.00</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">//&lt;------------------ 自定义唯一性标识</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"result\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"created\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token property\">\"_seq_no\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token property\">\"_primary_term\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><strong>此处需要注意：如果增加数据时明确数据主键，那么请求方式也可以为 PUT。</strong></p>\n<h2 id=\"查询文档\"><a class=\"anchor\" href=\"#查询文档\">#</a> 查询文档</h2>\n<h3 id=\"主键查询\"><a class=\"anchor\" href=\"#主键查询\">#</a> 主键查询</h3>\n<p>查看文档时，需要指明文档的唯一性标识，类似于 MySQL 中数据的主键查询</p>\n<p>在 Postman 中，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_doc/1</code>  返回结果如下：</p>\n<p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"_seq_no\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"_primary_term\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token property\">\"found\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3999</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>查找不存在的内容，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_doc/1001</code></p>\n<p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1001\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"found\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"全查询\"><a class=\"anchor\" href=\"#全查询\">#</a> 全查询</h3>\n<p>查看索引下所有数据，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_search</code></p>\n<p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"took\"</span><span class=\"token operator\">:</span> <span class=\"token number\">133</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"timed_out\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"skipped\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token property\">\"relation\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"max_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ANQqsHgBaKNfVnMbhZYU\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3999</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3999</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"修改文档\"><a class=\"anchor\" href=\"#修改文档\">#</a> 修改文档</h2>\n<h3 id=\"全量修改\"><a class=\"anchor\" href=\"#全量修改\">#</a> 全量修改</h3>\n<p>和新增文档一样，输入相同的 URL 地址请求，如果请求体变化，会将原有的数据内容覆盖</p>\n<p>在 Postman 中，向 ES 服务器发 POST 请求 ：  <code>http://192.168.10.100:9200/shopping/_doc/1</code></p>\n<p>请求体 JSON 内容为:</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"华为手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"华为\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"http://www.gulixueyuan.com/hw.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span><span class=\"token number\">1999.00</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>修改成功后，服务器响应结果：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"result\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"updated\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">//&lt;-----------updated 表示数据被更新</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token property\">\"_seq_no\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token property\">\"_primary_term\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"局部修改\"><a class=\"anchor\" href=\"#局部修改\">#</a> 局部修改</h3>\n<p>修改数据时，也可以只修改某一给条数据的局部信息</p>\n<p>在 Postman 中，向 ES 服务器发 POST 请求 ：  <code>http://192.168.10.100:9200/shopping/_update/1</code></p>\n<p>请求体 JSON 内容为:</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"doc\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"小米\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"result\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"updated\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">//&lt;-----------updated 表示数据被更新</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token property\">\"_seq_no\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token property\">\"_primary_term\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"删除文档\"><a class=\"anchor\" href=\"#删除文档\">#</a> 删除文档</h2>\n<p>删除一个文档不会立即从磁盘上移除，它只是被标记成已删除（逻辑删除）。</p>\n<p>在 Postman 中，向 ES 服务器发 <code>DELETE</code>  请求 ：  <code>http://192.168.10.100:9200/shopping/_doc/1</code></p>\n<p>返回结果：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"1\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"_version\"</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"result\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"deleted\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">//&lt;--- 删除成功</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">2</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token property\">\"_seq_no\"</span><span class=\"token operator\">:</span> <span class=\"token number\">4</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token property\">\"_primary_term\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"高级查询\"><a class=\"anchor\" href=\"#高级查询\">#</a> 高级查询</h2>\n<h3 id=\"条件查询\"><a class=\"anchor\" href=\"#条件查询\">#</a> 条件查询</h3>\n<p>假设有以下文档内容：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"took\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"timed_out\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"skipped\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token property\">\"relation\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"max_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ANQqsHgBaKNfVnMbhZYU\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3999</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A9R5sHgBaKNfVnMb25Ya\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"BNR5sHgBaKNfVnMb7pal\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"BtR6sHgBaKNfVnMbX5Y5\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"B9R6sHgBaKNfVnMbZpZ6\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CdR7sHgBaKNfVnMbsJb9\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"请求体带参查询\"><a class=\"anchor\" href=\"#请求体带参查询\">#</a> 请求体带参查询</h4>\n<p><strong>查找 category 为小米的文档</strong>，在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"小米\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"took\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"timed_out\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"skipped\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token property\">\"relation\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"max_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.3862942</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ANQqsHgBaKNfVnMbhZYU\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.3862942</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3999</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A9R5sHgBaKNfVnMb25Ya\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.3862942</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"BNR5sHgBaKNfVnMb7pal\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1.3862942</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"查找所有文档内容\"><a class=\"anchor\" href=\"#查找所有文档内容\">#</a> 查找所有文档内容</h4>\n<p>在 Postman 中，向 ES 服务器发 GET 请求： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>则返回所有文档内容。</p>\n<h4 id=\"查询指定字段\"><a class=\"anchor\" href=\"#查询指定字段\">#</a> 查询指定字段</h4>\n<p>在 Postman 中，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token string\">\"title\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"分页查询\"><a class=\"anchor\" href=\"#分页查询\">#</a> 分页查询</h4>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"from\"</span><span class=\"token operator\">:</span><span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span><span class=\"token number\">2</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"查询排序\"><a class=\"anchor\" href=\"#查询排序\">#</a> 查询排序</h4>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"match_all\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"sort\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token property\">\"order\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"desc\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"多条件查询\"><a class=\"anchor\" href=\"#多条件查询\">#</a> 多条件查询</h3>\n<p>假设想找出小米牌子，价格为 3999 元的。（must 相当于数据库的 &amp;&amp;）</p>\n<p>在 Postman 中，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"bool\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token property\">\"must\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"小米\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span><span class=\"token number\">3999.00</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>假设想找出小米和华为的牌子。（should 相当于数据库的 ||）</p>\n<p>在 Postman 中，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"bool\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token property\">\"should\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"小米\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"华为\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token property\">\"range\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                    <span class=\"token property\">\"gt\"</span><span class=\"token operator\">:</span><span class=\"token number\">2000</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"范围查询\"><a class=\"anchor\" href=\"#范围查询\">#</a> 范围查询</h3>\n<p>假设想找出小米和华为的牌子，价格大于 2000 元的手机。</p>\n<p>在 Postman 中，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"bool\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token property\">\"should\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"小米\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"华为\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token property\">\"filter\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token property\">\"range\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>                        <span class=\"token property\">\"gt\"</span><span class=\"token operator\">:</span><span class=\"token number\">2000</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>                    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"全文检索\"><a class=\"anchor\" href=\"#全文检索\">#</a> 全文检索</h3>\n<p>这功能像搜索引擎那样，如品牌输入 “小华”，返回结果带回品牌有 “小米” 和” 华为” 的。</p>\n<p>在 Postman 中，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token property\">\"category\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"小华\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"完全匹配\"><a class=\"anchor\" href=\"#完全匹配\">#</a> 完全匹配</h3>\n<p>在 Postman 中，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"match_phrase\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token property\">\"category\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"为\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"高亮查询\"><a class=\"anchor\" href=\"#高亮查询\">#</a> 高亮查询</h3>\n<p>在 Postman 中，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"match_phrase\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token property\">\"category\"</span> <span class=\"token operator\">:</span> <span class=\"token string\">\"为\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token property\">\"highlight\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"fields\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>            <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token comment\">//&lt;---- 高亮这字段</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"took\"</span><span class=\"token operator\">:</span> <span class=\"token number\">100</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"timed_out\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"skipped\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token property\">\"relation\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"max_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0.6931471</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"BtR6sHgBaKNfVnMbX5Y5\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0.6931471</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                <span class=\"token property\">\"highlight\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                        <span class=\"token string\">\"华&lt;em>为&lt;/em>\"</span><span class=\"token comment\">//&lt;------ 高亮一个为字。</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                    <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"B9R6sHgBaKNfVnMbZpZ6\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0.6931471</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token property\">\"highlight\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                        <span class=\"token string\">\"华&lt;em>为&lt;/em>\"</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                    <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CdR7sHgBaKNfVnMbsJb9\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0.6931471</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                <span class=\"token property\">\"highlight\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                        <span class=\"token string\">\"华&lt;em>为&lt;/em>\"</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                    <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"聚合查询\"><a class=\"anchor\" href=\"#聚合查询\">#</a> 聚合查询</h3>\n<h4 id=\"带原始数据\"><a class=\"anchor\" href=\"#带原始数据\">#</a> 带原始数据</h4>\n<p>聚合允许使用者对 es 文档进行统计分析，类似与关系型数据库中的 group by，当然还有很多其他的聚合，例如取最大值 max、平均值 avg 等等。</p>\n<p>接下来按 price 字段进行分组：</p>\n<p>在 Postman 中，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// 聚合操作</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"price_group\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// 名称，随意起名</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token property\">\"terms\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// 分组</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"price\"</span><span class=\"token comment\">// 分组字段</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"took\"</span><span class=\"token operator\">:</span> <span class=\"token number\">63</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"timed_out\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"skipped\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token property\">\"relation\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"max_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"ANQqsHgBaKNfVnMbhZYU\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3999</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"A9R5sHgBaKNfVnMb25Ya\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"BNR5sHgBaKNfVnMb7pal\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"BtR6sHgBaKNfVnMbX5Y5\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"B9R6sHgBaKNfVnMbZpZ6\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>            <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                <span class=\"token property\">\"_index\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"shopping\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre>                <span class=\"token property\">\"_type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"_doc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre>                <span class=\"token property\">\"_id\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"CdR7sHgBaKNfVnMbsJb9\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"81\"></td><td><pre>                <span class=\"token property\">\"_score\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"82\"></td><td><pre>                <span class=\"token property\">\"_source\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"83\"></td><td><pre>                    <span class=\"token property\">\"title\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为手机\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre>                    <span class=\"token property\">\"category\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"华为\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre>                    <span class=\"token property\">\"images\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"http://www.gulixueyuan.com/xm.jpg\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"86\"></td><td><pre>                    <span class=\"token property\">\"price\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"88\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>        <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>    <span class=\"token property\">\"aggregations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>        <span class=\"token property\">\"price_group\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>            <span class=\"token property\">\"doc_count_error_upper_bound\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>            <span class=\"token property\">\"sum_other_doc_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>            <span class=\"token property\">\"buckets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                    <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>                    <span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>                    <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3999</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>                    <span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>            <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"不带原始数据\"><a class=\"anchor\" href=\"#不带原始数据\">#</a> 不带原始数据</h4>\n<p>在 Postman 中，向 ES 服务器发 GET 请求 ：  <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"price_group\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token property\">\"terms\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"price\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"took\"</span><span class=\"token operator\">:</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"timed_out\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"skipped\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token number\">6</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token property\">\"relation\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"max_score\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token property\">\"aggregations\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token property\">\"price_group\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token property\">\"doc_count_error_upper_bound\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>            <span class=\"token property\">\"sum_other_doc_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>            <span class=\"token property\">\"buckets\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>                    <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1999</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>                    <span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">5</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>                <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>                    <span class=\"token property\">\"key\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3999</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>                    <span class=\"token property\">\"doc_count\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>            <span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h4 id=\"平均值\"><a class=\"anchor\" href=\"#平均值\">#</a> 平均值</h4>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"aggs\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"price_avg\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// 名称，随意起名</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token property\">\"avg\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span><span class=\"token comment\">// 求平均</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token property\">\"field\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"price\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token property\">\"size\"</span><span class=\"token operator\">:</span><span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"映射关系\"><a class=\"anchor\" href=\"#映射关系\">#</a> 映射关系</h2>\n<p>创建数据库表需要设置字段名称，类型，长度，约束等；索引库也一样，需要知道这个类型下有哪些字段，每个字段有哪些约束信息，这就叫做映射 (mapping)。</p>\n<p>先创建一个索引：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>PUT http://192.168.10.100:9200/user</pre></td></tr></table></figure><h3 id=\"创建映射\"><a class=\"anchor\" href=\"#创建映射\">#</a> 创建映射</h3>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre># PUT http<span class=\"token operator\">:</span><span class=\"token comment\">//127.0.0.1:9200/user/_mapping</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        <span class=\"token property\">\"sex\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token property\">\"tel\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>            <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"查询映射\"><a class=\"anchor\" href=\"#查询映射\">#</a> 查询映射</h3>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET http<span class=\"token operator\">:</span><span class=\"token comment\">//127.0.0.1:9200/user/_mapping</span></pre></td></tr></table></figure><p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"user\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        <span class=\"token property\">\"mappings\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>            <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>                <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>                    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"text\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>                <span class=\"token property\">\"sex\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>                    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>                <span class=\"token property\">\"tel\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>                    <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"keyword\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>                    <span class=\"token property\">\"index\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>                <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>            <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>增加数据：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>PUT http<span class=\"token operator\">:</span><span class=\"token comment\">//127.0.0.1:9200/user/_create/1001</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"name\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"小米\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"sex\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"男的\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token property\">\"tel\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"1111\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>设置为 <code>keyword</code>  的只能完全匹配</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GET http<span class=\"token operator\">:</span><span class=\"token comment\">//127.0.0.1:9200/user/_search</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"query\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        <span class=\"token property\">\"match\"</span><span class=\"token operator\">:</span><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>            <span class=\"token property\">\"sex\"</span><span class=\"token operator\">:</span><span class=\"token string\">\"男\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"took\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token property\">\"timed_out\"</span><span class=\"token operator\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"_shards\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        <span class=\"token property\">\"successful\"</span><span class=\"token operator\">:</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>        <span class=\"token property\">\"skipped\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token property\">\"failed\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token property\">\"total\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token property\">\"value\"</span><span class=\"token operator\">:</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            <span class=\"token property\">\"relation\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"eq\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token property\">\"max_score\"</span><span class=\"token operator\">:</span> <span class=\"token null keyword\">null</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token property\">\"hits\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p><code>index</code>  设置为 false 查询不到</p>\n<h3 id=\"动态映射\"><a class=\"anchor\" href=\"#动态映射\">#</a> 动态映射</h3>\n<p>Elasticsearch 具有一项称为 “动态映射”（Dynamic Mapping）的功能，它允许在插入文档时自动创建映射，而无需预先定义映射。这意味着您可以向索引中插入文档，Elasticsearch 会根据文档的结构自动创建相应的映射。这对于快速开始和灵活的数据处理非常有用。</p>\n<h2 id=\"删除索引\"><a class=\"anchor\" href=\"#删除索引\">#</a> 删除索引</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">curl</span> <span class=\"token parameter variable\">-X</span> DELETE <span class=\"token number\">192.168</span>.10.100:9200/www</pre></td></tr></table></figure><p>输出：</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token property\">\"acknowledged\"</span><span class=\"token operator\">:</span><span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"kibana\"><a class=\"anchor\" href=\"#kibana\">#</a> Kibana</h1>\n<h1 id=\"logstash\"><a class=\"anchor\" href=\"#logstash\">#</a> Logstash</h1>\n<h2 id=\"实践\"><a class=\"anchor\" href=\"#实践\">#</a> 实践</h2>\n<p>创建一个 <code>logstash.conf</code></p>\n<figure class=\"highlight ruby\"><figcaption data-lang=\"ruby\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>input <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  file <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    path <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"/home/elk/log.log\"</span></span> <span class=\"token comment\"># 日志目录 </span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    start_position <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"beginning\"</span></span> <span class=\"token comment\"># 从开头开始采集数据</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    sincedb_path <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"/dev/null\"</span></span> <span class=\"token comment\"># 每次重新启动 Logstash 时，它都会从文件的开头开始读取数据。</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>filter <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token comment\"># grok 插件，匹配规则</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  grok <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    match <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span> <span class=\"token string-literal\"><span class=\"token string\">\"message\"</span></span> <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"%&#123;TIMESTAMP_ISO8601:timestamp&#125; %&#123;LOGLEVEL:loglevel&#125; %&#123;GREEDYDATA:msg&#125;\"</span></span> <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> </pre></td></tr><tr><td data-num=\"14\"></td><td><pre> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre>  mutate <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\"># 删除不想要的字段，某些固定字段无法删除</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        remove_field <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">\"message\"</span></span><span class=\"token punctuation\">,</span><span class=\"token string-literal\"><span class=\"token string\">\"path\"</span></span><span class=\"token punctuation\">,</span><span class=\"token string-literal\"><span class=\"token string\">\"@version\"</span></span><span class=\"token punctuation\">,</span><span class=\"token string-literal\"><span class=\"token string\">\"host\"</span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"19\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>output <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>  elasticsearch <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    hosts <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">\"elasticsearch:9200\"</span></span><span class=\"token punctuation\">]</span> <span class=\"token comment\"># es 主机地址</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    index <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"log\"</span></span> <span class=\"token comment\"># 需要发送的索引，无需提前创建 index 和 mapping</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>然后把这个文件挂载到容器里，在 <code>logstash</code>  的 <code>volumes</code>  字段里加入，宿主机目录可以自定义。</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>- \"./logstash.conf:/usr/share/logstash/pipeline/logstash.conf\"</pre></td></tr></table></figure><p>随便创建一个目录用于存储目录文件</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /home/elk/log.log</pre></td></tr></table></figure><p><code>vim</code>  写一点内容</p>\n<figure class=\"highlight lua\"><figcaption data-lang=\"lua\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">08</span><span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token number\">15</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">45</span> INFO This is an informational log message<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">08</span><span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token number\">15</span><span class=\"token punctuation\">:</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">12</span> ERROR An error occurred <span class=\"token keyword\">in</span> the application<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">08</span><span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token number\">15</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span><span class=\"token punctuation\">:</span><span class=\"token number\">05</span> WARNING This is a warning message<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">08</span><span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token number\">15</span><span class=\"token punctuation\">:</span><span class=\"token number\">33</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> INFO Another informational log entry<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">08</span><span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token number\">15</span><span class=\"token punctuation\">:</span><span class=\"token number\">34</span><span class=\"token punctuation\">:</span><span class=\"token number\">05</span> DEBUG Debugging information <span class=\"token keyword\">for</span> troubleshooting<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">08</span><span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token number\">15</span><span class=\"token punctuation\">:</span><span class=\"token number\">30</span><span class=\"token punctuation\">:</span><span class=\"token number\">45</span> INFO This is an informational log message<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">08</span><span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token number\">15</span><span class=\"token punctuation\">:</span><span class=\"token number\">31</span><span class=\"token punctuation\">:</span><span class=\"token number\">12</span> ERROR An error occurred <span class=\"token keyword\">in</span> the application<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">08</span><span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token number\">15</span><span class=\"token punctuation\">:</span><span class=\"token number\">32</span><span class=\"token punctuation\">:</span><span class=\"token number\">05</span> WARNING This is a warning message<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">08</span><span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token number\">15</span><span class=\"token punctuation\">:</span><span class=\"token number\">33</span><span class=\"token punctuation\">:</span><span class=\"token number\">20</span> INFO Another informational log entry<span class=\"token punctuation\">.</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token number\">2023</span><span class=\"token operator\">-</span><span class=\"token number\">08</span><span class=\"token operator\">-</span><span class=\"token number\">20</span> <span class=\"token number\">15</span><span class=\"token punctuation\">:</span><span class=\"token number\">34</span><span class=\"token punctuation\">:</span><span class=\"token number\">05</span> DEBUG Debugging information <span class=\"token keyword\">for</span> troubleshooting<span class=\"token punctuation\">.</span></pre></td></tr></table></figure><p><code>Discover</code>  里查看一下</p>\n<p><img data-src=\"https://s2.loli.net/2024/02/17/PnQjMpF4LVRa1EA.png\" alt=\"discover.png\" /></p>\n<p><code>logstash.conf</code>  使用了 <code>ruby</code>  语言，如果不会的话，我们就对 <code>chatgpt</code>  提需求吧！</p>\n<figure class=\"highlight ruby\"><figcaption data-lang=\"ruby\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>input <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  file <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    path <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"/home/project/GoYin/api/tmp/klog/logs/*.log\"</span></span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    start_position <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"beginning\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    sincedb_path <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"/dev/null\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    codec <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"json\"</span></span> <span class=\"token comment\"># 如果日志是 JSON 格式的</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    tags <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">\"klog\"</span></span><span class=\"token punctuation\">]</span>     <span class=\"token comment\"># 为这个输入添加一个标签以区分日志类型</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  file <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    path <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"/home/project/GoYin/api/tmp/hlog/logs/*.log\"</span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    start_position <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"beginning\"</span></span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    sincedb_path <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"/dev/null\"</span></span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    codec <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"json\"</span></span> <span class=\"token comment\"># 如果您的日志是 JSON 格式的</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    tags <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">\"hlog\"</span></span><span class=\"token punctuation\">]</span>     <span class=\"token comment\"># 为这个输入添加一个标签以区分日志类型</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>filter <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token string-literal\"><span class=\"token string\">\"klog\"</span></span> <span class=\"token keyword\">in</span> <span class=\"token punctuation\">[</span>tags<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token comment\"># 对于以 \"klog\" 标签标记的日志，您可以在这里进行特定的过滤和处理</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token string-literal\"><span class=\"token string\">\"hlog\"</span></span> <span class=\"token keyword\">in</span> <span class=\"token punctuation\">[</span>tags<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token comment\"># 对于以 \"hlog\" 标签标记的日志，您可以在这里进行特定的过滤和处理</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>output <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>  <span class=\"token keyword\">if</span> <span class=\"token string-literal\"><span class=\"token string\">\"klog\"</span></span> <span class=\"token keyword\">in</span> <span class=\"token punctuation\">[</span>tags<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    elasticsearch <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      hosts <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">\"your_elasticsearch_host\"</span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      index <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"klog-%&#123;+YYYY.MM.dd&#125;\"</span></span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token keyword\">if</span> <span class=\"token string-literal\"><span class=\"token string\">\"hlog\"</span></span> <span class=\"token keyword\">in</span> <span class=\"token punctuation\">[</span>tags<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    elasticsearch <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      hosts <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">\"your_elasticsearch_host\"</span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      index <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"hlog-%&#123;+YYYY.MM.dd&#125;\"</span></span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\"># %&#123;+YYYY.MM.dd&#125; 会自动赋予当前日期</span></pre></td></tr></table></figure><h2 id=\"conf文件说明\"><a class=\"anchor\" href=\"#conf文件说明\">#</a> conf 文件说明</h2>\n<h3 id=\"input\"><a class=\"anchor\" href=\"#input\">#</a> Input</h3>\n<p>事件源可以是从 stdin 屏幕输入读取，可以从 file 指定的文件，也可以从 es，filebeat，kafka，redis 等读取</p>\n<ul>\n<li>\n<p><strong>stdin</strong> 标准输入</p>\n</li>\n<li>\n<p><strong>file</strong> 从文件读取数据</p>\n</li>\n<li>\n<p><strong>syslog</strong> 通过网络将系统日志消息读取为事件</p>\n</li>\n</ul>\n<h3 id=\"filter\"><a class=\"anchor\" href=\"#filter\">#</a> Filter</h3>\n<h3 id=\"output\"><a class=\"anchor\" href=\"#output\">#</a> Output</h3>\n<h2 id=\"mysql数据库同步\"><a class=\"anchor\" href=\"#mysql数据库同步\">#</a> Mysql 数据库同步</h2>\n<p>用 <code>docker-compose</code>  快速部署 <code>MySQL</code>  数据库</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">mysql</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span>latest</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> mysql</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">MYSQL_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token number\">224488</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">MYSQL_DATABASE</span><span class=\"token punctuation\">:</span> herbal</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"13306:3306\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./mysql_data:/var/lib/mysql\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./init.sql:/docker-entrypoint-initdb.d/init.sql\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">-</span> elk</pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\"># 和刚才的放在一个 yml 文件里</span></pre></td></tr></table></figure><p><code>init.sql</code></p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">USE</span> herbal<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> herbs <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  id <span class=\"token keyword\">INT</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  name <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>  botanical_name <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">255</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> herbs <span class=\"token punctuation\">(</span>name<span class=\"token punctuation\">,</span> botanical_name<span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token string\">'Herb 1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Botanical 1'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token string\">'Herb 2'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Botanical 2'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token string\">'Herb 3'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Botanical 3'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>下载 jar 包</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">wget</span> <span class=\"token parameter variable\">-P</span> jdbc_driver https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.26/mysql-connector-java-8.0.26.jar</pre></td></tr></table></figure><p><code>logstash</code>  中加上 jar 包的挂载路径</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">logstash</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> docker.elastic.co/logstash/logstash<span class=\"token punctuation\">:</span>7.13.1</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> logstash</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./logstash.conf:/usr/share/logstash/pipeline/logstash.conf\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"/home/elk/log.log:/log/log.log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./jdbc_driver/mysql-connector-java-8.0.26.jar:/jdbc_driver/mysql-connector-java-8.0.26.jar\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"XPACK_MONITORING_ENABLED=false\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">-</span> elasticsearch</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> elk</pre></td></tr></table></figure><p>修改 <code>logstash.conf</code></p>\n<figure class=\"highlight ruby\"><figcaption data-lang=\"ruby\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>input <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  jdbc <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    jdbc_connection_string <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"jdbc:mysql://mysql:13306/herbal\"</span></span> <span class=\"token comment\"># mysql 更换成你的 mysql 主机 ip</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    jdbc_user <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"root\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    jdbc_password <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"224488\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    jdbc_driver_library <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"/jdbc_driver/mysql-connector-java-8.0.26.jar\"</span></span> <span class=\"token comment\"># 容器内的路径</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    jdbc_driver_class <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"com.mysql.cj.jdbc.Driver\"</span></span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    statement <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"SELECT * FROM herbs\"</span></span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    schedule <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"* * * * *\"</span></span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>filter <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre> </pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>output <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>  elasticsearch <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    hosts <span class=\"token operator\">=></span> <span class=\"token punctuation\">[</span><span class=\"token string-literal\"><span class=\"token string\">\"elasticsearch:9200\"</span></span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>    index <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"mysql_data\"</span></span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"geo使用策略\"><a class=\"anchor\" href=\"#geo使用策略\">#</a> Geo 使用策略</h2>\n<p>目前只实践成功一个方案，可以让 <code>kibana</code>  的 <code>maps</code>  识别到经纬度的数据，先把 <code>logstash</code>  关闭，1.2 步结束再关。</p>\n<ol>\n<li>\n<p>创建好要导入的索引</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>PUT http://<span class=\"token punctuation\">&#123;</span>ip<span class=\"token punctuation\">&#125;</span>:<span class=\"token punctuation\">&#123;</span>port<span class=\"token punctuation\">&#125;</span>/<span class=\"token punctuation\">&#123;</span>your_index<span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p>添加 <code>location</code>  字段类型为 <code>geo_point</code>  (因为 <code>logstash</code>  自动搜集信息时不支持设置为此字段)</p>\n<figure class=\"highlight json\"><figcaption data-lang=\"JSON\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// PUT http://&#123;ip&#125;:&#123;port&#125;/&#123;your_index&#125;/_mapping</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token property\">\"properties\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token property\">\"location\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token property\">\"type\"</span><span class=\"token operator\">:</span> <span class=\"token string\">\"geo_point\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p><code>logstash.conf</code>  的 <code>filter</code>  部分</p>\n<figure class=\"highlight ruby\"><figcaption data-lang=\"ruby\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 提前解析出来 \"latitude\" 和 \"longitude\" 字段</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  mutate <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    convert <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>      <span class=\"token string-literal\"><span class=\"token string\">\"latitude\"</span></span> <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"float\"</span></span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token string-literal\"><span class=\"token string\">\"longitude\"</span></span> <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"float\"</span></span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   mutate <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    add_field <span class=\"token operator\">=></span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token string-literal\"><span class=\"token string\">\"location\"</span></span> <span class=\"token operator\">=></span> <span class=\"token string-literal\"><span class=\"token string\">\"%&#123;[latitude]&#125;,%&#123;[longitude]&#125;\"</span></span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>  <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure></li>\n<li>\n<p><code>kibana</code>  的 <code>maps</code>  可以自动选择 <code>location</code>  字段</p>\n<p><img data-src=\"https://s2.loli.net/2023/09/11/IfdVGohip5yRxYD.png\" alt=\"1IEOK@V_9VRENT7DQ_@IJ`0.png\" /></p>\n</li>\n</ol>\n<h1 id=\"完整部署参考\"><a class=\"anchor\" href=\"#完整部署参考\">#</a> 完整部署参考</h1>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"2\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  <span class=\"token key atrule\">mysql</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span><span class=\"token number\">5.7</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> mysql</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">MYSQL_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token number\">224488</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token key atrule\">MYSQL_DATABASE</span><span class=\"token punctuation\">:</span> herbal</pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"13306:3306\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./mysql_data:/var/lib/mysql\"</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./init.sql:/docker-entrypoint-initdb.d/init.sql\"</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">-</span> elk</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>  <span class=\"token key atrule\">elasticsearch</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> elasticsearch<span class=\"token punctuation\">:</span>7.13.1</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> elasticsearch</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./elasticsearch_data:/bitnami/elasticsearch\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9200:9200\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9300:9300\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token punctuation\">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token punctuation\">-</span> discovery.type=single<span class=\"token punctuation\">-</span>node</pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"ES_JAVA_OPTS=-Xms512m -Xmx512m\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token key atrule\">privileged</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>    <span class=\"token key atrule\">ulimits</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token key atrule\">nofile</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token key atrule\">soft</span><span class=\"token punctuation\">:</span> <span class=\"token number\">65536</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>        <span class=\"token key atrule\">hard</span><span class=\"token punctuation\">:</span> <span class=\"token number\">65536</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token punctuation\">-</span> elk</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>  <span class=\"token key atrule\">kibana</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> kibana<span class=\"token punctuation\">:</span>7.13.1</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> kibana</pre></td></tr><tr><td data-num=\"38\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>      <span class=\"token punctuation\">-</span> elasticsearch.hosts=http<span class=\"token punctuation\">:</span>//elasticsearch<span class=\"token punctuation\">:</span><span class=\"token number\">9200</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token punctuation\">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"5601:5601\"</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./kibana_data:/bitnami/kibana\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token punctuation\">-</span> elasticsearch</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>      <span class=\"token punctuation\">-</span> elk</pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token key atrule\">logstash</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> docker.elastic.co/logstash/logstash<span class=\"token punctuation\">:</span>7.13.1</pre></td></tr><tr><td data-num=\"52\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> logstash</pre></td></tr><tr><td data-num=\"53\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./logstash.conf:/usr/share/logstash/pipeline/logstash.conf\"</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"/home/elk/log/:/home/elk/log/\"</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"./jdbc_driver/mysql-connector-java-8.0.26.jar:/jdbc_driver/mysql-connector-java-8.0.26.jar\"</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"XPACK_MONITORING_ENABLED=false\"</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>      <span class=\"token punctuation\">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num=\"60\"></td><td><pre>    <span class=\"token key atrule\">depends_on</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>      <span class=\"token punctuation\">-</span> elasticsearch</pre></td></tr><tr><td data-num=\"62\"></td><td><pre>    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>      <span class=\"token punctuation\">-</span> elk</pre></td></tr><tr><td data-num=\"64\"></td><td><pre>  <span class=\"token key atrule\">phpmyadmin</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> phpmyadmin<span class=\"token punctuation\">:</span>latest</pre></td></tr><tr><td data-num=\"66\"></td><td><pre>    <span class=\"token key atrule\">container_name</span><span class=\"token punctuation\">:</span> phpadmin</pre></td></tr><tr><td data-num=\"67\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"3300:80\"</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>      <span class=\"token key atrule\">PMA_ARBITRARY</span><span class=\"token punctuation\">:</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>      <span class=\"token key atrule\">PMA_HOST</span><span class=\"token punctuation\">:</span> mysql</pre></td></tr><tr><td data-num=\"72\"></td><td><pre>      <span class=\"token key atrule\">PMA_USER</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"73\"></td><td><pre>      <span class=\"token key atrule\">PMA_PASSWORD</span><span class=\"token punctuation\">:</span> <span class=\"token number\">224488</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>    <span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>      <span class=\"token punctuation\">-</span> elk</pre></td></tr><tr><td data-num=\"76\"></td><td><pre><span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>  <span class=\"token key atrule\">elk</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>    <span class=\"token key atrule\">external</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr></table></figure><h1 id=\"参考链接\"><a class=\"anchor\" href=\"#参考链接\">#</a> 参考链接</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTA0MDUxOTk0MjYzNTU5\">https://juejin.cn/post/6844904051994263559</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cubGl3ZW56aG91LmNvbS9wb3N0cy9Hby9lbGFzdGljc2VhcmNoLw==\">https://www.liwenzhou.com/posts/Go/elasticsearch/</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTE4NjMwMjQvYXJ0aWNsZS9kZXRhaWxzLzExNTcyMTMyOA==\">https://blog.csdn.net/u011863024/article/details/115721328</span></p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ppbmVEL2FydGljbGUvZGV0YWlscy8xMTQ0NDQyMzk=\">https://blog.csdn.net/JineD/article/details/114444239</span></p>\n",
            "tags": [
                "后端",
                "elk"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2024/02/07/%E5%90%8E%E7%AB%AF/Traefik%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "url": "https://withoutabc.github.io/2024/02/07/%E5%90%8E%E7%AB%AF/Traefik%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "title": "Traefik部署及使用",
            "date_published": "2024-02-06T16:50:56.000Z",
            "content_html": "<h1 id=\"docker-compose-部署\"><a class=\"anchor\" href=\"#docker-compose-部署\">#</a> Docker-compose 部署</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">docker</span> create network traefik</pre></td></tr></table></figure><figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">traefik</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> traefik<span class=\"token punctuation\">:</span>v3.0.0<span class=\"token punctuation\">-</span>beta3</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>       <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> <span class=\"token number\">80</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>       <span class=\"token key atrule\">published</span><span class=\"token punctuation\">:</span> <span class=\"token number\">79</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>       <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> tcp</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>       <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> host</pre></td></tr><tr><td data-num=\"12\"></td><td><pre>       <span class=\"token punctuation\">-</span> <span class=\"token key atrule\">target</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8078</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>       <span class=\"token key atrule\">published</span><span class=\"token punctuation\">:</span> <span class=\"token number\">8080</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>       <span class=\"token key atrule\">protocol</span><span class=\"token punctuation\">:</span> tcp</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>       <span class=\"token key atrule\">mode</span><span class=\"token punctuation\">:</span> host</pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"--api=true\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"--api.dashboard=true\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"--api.insecure=true\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"--ping=true\"</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"--entrypoints.http.address=:80\"</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"--providers.docker=true\"</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"--providers.docker.endpoint=unix:///var/run/docker.sock\"</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"--global.sendanonymoususage=false\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"--global.checknewversion=false\"</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.traefik-dashboard.entrypoints=http\"</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.traefik-dashboard.rule=Host(`domain.com`)\"</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.traefik-dashboard.service=dashboard@internal\"</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.traefik-dashboard-api.entrypoints=http\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.traefik-dashboard-api.rule=Host(`domain.com`) &amp;&amp; PathPrefix(`/api`)\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.traefik-dashboard-api.service=api@internal\"</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.middlewares.gzip.compress=true\"</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.traefik-dashboard.middlewares=gzip@docker\"</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.traefik-dashboard-api.middlewares=gzip@docker\"</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.traefik-dashboard.tls=true\"</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token punctuation\">-</span> /var/run/docker.sock<span class=\"token punctuation\">:</span>/var/run/docker.sock<span class=\"token punctuation\">:</span>ro</pre></td></tr><tr><td data-num=\"39\"></td><td><pre>    <span class=\"token key atrule\">healthcheck</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>      <span class=\"token key atrule\">test</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token string\">\"CMD-SHELL\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"wget -q --spider --proxy off domain.com:8078/ping || exit 1\"</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>      <span class=\"token key atrule\">interval</span><span class=\"token punctuation\">:</span> 3s</pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token key atrule\">logging</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>      <span class=\"token key atrule\">driver</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"json-file\"</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token key atrule\">options</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>        <span class=\"token key atrule\">max-size</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"1m\"</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre><span class=\"token key atrule\">networks</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token key atrule\">traefik</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>    <span class=\"token key atrule\">external</span><span class=\"token punctuation\">:</span> <span class=\"token boolean important\">true</span></pre></td></tr></table></figure><p>访问主机  <code>ip:8078</code>  进入 traefik 面板</p>\n<h1 id=\"负载均衡配置\"><a class=\"anchor\" href=\"#负载均衡配置\">#</a> 负载均衡配置</h1>\n<p>sdocker-compose 部署其他服务时，需指定 <code>labels</code></p>\n<p>下面以微服务举例：</p>\n<p>假如有两个微服务， 端口号分别为 1001，1002。</p>\n<p>user 服务对应 1001 端口，video 服务对应 1002 端口。</p>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3\"</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token key atrule\">user-service</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> your/user<span class=\"token punctuation\">-</span>service<span class=\"token punctuation\">-</span>image</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.user-service.entrypoints=http\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.user-service.rule=Host(`domain.com`) &amp;&amp; PathPrefix(`/user/`)\"</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.services.user-service.loadbalancer.server.port=1001\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>  <span class=\"token key atrule\">video-service</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> your/video<span class=\"token punctuation\">-</span>service<span class=\"token punctuation\">-</span>image</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">labels</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.video-service.entrypoints=http\"</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.routers.video-service.rule=Host(`domain.com`) &amp;&amp; PathPrefix(`/video/`)\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"traefik.http.services.video-service.loadbalancer.server.port=1002\"</span></pre></td></tr></table></figure><table>\n<thead>\n<tr>\n<th style=\"text-align:center\">请求地址</th>\n<th style=\"text-align:center\">转发地址</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><span class=\"exturl\" data-url=\"aHR0cDovL2RvbWFpbi5jb20vdXNlci8=\">domain.com/user/</span></td>\n<td style=\"text-align:center\">ip:1001/user/</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><span class=\"exturl\" data-url=\"aHR0cDovL2RvbWFpbi5jb20vdmlkZW8v\">domain.com/video/</span></td>\n<td style=\"text-align:center\">ip:1002/video/</td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "后端",
                "traefik"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2024/02/07/%E5%90%8E%E7%AB%AF/Apollo%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "url": "https://withoutabc.github.io/2024/02/07/%E5%90%8E%E7%AB%AF/Apollo%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "title": "Apollo部署及使用",
            "date_published": "2024-02-06T16:15:37.000Z",
            "content_html": "<h1 id=\"docker-部署-apollo\"><a class=\"anchor\" href=\"#docker-部署-apollo\">#</a> Docker 部署 Apollo</h1>\n<h2 id=\"docker-composeyml\"><a class=\"anchor\" href=\"#docker-composeyml\">#</a>  <code>docker-compose.yml</code></h2>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">'3.8'</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  <span class=\"token key atrule\">mysql</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> mysql<span class=\"token punctuation\">:</span><span class=\"token number\">8.0</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token key atrule\">MYSQL_ROOT_PASSWORD</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">-</span> mysql<span class=\"token punctuation\">:</span>/var/lib/mysql</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">-</span> ./mysql<span class=\"token punctuation\">:</span>/docker<span class=\"token punctuation\">-</span>entrypoint<span class=\"token punctuation\">-</span>initdb.d</pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>  <span class=\"token key atrule\">mysql-admin</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> phpmyadmin</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"23306:80\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token key atrule\">PMA_HOST</span><span class=\"token punctuation\">:</span> mysql</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token key atrule\">PMA_USER</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token key atrule\">PMA_PASSWORD</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>  <span class=\"token key atrule\">apollo-configservice</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> apolloconfig/apollo<span class=\"token punctuation\">-</span>configservice<span class=\"token punctuation\">:</span>1.9.2</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"18080:8080\"</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token key atrule\">SPRING_DATASOURCE_URL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"jdbc:mysql://mysql:3306/ApolloConfigDB?characterEncoding=utf8\"</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token key atrule\">SPRING_DATASOURCE_USERNAME</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token key atrule\">SPRING_DATASOURCE_PASSWORD</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>  <span class=\"token key atrule\">apollo-adminservice</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> apolloconfig/apollo<span class=\"token punctuation\">-</span>adminservice<span class=\"token punctuation\">:</span>1.9.2</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"18090:8090\"</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      <span class=\"token key atrule\">SPRING_DATASOURCE_URL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"jdbc:mysql://mysql:3306/ApolloConfigDB?characterEncoding=utf8\"</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token key atrule\">SPRING_DATASOURCE_USERNAME</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"37\"></td><td><pre>      <span class=\"token key atrule\">SPRING_DATASOURCE_PASSWORD</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token key atrule\">apollo-portal</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> apolloconfig/apollo<span class=\"token punctuation\">-</span>portal<span class=\"token punctuation\">:</span>1.9.2</pre></td></tr><tr><td data-num=\"41\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"18070:8070\"</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>      <span class=\"token key atrule\">SPRING_DATASOURCE_URL</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"jdbc:mysql://mysql:3306/ApolloPortalDB?characterEncoding=utf8\"</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>      <span class=\"token key atrule\">SPRING_DATASOURCE_USERNAME</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"46\"></td><td><pre>      <span class=\"token key atrule\">SPRING_DATASOURCE_PASSWORD</span><span class=\"token punctuation\">:</span> root</pre></td></tr><tr><td data-num=\"47\"></td><td><pre>      <span class=\"token key atrule\">APOLLO_PORTAL_ENVS</span><span class=\"token punctuation\">:</span> dev</pre></td></tr><tr><td data-num=\"48\"></td><td><pre>      <span class=\"token key atrule\">DEV_META</span><span class=\"token punctuation\">:</span> http<span class=\"token punctuation\">:</span>//apollo<span class=\"token punctuation\">-</span>configservice<span class=\"token punctuation\">:</span><span class=\"token number\">8080</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre><span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token key atrule\">mysql</span><span class=\"token punctuation\">:</span> <span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"mysqlapolloconfigdbsql\"><a class=\"anchor\" href=\"#mysqlapolloconfigdbsql\">#</a>  <code>mysql/apolloconfigdb.sql</code></h2>\n<ul>\n<li><strong>注意将此处，修改成本地 ip</strong></li>\n</ul>\n<p>('eureka.service.url', 'default', '<span class=\"exturl\" data-url=\"aHR0cDovLzE5Mi4xNjguMC4xMDU6MTgwODAvZXVyZWthLw==\">http://192.168.0.105:18080/eureka/</span>', 'Eureka 服务 Url，多个 service 以英文逗号分隔 '),</p>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">--</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">-- Copyright 2023 Apollo Authors</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">--</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">-- Licensed under the Apache License, Version 2.0 (the \"License\");</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- you may not use this file except in compliance with the License.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">-- You may obtain a copy of the License at</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">--</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">-- http://www.apache.org/licenses/LICENSE-2.0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">--</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">-- Unless required by applicable law or agreed to in writing, software</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">-- distributed under the License is distributed on an \"AS IS\" BASIS,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">-- See the License for the specific language governing permissions and</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">-- limitations under the License.</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">--</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">/*!40101 SET NAMES utf8 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># Create Database</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> ApolloConfigDB <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">Use</span> ApolloConfigDB<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\"># Dump of table app</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'应用名'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OrgId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'部门Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OrgName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'部门名字'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OwnerName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OwnerEmail<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerEmail'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>                       <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>                       <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>                       <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_AppId_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>                       <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>                       <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_Name<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'应用表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\"># Dump of table appnamespace</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespace名字，注意，需要全局唯一'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'app id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Format<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'properties'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespace的format类型'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsPublic<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespace是否为公共'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'注释'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>                                <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>                                <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_AppId_Name_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>                                <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name_AppId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>                                <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'应用namespace定义'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token comment\"># Dump of table audit</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Audit<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Audit<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>                         <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>                         <span class=\"token identifier\"><span class=\"token punctuation\">`</span>EntityName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'表名'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>                         <span class=\"token identifier\"><span class=\"token punctuation\">`</span>EntityId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'记录ID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>                         <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OpName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'操作类型'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>                         <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'备注'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>                         <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>                         <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>                         <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>                         <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>                         <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>                         <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>                         <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>                         <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'日志审计表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre></pre></td></tr><tr><td data-num=\"104\"></td><td><pre></pre></td></tr><tr><td data-num=\"105\"></td><td><pre></pre></td></tr><tr><td data-num=\"106\"></td><td><pre><span class=\"token comment\"># Dump of table cluster</span></pre></td></tr><tr><td data-num=\"107\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"108\"></td><td><pre></pre></td></tr><tr><td data-num=\"109\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre></pre></td></tr><tr><td data-num=\"111\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"112\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'集群名字'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"114\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'App id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ParentClusterId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'父cluster'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>                           <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>                           <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_AppId_Name_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre>                           <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_ParentClusterId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ParentClusterId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre>                           <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"126\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'集群'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"127\"></td><td><pre></pre></td></tr><tr><td data-num=\"128\"></td><td><pre></pre></td></tr><tr><td data-num=\"129\"></td><td><pre></pre></td></tr><tr><td data-num=\"130\"></td><td><pre><span class=\"token comment\"># Dump of table commit</span></pre></td></tr><tr><td data-num=\"131\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Commit<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre></pre></td></tr><tr><td data-num=\"135\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Commit<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ChangeSets<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'修改变更集'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ClusterName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'备注'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre>                          <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre>                          <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"149\"></td><td><pre>                          <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"150\"></td><td><pre>                          <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"151\"></td><td><pre>                          <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre>                          <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'commit 历史表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"154\"></td><td><pre></pre></td></tr><tr><td data-num=\"155\"></td><td><pre><span class=\"token comment\"># Dump of table grayreleaserule</span></pre></td></tr><tr><td data-num=\"156\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre></pre></td></tr><tr><td data-num=\"158\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>GrayReleaseRule<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre></pre></td></tr><tr><td data-num=\"160\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>GrayReleaseRule<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Cluster Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Namespace Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>BranchName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'branch name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Rules<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">16000</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'[]'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'灰度规则'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'灰度对应的release'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>BranchStatus<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'1'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'灰度分支状态: 0:删除分支,1:正在使用的规则 2：全量发布'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"172\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"175\"></td><td><pre>                                   <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre>                                   <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"177\"></td><td><pre>                                   <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_Namespace<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'灰度规则表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre></pre></td></tr><tr><td data-num=\"180\"></td><td><pre></pre></td></tr><tr><td data-num=\"181\"></td><td><pre><span class=\"token comment\"># Dump of table instance</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre></pre></td></tr><tr><td data-num=\"184\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Instance<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre></pre></td></tr><tr><td data-num=\"186\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Instance<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre>                            <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>                            <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>                            <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ClusterName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>                            <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataCenter<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Data Center Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>                            <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Ip<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'instance ip'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre>                            <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre>                            <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"194\"></td><td><pre>                            <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre>                            <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_UNIQUE_KEY<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Ip<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataCenter<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre>                            <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_IP<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Ip<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"197\"></td><td><pre>                            <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'使用配置的应用实例'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"199\"></td><td><pre></pre></td></tr><tr><td data-num=\"200\"></td><td><pre></pre></td></tr><tr><td data-num=\"201\"></td><td><pre></pre></td></tr><tr><td data-num=\"202\"></td><td><pre><span class=\"token comment\"># Dump of table instanceconfig</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre></pre></td></tr><tr><td data-num=\"205\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>InstanceConfig<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre></pre></td></tr><tr><td data-num=\"207\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>InstanceConfig<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"209\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>InstanceId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Instance Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"210\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConfigAppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Config App Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConfigClusterName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Config Cluster Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"212\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConfigNamespaceName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Config Namespace Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"213\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseKey<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'发布的Key'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"214\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseDeliveryTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'配置获取时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"215\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"216\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"217\"></td><td><pre>                                  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre>                                  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_UNIQUE_KEY<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>InstanceId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConfigAppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConfigNamespaceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"219\"></td><td><pre>                                  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_ReleaseKey<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseKey<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"220\"></td><td><pre>                                  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"221\"></td><td><pre>                                  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_Valid_Namespace<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConfigAppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConfigClusterName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConfigNamespaceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"222\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'应用实例的配置信息'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"223\"></td><td><pre></pre></td></tr><tr><td data-num=\"224\"></td><td><pre></pre></td></tr><tr><td data-num=\"225\"></td><td><pre></pre></td></tr><tr><td data-num=\"226\"></td><td><pre><span class=\"token comment\"># Dump of table item</span></pre></td></tr><tr><td data-num=\"227\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"228\"></td><td><pre></pre></td></tr><tr><td data-num=\"229\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Item<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre></pre></td></tr><tr><td data-num=\"231\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Item<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"232\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"233\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'集群NamespaceId'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"234\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Key<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'配置项Key'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"235\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Type<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'配置项类型，0: String，1: Number，2: Boolean，3: JSON'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"236\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Value<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'配置项值'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"237\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'注释'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"238\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>LineNum<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'行号'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"239\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"240\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"241\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"242\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"243\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"244\"></td><td><pre>                        <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"245\"></td><td><pre>                        <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"246\"></td><td><pre>                        <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_GroupId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"247\"></td><td><pre>                        <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"248\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'配置项目'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"249\"></td><td><pre></pre></td></tr><tr><td data-num=\"250\"></td><td><pre></pre></td></tr><tr><td data-num=\"251\"></td><td><pre></pre></td></tr><tr><td data-num=\"252\"></td><td><pre><span class=\"token comment\"># Dump of table namespace</span></pre></td></tr><tr><td data-num=\"253\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"254\"></td><td><pre></pre></td></tr><tr><td data-num=\"255\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Namespace<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"256\"></td><td><pre></pre></td></tr><tr><td data-num=\"257\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Namespace<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"258\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"259\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"260\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Cluster Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"261\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Namespace Name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"262\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"263\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"264\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"265\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"266\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"267\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"268\"></td><td><pre>                             <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"269\"></td><td><pre>                             <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_AppId_ClusterName_NamespaceName_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"270\"></td><td><pre>                             <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"271\"></td><td><pre>                             <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_NamespaceName<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"272\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'命名空间'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"273\"></td><td><pre></pre></td></tr><tr><td data-num=\"274\"></td><td><pre></pre></td></tr><tr><td data-num=\"275\"></td><td><pre></pre></td></tr><tr><td data-num=\"276\"></td><td><pre><span class=\"token comment\"># Dump of table namespacelock</span></pre></td></tr><tr><td data-num=\"277\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"278\"></td><td><pre></pre></td></tr><tr><td data-num=\"279\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceLock<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"280\"></td><td><pre></pre></td></tr><tr><td data-num=\"281\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceLock<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"282\"></td><td><pre>                                 <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"283\"></td><td><pre>                                 <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'集群NamespaceId'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"284\"></td><td><pre>                                 <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"285\"></td><td><pre>                                 <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"286\"></td><td><pre>                                 <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"287\"></td><td><pre>                                 <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"288\"></td><td><pre>                                 <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'软删除'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"289\"></td><td><pre>                                 <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"290\"></td><td><pre>                                 <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"291\"></td><td><pre>                                 <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_NamespaceId_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"292\"></td><td><pre>                                 <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"293\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'namespace的编辑锁'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"294\"></td><td><pre></pre></td></tr><tr><td data-num=\"295\"></td><td><pre></pre></td></tr><tr><td data-num=\"296\"></td><td><pre></pre></td></tr><tr><td data-num=\"297\"></td><td><pre><span class=\"token comment\"># Dump of table release</span></pre></td></tr><tr><td data-num=\"298\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"299\"></td><td><pre></pre></td></tr><tr><td data-num=\"300\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Release<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"301\"></td><td><pre></pre></td></tr><tr><td data-num=\"302\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Release<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"303\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"304\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseKey<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'发布的Key'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"305\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'发布名字'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"306\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'发布说明'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"307\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"308\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ClusterName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"309\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"310\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Configurations<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'发布配置'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"311\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsAbandoned<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'是否废弃'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"312\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"313\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"314\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"315\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"316\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"317\"></td><td><pre>                           <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"318\"></td><td><pre>                           <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"319\"></td><td><pre>                           <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_ReleaseKey_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseKey<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"320\"></td><td><pre>                           <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId_ClusterName_GroupName<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"321\"></td><td><pre>                           <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"322\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'发布'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"323\"></td><td><pre></pre></td></tr><tr><td data-num=\"324\"></td><td><pre></pre></td></tr><tr><td data-num=\"325\"></td><td><pre><span class=\"token comment\"># Dump of table releasehistory</span></pre></td></tr><tr><td data-num=\"326\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"327\"></td><td><pre></pre></td></tr><tr><td data-num=\"328\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseHistory<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"329\"></td><td><pre></pre></td></tr><tr><td data-num=\"330\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseHistory<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"331\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"332\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"333\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ClusterName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"334\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespaceName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"335\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>BranchName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'发布分支名'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"336\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'关联的Release Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"337\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>PreviousReleaseId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'前一次发布的ReleaseId'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"338\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Operation<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'发布类型，0: 普通发布，1: 回滚，2: 灰度发布，3: 灰度规则更新，4: 灰度合并回主分支发布，5: 主分支发布灰度自动发布，6: 主分支回滚灰度自动发布，7: 放弃灰度'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"339\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OperationContext<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">longtext</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'发布上下文信息'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"340\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"341\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"342\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"343\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"344\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"345\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"346\"></td><td><pre>                                  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"347\"></td><td><pre>                                  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_Namespace<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>BranchName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"348\"></td><td><pre>                                  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_ReleaseId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"349\"></td><td><pre>                                  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"350\"></td><td><pre>                                  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_PreviousReleaseId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>PreviousReleaseId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"351\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'发布历史'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"352\"></td><td><pre></pre></td></tr><tr><td data-num=\"353\"></td><td><pre></pre></td></tr><tr><td data-num=\"354\"></td><td><pre><span class=\"token comment\"># Dump of table releasemessage</span></pre></td></tr><tr><td data-num=\"355\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"356\"></td><td><pre></pre></td></tr><tr><td data-num=\"357\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseMessage<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"358\"></td><td><pre></pre></td></tr><tr><td data-num=\"359\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseMessage<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"360\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"361\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Message<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'发布的消息内容'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"362\"></td><td><pre>                                  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"363\"></td><td><pre>                                  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"364\"></td><td><pre>                                  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"365\"></td><td><pre>                                  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_Message<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Message<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"366\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'发布消息'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"367\"></td><td><pre></pre></td></tr><tr><td data-num=\"368\"></td><td><pre></pre></td></tr><tr><td data-num=\"369\"></td><td><pre></pre></td></tr><tr><td data-num=\"370\"></td><td><pre><span class=\"token comment\"># Dump of table serverconfig</span></pre></td></tr><tr><td data-num=\"371\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"372\"></td><td><pre></pre></td></tr><tr><td data-num=\"373\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"374\"></td><td><pre></pre></td></tr><tr><td data-num=\"375\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"376\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"377\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Key<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'配置项Key'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"378\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'配置对应的集群，default为不针对特定的集群'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"379\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Value<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">2048</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'配置项值'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"380\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'注释'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"381\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"382\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"383\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"384\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"385\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"386\"></td><td><pre>                                <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"387\"></td><td><pre>                                <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"388\"></td><td><pre>                                <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_Key_Cluster_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Key<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"389\"></td><td><pre>                                <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"390\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'配置服务自身配置'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"391\"></td><td><pre></pre></td></tr><tr><td data-num=\"392\"></td><td><pre><span class=\"token comment\"># Dump of table accesskey</span></pre></td></tr><tr><td data-num=\"393\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"394\"></td><td><pre></pre></td></tr><tr><td data-num=\"395\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AccessKey<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"396\"></td><td><pre></pre></td></tr><tr><td data-num=\"397\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AccessKey<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"398\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"399\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"400\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Secret<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Secret'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"401\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsEnabled<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: enabled, 0: disabled'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"402\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"403\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"404\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"405\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"406\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"407\"></td><td><pre>                             <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"408\"></td><td><pre>                             <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"409\"></td><td><pre>                             <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_AppId_Secret_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Secret<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"410\"></td><td><pre>                             <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"411\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'访问密钥'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"412\"></td><td><pre></pre></td></tr><tr><td data-num=\"413\"></td><td><pre></pre></td></tr><tr><td data-num=\"414\"></td><td><pre><span class=\"token comment\"># Dump of table serviceregistry</span></pre></td></tr><tr><td data-num=\"415\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"416\"></td><td><pre></pre></td></tr><tr><td data-num=\"417\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ServiceRegistry<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"418\"></td><td><pre></pre></td></tr><tr><td data-num=\"419\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ServiceRegistry<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"420\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">INT</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">UNSIGNED</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"421\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ServiceName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'服务名'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"422\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Uri<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'服务地址'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"423\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'集群，可以用来标识apollo.cluster或者网络分区'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"424\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Metadata<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'&#123;&#125;'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'元数据，key value结构的json object，为了方面后面扩展功能而不需要修改表结构'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"425\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">TIMESTAMP</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"426\"></td><td><pre>                                   <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">TIMESTAMP</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"427\"></td><td><pre>                                   <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"428\"></td><td><pre>                                   <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_UNIQUE_KEY<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ServiceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Uri<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"429\"></td><td><pre>                                   <span class=\"token keyword\">INDEX</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"430\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'注册中心'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"431\"></td><td><pre></pre></td></tr><tr><td data-num=\"432\"></td><td><pre></pre></td></tr><tr><td data-num=\"433\"></td><td><pre><span class=\"token comment\"># Config</span></pre></td></tr><tr><td data-num=\"434\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"435\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Key<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Value<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"436\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"437\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'eureka.service.url'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'http://192.168.0.105:18080/eureka/'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Eureka服务Url，多个service以英文逗号分隔'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"438\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'namespace.lock.switch'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'false'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'一次发布只能有一个人修改开关'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"439\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'item.key.length.limit'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'128'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'item key 最大长度限制'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"440\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'item.value.length.limit'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'20000'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'item value最大长度限制'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"441\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'config-service.cache.enabled'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'false'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ConfigService是否开启缓存，开启后能提高性能，但是会增大内存消耗！'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"442\"></td><td><pre></pre></td></tr><tr><td data-num=\"443\"></td><td><pre><span class=\"token comment\"># Sample Data</span></pre></td></tr><tr><td data-num=\"444\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"445\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OrgId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OrgName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OwnerName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OwnerEmail<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"446\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"447\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Sample App'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'TEST1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'样例部门1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo@acme.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"448\"></td><td><pre></pre></td></tr><tr><td data-num=\"449\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Format<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsPublic<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"450\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"451\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'application'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'properties'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default app namespace'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"452\"></td><td><pre></pre></td></tr><tr><td data-num=\"453\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Cluster<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"454\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"455\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"456\"></td><td><pre></pre></td></tr><tr><td data-num=\"457\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Namespace<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"458\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"459\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"460\"></td><td><pre></pre></td></tr><tr><td data-num=\"461\"></td><td><pre></pre></td></tr><tr><td data-num=\"462\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Item<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Key<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Value<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>LineNum<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"463\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"464\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'timeout'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'100'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'sample timeout配置'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"465\"></td><td><pre></pre></td></tr><tr><td data-num=\"466\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Release<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseKey<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Configurations<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"467\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"468\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'20161009155425-d3a0749c6e20bc15'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'20161009155424-release'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Sample发布'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'application'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&#123;\\\"timeout\\\":\\\"100\\\"&#125;'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"469\"></td><td><pre></pre></td></tr><tr><td data-num=\"470\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseHistory<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ClusterName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>NamespaceName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>BranchName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>PreviousReleaseId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Operation<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OperationContext<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"471\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"472\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'application'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&#123;&#125;'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"473\"></td><td><pre></pre></td></tr><tr><td data-num=\"474\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ReleaseMessage<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Message<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"475\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"476\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'SampleApp+default+application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"477\"></td><td><pre></pre></td></tr><tr><td data-num=\"478\"></td><td><pre><span class=\"token comment\">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"479\"></td><td><pre><span class=\"token comment\">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"480\"></td><td><pre><span class=\"token comment\">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"481\"></td><td><pre><span class=\"token comment\">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"482\"></td><td><pre><span class=\"token comment\">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"483\"></td><td><pre><span class=\"token comment\">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"mysqlapolloportaldbsql\"><a class=\"anchor\" href=\"#mysqlapolloportaldbsql\">#</a>  <code>mysql/apolloportaldb.sql</code></h2>\n<figure class=\"highlight sql\"><figcaption data-lang=\"SQL\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">--</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token comment\">-- Copyright 2023 Apollo Authors</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\">--</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token comment\">-- Licensed under the Apache License, Version 2.0 (the \"License\");</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">-- you may not use this file except in compliance with the License.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token comment\">-- You may obtain a copy of the License at</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">--</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">-- http://www.apache.org/licenses/LICENSE-2.0</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">--</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">-- Unless required by applicable law or agreed to in writing, software</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token comment\">-- distributed under the License is distributed on an \"AS IS\" BASIS,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token comment\">-- WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token comment\">-- See the License for the specific language governing permissions and</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token comment\">-- limitations under the License.</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token comment\">--</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_CHARACTER_SET_CLIENT=@@CHARACTER_SET_CLIENT */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_CHARACTER_SET_RESULTS=@@CHARACTER_SET_RESULTS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_COLLATION_CONNECTION=@@COLLATION_CONNECTION */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token comment\">/*!40101 SET NAMES utf8 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">/*!40014 SET @OLD_FOREIGN_KEY_CHECKS=@@FOREIGN_KEY_CHECKS, FOREIGN_KEY_CHECKS=0 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre><span class=\"token comment\">/*!40101 SET @OLD_SQL_MODE=@@SQL_MODE, SQL_MODE='NO_AUTO_VALUE_ON_ZERO' */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token comment\">/*!40111 SET @OLD_SQL_NOTES=@@SQL_NOTES, SQL_NOTES=0 */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token comment\"># Create Database</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">DATABASE</span> <span class=\"token keyword\">IF</span> <span class=\"token operator\">NOT</span> <span class=\"token keyword\">EXISTS</span> ApolloPortalDB <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARACTER</span> <span class=\"token keyword\">SET</span> <span class=\"token operator\">=</span> utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre></pre></td></tr><tr><td data-num=\"28\"></td><td><pre><span class=\"token keyword\">Use</span> ApolloPortalDB<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token comment\"># Dump of table app</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'应用名'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OrgId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'部门Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OrgName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'部门名字'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OwnerName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OwnerEmail<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerEmail'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_AppId_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_Name<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">(</span><span class=\"token number\">191</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'应用表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre></pre></td></tr><tr><td data-num=\"57\"></td><td><pre><span class=\"token comment\"># Dump of table appnamespace</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre></pre></td></tr><tr><td data-num=\"60\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"61\"></td><td><pre></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"63\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"64\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespace名字，注意，需要全局唯一'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"65\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'app id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"66\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Format<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'properties'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespace的format类型'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"67\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsPublic<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'namespace是否为公共'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"68\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'注释'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"69\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"70\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"71\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"72\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"73\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"74\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"75\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"76\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_AppId_Name_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"77\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name_AppId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"78\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"79\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'应用namespace定义'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"80\"></td><td><pre></pre></td></tr><tr><td data-num=\"81\"></td><td><pre></pre></td></tr><tr><td data-num=\"82\"></td><td><pre></pre></td></tr><tr><td data-num=\"83\"></td><td><pre><span class=\"token comment\"># Dump of table consumer</span></pre></td></tr><tr><td data-num=\"84\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"85\"></td><td><pre></pre></td></tr><tr><td data-num=\"86\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Consumer<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"87\"></td><td><pre></pre></td></tr><tr><td data-num=\"88\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Consumer<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"89\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"90\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"91\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'应用名'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"92\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OrgId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'部门Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"93\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OrgName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'部门名字'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"94\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OwnerName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerName'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"95\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OwnerEmail<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">500</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ownerEmail'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"96\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"97\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"98\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"99\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"100\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"101\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"102\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"103\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_AppId_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"104\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"105\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'开放API消费者'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"106\"></td><td><pre></pre></td></tr><tr><td data-num=\"107\"></td><td><pre></pre></td></tr><tr><td data-num=\"108\"></td><td><pre></pre></td></tr><tr><td data-num=\"109\"></td><td><pre><span class=\"token comment\"># Dump of table consumeraudit</span></pre></td></tr><tr><td data-num=\"110\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"111\"></td><td><pre></pre></td></tr><tr><td data-num=\"112\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConsumerAudit<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"113\"></td><td><pre></pre></td></tr><tr><td data-num=\"114\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConsumerAudit<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"115\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"116\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConsumerId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Consumer Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"117\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Uri<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'访问的Uri'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"118\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Method<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">16</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'访问的Method'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"119\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"120\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"121\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"122\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"123\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_ConsumerId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConsumerId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"124\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'consumer审计表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"125\"></td><td><pre></pre></td></tr><tr><td data-num=\"126\"></td><td><pre></pre></td></tr><tr><td data-num=\"127\"></td><td><pre></pre></td></tr><tr><td data-num=\"128\"></td><td><pre><span class=\"token comment\"># Dump of table consumerrole</span></pre></td></tr><tr><td data-num=\"129\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"130\"></td><td><pre></pre></td></tr><tr><td data-num=\"131\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConsumerRole<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"132\"></td><td><pre></pre></td></tr><tr><td data-num=\"133\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConsumerRole<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"134\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"135\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConsumerId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Consumer Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"136\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Role Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"137\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"138\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"139\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"140\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"141\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"142\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"143\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"144\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_ConsumerId_RoleId_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConsumerId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"145\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"146\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_RoleId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"147\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'consumer和role的绑定表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"148\"></td><td><pre></pre></td></tr><tr><td data-num=\"149\"></td><td><pre></pre></td></tr><tr><td data-num=\"150\"></td><td><pre></pre></td></tr><tr><td data-num=\"151\"></td><td><pre><span class=\"token comment\"># Dump of table consumertoken</span></pre></td></tr><tr><td data-num=\"152\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"153\"></td><td><pre></pre></td></tr><tr><td data-num=\"154\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConsumerToken<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"155\"></td><td><pre></pre></td></tr><tr><td data-num=\"156\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConsumerToken<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"157\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"158\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ConsumerId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'ConsumerId'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"159\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Token<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'token'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"160\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Expires<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">datetime</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'2099-01-01 00:00:00'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'token失效时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"161\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"162\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"163\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"164\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"165\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"166\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"167\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"168\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_Token_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Token<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"169\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"170\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'consumer token表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"171\"></td><td><pre></pre></td></tr><tr><td data-num=\"172\"></td><td><pre><span class=\"token comment\"># Dump of table favorite</span></pre></td></tr><tr><td data-num=\"173\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"174\"></td><td><pre></pre></td></tr><tr><td data-num=\"175\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Favorite<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"176\"></td><td><pre></pre></td></tr><tr><td data-num=\"177\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Favorite<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"178\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'主键'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"179\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UserId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'收藏的用户'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"180\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'AppID'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"181\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Position<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'10000'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'收藏顺序'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"182\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"183\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"184\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"185\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"186\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"187\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"188\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"189\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_UserId_AppId_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>UserId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"190\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"191\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"192\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">AUTO_INCREMENT</span><span class=\"token operator\">=</span><span class=\"token number\">23</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'应用收藏表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"193\"></td><td><pre></pre></td></tr><tr><td data-num=\"194\"></td><td><pre><span class=\"token comment\"># Dump of table permission</span></pre></td></tr><tr><td data-num=\"195\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"196\"></td><td><pre></pre></td></tr><tr><td data-num=\"197\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Permission<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"198\"></td><td><pre></pre></td></tr><tr><td data-num=\"199\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Permission<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"200\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"201\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>PermissionType<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">32</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'权限类型'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"202\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>TargetId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'权限对象类型'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"203\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"204\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"205\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"206\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"207\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"208\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"209\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"210\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_TargetId_PermissionType_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>TargetId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>PermissionType<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"211\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"212\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'permission表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"213\"></td><td><pre></pre></td></tr><tr><td data-num=\"214\"></td><td><pre></pre></td></tr><tr><td data-num=\"215\"></td><td><pre></pre></td></tr><tr><td data-num=\"216\"></td><td><pre><span class=\"token comment\"># Dump of table role</span></pre></td></tr><tr><td data-num=\"217\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"218\"></td><td><pre></pre></td></tr><tr><td data-num=\"219\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Role<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"220\"></td><td><pre></pre></td></tr><tr><td data-num=\"221\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Role<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"222\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"223\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">256</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Role name'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"224\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"225\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"226\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"227\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"228\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"229\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"230\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"231\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_RoleName_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"232\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"233\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'角色表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"234\"></td><td><pre></pre></td></tr><tr><td data-num=\"235\"></td><td><pre></pre></td></tr><tr><td data-num=\"236\"></td><td><pre></pre></td></tr><tr><td data-num=\"237\"></td><td><pre><span class=\"token comment\"># Dump of table rolepermission</span></pre></td></tr><tr><td data-num=\"238\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"239\"></td><td><pre></pre></td></tr><tr><td data-num=\"240\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>RolePermission<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"241\"></td><td><pre></pre></td></tr><tr><td data-num=\"242\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>RolePermission<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"243\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"244\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Role Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"245\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>PermissionId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Permission Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"246\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"247\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"248\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"249\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"250\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"251\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"252\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"253\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_RoleId_PermissionId_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>PermissionId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"254\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"255\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_PermissionId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>PermissionId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"256\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'角色和权限的绑定表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"257\"></td><td><pre></pre></td></tr><tr><td data-num=\"258\"></td><td><pre></pre></td></tr><tr><td data-num=\"259\"></td><td><pre></pre></td></tr><tr><td data-num=\"260\"></td><td><pre><span class=\"token comment\"># Dump of table serverconfig</span></pre></td></tr><tr><td data-num=\"261\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"262\"></td><td><pre></pre></td></tr><tr><td data-num=\"263\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"264\"></td><td><pre></pre></td></tr><tr><td data-num=\"265\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"266\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"267\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Key<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'配置项Key'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"268\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Value<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">2048</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'配置项值'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"269\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">1024</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'注释'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"270\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"271\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"272\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"273\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"274\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"275\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"276\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"277\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_Key_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Key<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"278\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"279\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'配置服务自身配置'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"280\"></td><td><pre></pre></td></tr><tr><td data-num=\"281\"></td><td><pre></pre></td></tr><tr><td data-num=\"282\"></td><td><pre></pre></td></tr><tr><td data-num=\"283\"></td><td><pre><span class=\"token comment\"># Dump of table userrole</span></pre></td></tr><tr><td data-num=\"284\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"285\"></td><td><pre></pre></td></tr><tr><td data-num=\"286\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UserRole<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"287\"></td><td><pre></pre></td></tr><tr><td data-num=\"288\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UserRole<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"289\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"290\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UserId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">128</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'用户身份标识'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"291\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Role Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"292\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsDeleted<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">bit</span><span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> b<span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'1: deleted, 0: normal'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"293\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">BIGINT</span><span class=\"token punctuation\">(</span><span class=\"token number\">20</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'0'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'Delete timestamp based on milliseconds'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"294\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"295\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_CreatedTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'创建时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"296\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastModifiedBy<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">''</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改人邮箱前缀'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"297\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">timestamp</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">UPDATE</span> <span class=\"token keyword\">CURRENT_TIMESTAMP</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'最后修改时间'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"298\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"299\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_UserId_RoleId_DeletedAt<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>UserId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DeletedAt<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"300\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_DataChange_LastTime<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>DataChange_LastTime<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"301\"></td><td><pre>  <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IX_RoleId<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"302\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'用户和role的绑定表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"303\"></td><td><pre></pre></td></tr><tr><td data-num=\"304\"></td><td><pre><span class=\"token comment\"># Dump of table Users</span></pre></td></tr><tr><td data-num=\"305\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"306\"></td><td><pre></pre></td></tr><tr><td data-num=\"307\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Users<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"308\"></td><td><pre></pre></td></tr><tr><td data-num=\"309\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Users<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"310\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">10</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"311\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'用户登录账户'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"312\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Password<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'密码'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"313\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UserDisplayName<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">512</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'用户名称'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"314\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Email<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token string\">'default'</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'邮箱地址'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"315\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Enabled<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">tinyint</span><span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'是否有效'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"316\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"317\"></td><td><pre>  <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">KEY</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UK_Username<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Username<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"318\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4 <span class=\"token keyword\">COMMENT</span><span class=\"token operator\">=</span><span class=\"token string\">'用户表'</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"319\"></td><td><pre></pre></td></tr><tr><td data-num=\"320\"></td><td><pre></pre></td></tr><tr><td data-num=\"321\"></td><td><pre><span class=\"token comment\"># Dump of table Authorities</span></pre></td></tr><tr><td data-num=\"322\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"323\"></td><td><pre></pre></td></tr><tr><td data-num=\"324\"></td><td><pre><span class=\"token keyword\">DROP</span> <span class=\"token keyword\">TABLE</span> <span class=\"token keyword\">IF</span> <span class=\"token keyword\">EXISTS</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Authorities<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"325\"></td><td><pre></pre></td></tr><tr><td data-num=\"326\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Authorities<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"327\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">int</span><span class=\"token punctuation\">(</span><span class=\"token number\">11</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">unsigned</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span> <span class=\"token keyword\">AUTO_INCREMENT</span> <span class=\"token keyword\">COMMENT</span> <span class=\"token string\">'自增Id'</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"328\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Username<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">64</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"329\"></td><td><pre>  <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Authority<span class=\"token punctuation\">`</span></span> <span class=\"token keyword\">varchar</span><span class=\"token punctuation\">(</span><span class=\"token number\">50</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"330\"></td><td><pre>  <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"331\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> <span class=\"token keyword\">DEFAULT</span> <span class=\"token keyword\">CHARSET</span><span class=\"token operator\">=</span>utf8mb4<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"332\"></td><td><pre></pre></td></tr><tr><td data-num=\"333\"></td><td><pre></pre></td></tr><tr><td data-num=\"334\"></td><td><pre><span class=\"token comment\"># Config</span></pre></td></tr><tr><td data-num=\"335\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"336\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>ServerConfig<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Key<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Value<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"337\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"338\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'apollo.portal.envs'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'dev'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'可支持的环境列表'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"339\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'organizations'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'[&#123;\\\"orgId\\\":\\\"TEST1\\\",\\\"orgName\\\":\\\"样例部门1\\\"&#125;,&#123;\\\"orgId\\\":\\\"TEST2\\\",\\\"orgName\\\":\\\"样例部门2\\\"&#125;]'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'部门列表'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"340\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'superAdmin'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Portal超级管理员'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"341\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'api.readTimeout'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'10000'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'http接口read timeout'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"342\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'consumer.token.salt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'someSalt'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'consumer token salt'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"343\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'admin.createPrivateNamespace.switch'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'true'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'是否允许项目管理员创建私有namespace'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"344\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'configView.memberOnly.envs'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'dev'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'只对项目成员显示配置信息的环境列表，多个env以英文逗号分隔'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"345\"></td><td><pre>    <span class=\"token punctuation\">(</span><span class=\"token string\">'apollo.portal.meta.servers'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'&#123;&#125;'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'各环境Meta Service列表'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"346\"></td><td><pre></pre></td></tr><tr><td data-num=\"347\"></td><td><pre></pre></td></tr><tr><td data-num=\"348\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Users<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Username<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Password<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UserDisplayName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Email<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Enabled<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"349\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"350\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'$2a$10$7r20uS.BQ9uBpf3Baj3uQOZvMVvB1RN3PYoKE94gtz2.WAOuiiwXS'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo@acme.com'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"351\"></td><td><pre></pre></td></tr><tr><td data-num=\"352\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Authorities<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Username<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Authority<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">VALUES</span> <span class=\"token punctuation\">(</span><span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ROLE_user'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"353\"></td><td><pre></pre></td></tr><tr><td data-num=\"354\"></td><td><pre><span class=\"token comment\">-- spring session (https://github.com/spring-projects/spring-session/blob/faee8f1bdb8822a5653a81eba838dddf224d92d6/spring-session-jdbc/src/main/resources/org/springframework/session/jdbc/schema-mysql.sql)</span></pre></td></tr><tr><td data-num=\"355\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> SPRING_SESSION <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"356\"></td><td><pre>  PRIMARY_ID <span class=\"token keyword\">CHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">36</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"357\"></td><td><pre>  SESSION_ID <span class=\"token keyword\">CHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">36</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"358\"></td><td><pre>  CREATION_TIME <span class=\"token keyword\">BIGINT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"359\"></td><td><pre>  LAST_ACCESS_TIME <span class=\"token keyword\">BIGINT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"360\"></td><td><pre>  MAX_INACTIVE_INTERVAL <span class=\"token keyword\">INT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"361\"></td><td><pre>  EXPIRY_TIME <span class=\"token keyword\">BIGINT</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"362\"></td><td><pre>  PRINCIPAL_NAME <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">100</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"363\"></td><td><pre>  <span class=\"token keyword\">CONSTRAINT</span> SPRING_SESSION_PK <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>PRIMARY_ID<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"364\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> ROW_FORMAT<span class=\"token operator\">=</span>DYNAMIC<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"365\"></td><td><pre></pre></td></tr><tr><td data-num=\"366\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">UNIQUE</span> <span class=\"token keyword\">INDEX</span> SPRING_SESSION_IX1 <span class=\"token keyword\">ON</span> SPRING_SESSION <span class=\"token punctuation\">(</span>SESSION_ID<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"367\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">INDEX</span> SPRING_SESSION_IX2 <span class=\"token keyword\">ON</span> SPRING_SESSION <span class=\"token punctuation\">(</span>EXPIRY_TIME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"368\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">INDEX</span> SPRING_SESSION_IX3 <span class=\"token keyword\">ON</span> SPRING_SESSION <span class=\"token punctuation\">(</span>PRINCIPAL_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"369\"></td><td><pre></pre></td></tr><tr><td data-num=\"370\"></td><td><pre><span class=\"token keyword\">CREATE</span> <span class=\"token keyword\">TABLE</span> SPRING_SESSION_ATTRIBUTES <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"371\"></td><td><pre>  SESSION_PRIMARY_ID <span class=\"token keyword\">CHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">36</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"372\"></td><td><pre>  ATTRIBUTE_NAME <span class=\"token keyword\">VARCHAR</span><span class=\"token punctuation\">(</span><span class=\"token number\">200</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"373\"></td><td><pre>  ATTRIBUTE_BYTES <span class=\"token keyword\">BLOB</span> <span class=\"token operator\">NOT</span> <span class=\"token boolean\">NULL</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"374\"></td><td><pre>  <span class=\"token keyword\">CONSTRAINT</span> SPRING_SESSION_ATTRIBUTES_PK <span class=\"token keyword\">PRIMARY</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>SESSION_PRIMARY_ID<span class=\"token punctuation\">,</span> ATTRIBUTE_NAME<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"375\"></td><td><pre>  <span class=\"token keyword\">CONSTRAINT</span> SPRING_SESSION_ATTRIBUTES_FK <span class=\"token keyword\">FOREIGN</span> <span class=\"token keyword\">KEY</span> <span class=\"token punctuation\">(</span>SESSION_PRIMARY_ID<span class=\"token punctuation\">)</span> <span class=\"token keyword\">REFERENCES</span> SPRING_SESSION<span class=\"token punctuation\">(</span>PRIMARY_ID<span class=\"token punctuation\">)</span> <span class=\"token keyword\">ON</span> <span class=\"token keyword\">DELETE</span> <span class=\"token keyword\">CASCADE</span></pre></td></tr><tr><td data-num=\"376\"></td><td><pre><span class=\"token punctuation\">)</span> <span class=\"token keyword\">ENGINE</span><span class=\"token operator\">=</span><span class=\"token keyword\">InnoDB</span> ROW_FORMAT<span class=\"token operator\">=</span>DYNAMIC<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"377\"></td><td><pre></pre></td></tr><tr><td data-num=\"378\"></td><td><pre><span class=\"token comment\"># Sample Data</span></pre></td></tr><tr><td data-num=\"379\"></td><td><pre><span class=\"token comment\"># ------------------------------------------------------------</span></pre></td></tr><tr><td data-num=\"380\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>App<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OrgId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OrgName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OwnerName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>OwnerEmail<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"381\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"382\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Sample App'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'TEST1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'样例部门1'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'apollo@acme.com'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"383\"></td><td><pre></pre></td></tr><tr><td data-num=\"384\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppNamespace<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Name<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>AppId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Format<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>IsPublic<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Comment<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"385\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"386\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token string\">'application'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'properties'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'default app namespace'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"387\"></td><td><pre></pre></td></tr><tr><td data-num=\"388\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Permission<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>PermissionType<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>TargetId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"389\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"390\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CreateCluster'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"391\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'CreateNamespace'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"392\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'AssignRole'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"393\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">4</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ModifyNamespace'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp+application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"394\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">5</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ReleaseNamespace'</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'SampleApp+application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"395\"></td><td><pre></pre></td></tr><tr><td data-num=\"396\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>Role<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>Id<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleName<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"397\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"398\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'Master+SampleApp'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"399\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ModifyNamespace+SampleApp+application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"400\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token string\">'ReleaseNamespace+SampleApp+application'</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"401\"></td><td><pre></pre></td></tr><tr><td data-num=\"402\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>RolePermission<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>PermissionId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"403\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"404\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"405\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"406\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"407\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">2</span><span class=\"token punctuation\">,</span> <span class=\"token number\">4</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"408\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token number\">3</span><span class=\"token punctuation\">,</span> <span class=\"token number\">5</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"409\"></td><td><pre></pre></td></tr><tr><td data-num=\"410\"></td><td><pre><span class=\"token keyword\">INSERT</span> <span class=\"token keyword\">INTO</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>UserRole<span class=\"token punctuation\">`</span></span> <span class=\"token punctuation\">(</span><span class=\"token identifier\"><span class=\"token punctuation\">`</span>UserId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">,</span> <span class=\"token identifier\"><span class=\"token punctuation\">`</span>RoleId<span class=\"token punctuation\">`</span></span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"411\"></td><td><pre><span class=\"token keyword\">VALUES</span></pre></td></tr><tr><td data-num=\"412\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"413\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">2</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"414\"></td><td><pre>  <span class=\"token punctuation\">(</span><span class=\"token string\">'apollo'</span><span class=\"token punctuation\">,</span> <span class=\"token number\">3</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"415\"></td><td><pre></pre></td></tr><tr><td data-num=\"416\"></td><td><pre><span class=\"token comment\">/*!40111 SET SQL_NOTES=@OLD_SQL_NOTES */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"417\"></td><td><pre><span class=\"token comment\">/*!40101 SET SQL_MODE=@OLD_SQL_MODE */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"418\"></td><td><pre><span class=\"token comment\">/*!40014 SET FOREIGN_KEY_CHECKS=@OLD_FOREIGN_KEY_CHECKS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"419\"></td><td><pre><span class=\"token comment\">/*!40101 SET CHARACTER_SET_CLIENT=@OLD_CHARACTER_SET_CLIENT */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"420\"></td><td><pre><span class=\"token comment\">/*!40101 SET CHARACTER_SET_RESULTS=@OLD_CHARACTER_SET_RESULTS */</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"421\"></td><td><pre><span class=\"token comment\">/*!40101 SET COLLATION_CONNECTION=@OLD_COLLATION_CONNECTION */</span><span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>部署好后如图所示</p>\n<p><img data-src=\"https://s2.loli.net/2024/02/15/hdbjUIN4JeBRr7S.png\" alt=\"apollo0.png\" /></p>\n<p>访问  <code>http://localhost:18070</code>  进入面板</p>\n<p>默认用户名  <code>apollo</code>  密码  <code>admin</code></p>\n<h1 id=\"面板操作\"><a class=\"anchor\" href=\"#面板操作\">#</a> 面板操作</h1>\n<p>官方文档：</p>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly93d3cuYXBvbGxvY29uZmlnLmNvbS8jL3poL3VzYWdlL2Fwb2xsby11c2VyLWd1aWRl\">https://www.apolloconfig.com/#/zh/usage/apollo-user-guide</span></p>\n<p><s>会点鼠标即可</s></p>\n<h1 id=\"go-apollo-客户端连接\"><a class=\"anchor\" href=\"#go-apollo-客户端连接\">#</a> Go Apollo 客户端连接</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>go get <span class=\"token parameter variable\">-u</span> github.com/apolloconfig/agollo/v4@latest</pre></td></tr></table></figure><h2 id=\"客户端初始化\"><a class=\"anchor\" href=\"#客户端初始化\">#</a> 客户端初始化</h2>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tc <span class=\"token operator\">:=</span> <span class=\"token operator\">&amp;</span>config<span class=\"token punctuation\">.</span>AppConfig<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\tAppID<span class=\"token punctuation\">:</span>          <span class=\"token string\">\"1234567\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t\tCluster<span class=\"token punctuation\">:</span>        <span class=\"token string\">\"dev\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\tIP<span class=\"token punctuation\">:</span>             <span class=\"token string\">\"http://localhost:18080\"</span><span class=\"token punctuation\">,</span><span class=\"token comment\">// 如果参考以上部署方式，不用修改</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\tNamespaceName<span class=\"token punctuation\">:</span>  <span class=\"token string\">\"TEST1.abc\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\tIsBackupConfig<span class=\"token punctuation\">:</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\tSecret<span class=\"token punctuation\">:</span>         <span class=\"token string\">\"70f716e7cc5044b4894829a8db612f08\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tclient<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> agollo<span class=\"token punctuation\">.</span><span class=\"token function\">StartWithConfig</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>config<span class=\"token punctuation\">.</span>AppConfig<span class=\"token punctuation\">,</span> <span class=\"token builtin\">error</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> c<span class=\"token punctuation\">,</span> <span class=\"token boolean\">nil</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"agollo start err:%v\\n\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"初始化Apollo配置成功\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>\n<p><code>AppID</code>  ：配置中心中的应用程序 ID，用于标识不同的应用程序。每个应用程序都有唯一的 AppID。</p>\n</li>\n<li>\n<p><code>Cluster</code>  ：配置中心中的集群名称。应用程序可以分布在不同的集群中，根据实际情况设置相应的集群名称。</p>\n</li>\n<li>\n<p><code>IP</code>  ：配置中心的服务地址。</p>\n</li>\n<li>\n<p><code>NamespaceName</code>  ：应用程序的命名空间名称。命名空间是配置项的逻辑分组，不同的应用程序可以有不同的命名空间，用于隔离配置。</p>\n</li>\n<li>\n<p><code>IsBackupConfig</code>  ：是否备份配置。如果为 true，当连接到配置中心失败时，将使用本地缓存的配置备份数据。</p>\n</li>\n<li>\n<p><code>Secret</code>  ：配置中心的访问密钥，用于授权认证。如果启用了配置中心的授权认证，需要设置相应的密钥。</p>\n</li>\n</ul>\n<h2 id=\"获取配置\"><a class=\"anchor\" href=\"#获取配置\">#</a> 获取配置</h2>\n<h3 id=\"getconfig\"><a class=\"anchor\" href=\"#getconfig\">#</a>  <code>GetConfig</code></h3>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">GetFromStorage</span><span class=\"token punctuation\">(</span>client agollo<span class=\"token punctuation\">.</span>Client<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tkey <span class=\"token operator\">:=</span> <span class=\"token string\">\"timeout\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">// 获取配置</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tstorage <span class=\"token operator\">:=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">GetConfig</span><span class=\"token punctuation\">(</span>common<span class=\"token punctuation\">.</span>NameSpaceDemo<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">// 获取键值</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tstrVal <span class=\"token operator\">:=</span> storage<span class=\"token punctuation\">.</span><span class=\"token function\">GetStringValue</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token string\">\"xxx\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>strVal<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// 获取键值</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tstrVal <span class=\"token operator\">=</span> storage<span class=\"token punctuation\">.</span><span class=\"token function\">GetStringValueImmediately</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token string\">\"xxx\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>strVal<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">//storage 是否初始化</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tb <span class=\"token operator\">:=</span> storage<span class=\"token punctuation\">.</span><span class=\"token function\">GetIsInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>b<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">// 获取全部内容，string 格式</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tcontent <span class=\"token operator\">:=</span> storage<span class=\"token punctuation\">.</span><span class=\"token function\">GetContent</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>content<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t<span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\tGetValue(key string) string</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\tGetStringValue(key string, defaultValue string) string</pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\tGetStringSliceValue(key string, separator string, defaultValue []string) []string</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\tGetIntSliceValue(key string, separator string, defaultValue []int) []int</pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\tGetSliceValue(key string, defaultValue []interface&#123;&#125;) []interface&#123;&#125;</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\tGetIntValue(key string, defaultValue int) int</pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\tGetFloatValue(key string, defaultValue float64) float64</pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\tGetBoolValue(key string, defaultValue bool) bool</pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t*/</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t<span class=\"token comment\">/*</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\tGetValueImmediately(key string) string</pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\tGetStringValueImmediately(key string, defaultValue string) string</pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\tGetStringSliceValueImmediately(key string, defaultValue []string) []string</pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\tGetIntSliceValueImmediately(key string, defaultValue []int) []int</pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\tGetSliceValueImmediately(key string, defaultValue []interface&#123;&#125;) []interface&#123;&#125;</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\tGetIntValueImmediately(key string, defaultValue int) int</pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\tGetFloatValueImmediately(key string, defaultValue float64) float64</pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\tGetBoolValueImmediately(key string, defaultValue bool) bool</pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t*/</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><blockquote>\n<p><code>GetStringValue</code>  和 <code>GetStringValueImmediately</code>  有什么区别呢？让我们看一下源码。</p>\n</blockquote>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// GetStringValue 获取配置值（string），获取不到则取默认值</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>Config<span class=\"token punctuation\">)</span> <span class=\"token function\">GetStringValue</span><span class=\"token punctuation\">(</span>key <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> defaultValue <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tvalue <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">GetValue</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">if</span> value <span class=\"token operator\">==</span> utils<span class=\"token punctuation\">.</span>Empty <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> defaultValue</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">return</span> value</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// GetStringValueImmediately 获取配置值（string），立即返回，初始化未完成直接返回错误</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>Config<span class=\"token punctuation\">)</span> <span class=\"token function\">GetStringValueImmediately</span><span class=\"token punctuation\">(</span>key <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> defaultValue <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tvalue <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">GetValueImmediately</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token keyword\">if</span> value <span class=\"token operator\">==</span> utils<span class=\"token punctuation\">.</span>Empty <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> defaultValue</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">return</span> value</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>这时候应该比较一下 <code>c.GetValue</code>  和 <code>c.GetValueImmediately</code></p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// GetValue 获取配置值（string）</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>Config<span class=\"token punctuation\">)</span> <span class=\"token function\">GetValue</span><span class=\"token punctuation\">(</span>key <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tvalue <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">getConfigValue</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token boolean\">true</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token operator\">...</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>Config<span class=\"token punctuation\">)</span> <span class=\"token function\">GetValueImmediately</span><span class=\"token punctuation\">(</span>key <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tvalue <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">getConfigValue</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token operator\">...</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>区别在这:</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//getConfigValue 获取配置值</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>Config<span class=\"token punctuation\">)</span> <span class=\"token function\">getConfigValue</span><span class=\"token punctuation\">(</span>key <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> waitInit <span class=\"token builtin\">bool</span><span class=\"token punctuation\">)</span> <span class=\"token keyword\">interface</span><span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   b <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">GetIsInit</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span>b <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>      <span class=\"token keyword\">if</span> <span class=\"token operator\">!</span>waitInit <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>         log<span class=\"token punctuation\">.</span><span class=\"token function\">Errorf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"getConfigValue fail, init not done, namespace:%s key:%s\"</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span>namespace<span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>         <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      c<span class=\"token punctuation\">.</span>waitInit<span class=\"token punctuation\">.</span><span class=\"token function\">Wait</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token keyword\">if</span> c<span class=\"token punctuation\">.</span>cache <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      log<span class=\"token punctuation\">.</span><span class=\"token function\">Errorf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"get config value fail!namespace:%s is not exist!\"</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">.</span>namespace<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>   value<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> c<span class=\"token punctuation\">.</span>cache<span class=\"token punctuation\">.</span><span class=\"token function\">Get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>   <span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      log<span class=\"token punctuation\">.</span><span class=\"token function\">Errorf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"get config value fail!key:%s,err:%s\"</span><span class=\"token punctuation\">,</span> key<span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token keyword\">return</span> value</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>说明不带 immediately 的函数有阻塞，也就是说假如你的 ip 地址写错了，它就会一直等待，而不会直接给你返回错误。所以选择的标准就是是否希望立即获取并使用。</p>\n<p>如果应用程序希望在获取配置值的同时继续执行其他操作，不阻塞当前线程，那不带 immedialy 的函数肯定更适合。</p>\n<h3 id=\"getconfigcache\"><a class=\"anchor\" href=\"#getconfigcache\">#</a>  <code>GetConfigCache</code></h3>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">GetFromCache</span><span class=\"token punctuation\">(</span>client agollo<span class=\"token punctuation\">.</span>Client<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tkey <span class=\"token operator\">:=</span> <span class=\"token string\">\"timeout\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tcache <span class=\"token operator\">:=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">GetConfigCache</span><span class=\"token punctuation\">(</span>common<span class=\"token punctuation\">.</span>NameSpaceDemo<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tvalue<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> cache<span class=\"token punctuation\">.</span><span class=\"token function\">Get</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t\t<span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>value<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"踩坑点\"><a class=\"anchor\" href=\"#踩坑点\">#</a> 踩坑点</h2>\n<h3 id=\"直接用-client-获取键值\"><a class=\"anchor\" href=\"#直接用-client-获取键值\">#</a> 直接用  <code>client</code>  获取键值</h3>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">GetFromStorage</span><span class=\"token punctuation\">(</span>client agollo<span class=\"token punctuation\">.</span>Client<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    key <span class=\"token operator\">:=</span> <span class=\"token string\">\"timeout\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tstrVal <span class=\"token operator\">:=</span> client<span class=\"token punctuation\">.</span><span class=\"token function\">GetStringValue</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> <span class=\"token string\">\"xxx\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>strVal<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><p>查看源码：</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">//GetStringValue 获取 string 配置值</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token punctuation\">(</span>c <span class=\"token operator\">*</span>internalClient<span class=\"token punctuation\">)</span> <span class=\"token function\">GetStringValue</span><span class=\"token punctuation\">(</span>key <span class=\"token builtin\">string</span><span class=\"token punctuation\">,</span> defaultValue <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token keyword\">return</span> c<span class=\"token punctuation\">.</span><span class=\"token function\">GetConfig</span><span class=\"token punctuation\">(</span>storage<span class=\"token punctuation\">.</span><span class=\"token function\">GetDefaultNamespace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token function\">GetStringValue</span><span class=\"token punctuation\">(</span>key<span class=\"token punctuation\">,</span> defaultValue<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// GetDefaultNamespace 获取默认命名空间</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">GetDefaultNamespace</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">string</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   <span class=\"token keyword\">return</span> defaultNamespace</pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">const</span> defaultNamespace <span class=\"token builtin\">string</span> <span class=\"token operator\">=</span> <span class=\"token string\">\"application\"</span></pre></td></tr></table></figure><ul>\n<li>\n<p>如果默认命名空间没有你想获取的键，就会报空指针的错误。</p>\n</li>\n<li>\n<p>因为会判断出  <code>storage</code>  没有初始化。</p>\n</li>\n</ul>\n<p>以下方法皆同理：</p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>GetValue(key string) string</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tGetStringValue(key string, defaultValue string) string</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tGetIntValue(key string, defaultValue int) int</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tGetFloatValue(key string, defaultValue float64) float64</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tGetBoolValue(key string, defaultValue bool) bool</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tGetStringSliceValue(key string, defaultValue []string) []string</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tGetIntSliceValue(key string, defaultValue []int) []int</pre></td></tr></table></figure>",
            "tags": [
                "后端",
                "Apollo"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2024/02/06/golang%E5%9F%BA%E7%A1%80/container%E5%8C%85/",
            "url": "https://withoutabc.github.io/2024/02/06/golang%E5%9F%BA%E7%A1%80/container%E5%8C%85/",
            "title": "container包",
            "date_published": "2024-02-06T15:25:02.000Z",
            "content_html": "<h1 id=\"container-包\"><a class=\"anchor\" href=\"#container-包\">#</a> container 包</h1>\n<h2 id=\"containerlist\"><a class=\"anchor\" href=\"#containerlist\">#</a> container/list</h2>\n<h3 id=\"结构\"><a class=\"anchor\" href=\"#结构\">#</a> 结构</h3>\n<p>先看一下结构体由哪些部分组成：</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> Element <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    next<span class=\"token punctuation\">,</span> prev <span class=\"token operator\">*</span>Element</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    list       <span class=\"token operator\">*</span>List</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    Value      any</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">type</span> List <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    root Element</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token builtin\">len</span>  <span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"element-方法\"><a class=\"anchor\" href=\"#element-方法\">#</a> Element 方法</h3>\n<h4 id=\"下一个节点\"><a class=\"anchor\" href=\"#下一个节点\">#</a> 下一个节点</h4>\n<p><code>func (e *Element) Next() *Element</code></p>\n<h4 id=\"上一个节点\"><a class=\"anchor\" href=\"#上一个节点\">#</a> 上一个节点</h4>\n<p><code>func (e *Element) Prev() *Element</code></p>\n<h3 id=\"list-方法\"><a class=\"anchor\" href=\"#list-方法\">#</a> List 方法</h3>\n<h4 id=\"初始化链表\"><a class=\"anchor\" href=\"#初始化链表\">#</a> 初始化链表</h4>\n<p><code>func New() *List</code></p>\n<h4 id=\"链表长度\"><a class=\"anchor\" href=\"#链表长度\">#</a> 链表长度</h4>\n<p><code>func (l *List) Len() int</code></p>\n<h4 id=\"链表第一个节点\"><a class=\"anchor\" href=\"#链表第一个节点\">#</a> 链表第一个节点</h4>\n<p><code>func (l *List) Front() *Element</code></p>\n<h4 id=\"链表最后一个节点\"><a class=\"anchor\" href=\"#链表最后一个节点\">#</a> 链表最后一个节点</h4>\n<p><code>func (l *List) Back() *Element</code></p>\n<h4 id=\"初始化或清空一个链表\"><a class=\"anchor\" href=\"#初始化或清空一个链表\">#</a> 初始化或清空一个链表</h4>\n<p><code>func (l *List) Init() *List</code></p>\n<h4 id=\"指定节点前添加节点\"><a class=\"anchor\" href=\"#指定节点前添加节点\">#</a> 指定节点前添加节点</h4>\n<p><code>func (l *List) InsertAfter(v any, mark *Element) *Element</code></p>\n<p>若 mark 不属于 l，则链表不修改。</p>\n<h4 id=\"指定节点后添加节点\"><a class=\"anchor\" href=\"#指定节点后添加节点\">#</a> 指定节点后添加节点</h4>\n<p><code>func (l *List) InsertBefore(v any, mark *Element) *Element</code></p>\n<p>若 mark 不属于 l，则链表不修改。</p>\n<h4 id=\"链表末尾添加节点\"><a class=\"anchor\" href=\"#链表末尾添加节点\">#</a> 链表末尾添加节点</h4>\n<p><code>func (l *List) PushBack(v any) *Element</code></p>\n<h4 id=\"链表开头添加节点\"><a class=\"anchor\" href=\"#链表开头添加节点\">#</a> 链表开头添加节点</h4>\n<p><code>func (l *List) PushFront(other *List)</code></p>\n<h4 id=\"删除节点\"><a class=\"anchor\" href=\"#删除节点\">#</a> 删除节点</h4>\n<p><code>func (l *List) Remove(e *Element) any</code></p>\n<h4 id=\"把指定节点移动到指定节点之后\"><a class=\"anchor\" href=\"#把指定节点移动到指定节点之后\">#</a> 把指定节点移动到指定节点之后</h4>\n<p><code>func (l *List) MoveAfter(e, mark *Element)</code></p>\n<p>若 e 或 mark 不属于 l，则链表不修改。</p>\n<h4 id=\"把指定节点移动到指定节点之前\"><a class=\"anchor\" href=\"#把指定节点移动到指定节点之前\">#</a> 把指定节点移动到指定节点之前</h4>\n<p><code>func (l *List) MoveBefore(e, mark *Element)</code></p>\n<p>若 e 或 mark 不属于 l，则链表不修改。</p>\n<h4 id=\"把指定节点移动到链表末尾\"><a class=\"anchor\" href=\"#把指定节点移动到链表末尾\">#</a> 把指定节点移动到链表末尾</h4>\n<p><code>func (l *List) MoveToBack(e *Element)</code></p>\n<h4 id=\"把指定节点移动到链表开头\"><a class=\"anchor\" href=\"#把指定节点移动到链表开头\">#</a> 把指定节点移动到链表开头</h4>\n<p><code>func (l *List) MoveToFront(e *Element)</code></p>\n<h4 id=\"把指定节点移动到链表末尾-2\"><a class=\"anchor\" href=\"#把指定节点移动到链表末尾-2\">#</a> 把指定节点移动到链表末尾</h4>\n<p><code>func (l *List) MoveToBack(e *Element)</code></p>\n<h4 id=\"把指定节点移动到链表开头-2\"><a class=\"anchor\" href=\"#把指定节点移动到链表开头-2\">#</a> 把指定节点移动到链表开头</h4>\n<p><code>func (l *List) MoveToFront(e *Element)</code></p>\n<h4 id=\"结尾追加链表\"><a class=\"anchor\" href=\"#结尾追加链表\">#</a> 结尾追加链表</h4>\n<p><code>func (l *List) PushBackList(other *List)</code></p>\n<h4 id=\"开头加入链表\"><a class=\"anchor\" href=\"#开头加入链表\">#</a> 开头加入链表</h4>\n<p><code>func (l *List) PushFrontList(other *List)</code></p>\n",
            "tags": [
                "golang基础",
                "go_grammar"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2023/12/18/%E5%90%8E%E7%AB%AF/Nginx/",
            "url": "https://withoutabc.github.io/2023/12/18/%E5%90%8E%E7%AB%AF/Nginx/",
            "title": "Nginx",
            "date_published": "2023-12-18T10:38:37.000Z",
            "content_html": "<h1 id=\"centos-安装-nginx\"><a class=\"anchor\" href=\"#centos-安装-nginx\">#</a> CentOS 安装 Nginx</h1>\n<h2 id=\"下载安装包\"><a class=\"anchor\" href=\"#下载安装包\">#</a> 下载安装包</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">wget</span> https://nginx.org/download/nginx-1.16.1.tar.gz</pre></td></tr></table></figure><h2 id=\"解压缩\"><a class=\"anchor\" href=\"#解压缩\">#</a> 解压缩</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">tar</span> zxvf nginx-1.16.1.tar.gz <span class=\"token parameter variable\">-C</span> <span class=\"token punctuation\">..</span>/module/</pre></td></tr></table></figure><h2 id=\"进入目录\"><a class=\"anchor\" href=\"#进入目录\">#</a> 进入目录</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token builtin class-name\">cd</span> nginx-1.16.1/</pre></td></tr></table></figure><h2 id=\"安装-nginx\"><a class=\"anchor\" href=\"#安装-nginx\">#</a> 安装 nginx</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 安装 gcc</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> gcc</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 安装 perl</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> pcre pcre-devel</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 安装 zlib</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>yum <span class=\"token function\">install</span> <span class=\"token parameter variable\">-y</span> zlib zlib-devel</pre></td></tr></table></figure><figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">make</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token function\">make</span> <span class=\"token function\">install</span></pre></td></tr></table></figure><p>安装到指定目录</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>./configure <span class=\"token parameter variable\">--prefix</span><span class=\"token operator\">=</span>/usr/local/nginx</pre></td></tr></table></figure><h2 id=\"启动-nginx\"><a class=\"anchor\" href=\"#启动-nginx\">#</a> 启动 Nginx</h2>\n<p>进入  <code>/usr/local/nginx/sbin</code>  目录</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 启动</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>./nginx</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token comment\"># 快速停止</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>./nginx <span class=\"token parameter variable\">-s</span> stop</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\"># 优雅关闭，在退出前完成已经接受的连续请求</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>./nginx <span class=\"token parameter variable\">-s</span> quit</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\"># 重新加载配置</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>./nginx <span class=\"token parameter variable\">-s</span> reload</pre></td></tr></table></figure><h2 id=\"关闭防火墙\"><a class=\"anchor\" href=\"#关闭防火墙\">#</a> 关闭防火墙</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl stop firewalld.service</pre></td></tr></table></figure><h2 id=\"禁止防火墙开机启动\"><a class=\"anchor\" href=\"#禁止防火墙开机启动\">#</a> 禁止防火墙开机启动</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl disable firewalld.service</pre></td></tr></table></figure><h2 id=\"放行端口\"><a class=\"anchor\" href=\"#放行端口\">#</a> 放行端口</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>firewall-cmd <span class=\"token parameter variable\">--zone</span><span class=\"token operator\">=</span>public --add-port<span class=\"token operator\">=</span><span class=\"token number\">80</span>/tcp <span class=\"token parameter variable\">--permanent</span></pre></td></tr></table></figure><h2 id=\"重启防火墙\"><a class=\"anchor\" href=\"#重启防火墙\">#</a> 重启防火墙</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>firewall-cmd <span class=\"token parameter variable\">--reload</span></pre></td></tr></table></figure><h2 id=\"查看-nginx-状态\"><a class=\"anchor\" href=\"#查看-nginx-状态\">#</a> 查看 nginx 状态</h2>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">ps</span> <span class=\"token parameter variable\">-ef</span> <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> nginx</pre></td></tr></table></figure><h2 id=\"安装成系统服务\"><a class=\"anchor\" href=\"#安装成系统服务\">#</a> 安装成系统服务</h2>\n<p>创建服务脚本</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token function\">vi</span> /usr/lib/systemd/system/nginx.service</pre></td></tr></table></figure><p>复制，路径请对应</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token punctuation\">[</span>Unit<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token assign-left variable\">Description</span><span class=\"token operator\">=</span>nginx - web server</pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token assign-left variable\">After</span><span class=\"token operator\">=</span>network.target remote-fs.target nss-lookup.target</pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">[</span>Service<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token assign-left variable\">Type</span><span class=\"token operator\">=</span>forking</pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token assign-left variable\">PIDFile</span><span class=\"token operator\">=</span>/usr/local/nginx/logs/nginx.pid</pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token assign-left variable\">ExecStartPre</span><span class=\"token operator\">=</span>/usr/local/nginx/sbin/nginx <span class=\"token parameter variable\">-t</span> <span class=\"token parameter variable\">-c</span> /usr/local/nginx/conf/nginx.conf</pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token assign-left variable\">ExecStart</span><span class=\"token operator\">=</span>/usr/local/nginx/sbin/nginx <span class=\"token parameter variable\">-c</span> /usr/local/nginx/conf/nginx.conf</pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token assign-left variable\">ExecReload</span><span class=\"token operator\">=</span>/usr/local/nginx/sbin/nginx <span class=\"token parameter variable\">-s</span> reload</pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token assign-left variable\">ExecStop</span><span class=\"token operator\">=</span>/usr/local/nginx/sbin/nginx <span class=\"token parameter variable\">-s</span> stop</pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token assign-left variable\">ExecQuit</span><span class=\"token operator\">=</span>/usr/local/nginx/sbin/nginx <span class=\"token parameter variable\">-s</span> quit</pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token assign-left variable\">PrivateTmp</span><span class=\"token operator\">=</span>true</pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">[</span>Install<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token assign-left variable\">WantedBy</span><span class=\"token operator\">=</span>multi-user.target</pre></td></tr></table></figure><p>重新加载系统服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl daemon-reload</pre></td></tr></table></figure><p>关闭服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># 见上</span></pre></td></tr></table></figure><p>启动服务</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl start nginx</pre></td></tr></table></figure><p>开机启动</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>systemctl <span class=\"token builtin class-name\">enable</span> nginx.service</pre></td></tr></table></figure><h1 id=\"基本配置文件\"><a class=\"anchor\" href=\"#基本配置文件\">#</a> 基本配置文件</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># nginx.conf</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>worker_processes  <span class=\"token number\">1</span><span class=\"token punctuation\">;</span> <span class=\"token comment\">#允许进程数量，建议设置为 cpu 核心数或者 auto 自动检测，注意 Windows 服务器上虽然可以启动多个 processes，但是实际只会用其中一个</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>events <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\">#单个进程最大连接数（最大连接数 = 连接数 * 进程数）</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\">#根据硬件调整，和前面工作进程配合起来用，尽量大，但是别把 cpu 跑到 100% 就行。</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    worker_connections  <span class=\"token number\">1024</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre></pre></td></tr><tr><td data-num=\"10\"></td><td><pre></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>http <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>    <span class=\"token comment\">#文件扩展名与文件类型映射表 (是 conf 目录下的一个文件)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>    include       mime.types<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token comment\">#默认文件类型，如果 mime.types 预先定义的类型没匹配上，默认使用二进制流的方式传输</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>    default_type  application/octet-stream<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token comment\">#sendfile 指令指定 nginx 是否调用 sendfile 函数（zero copy 方式）来输出文件，对于普通应用，必须设为 on。如果用来进行下载等应用磁盘 IO 重负载应用，可设置为 off，以平衡磁盘与网络 IO 处理速度。</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>    sendfile        on<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>    </pre></td></tr><tr><td data-num=\"20\"></td><td><pre>     <span class=\"token comment\">#长连接超时时间，单位是秒</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    keepalive_timeout  <span class=\"token number\">65</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre> <span class=\"token comment\">#虚拟主机的配置</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>    server <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>    <span class=\"token comment\">#监听端口</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        listen       <span class=\"token number\">80</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">#域名，可以有多个，用空格隔开</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        server_name  localhost<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t<span class=\"token comment\">#配置根目录以及默认页面</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        location / <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>            root   html<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>            index  index.html index.htm<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token comment\">#出错页面配置</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>        error_page   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token comment\">#/50x.html 文件所在位置</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>        location <span class=\"token operator\">=</span> /50x.html <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>            root   html<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"虚拟主机与域名解析\"><a class=\"anchor\" href=\"#虚拟主机与域名解析\">#</a> 虚拟主机与域名解析</h1>\n<p>虚拟主机使用特殊的软硬件技术，把一台运行在因特网上的服务器主机分成一台台 “虚拟” 的主机，每一台虚拟主机都具有独立的域名，具有完整的 Internet 服务器（WWW、FTP、Email 等）功能，虚拟主机之间完全独立，并可由用户自行管理，在外界看来，每一台虚拟主机和一台独立的主机完全一样。</p>\n<p>域名解析就是域名到 IP 地址的转换过程，IP 地址是网路上标识站点的数字地址，为了简单好记，采用域名来代替 ip 地址标识站点地址。域名的解析工作由 DNS 服务器完成。</p>\n<h2 id=\"域名-dns-ip-地址的关系\"><a class=\"anchor\" href=\"#域名-dns-ip-地址的关系\">#</a> 域名、dns、ip 地址的关系</h2>\n<p>域名是相对网站来说的，IP 是相对网络来说的。当输入一个域名的时候，网页是如何做出反应的？</p>\n<p>输入域名 ----&gt; 域名解析服务器（dns）解析成 ip 地址 —&gt; 访问 IP 地址 —&gt; 完成访问的内容 —&gt; 返回信息。</p>\n<p>Internet 上的计算机 IP 是唯一的，一个 IP 地址对应一个计算机。</p>\n<p>一台计算机上面可以有很多个服务，也就是一个 ip 地址对应了很多个域名，即一个计算机上有很多网站。</p>\n<h2 id=\"ip-地址和-dns-地址的区别\"><a class=\"anchor\" href=\"#ip-地址和-dns-地址的区别\">#</a> IP 地址和 DNS 地址的区别</h2>\n<ul>\n<li>\n<p>IP 地址是指单个主机的唯一 IP 地址，而 DNS 服务器地址是用于域名解析的地址。</p>\n</li>\n<li>\n<p>一个是私网地址，一个是公网地址；</p>\n</li>\n<li>\n<p>一个作为主机的逻辑标志，一个作为域名解析服务器的访问地址。</p>\n</li>\n</ul>\n<h2 id=\"ip-地址\"><a class=\"anchor\" href=\"#ip-地址\">#</a> IP 地址</h2>\n<p>IP，就是 Internet Protocol 的缩写，是一种通信协议，我们用的因特网基本是 IP 网组成的。</p>\n<p>IP 地址就是因特网上的某个设备的一个编号。</p>\n<p>IP 地址一般由网络号，主机号，掩码来组成。</p>\n<p>IP 网络上有很多路由器，路由器之间转发、通信都是只认这个 IP 地址，类似什么哪？就好像你寄包裹，你的写上发件人地址，你的姓名，收件人地址，收件人姓名。</p>\n<p>这个发件人地址就是你电脑的 IP 的网络号，你的姓名就是你的主机号。</p>\n<p>收件人的地址就是你要访问的 IP 的网络号，收件人的姓名就是访问 IP 的主机号。</p>\n<p>现在还有了更复杂的 IPV6, 还有 IPV9。</p>\n<h2 id=\"dns-是什么\"><a class=\"anchor\" href=\"#dns-是什么\">#</a> DNS 是什么？</h2>\n<p>我们访问因特网必须知道对端的 IP 地址，可是我们访问网站一般只知道域名啊，怎么办？</p>\n<p>这时候 DNS 就有用处了，电脑先访问 DNS 服务器，查找域名对应的 IP, 于是，你的电脑就知道要发包到 IP 地址了。</p>\n<h1 id=\"servername-匹配规则\"><a class=\"anchor\" href=\"#servername-匹配规则\">#</a> ServerName 匹配规则</h1>\n<p>我们可以在同一个 servername 中配置多个域名</p>\n<h2 id=\"完整匹配\"><a class=\"anchor\" href=\"#完整匹配\">#</a> 完整匹配</h2>\n<p>server 中可以配置多个域名，例如：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>server_name  test81.xzj520520.cn  test82.xzj520520.cn<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"通配符匹配\"><a class=\"anchor\" href=\"#通配符匹配\">#</a> 通配符匹配</h2>\n<p>使用通配符的方式如下：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>server_name  *.xzj520520.cn<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><p>需要注意的是精确匹配的优先级大于通配符匹配和正则匹配。</p>\n<h2 id=\"通配符结束匹配\"><a class=\"anchor\" href=\"#通配符结束匹配\">#</a> 通配符结束匹配</h2>\n<p>使用通配符结束匹配的方式如下：</p>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>server_name  www.xzj520520.*<span class=\"token punctuation\">;</span></pre></td></tr></table></figure><h2 id=\"正则匹配\"><a class=\"anchor\" href=\"#正则匹配\">#</a> 正则匹配</h2>\n<p>正则匹配格式，必须以～开头，比如： <code>server_name~^www\\d+\\.example\\.net$;</code> 。如果开头没有～，则 nginx 认为是精确匹配。在逻辑上，需要添加  <code>^</code>  和  <code>$</code>  锚定符号。注意，正则匹配格式中。为正则元字符，如果需要匹配，则需要反斜线转义。如果正则匹配中含有  <code>&#123;</code>  和 <code>&#125;</code>  则需要双引号引用起来，避免 nginx 报错，如果没有加双引号，则 nginx 会报如下错误： <code>directive &quot;server_name&quot; is not terminated by &quot;;&quot; in ...</code> 。</p>\n<h2 id=\"特殊匹配格式\"><a class=\"anchor\" href=\"#特殊匹配格式\">#</a> 特殊匹配格式</h2>\n<pre><code>server_name &quot;&quot;;\n</code></pre>\n<p>匹配 Host 请求头不存在的情况。</p>\n<h2 id=\"匹配顺序\"><a class=\"anchor\" href=\"#匹配顺序\">#</a> 匹配顺序</h2>\n<ol>\n<li>精确的名字</li>\n<li>以 * 号开头的最长通配符名称，例如 *.example.org</li>\n<li>以号结尾的最长通配符名称，例如 mail</li>\n<li>第一个匹配的正则表达式（在配置文件中出现的顺序）</li>\n</ol>\n<h2 id=\"优化\"><a class=\"anchor\" href=\"#优化\">#</a> 优化</h2>\n<ol>\n<li>尽量使用精确匹配；</li>\n<li>当定义大量 <code>server_name</code>  时或特别长的 <code>server_name</code>  时，需要在 <code>http</code>  级别调整 <code>server_names_hash_max_size</code>  和  <code>server_names_hash_bucket_size</code> ，否则 <code>nginx</code>  将无法启动。</li>\n</ol>\n<h2 id=\"附录\"><a class=\"anchor\" href=\"#附录\">#</a> 附录</h2>\n<p>~ 为区分大小写的匹配</p>\n<p>~* 不区分大小写的匹配（匹配 firefox 的正则同时匹配 FireFox）</p>\n<p>!~ 区分大小写不匹配</p>\n<p>!~* 不区分大小写不匹配</p>\n<p>. 匹配除换行符以外的任意字符</p>\n<p>\\w 匹配字母或数字或下划线或汉字</p>\n<p>\\s 匹配任意的空白符</p>\n<p>\\d 匹配数字</p>\n<p>\\b 匹配单词的开始或结束</p>\n<p>^ 匹配字符串的开始</p>\n<p>$ 匹配字符串的结束</p>\n<p>* 重复零次或更多次前面一个字符</p>\n<p>+ 重复一次或更多次前面一个字符</p>\n<p>? 重复零次或一次前面一个字符</p>\n<p>{n} 重复 n 次前面一个字符 {n,} 重复 n 次或更多次</p>\n<p>{n,m} 重复 n 到 m 次</p>\n<p>*? 重复任意次，但尽可能少重复</p>\n<p>+? 重复 1 次或更多次，但尽可能少重复</p>\n<p>?? 重复 0 次或 1 次，但尽可能少重复</p>\n<p>{n,m}? 重复 n 到 m 次，但尽可能少重复</p>\n<p>{n,}? 重复 n 次以上，但尽可能少重复</p>\n<p>\\W 匹配任意不是字母，数字，下划线，汉字的字符</p>\n<p>\\S 匹配任意不是空白符的字符</p>\n<p>\\D 匹配任意非数字的字符</p>\n<p>\\B 匹配不是单词开头或结束的位置</p>\n<p>[^x] 匹配除了 x 以外的任意字符</p>\n<p>[^abc] 匹配除了 abc 这几个字母以外的任意字符</p>\n<p>(exp) 匹配 exp, 并捕获文本到 0…9</p>\n<p>(?exp) 匹配 exp, 并捕获文本到名称为 name 的组里，也可以写成 (?'name’exp)</p>\n<p>(?:exp) 匹配 exp, 不捕获匹配的文本，也不给此分组分配组号</p>\n<p>(?=exp) 零宽断言，匹配 exp 前面的位置</p>\n<p>(?&lt;=exp) 匹配 exp 后面的位置</p>\n<p>(?!exp) 匹配后面跟的不是 exp 的位置</p>\n<p>(?&lt;!exp) 匹配前面不是 exp 的位置</p>\n<p>(?#comment) 注释，这种类型的分组不对正则表达式的处理产生任何影响，用于提供注释让人阅读</p>\n<h1 id=\"反向代理在系统结构中的应用场景\"><a class=\"anchor\" href=\"#反向代理在系统结构中的应用场景\">#</a> 反向代理在系统结构中的应用场景</h1>\n<p>反向代理方式是指以代理服务器来接受 Internet 上的连接请求，然后将请求转发给内部网络上的服务器；并将从服务器上得到的结果返回给 Internet 上请求连接的客户端，此时代理服务器对外就表现为一个服务器。</p>\n<p>反向代理服务器通常有两种模型，一种是作为内容服务器的替身，另一种作为内容服务器集群的负载均衡器。</p>\n<ul>\n<li>作内容服务器的替身</li>\n</ul>\n<p>如果您的内容服务器具有必须保持安全的敏感信息，如信用卡号数据库，可在防火墙外部设置一个代理服务器作为内容服务器的替身。当外部客户机尝试访问内容服务器时，会将其送到代理服务器。实际内容位于内容服务器上，在防火墙内部受到安全保护。代理服务器位于防火墙外部，在客户机看来就像是内容服务器。</p>\n<p>当客户机向站点提出请求时，请求将转到代理服务器。然后，代理服务器通过防火墙中的特定通路，将客户机的请求发送到内容服务器。内容服务器再通过该通道将结果回传给代理服务器。代理服务器将检索到的信息发送给客户机，好像代理服务器就是实际的内容服务器。如果内容服务器返回错误消息，代理服务器会先行截取该消息并更改标头中列出的任何 URL，然后再将消息发送给客户机。如此可防止外部客户机获取内部内容服务器的重定向 URL。</p>\n<p>这样，代理服务器就在安全数据库和可能的恶意攻击之间提供了又一道屏障。与有权访问整个数据库的情况相对比，就算是侥幸攻击成功，作恶者充其量也仅限于访问单个事务中所涉及的信息。未经授权的用户无法访问到真正的内容服务器，因为防火墙通路只允许代理服务器有权进行访问。</p>\n<ul>\n<li>作为内容服务器的负载均衡器</li>\n</ul>\n<p>可以在一个组织内使用多个代理服务器来平衡各 Web 服务器间的网络负载。在此模型中，可以利用代理服务器的高速缓存特性，创建一个用于负载平衡的服务器池。此时，代理服务器可以位于防火墙的任意一侧。如果 Web 服务器每天都会接收大量的请求，则可以使用代理服务器分担 Web 服务器的负载并提高网络访问效率。</p>\n<p>对于客户机发往真正服务器的请求，代理服务器起着中间调停者的作用。代理服务器会将所请求的文档存入高速缓存。如果有不止一个代理服务器，DNS 可以采用 “轮询法” 选择其 IP 地址，随机地为请求选择路由。客户机每次都使用同一个 URL，但请求所采取的路由每次都可能经过不同的代理服务器。</p>\n<p>可以使用多个代理服务器来处理对一个高用量内容服务器的请求，这样做的好处是内容服务器可以处理更高的负载，并且比其独自工作时更有效率。在初始启动期间，代理服务器首次从内容服务器检索文档，此后，对内容服务器的请求数会大大下降。</p>\n<h2 id=\"反向代理\"><a class=\"anchor\" href=\"#反向代理\">#</a> 反向代理</h2>\n<h3 id=\"示例\"><a class=\"anchor\" href=\"#示例\">#</a> 示例</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#虚拟主机的配置</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>    server <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    <span class=\"token comment\">#监听端口</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>        listen       <span class=\"token number\">80</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        <span class=\"token comment\">#域名，可以有多个，用空格隔开</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>        server_name  test80.xzj520520.cn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token comment\">#配置根目录以及默认页面</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>        location / <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>            proxy_pass http://192.168.8.102<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>            <span class=\"token comment\"># root   /www/test80;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>            <span class=\"token comment\"># index  index.html index.htm;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token comment\">#出错页面配置</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        error_page   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        <span class=\"token comment\">#/50x.html 文件所在位置</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>        location <span class=\"token operator\">=</span> /50x.html <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            root   html<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li><code>proxy_pass</code>  后接要代理到的 url</li>\n</ul>\n<h3 id=\"location-配置规则\"><a class=\"anchor\" href=\"#location-配置规则\">#</a> location 配置规则</h3>\n<ol>\n<li>匹配模式及顺序举例</li>\n</ol>\n<table>\n<thead>\n<tr>\n<th><strong>location</strong></th>\n<th><strong>说明</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>location = /url</td>\n<td>= 开头表示精确匹配，只有完全匹配上才能生效</td>\n</tr>\n<tr>\n<td>location ^~ /url</td>\n<td>^~ 开头对 URL 路径进行前缀匹配，并且在正则之前</td>\n</tr>\n<tr>\n<td>location ~ pattern</td>\n<td>~ 开头表示区分大小写的正则匹配</td>\n</tr>\n<tr>\n<td>location /url</td>\n<td>不带任何修饰符，也表示前缀匹配，但是在正则匹配之后，如果没有正则命中，命中最长的规则</td>\n</tr>\n<tr>\n<td>location /</td>\n<td>通用匹配，任何未匹配到其它 location 的请求都会匹配到，相当于 switch 中的 default</td>\n</tr>\n</tbody>\n</table>\n<ol start=\"2\">\n<li>location 是否以 “／” 结尾</li>\n</ol>\n<p>在 <code>ngnix</code>  中 <code>location</code>  进行的是模糊匹配</p>\n<ul>\n<li>\n<p>没有 “/” 结尾时，location /abc/def 可以匹配 /abc/defghi 请求，也可以匹配 /abc/def/ghi 等</p>\n</li>\n<li>\n<p>而有 “/” 结尾时，location /abc/def/ 不能匹配 /abc/defghi 请求，只能匹配 /abc/def/anything 这样的请求</p>\n</li>\n</ul>\n<h3 id=\"proxy_pass-配置规则\"><a class=\"anchor\" href=\"#proxy_pass-配置规则\">#</a> proxy_pass 配置规则</h3>\n<ol>\n<li>\n<p>配置 proxy_pass 时，当在后面的 url 加上了 /，相当于是绝对路径，则 Nginx 不会把 location 中匹配的路径部分加入代理 url。</p>\n</li>\n<li>\n<p>如果配置 proxy_pass 时，后面没有 /，Nginx 则会把匹配的路径部分加入代理 uri。</p>\n</li>\n</ol>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>server <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>        listen       <span class=\"token number\">8081</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>        server_name  localhost<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre> </pre></td></tr><tr><td data-num=\"5\"></td><td><pre>        location / <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>            root   html<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>            index  index.html index.htm<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">#情景 1:proxy_pass 后有 / ，表绝对路径，不把匹配部分加入最终代理路径（location 和 proxy_pass 结尾一致）</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        <span class=\"token comment\">#访问地址：http://localhost:8081/WCP.Service/wcp/modeladapter/download/asc.shtml</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">#最终代理：http://10.194.171.7:13082/modeladapter/download/asc.shtml</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\tlocation /WCP.Service/wcp/modeladapter/download/ <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>            proxy_pass   http://10.194.171.7:13082/modeladapter/download/<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        <span class=\"token comment\">#访问地址：http://localhost:8081/model/asc.shtml</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>        <span class=\"token comment\">#最终代理：http://127.0.0.1:8082/model/asc.shtml</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\tlocation /model/ <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            proxy_pass   http://127.0.0.1:8082/model/<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre><span class=\"token comment\">#情景 2:proxy_pass 后有 / ，表绝对路径，不把匹配部分加入最终代理路径（location 和 proxy_pass 结尾不一致）</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token comment\">#访问地址：http://localhost:8081/model/asc.shtml</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        <span class=\"token comment\">#最终代理：http://127.0.0.1:8082/asc.shtml</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\tlocation /model/ <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>            proxy_pass   http://127.0.0.1:8082/<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token comment\">#情景 3：proxy_pass 后没有 / ，Nginx 会把匹配部分带到代理的 url</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        <span class=\"token comment\">#访问地址：http://localhost:8081/model/asc.shtml</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token comment\">#最终代理：http://127.0.0.1:8082/model/asc.shtml</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>\t\tlocation /model/ <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>            proxy_pass   http://127.0.0.1:8082<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre> </pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token comment\">#情景 4</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>        <span class=\"token comment\">#访问地址：http://localhost:8081/model/asc.shtml</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>        <span class=\"token comment\">#最终代理：http://127.0.0.1:8082/AAAmodel/asc.shtml</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\tlocation /model/ <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>            proxy_pass   http://127.0.0.1:8082/AAA<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre><span class=\"token comment\">#情景 5</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>        <span class=\"token comment\">#访问地址：http://localhost:8081/model/asc.shtml</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>        <span class=\"token comment\">#最终代理：http://127.0.0.1:8082/asc.shtml</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t\tlocation /model <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>            proxy_pass   http://127.0.0.1:8082/<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre><span class=\"token comment\">#情景 6</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>        <span class=\"token comment\">#访问地址：http://localhost:8081/modelBBB/asc.shtml</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>        <span class=\"token comment\">#最终代理：http://127.0.0.1:8082/asc.shtml</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\tlocation /model <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>            proxy_pass   http://127.0.0.1:8082/<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"51\"></td><td><pre> </pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\t\tlocation /opus-front-sso <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>            proxy_pass   http://10.194.170.94/opus-front-sso<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre>\t\tlocation /awater <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>            proxy_pass   http://10.194.170.94/awater<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span>        </pre></td></tr><tr><td data-num=\"58\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"负载均衡\"><a class=\"anchor\" href=\"#负载均衡\">#</a> 负载均衡</h2>\n<h3 id=\"轮询模式\"><a class=\"anchor\" href=\"#轮询模式\">#</a> 轮询模式</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#定义一组服务器</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>upstream httpds<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    server <span class=\"token number\">192.168</span>.8.102:80<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    server <span class=\"token number\">192.168</span>.8.103:80<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre> <span class=\"token comment\">#虚拟主机的配置</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    server <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token comment\">#监听端口</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>        listen       <span class=\"token number\">80</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>        <span class=\"token comment\">#域名，可以有多个，用空格隔开</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        server_name  test80.xzj520520.cn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token comment\">#配置根目录以及默认页面</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>        location / <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>            proxy_pass http://httpds<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>            <span class=\"token comment\"># root   /www/test80;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            <span class=\"token comment\"># index  index.html index.htm;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token comment\">#出错页面配置</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>        error_page   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>        <span class=\"token comment\">#/50x.html 文件所在位置</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        location <span class=\"token operator\">=</span> /50x.html <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>            root   html<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"28\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"权重模式\"><a class=\"anchor\" href=\"#权重模式\">#</a> 权重模式</h3>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">#定义一组服务器</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>upstream httpds<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    server <span class=\"token number\">192.168</span>.8.102 <span class=\"token assign-left variable\">weight</span><span class=\"token operator\">=</span><span class=\"token number\">10</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    server <span class=\"token number\">192.168</span>.8.103 <span class=\"token assign-left variable\">weight</span><span class=\"token operator\">=</span><span class=\"token number\">1</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    <span class=\"token comment\"># server 192.168.8.102 weight=10 down; #down 表示不参与负载均衡</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token comment\"># server 192.168.8.102 weight=10 backup; #backup 表示是备用服务器，没有服务器可用的时候使用</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre> <span class=\"token comment\">#虚拟主机的配置</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    server <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token comment\">#监听端口</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>        listen       <span class=\"token number\">80</span><span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>        <span class=\"token comment\">#域名，可以有多个，用空格隔开</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>        server_name  test80.xzj520520.cn<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t<span class=\"token comment\">#配置根目录以及默认页面</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>        location / <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>            proxy_pass http://httpds<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>            <span class=\"token comment\"># root   /www/test80;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            <span class=\"token comment\"># index  index.html index.htm;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token comment\">#出错页面配置</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>        error_page   <span class=\"token number\">500</span> <span class=\"token number\">502</span> <span class=\"token number\">503</span> <span class=\"token number\">504</span>  /50x.html<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>        <span class=\"token comment\">#/50x.html 文件所在位置</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>        location <span class=\"token operator\">=</span> /50x.html <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            root   html<span class=\"token punctuation\">;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>        <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>        </pre></td></tr><tr><td data-num=\"30\"></td><td><pre>    <span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h3 id=\"其他策略\"><a class=\"anchor\" href=\"#其他策略\">#</a> 其他策略</h3>\n<ul>\n<li>ip_hash</li>\n</ul>\n<p>根据客户端的 ip 地址转发同一台服务器，可以保持会话，但是很少用这种方式去保持会话，例如我们当前正在使用 wifi 访问，当切换成手机信号访问时，会话就不保持了。</p>\n<ul>\n<li>least_conn</li>\n</ul>\n<p>最少连接访问，优先访问连接最少的那一台服务器，这种方式也很少使用，因为连接少，可能是由于该服务器配置较低，刚开始赋予的权重较低。</p>\n<ul>\n<li>url_hash（需要第三方插件）</li>\n</ul>\n<p>根据用户访问的 url 定向转发请求，不同的 url 转发到不同的服务器进行处理（定向流量转发）。</p>\n<ul>\n<li>fair（需要第三方插件）</li>\n</ul>\n<p>根据后端服务器响应时间转发请求，这种方式也很少使用，因为容易造成流量倾斜，给某一台服务器压垮。</p>\n<h1 id=\"使用阿里云配置https\"><a class=\"anchor\" href=\"#使用阿里云配置https\">#</a> 使用阿里云配置 https</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9oYXNobm9kZS5ibG9nLmNzZG4ubmV0L2FydGljbGUvZGV0YWlscy8xMjQ1NTUzMDM=\">使用阿里云配置 https</span></p>\n<h1 id=\"参考链接\"><a class=\"anchor\" href=\"#参考链接\">#</a> 参考链接</h1>\n<p><span class=\"exturl\" data-url=\"aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L2xlYXJuaW5nX3h6ai9jYXRlZ29yeV8xMTc5MjE5NC5odG1s\">参考链接</span></p>\n",
            "tags": [
                "后端",
                "nginx"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2023/12/18/%E5%90%8E%E7%AB%AF/Minio%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "url": "https://withoutabc.github.io/2023/12/18/%E5%90%8E%E7%AB%AF/Minio%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/",
            "title": "Minio部署及使用",
            "date_published": "2023-12-18T04:31:54.000Z",
            "content_html": "<h1 id=\"minio部署\"><a class=\"anchor\" href=\"#minio部署\">#</a> Minio 部署</h1>\n<figure class=\"highlight yaml\"><figcaption data-lang=\"YAML\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\"># docker-compose.yml</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token key atrule\">version</span><span class=\"token punctuation\">:</span> <span class=\"token string\">\"3.7\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token key atrule\">services</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  <span class=\"token key atrule\">minio</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token key atrule\">image</span><span class=\"token punctuation\">:</span> minio/minio<span class=\"token punctuation\">:</span>latest</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>    <span class=\"token key atrule\">command</span><span class=\"token punctuation\">:</span> server <span class=\"token punctuation\">-</span><span class=\"token punctuation\">-</span>console<span class=\"token punctuation\">-</span>address \"<span class=\"token punctuation\">:</span>9001\" /data</pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token key atrule\">volumes</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">-</span> ./data/configs/minio<span class=\"token punctuation\">:</span>/root/.minio</pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token punctuation\">-</span> ./data/data/minio<span class=\"token punctuation\">:</span>/data</pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token key atrule\">environment</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token punctuation\">-</span> MINIO_ACCESS_KEY=admin</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">-</span> MINIO_SECRET_KEY=admin123</pre></td></tr><tr><td data-num=\"14\"></td><td><pre>    <span class=\"token key atrule\">ports</span><span class=\"token punctuation\">:</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9000:9000\"</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token punctuation\">-</span> <span class=\"token string\">\"9001:9001\"</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token key atrule\">restart</span><span class=\"token punctuation\">:</span> always</pre></td></tr></table></figure><h1 id=\"安装-sdk\"><a class=\"anchor\" href=\"#安装-sdk\">#</a> 安装 sdk</h1>\n<figure class=\"highlight bash\"><figcaption data-lang=\"bash\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>go get github.com/minio/minio-go/v7</pre></td></tr></table></figure><h1 id=\"minio操作\"><a class=\"anchor\" href=\"#minio操作\">#</a> Minio 操作</h1>\n<h2 id=\"连接客户端\"><a class=\"anchor\" href=\"#连接客户端\">#</a> 连接客户端</h2>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">InitMinio</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">*</span>minio<span class=\"token punctuation\">.</span>Client <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tendpoint <span class=\"token operator\">:=</span> <span class=\"token string\">\"127.0.0.1:9000\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\taccessKeyID <span class=\"token operator\">:=</span> <span class=\"token string\">\"yxJZ0Ik5DFCEDhn8ojbX\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tsecretAccessKey <span class=\"token operator\">:=</span> <span class=\"token string\">\"PKYmEQsdjrMLbl1tRDbvgSzfQNPptyIAGsO4hqCB\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token comment\">// Initialize minio client object.</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tminioClient<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> minio<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span>endpoint<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>minio<span class=\"token punctuation\">.</span>Options<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t\tCreds<span class=\"token punctuation\">:</span>  credentials<span class=\"token punctuation\">.</span><span class=\"token function\">NewStaticV4</span><span class=\"token punctuation\">(</span>accessKeyID<span class=\"token punctuation\">,</span> secretAccessKey<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\tSecure<span class=\"token punctuation\">:</span> <span class=\"token boolean\">false</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalln</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t<span class=\"token keyword\">return</span> minioClient</pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"对象存储\"><a class=\"anchor\" href=\"#对象存储\">#</a> 对象存储</h2>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">Upload</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tbucketName <span class=\"token operator\">:=</span> <span class=\"token string\">\"mybuc\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tobjectName <span class=\"token operator\">:=</span> <span class=\"token string\">\"golden-oldies.txt\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tfilePath <span class=\"token operator\">:=</span> <span class=\"token string\">\"./tmp/golden-oldies.txt\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tcontentType <span class=\"token operator\">:=</span> <span class=\"token string\">\"application/json\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\tinfo<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> MC<span class=\"token punctuation\">.</span><span class=\"token function\">FPutObject</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> bucketName<span class=\"token punctuation\">,</span> objectName<span class=\"token punctuation\">,</span> filePath<span class=\"token punctuation\">,</span> minio<span class=\"token punctuation\">.</span>PutObjectOptions<span class=\"token punctuation\">&#123;</span>ContentType<span class=\"token punctuation\">:</span> contentType<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalln</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Printf</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Successfully uploaded %s of size %d\\n\"</span><span class=\"token punctuation\">,</span> objectName<span class=\"token punctuation\">,</span> info<span class=\"token punctuation\">.</span>Size<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>\n<p><code>filePath</code>  指要上传文件的路径</p>\n</li>\n<li>\n<p><code>objectName</code>  指上传指桶里的路径</p>\n</li>\n</ul>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">Download</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">:=</span> MC<span class=\"token punctuation\">.</span><span class=\"token function\">FGetObject</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> bucket<span class=\"token punctuation\">,</span> object<span class=\"token punctuation\">,</span> <span class=\"token string\">\"./test\"</span><span class=\"token punctuation\">,</span> minio<span class=\"token punctuation\">.</span>GetObjectOptions<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalln</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Successfully saved\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li><code>FGetObject</code>  和 <code>FPutObject</code>  都使用文件路径方式上传和下载。</li>\n</ul>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>object<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">GetObject</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"mybucket\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"myobject\"</span><span class=\"token punctuation\">,</span> minio<span class=\"token punctuation\">.</span>GetObjectOptions<span class=\"token punctuation\">&#123;</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">defer</span> object<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>localFile<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span><span class=\"token function\">Create</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"/tmp/local-file.jpg\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre><span class=\"token keyword\">defer</span> localFile<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">if</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> err <span class=\"token operator\">=</span> io<span class=\"token punctuation\">.</span><span class=\"token function\">Copy</span><span class=\"token punctuation\">(</span>localFile<span class=\"token punctuation\">,</span> object<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>可用 io 流操作的写法</li>\n</ul>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>file<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> os<span class=\"token punctuation\">.</span><span class=\"token function\">Open</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"my-testfile\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre><span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>    <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre><span class=\"token keyword\">defer</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">Close</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>fileStat<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> file<span class=\"token punctuation\">.</span><span class=\"token function\">Stat</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>    <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>uploadInfo<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">PutObject</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"mybucket\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"myobject\"</span><span class=\"token punctuation\">,</span> file<span class=\"token punctuation\">,</span> fileStat<span class=\"token punctuation\">.</span><span class=\"token function\">Size</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> minio<span class=\"token punctuation\">.</span>PutObjectOptions<span class=\"token punctuation\">&#123;</span>ContentType<span class=\"token punctuation\">:</span><span class=\"token string\">\"application/octet-stream\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre><span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>    <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Successfully uploaded bytes: \"</span><span class=\"token punctuation\">,</span> uploadInfo<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"访问控制\"><a class=\"anchor\" href=\"#访问控制\">#</a> 访问控制</h2>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">SetPolicy</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tbucketName <span class=\"token operator\">:=</span> <span class=\"token string\">\"mybuc\"</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\t<span class=\"token comment\">// 定义访问控制策略</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tpolicy <span class=\"token operator\">:=</span> <span class=\"token string\">`&#123;\"Version\":\"2012-10-17\",\"Statement\":[&#123;\"Action\":[\"s3:GetObject\"],\"Effect\":\"Allow\",\"Principal\":&#123;\"AWS\":[\"*\"]&#125;,\"Resource\":[\"arn:aws:s3:::`</span> <span class=\"token operator\">+</span> bucketName <span class=\"token operator\">+</span> <span class=\"token string\">`/*\"],\"Sid\":\"\"&#125;,&#123;\"Action\":[\"s3:PutObject\"],\"Effect\":\"Deny\",\"Principal\":&#123;\"AWS\":[\"123456789012\"]&#125;,\"Resource\":[\"arn:aws:s3:::`</span> <span class=\"token operator\">+</span> bucketName <span class=\"token operator\">+</span> <span class=\"token string\">`/*\"],\"Sid\":\"DenyUser\"&#125;]&#125;`</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token comment\">// 设置存储桶策略</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\terr <span class=\"token operator\">:=</span> MC<span class=\"token punctuation\">.</span><span class=\"token function\">SetBucketPolicy</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> bucketName<span class=\"token punctuation\">,</span> policy<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalln</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SetBucketPolicy failed:\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"SetBucketPolicy successfully!\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><ul>\n<li>请注意，policy 不要换行，否则会读取到  <code>\\n</code></li>\n</ul>\n<p>访问控制是 MinIO 中的一项重要功能，它允许您配置对存储桶和对象的访问权限。访问控制采用 IAM（Identity and Access Management）策略，用于控制哪些用户或实体可以执行哪些操作。让我们来详细了解 MinIO 中访问控制的各个字段和选项：</p>\n<p>在 MinIO 中，访问控制的字段包括：</p>\n<ul>\n<li>\n<p><code>Version</code> ：策略版本，目前只有一个版本 &quot;2012-10-17&quot;。</p>\n</li>\n<li>\n<p><code>Statement</code> ：策略规则的数组，每个规则都是一个 JSON 对象。</p>\n</li>\n</ul>\n<p>在每个策略规则中，包含以下字段：</p>\n<ul>\n<li>\n<p><code>Action</code> ：一个数组，定义允许或拒绝执行的操作。可以是对象和桶级别的操作，如 &quot;s3:GetObject&quot;、&quot;s3:PutObject&quot;、&quot;s3:ListBucket&quot; 等。</p>\n</li>\n<li>\n<p><code>Effect</code> ：规定操作是 &quot;Allow&quot;（允许）还是 &quot;Deny&quot;（拒绝）。</p>\n</li>\n<li>\n<p><code>Principal</code>  ：指定允许或拒绝执行操作的实体，可以是特定的 AWS 账号（使用 AWS 的账号 ID 或 ARN）或者是通配符 &quot;*&quot; 表示允许所有实体。</p>\n</li>\n<li>\n<p><code>Resource</code>  ：定义策略适用的资源，可以是存储桶的 ARN（Amazon Resource Name）或者存储桶内的对象的 ARN，也可以使用通配符指定一类资源。</p>\n</li>\n<li>\n<p><code>Sid</code>  ：一个可选的标识符，用于在策略规则中标识唯一的规则。</p>\n</li>\n</ul>\n<h2 id=\"预签名\"><a class=\"anchor\" href=\"#预签名\">#</a> 预签名</h2>\n<p>预签名（Presigned URL）的作用在于实现对存储对象的临时授权访问，而无需提供实际的访问凭证。它通常用于对象存储服务（比如 Minio、AWS S3 等）中，允许临时授权一个或多个 HTTP 请求来读取或上传对象。</p>\n<p>主要作用如下：</p>\n<ol>\n<li>\n<p><strong>临时授权：</strong> 预签名 URL 提供了一种临时授权访问对象的方式。通过生成预签名 URL，可以在特定时间窗口内，让任何人可以通过该 URL 来执行授权的操作，如读取对象或上传对象，无需共享实际的访问凭证。</p>\n</li>\n<li>\n<p><strong>安全性</strong>： 使用预签名 URL，可以避免将实际的访问凭证（比如访问密钥）暴露给公共网络。预签名 URL 只有在有效期内才可用，有效期过后，即使泄露也无法再访问。</p>\n</li>\n<li>\n<p><strong>简化权限管理</strong>： 预签名 URL 允许实现对象级别的临时授权，而无需为每个用户或应用程序单独创建访问凭证。这简化了权限管理，减少了访问凭证的创建和管理的工作量。</p>\n</li>\n<li>\n<p><strong>限制访问范围</strong>： 可以通过预签名 URL 的有效期和权限设置，限制特定 URL 的访问范围。例如，可以设置只允许读取指定对象的预签名 URL，或者只允许在特定时间范围内上传对象。</p>\n</li>\n<li>\n<p><strong>共享链接</strong>： 预签名 URL 可以方便地共享给其他用户或应用程序，让它们在授权有效期内进行特定的操作。</p>\n</li>\n</ol>\n<p>预签名 URL 在云存储服务和需要临时授权访问的场景中特别有用，它提供了一种安全且便捷的方式来控制对存储对象的访问权限，并且不需要在代码中传递敏感的访问凭证。</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Generates a url which expires in a day.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>expiry <span class=\"token operator\">:=</span> time<span class=\"token punctuation\">.</span>Second <span class=\"token operator\">*</span> <span class=\"token number\">24</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token comment\">// 1 day.</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>presignedURL<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">PresignedPutObject</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"mybucket\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"myobject\"</span><span class=\"token punctuation\">,</span> expiry<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre><span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>    <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Successfully generated presigned URL\"</span><span class=\"token punctuation\">,</span> presignedURL<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token comment\">// Set request parameters for content-disposition.</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>reqParams <span class=\"token operator\">:=</span> <span class=\"token function\">make</span><span class=\"token punctuation\">(</span>url<span class=\"token punctuation\">.</span>Values<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>reqParams<span class=\"token punctuation\">.</span><span class=\"token function\">Set</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"response-content-disposition\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"attachment; filename=\\\"your-filename.txt\\\"\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre></pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token comment\">// Generates a presigned url which expires in a day.</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>presignedURL<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">PresignedGetObject</span><span class=\"token punctuation\">(</span>context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"mybucket\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"myobject\"</span><span class=\"token punctuation\">,</span> time<span class=\"token punctuation\">.</span>Second <span class=\"token operator\">*</span> <span class=\"token number\">24</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span> <span class=\"token operator\">*</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span> reqParams<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span>err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>    <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>fmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Successfully generated presigned URL\"</span><span class=\"token punctuation\">,</span> presignedURL<span class=\"token punctuation\">)</span></pre></td></tr></table></figure><h2 id=\"对象锁定\"><a class=\"anchor\" href=\"#对象锁定\">#</a> 对象锁定</h2>\n<p>对象锁定是一种机制，用于确保在一段时间内对象的内容不被修改或删除。这在某些情况下非常有用，例如合规性要求、法规要求或法律保留期要求等。</p>\n<h2 id=\"桶复制\"><a class=\"anchor\" href=\"#桶复制\">#</a> 桶复制</h2>\n<p>桶复制（Bucket Replication）是指在 MinIO 对象存储系统中将一个存储桶的数据自动复制到另一个存储桶的功能。通过桶复制，您可以在不同的 MinIO 服务器之间或在同一服务器的不同存储桶之间实现数据的复制和同步。</p>\n<h2 id=\"生命周期管理\"><a class=\"anchor\" href=\"#生命周期管理\">#</a> 生命周期管理</h2>\n<p>生命周期管理（Lifecycle Management）是 MinIO 对象存储系统中的一项功能，它允许您自动管理对象的生命周期，包括对象的转换、迁移、删除等操作。通过生命周期管理，您可以根据对象的年龄、大小、存储类别等条件来定义规则，并根据这些规则自动执行操作。</p>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">package</span> main</pre></td></tr><tr><td data-num=\"2\"></td><td><pre></pre></td></tr><tr><td data-num=\"3\"></td><td><pre><span class=\"token keyword\">import</span> <span class=\"token punctuation\">(</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\t<span class=\"token string\">\"context\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\t<span class=\"token string\">\"fmt\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\t<span class=\"token string\">\"log\"</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>\t<span class=\"token string\">\"time\"</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token string\">\"github.com/minio/minio-go/v7\"</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token string\">\"github.com/minio/minio-go/v7/pkg/credentials\"</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token string\">\"github.com/minio/minio-go/v7/pkg/lifecycle\"</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre></pre></td></tr><tr><td data-num=\"14\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\tctx <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tendpoint <span class=\"token operator\">:=</span> <span class=\"token string\">\"your-minio-endpoint\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\taccessKeyID <span class=\"token operator\">:=</span> <span class=\"token string\">\"your-access-key-id\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\tsecretAccessKey <span class=\"token operator\">:=</span> <span class=\"token string\">\"your-secret-access-key\"</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\tuseSSL <span class=\"token operator\">:=</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\tminioClient<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> minio<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span>endpoint<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>minio<span class=\"token punctuation\">.</span>Options<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\tCreds<span class=\"token punctuation\">:</span>  credentials<span class=\"token punctuation\">.</span><span class=\"token function\">NewStaticV4</span><span class=\"token punctuation\">(</span>accessKeyID<span class=\"token punctuation\">,</span> secretAccessKey<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\tSecure<span class=\"token punctuation\">:</span> useSSL<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalln</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error initializing Minio client:\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\tbucketName <span class=\"token operator\">:=</span> <span class=\"token string\">\"your-bucket-name\"</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\truleID <span class=\"token operator\">:=</span> <span class=\"token string\">\"rule1\"</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t<span class=\"token comment\">// 设置规则过滤条件，只选择前缀为 \"documents/\" 的对象</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\tfilter <span class=\"token operator\">:=</span> lifecycle<span class=\"token punctuation\">.</span>Filter<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\tPrefix<span class=\"token punctuation\">:</span> <span class=\"token string\">\"documents/\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>\t<span class=\"token comment\">// 设置过期条件，对象在 30 天后过期并自动删除</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\texpiration <span class=\"token operator\">:=</span> lifecycle<span class=\"token punctuation\">.</span>Expiration<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\t\tDays<span class=\"token punctuation\">:</span> <span class=\"token number\">30</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre></pre></td></tr><tr><td data-num=\"43\"></td><td><pre>\t<span class=\"token comment\">// 创建生命周期配置规则</span></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\trule <span class=\"token operator\">:=</span> lifecycle<span class=\"token punctuation\">.</span>Rule<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t\tID<span class=\"token punctuation\">:</span>         ruleID<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\tStatus<span class=\"token punctuation\">:</span>     <span class=\"token string\">\"Enabled\"</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t\tRuleFilter<span class=\"token punctuation\">:</span> filter<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre>\t\tExpiration<span class=\"token punctuation\">:</span> expiration<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre></pre></td></tr><tr><td data-num=\"51\"></td><td><pre>\t<span class=\"token comment\">// 将规则添加到存储桶的生命周期配置中</span></pre></td></tr><tr><td data-num=\"52\"></td><td><pre>\tconfig <span class=\"token operator\">:=</span> lifecycle<span class=\"token punctuation\">.</span>Configuration<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"53\"></td><td><pre>\t\tRules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>lifecycle<span class=\"token punctuation\">.</span>Rule<span class=\"token punctuation\">&#123;</span>rule<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"54\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"55\"></td><td><pre></pre></td></tr><tr><td data-num=\"56\"></td><td><pre>\terr <span class=\"token operator\">=</span> minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">SetBucketLifecycle</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> bucketName<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>config<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"57\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"58\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalln</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error setting bucket lifecycle:\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"59\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"60\"></td><td><pre></pre></td></tr><tr><td data-num=\"61\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bucket lifecycle configuration set successfully.\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"62\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">main</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\t<span class=\"token comment\">// 连接到 Minio 服务器</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tendpoint <span class=\"token operator\">:=</span> <span class=\"token string\">\"your-minio-endpoint\"</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\taccessKeyID <span class=\"token operator\">:=</span> <span class=\"token string\">\"your-access-key-id\"</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>\tsecretAccessKey <span class=\"token operator\">:=</span> <span class=\"token string\">\"your-secret-access-key\"</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>\tuseSSL <span class=\"token operator\">:=</span> <span class=\"token boolean\">false</span> <span class=\"token comment\">// 设置为 true 如果使用 HTTPS，否则设置为 false</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>\tctx <span class=\"token operator\">:=</span> context<span class=\"token punctuation\">.</span><span class=\"token function\">Background</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\tminioClient<span class=\"token punctuation\">,</span> err <span class=\"token operator\">:=</span> minio<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span>endpoint<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>minio<span class=\"token punctuation\">.</span>Options<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\tCreds<span class=\"token punctuation\">:</span>  credentials<span class=\"token punctuation\">.</span><span class=\"token function\">NewStaticV4</span><span class=\"token punctuation\">(</span>accessKeyID<span class=\"token punctuation\">,</span> secretAccessKey<span class=\"token punctuation\">,</span> <span class=\"token string\">\"\"</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\tSecure<span class=\"token punctuation\">:</span> useSSL<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalln</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error initializing Minio client:\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\tbucketName <span class=\"token operator\">:=</span> <span class=\"token string\">\"your-bucket-name\"</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\truleID <span class=\"token operator\">:=</span> <span class=\"token string\">\"rule1\"</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token comment\">// 创建生命周期配置规则</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\trule <span class=\"token operator\">:=</span> lifecycle<span class=\"token punctuation\">.</span>Rule<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\tID<span class=\"token punctuation\">:</span>         ruleID<span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\tStatus<span class=\"token punctuation\">:</span>     <span class=\"token string\">\"Enabled\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 启用规则</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t\tRuleFilter<span class=\"token punctuation\">:</span> lifecycle<span class=\"token punctuation\">.</span>Filter<span class=\"token punctuation\">&#123;</span>Prefix<span class=\"token punctuation\">:</span> <span class=\"token string\">\"documents/\"</span><span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t\tTransition<span class=\"token punctuation\">:</span> lifecycle<span class=\"token punctuation\">.</span>Transition<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>\t\t\tDays<span class=\"token punctuation\">:</span>         <span class=\"token number\">30</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>\t\t\tStorageClass<span class=\"token punctuation\">:</span> <span class=\"token string\">\"STANDARD_IA\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 标准 - 低频访问存储类</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>\t\tExpiration<span class=\"token punctuation\">:</span> lifecycle<span class=\"token punctuation\">.</span>Expiration<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>\t\t\tDays<span class=\"token punctuation\">:</span> <span class=\"token number\">60</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 对象过期时间为 60 天</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>\t\tNoncurrentVersionTransition<span class=\"token punctuation\">:</span> lifecycle<span class=\"token punctuation\">.</span>NoncurrentVersionTransition<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>\t\t\tNoncurrentDays<span class=\"token punctuation\">:</span> <span class=\"token number\">90</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>\t\t\tStorageClass<span class=\"token punctuation\">:</span>   <span class=\"token string\">\"GLACIER\"</span><span class=\"token punctuation\">,</span> <span class=\"token comment\">// 冷冻存储类</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>\t<span class=\"token comment\">// 将规则添加到存储桶的生命周期配置中</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>\tconfig <span class=\"token operator\">:=</span> lifecycle<span class=\"token punctuation\">.</span>Configuration<span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"41\"></td><td><pre>\t\tRules<span class=\"token punctuation\">:</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span>lifecycle<span class=\"token punctuation\">.</span>Rule<span class=\"token punctuation\">&#123;</span>rule<span class=\"token punctuation\">&#125;</span><span class=\"token punctuation\">,</span></pre></td></tr><tr><td data-num=\"42\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"43\"></td><td><pre></pre></td></tr><tr><td data-num=\"44\"></td><td><pre>\terr <span class=\"token operator\">=</span> minioClient<span class=\"token punctuation\">.</span><span class=\"token function\">SetBucketLifecycle</span><span class=\"token punctuation\">(</span>ctx<span class=\"token punctuation\">,</span> bucketName<span class=\"token punctuation\">,</span> <span class=\"token operator\">&amp;</span>config<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"45\"></td><td><pre>\t<span class=\"token keyword\">if</span> err <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"46\"></td><td><pre>\t\tlog<span class=\"token punctuation\">.</span><span class=\"token function\">Fatalln</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Error setting bucket lifecycle:\"</span><span class=\"token punctuation\">,</span> err<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"47\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"48\"></td><td><pre></pre></td></tr><tr><td data-num=\"49\"></td><td><pre>\tfmt<span class=\"token punctuation\">.</span><span class=\"token function\">Println</span><span class=\"token punctuation\">(</span><span class=\"token string\">\"Bucket lifecycle configuration set successfully.\"</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"50\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"按图索骥\"><a class=\"anchor\" href=\"#按图索骥\">#</a> 按图索骥</h1>\n<p>直接把官网的表格 copy 下来了，方便查看有哪些可用的方法，随便点哪个都能进</p>\n<table>\n<thead>\n<tr>\n<th><strong>Bucket operations</strong></th>\n<th><strong>Object operations</strong></th>\n<th><strong>Presigned operations</strong></th>\n<th>Bucket Policy/Notification Operations</th>\n<th><strong>Client custom settings</strong></th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#MakeBucket\"> <code>MakeBucket</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#GetObject\"> <code>GetObject</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#PresignedGetObject\"> <code>PresignedGetObject</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#SetBucketPolicy\"> <code>SetBucketPolicy</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#SetAppInfo\"> <code>SetAppInfo</code> </a></td>\n</tr>\n<tr>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#PutObject\"> <code>PutObject</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#PresignedPutObject\"> <code>PresignedPutObject</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#GetBucketPolicy\"> <code>GetBucketPolicy</code> </a></td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#ListBuckets\"> <code>ListBuckets</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#CopyObject\"> <code>CopyObject</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#PresignedHeadObject\"> <code>PresignedHeadObject</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#SetBucketNotification\"> <code>SetBucketNotification</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#TraceOn\"> <code>TraceOn</code> </a></td>\n</tr>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#BucketExists\"> <code>BucketExists</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#StatObject\"> <code>StatObject</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#PresignedPostPolicy\"> <code>PresignedPostPolicy</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#GetBucketNotification\"> <code>GetBucketNotification</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#TraceOff\"> <code>TraceOff</code> </a></td>\n</tr>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#RemoveBucket\"> <code>RemoveBucket</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#RemoveObject\"> <code>RemoveObject</code> </a></td>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#RemoveAllBucketNotification\"> <code>RemoveAllBucketNotification</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#SetS3TransferAccelerate\"> <code>SetS3TransferAccelerate</code> </a></td>\n</tr>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#ListObjects\"> <code>ListObjects</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#RemoveObjects\"> <code>RemoveObjects</code> </a></td>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#ListenBucketNotification\"> <code>ListenBucketNotification</code> </a></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td></td>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#SetBucketLifecycle\"> <code>SetBucketLifecycle</code> </a></td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#ListIncompleteUploads\"> <code>ListIncompleteUploads</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#FPutObject\"> <code>FPutObject</code> </a></td>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#GetBucketLifecycle\"> <code>GetBucketLifecycle</code> </a></td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#SetBucketTagging\"> <code>SetBucketTagging</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#FGetObject\"> <code>FGetObject</code> </a></td>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#SetObjectLockConfig\"> <code>SetObjectLockConfig</code> </a></td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#GetBucketTagging\"> <code>GetBucketTagging</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#ComposeObject\"> <code>ComposeObject</code> </a></td>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#GetObjectLockConfig\"> <code>GetObjectLockConfig</code> </a></td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#RemoveBucketTagging\"> <code>RemoveBucketTagging</code> </a></td>\n<td></td>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#EnableVersioning\"> <code>EnableVersioning</code> </a></td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#SetBucketReplication\"> <code>SetBucketReplication</code> </a></td>\n<td></td>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#DisableVersioning\"> <code>DisableVersioning</code> </a></td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#GetBucketReplication\"> <code>GetBucketReplication</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#PutObjectRetention\"> <code>PutObjectRetention</code> </a></td>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#GetBucketEncryption\"> <code>GetBucketEncryption</code> </a></td>\n<td></td>\n</tr>\n<tr>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#RemoveBucketReplication\"> <code>RemoveBucketReplication</code> </a></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#GetObjectRetention\"> <code>GetObjectRetention</code> </a></td>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#RemoveBucketEncryption\"> <code>RemoveBucketEncryption</code> </a></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#PutObjectLegalHold\"> <code>PutObjectLegalHold</code> </a></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#GetObjectLegalHold\"> <code>GetObjectLegalHold</code> </a></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#SelectObjectContent\"> <code>SelectObjectContent</code> </a></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#PutObjectTagging\"> <code>PutObjectTagging</code> </a></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#GetObjectTagging\"> <code>GetObjectTagging</code> </a></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#RemoveObjectTagging\"> <code>RemoveObjectTagging</code> </a></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n<tr>\n<td></td>\n<td><a href=\"https://min.io/docs/minio/linux/developers/go/API.html#RestoreObject\"> <code>RestoreObject</code> </a></td>\n<td></td>\n<td></td>\n<td></td>\n</tr>\n</tbody>\n</table>\n",
            "tags": [
                "后端",
                "minio"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2023/12/17/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%A0%91/",
            "url": "https://withoutabc.github.io/2023/12/17/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%A0%91/",
            "title": "二叉树",
            "date_published": "2023-12-17T08:31:04.000Z",
            "content_html": "<h1 id=\"理论基础\"><a class=\"anchor\" href=\"#理论基础\">#</a> 理论基础</h1>\n<h2 id=\"二叉树的种类\"><a class=\"anchor\" href=\"#二叉树的种类\">#</a> 二叉树的种类</h2>\n<h3 id=\"满二叉树\"><a class=\"anchor\" href=\"#满二叉树\">#</a> 满二叉树</h3>\n<p>如果一棵二叉树只有度为 0 的结点和度为 2 的结点，并且度为 0 的结点在同一层上，则这棵二叉树为满二叉树。</p>\n<p><img data-src=\"https://s2.loli.net/2023/07/24/FOHMQE7ZlnV926B.png\" alt=\"ec39058c977efc50ac89193b7e24a95e_20200806185805576.png\" /></p>\n<ul>\n<li>深度为 k</li>\n<li>有<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mrow><mi>k</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">2^{k-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8491079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\" style=\"margin-right:0.03148em;\">k</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span> 个节点</li>\n</ul>\n<h3 id=\"完全二叉树\"><a class=\"anchor\" href=\"#完全二叉树\">#</a> 完全二叉树</h3>\n<p>在完全二叉树中，除了最底层节点可能没填满外，其余每层节点数都达到最大值，并且最下面一层的节点都集中在该层最左边的若干位置。若最底层为第 h 层（h 从 1 开始），则该层包含<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mo>∼</mo><msup><mn>2</mn><mrow><mi>h</mi><mo>−</mo><mn>1</mn></mrow></msup></mrow><annotation encoding=\"application/x-tex\">1\\sim2^{h-1}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.64444em;vertical-align:0em;\"></span><span class=\"mord\">1</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span><span class=\"mrel\">∼</span><span class=\"mspace\" style=\"margin-right:0.2777777777777778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8491079999999999em;vertical-align:0em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8491079999999999em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mathnormal mtight\">h</span><span class=\"mbin mtight\">−</span><span class=\"mord mtight\">1</span></span></span></span></span></span></span></span></span></span></span></span> 个节点。</p>\n<p><img data-src=\"https://s2.loli.net/2023/07/24/IZO9EiDkQMsxq2H.png\" alt=\"3d72bb5b709bcbed4ec59f3602ecddd9_20200920221638903.png\" /></p>\n<h3 id=\"二叉搜索树\"><a class=\"anchor\" href=\"#二叉搜索树\">#</a> 二叉搜索树</h3>\n<p>前面介绍的树，都没有数值的，而二叉搜索树是有数值的了，二叉搜索树是一个有序树。</p>\n<ul>\n<li>若它的左子树不空，则左子树上所有结点的值均小于它的根结点的值；</li>\n<li>若它的右子树不空，则右子树上所有结点的值均大于它的根结点的值；</li>\n<li>它的左、右子树也分别为二叉排序树</li>\n</ul>\n<p><img data-src=\"https://s2.loli.net/2023/07/24/lvgH51oLrK3RQza.png\" alt=\"20200806190304693.png\" /></p>\n<h3 id=\"平衡二叉搜索树\"><a class=\"anchor\" href=\"#平衡二叉搜索树\">#</a> 平衡二叉搜索树</h3>\n<p>它是一棵空树或它的左右两个子树的高度差的绝对值不超过 1，并且左右两个子树都是一棵平衡二叉树。</p>\n<p><img data-src=\"https://s2.loli.net/2023/07/24/Sr7upiAwLbUCkaq.png\" alt=\"20200806190511967.png\" /></p>\n<h2 id=\"遍历方式\"><a class=\"anchor\" href=\"#遍历方式\">#</a> 遍历方式</h2>\n<h3 id=\"深度优先遍历\"><a class=\"anchor\" href=\"#深度优先遍历\">#</a> 深度优先遍历</h3>\n<ul>\n<li>\n<p>前序遍历（递归法，迭代法） <code>中左右</code></p>\n</li>\n<li>\n<p>中序遍历（递归法，迭代法） <code>左中右</code></p>\n</li>\n<li>\n<p>后序遍历（递归法，迭代法） <code>左右中</code></p>\n</li>\n</ul>\n<p>顺序针对的是 <code>中</code> 的位置</p>\n<h3 id=\"广度优先遍历\"><a class=\"anchor\" href=\"#广度优先遍历\">#</a> 广度优先遍历</h3>\n<ul>\n<li>层次遍历（迭代法）  <code>一层一层</code></li>\n</ul>\n<h1 id=\"递归遍历\"><a class=\"anchor\" href=\"#递归遍历\">#</a> 递归遍历</h1>\n<ol>\n<li>确定递归函数的参数和返回值：传入树的节点；由于只是把值写进数组，所以没有返回值</li>\n<li>确定终止条件：节点为空时终止</li>\n<li>确定单层递归逻辑：添加对应节点值</li>\n</ol>\n<h2 id=\"前序遍历\"><a class=\"anchor\" href=\"#前序遍历\">#</a> 前序遍历</h2>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> TreeNode <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tVal   <span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tLeft  <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tRight <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//preorderTraversal 前序遍历</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// 中左右</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">preorderTraversal</span><span class=\"token punctuation\">(</span>root <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token keyword\">var</span> result <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token comment\">// 构造一个函数然后调用自己</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token keyword\">var</span> traversal <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\ttraversal <span class=\"token operator\">=</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t<span class=\"token keyword\">if</span> node <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t\t<span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\tresult <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">.</span>Val<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token function\">traversal</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>Left<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token function\">traversal</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>Right<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token function\">traversal</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token keyword\">return</span> result</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"中序遍历\"><a class=\"anchor\" href=\"#中序遍历\">#</a> 中序遍历</h2>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> TreeNode <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tVal   <span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tLeft  <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tRight <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//inorderTraversal 二叉树的中序遍历</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// 左中右</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">inorderTraversal</span><span class=\"token punctuation\">(</span>root <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token keyword\">var</span> result <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token keyword\">var</span> traversal <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\ttraversal <span class=\"token operator\">=</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t\t<span class=\"token keyword\">if</span> node <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\t\t\t<span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token function\">traversal</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>Left<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\tresult <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">.</span>Val<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token function\">traversal</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>Right<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t<span class=\"token function\">traversal</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token keyword\">return</span> result</pre></td></tr><tr><td data-num=\"22\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"后序遍历\"><a class=\"anchor\" href=\"#后序遍历\">#</a> 后序遍历</h2>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> TreeNode <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tVal   <span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tLeft  <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tRight <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token comment\">//postorderTraversal 二叉树的后序遍历</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token comment\">// 后序遍历的流程是先遍历左子树，然后遍历右子树，最后访问根节点。</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre><span class=\"token comment\">// 这种遍历方式可以用于获取二叉树的后序遍历结果，常用于删除二叉树的操作。</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre><span class=\"token comment\">// 在遍历过程中，根节点的值总是在最后被访问。</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">postorderTraversal</span><span class=\"token punctuation\">(</span>root <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token keyword\">var</span> result <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\t<span class=\"token keyword\">var</span> traversal <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\ttraversal <span class=\"token operator\">=</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>node <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t\t<span class=\"token keyword\">if</span> node <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t\t<span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t<span class=\"token function\">traversal</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>Left<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token function\">traversal</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>Right<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\tresult <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>result<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">.</span>Val<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token function\">traversal</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t<span class=\"token keyword\">return</span> result</pre></td></tr><tr><td data-num=\"24\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"迭代遍历\"><a class=\"anchor\" href=\"#迭代遍历\">#</a> 迭代遍历</h1>\n<h2 id=\"前序遍历-2\"><a class=\"anchor\" href=\"#前序遍历-2\">#</a> 前序遍历</h2>\n<ul>\n<li>每个节点先推右孩子，再推左孩子</li>\n</ul>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> TreeNode <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tVal   <span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tLeft  <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tRight <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">preorderTraversal</span><span class=\"token punctuation\">(</span>root <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">var</span> res <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token keyword\">if</span> root <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   st <span class=\"token operator\">:=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   st<span class=\"token punctuation\">.</span><span class=\"token function\">PushBack</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>   <span class=\"token keyword\">for</span> st<span class=\"token punctuation\">.</span><span class=\"token function\">Len</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      node <span class=\"token operator\">:=</span> st<span class=\"token punctuation\">.</span><span class=\"token function\">Remove</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">.</span><span class=\"token function\">Back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      res <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">.</span>Val<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">if</span> node<span class=\"token punctuation\">.</span>Right <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         st<span class=\"token punctuation\">.</span><span class=\"token function\">PushBack</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>Right<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token keyword\">if</span> node<span class=\"token punctuation\">.</span>Left <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>         st<span class=\"token punctuation\">.</span><span class=\"token function\">PushBack</span><span class=\"token punctuation\">(</span>node<span class=\"token punctuation\">.</span>Left<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token keyword\">return</span> res</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"中序遍历-2\"><a class=\"anchor\" href=\"#中序遍历-2\">#</a> 中序遍历</h2>\n<ul>\n<li>如果  <code>cur</code>  不为空，说明还有左子树未遍历</li>\n</ul>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> TreeNode <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tVal   <span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tLeft  <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tRight <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre></pre></td></tr><tr><td data-num=\"8\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">inorderTraversal</span><span class=\"token punctuation\">(</span>root <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token keyword\">var</span> res <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t<span class=\"token keyword\">if</span> root <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tst <span class=\"token operator\">:=</span> list<span class=\"token punctuation\">.</span><span class=\"token function\">New</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tcur <span class=\"token operator\">:=</span> root</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token keyword\">for</span> cur <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token operator\">||</span> st<span class=\"token punctuation\">.</span><span class=\"token function\">Len</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>\t\t<span class=\"token keyword\">if</span> cur <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>\t\t\tst<span class=\"token punctuation\">.</span><span class=\"token function\">PushBack</span><span class=\"token punctuation\">(</span>cur<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>\t\t\tcur <span class=\"token operator\">=</span> cur<span class=\"token punctuation\">.</span>Left</pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span> <span class=\"token keyword\">else</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t\tcur <span class=\"token operator\">=</span> st<span class=\"token punctuation\">.</span><span class=\"token function\">Remove</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">.</span><span class=\"token function\">Back</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">(</span><span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t\t\tres <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> cur<span class=\"token punctuation\">.</span>Val<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t\t\tcur <span class=\"token operator\">=</span> cur<span class=\"token punctuation\">.</span>Right</pre></td></tr><tr><td data-num=\"23\"></td><td><pre>\t\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>\t<span class=\"token keyword\">return</span> res</pre></td></tr><tr><td data-num=\"26\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h2 id=\"后序遍历-2\"><a class=\"anchor\" href=\"#后序遍历-2\">#</a> 后序遍历</h2>\n<ul>\n<li>先推左孩子，再推右孩子</li>\n<li><code>左右中</code>  的结果恰好与  <code>中右左</code>  相反</li>\n</ul>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> TreeNode <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tVal   <span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tLeft  <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tRight <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">postorderTraversal</span><span class=\"token punctuation\">(</span>root <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">var</span> res <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>   <span class=\"token keyword\">if</span> root <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   <span class=\"token keyword\">var</span> st <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   st <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">,</span> root<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>   <span class=\"token keyword\">for</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      node <span class=\"token operator\">:=</span> st<span class=\"token punctuation\">[</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      st <span class=\"token operator\">=</span> st<span class=\"token punctuation\">[</span><span class=\"token punctuation\">:</span><span class=\"token function\">len</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      res <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">.</span>Val<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token keyword\">if</span> node<span class=\"token punctuation\">.</span>Left <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>         st <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">.</span>Left<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token keyword\">if</span> node<span class=\"token punctuation\">.</span>Right <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         st <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>st<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">.</span>Right<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>   <span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>   <span class=\"token keyword\">return</span> res</pre></td></tr><tr><td data-num=\"27\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre></pre></td></tr><tr><td data-num=\"29\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">reverse</span><span class=\"token punctuation\">(</span>res <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>   head <span class=\"token operator\">:=</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   tail <span class=\"token operator\">:=</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">)</span> <span class=\"token operator\">-</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token keyword\">for</span> head <span class=\"token operator\">&lt;</span> tail <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"33\"></td><td><pre>      res<span class=\"token punctuation\">[</span>head<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">[</span>tail<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> res<span class=\"token punctuation\">[</span>tail<span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span> res<span class=\"token punctuation\">[</span>head<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre>      head<span class=\"token operator\">++</span></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>      tail<span class=\"token operator\">--</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"层序遍历\"><a class=\"anchor\" href=\"#层序遍历\">#</a> 层序遍历</h1>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> TreeNode <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   Val   <span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   Left  <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   Right <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">levelOrder</span><span class=\"token punctuation\">(</span>root <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>   <span class=\"token keyword\">if</span> root <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token keyword\">return</span> <span class=\"token boolean\">nil</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>   <span class=\"token keyword\">var</span> res <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>   curLevel <span class=\"token operator\">:=</span> <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">&#123;</span>root<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>   <span class=\"token keyword\">for</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>curLevel<span class=\"token punctuation\">)</span> <span class=\"token operator\">></span> <span class=\"token number\">0</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token keyword\">var</span> nextLevel <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token keyword\">var</span> vals <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token keyword\">for</span> <span class=\"token boolean\">_</span><span class=\"token punctuation\">,</span> node <span class=\"token operator\">:=</span> <span class=\"token keyword\">range</span> curLevel <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>         vals <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>vals<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">.</span>Val<span class=\"token punctuation\">)</span> <span class=\"token comment\">// 收集当前的值</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>         <span class=\"token comment\">// 收集下一层的节点</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>         <span class=\"token keyword\">if</span> node<span class=\"token punctuation\">.</span>Left <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>            nextLevel <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>nextLevel<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">.</span>Left<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>         <span class=\"token keyword\">if</span> node<span class=\"token punctuation\">.</span>Right <span class=\"token operator\">!=</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>            nextLevel <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>nextLevel<span class=\"token punctuation\">,</span> node<span class=\"token punctuation\">.</span>Right<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      res <span class=\"token operator\">=</span> <span class=\"token function\">append</span><span class=\"token punctuation\">(</span>res<span class=\"token punctuation\">,</span> vals<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      curLevel <span class=\"token operator\">=</span> nextLevel</pre></td></tr><tr><td data-num=\"28\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>   <span class=\"token keyword\">return</span> res</pre></td></tr><tr><td data-num=\"30\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"二叉树的最大深度\"><a class=\"anchor\" href=\"#二叉树的最大深度\">#</a> 二叉树的最大深度</h1>\n<ul>\n<li>\n<p>每个节点处的深度为孩子节点的最大深度 + 1</p>\n</li>\n<li>\n<p>递归到空指针时表明上一级深度为 1（0+1）</p>\n</li>\n</ul>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">type</span> TreeNode <span class=\"token keyword\">struct</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>\tVal   <span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>\tLeft  <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>\tRight <span class=\"token operator\">*</span>TreeNode</pre></td></tr><tr><td data-num=\"5\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre></pre></td></tr><tr><td data-num=\"7\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">maxDepth</span><span class=\"token punctuation\">(</span>root <span class=\"token operator\">*</span>TreeNode<span class=\"token punctuation\">)</span> <span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>    <span class=\"token comment\">// 终止条件</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>\t<span class=\"token keyword\">if</span> root <span class=\"token operator\">==</span> <span class=\"token boolean\">nil</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> <span class=\"token number\">0</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>\tleft <span class=\"token operator\">:=</span> <span class=\"token function\">maxDepth</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">.</span>Left<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>\tright <span class=\"token operator\">:=</span> <span class=\"token function\">maxDepth</span><span class=\"token punctuation\">(</span>root<span class=\"token punctuation\">.</span>Right<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>\tmaxDep <span class=\"token operator\">:=</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span>left<span class=\"token punctuation\">,</span> right<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>\t<span class=\"token keyword\">return</span> maxDep <span class=\"token operator\">+</span> <span class=\"token number\">1</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre></pre></td></tr><tr><td data-num=\"18\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">max</span><span class=\"token punctuation\">(</span>a<span class=\"token punctuation\">,</span> b <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>\t<span class=\"token keyword\">if</span> a <span class=\"token operator\">></span> b <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>\t\t<span class=\"token keyword\">return</span> a</pre></td></tr><tr><td data-num=\"21\"></td><td><pre>\t<span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>\t<span class=\"token keyword\">return</span> b</pre></td></tr><tr><td data-num=\"23\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "算法",
                "algorithm",
                "BiTree"
            ]
        },
        {
            "id": "https://withoutabc.github.io/2023/12/16/%E7%AE%97%E6%B3%95/DFS/",
            "url": "https://withoutabc.github.io/2023/12/16/%E7%AE%97%E6%B3%95/DFS/",
            "title": "DFS",
            "date_published": "2023-12-16T13:48:06.000Z",
            "content_html": "<h1 id=\"岛屿数量\"><a class=\"anchor\" href=\"#岛屿数量\">#</a> 岛屿数量</h1>\n<p>给你一个由 <code>1</code> （陆地）和 <code>0</code> （水）组成的的二维网格，请你计算网格中岛屿的数量。</p>\n<p><strong>示例 1：</strong></p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>输入：grid = [</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  [\"1\",\"1\",\"1\",\"1\",\"0\"],</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  [\"1\",\"1\",\"0\",\"1\",\"0\"],</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  [\"1\",\"1\",\"0\",\"0\",\"0\"],</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  [\"0\",\"0\",\"0\",\"0\",\"0\"]</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>]</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>输出：1</pre></td></tr></table></figure><p><strong>示例 2：</strong></p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>输入：grid = [</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>  [\"1\",\"1\",\"0\",\"0\",\"0\"],</pre></td></tr><tr><td data-num=\"3\"></td><td><pre>  [\"1\",\"1\",\"0\",\"0\",\"0\"],</pre></td></tr><tr><td data-num=\"4\"></td><td><pre>  [\"0\",\"0\",\"1\",\"0\",\"0\"],</pre></td></tr><tr><td data-num=\"5\"></td><td><pre>  [\"0\",\"0\",\"0\",\"1\",\"1\"]</pre></td></tr><tr><td data-num=\"6\"></td><td><pre>]</pre></td></tr><tr><td data-num=\"7\"></td><td><pre>输出：3</pre></td></tr></table></figure><p>关键步骤已经注释出：</p>\n<ol>\n<li>按顺序遍历二维数组，每次遍历时通过 <code>dfs</code>  函数搜索其上下左右位置</li>\n<li>防止出边界的情况，提前计算好长、宽，及时 <code>return</code></li>\n<li>对访问过的位置进行标记，防止重复访问导致无法退出递归</li>\n<li>搜索中遇到非 <code>1</code>  处即停止，这样保证一次搜出了一整块陆地，且不会被重复计数</li>\n</ol>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">numIslands</span><span class=\"token punctuation\">(</span>grid <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">int</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   <span class=\"token keyword\">var</span> ans <span class=\"token builtin\">int</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   m<span class=\"token punctuation\">,</span> n <span class=\"token operator\">:=</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>grid<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>grid<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>   <span class=\"token keyword\">var</span> dfs <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> c <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>   dfs <span class=\"token operator\">=</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> c <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>      <span class=\"token comment\">// 防止出边界</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token keyword\">if</span> r <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> r <span class=\"token operator\">>=</span> m <span class=\"token operator\">||</span> c <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> c <span class=\"token operator\">>=</span> n <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>         <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>      <span class=\"token comment\">// 非未访问过的陆地（水 or 已访问过的陆地）</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token keyword\">if</span> grid<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> <span class=\"token char\">'1'</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>         <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>      <span class=\"token comment\">// 标记已访问过的陆地：防止无限循环无法退出</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      grid<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token char\">'2'</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token function\">dfs</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token function\">dfs</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>      <span class=\"token function\">dfs</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> c<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>      <span class=\"token function\">dfs</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> c<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>   <span class=\"token keyword\">for</span> r <span class=\"token operator\">:=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> r <span class=\"token operator\">&lt;</span> m<span class=\"token punctuation\">;</span> r<span class=\"token operator\">++</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      <span class=\"token keyword\">for</span> c <span class=\"token operator\">:=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> c <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span> c<span class=\"token operator\">++</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>         <span class=\"token keyword\">if</span> grid<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token char\">'1'</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>            ans<span class=\"token operator\">++</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>            <span class=\"token function\">dfs</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>         <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>   <span class=\"token keyword\">return</span> ans</pre></td></tr><tr><td data-num=\"33\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure><h1 id=\"单词搜索\"><a class=\"anchor\" href=\"#单词搜索\">#</a> 单词搜索</h1>\n<p>给定一个 <code>m x n</code>  二维字符网格 <code>board</code>  和一个字符串单词 <code>word</code> 。如果 word 存在于网格中，返回 <code>true</code> ；否则，返回 <code>false</code> 。</p>\n<p><strong>示例</strong></p>\n<p><img data-src=\"https://assets.leetcode.com/uploads/2020/11/04/word2.jpg\" alt=\"img\" /></p>\n<figure class=\"highlight text\"><figcaption data-lang=\"text\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre>输入：board = [[\"A\",\"B\",\"C\",\"E\"],[\"S\",\"F\",\"C\",\"S\"],[\"A\",\"D\",\"E\",\"E\"]], word = \"ABCCED\"</pre></td></tr><tr><td data-num=\"2\"></td><td><pre>输出：true</pre></td></tr></table></figure><p>关键步骤已注释出：</p>\n<ol>\n<li>保证边界问题</li>\n<li>防止同次在重复位置搜索</li>\n<li><code>found</code>  变为 <code>true</code>  的条件：之前的搜索都不被 <code>return</code> ，直至最后一次下标值 = 长度 - 1 时仍匹配正确</li>\n<li>本题递归中带有回溯，因此要保证从每个点开始尝试搜索时，二维矩阵都回到初始状态，可以用 <code>tmp</code>  暂做记录，等待搜索结束后复原</li>\n</ol>\n<figure class=\"highlight go\"><figcaption data-lang=\"go\"></figcaption><table><tr><td data-num=\"1\"></td><td><pre><span class=\"token keyword\">func</span> <span class=\"token function\">exist</span><span class=\"token punctuation\">(</span>board <span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span><span class=\"token punctuation\">]</span><span class=\"token builtin\">byte</span><span class=\"token punctuation\">,</span> word <span class=\"token builtin\">string</span><span class=\"token punctuation\">)</span> <span class=\"token builtin\">bool</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"2\"></td><td><pre>   m<span class=\"token punctuation\">,</span> n <span class=\"token operator\">:=</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>board<span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>board<span class=\"token punctuation\">[</span><span class=\"token number\">0</span><span class=\"token punctuation\">]</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"3\"></td><td><pre>   found <span class=\"token operator\">:=</span> <span class=\"token boolean\">false</span></pre></td></tr><tr><td data-num=\"4\"></td><td><pre>   <span class=\"token keyword\">var</span> dfs <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> k <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"5\"></td><td><pre>   dfs <span class=\"token operator\">=</span> <span class=\"token keyword\">func</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> k <span class=\"token builtin\">int</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"6\"></td><td><pre>      <span class=\"token comment\">// 超出索引范围</span></pre></td></tr><tr><td data-num=\"7\"></td><td><pre>      <span class=\"token keyword\">if</span> r <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> c <span class=\"token operator\">&lt;</span> <span class=\"token number\">0</span> <span class=\"token operator\">||</span> r <span class=\"token operator\">>=</span> m <span class=\"token operator\">||</span> c <span class=\"token operator\">>=</span> n <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"8\"></td><td><pre>         <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"9\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"10\"></td><td><pre>      <span class=\"token comment\">// 不能再走已经走过的</span></pre></td></tr><tr><td data-num=\"11\"></td><td><pre>      <span class=\"token keyword\">if</span> board<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span> <span class=\"token operator\">==</span> <span class=\"token char\">'*'</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"12\"></td><td><pre>         <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"13\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"14\"></td><td><pre>      <span class=\"token comment\">// 元素不相等</span></pre></td></tr><tr><td data-num=\"15\"></td><td><pre>      <span class=\"token keyword\">if</span> board<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span> <span class=\"token operator\">!=</span> word<span class=\"token punctuation\">[</span>k<span class=\"token punctuation\">]</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"16\"></td><td><pre>         <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"17\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"18\"></td><td><pre>      <span class=\"token comment\">// 找到了最后一个（元素相等）</span></pre></td></tr><tr><td data-num=\"19\"></td><td><pre>      <span class=\"token keyword\">if</span> k <span class=\"token operator\">==</span> <span class=\"token function\">len</span><span class=\"token punctuation\">(</span>word<span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token number\">1</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"20\"></td><td><pre>         found <span class=\"token operator\">=</span> <span class=\"token boolean\">true</span></pre></td></tr><tr><td data-num=\"21\"></td><td><pre>         <span class=\"token keyword\">return</span></pre></td></tr><tr><td data-num=\"22\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"23\"></td><td><pre>      <span class=\"token comment\">// 标记走过</span></pre></td></tr><tr><td data-num=\"24\"></td><td><pre>      tmp <span class=\"token operator\">:=</span> board<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span></pre></td></tr><tr><td data-num=\"25\"></td><td><pre>      board<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> <span class=\"token char\">'*'</span></pre></td></tr><tr><td data-num=\"26\"></td><td><pre>      <span class=\"token comment\">// 往四周走试试</span></pre></td></tr><tr><td data-num=\"27\"></td><td><pre>      <span class=\"token function\">dfs</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"28\"></td><td><pre>      <span class=\"token function\">dfs</span><span class=\"token punctuation\">(</span>r<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"29\"></td><td><pre>      <span class=\"token function\">dfs</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> c<span class=\"token operator\">-</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"30\"></td><td><pre>      <span class=\"token function\">dfs</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> c<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">,</span> k<span class=\"token operator\">+</span><span class=\"token number\">1</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"31\"></td><td><pre>      <span class=\"token comment\">// 回溯状态，便于下一点的验证</span></pre></td></tr><tr><td data-num=\"32\"></td><td><pre>      board<span class=\"token punctuation\">[</span>r<span class=\"token punctuation\">]</span><span class=\"token punctuation\">[</span>c<span class=\"token punctuation\">]</span> <span class=\"token operator\">=</span> tmp</pre></td></tr><tr><td data-num=\"33\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"34\"></td><td><pre></pre></td></tr><tr><td data-num=\"35\"></td><td><pre>   <span class=\"token keyword\">for</span> r <span class=\"token operator\">:=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> r <span class=\"token operator\">&lt;</span> m<span class=\"token punctuation\">;</span> r<span class=\"token operator\">++</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"36\"></td><td><pre>      <span class=\"token keyword\">for</span> c <span class=\"token operator\">:=</span> <span class=\"token number\">0</span><span class=\"token punctuation\">;</span> c <span class=\"token operator\">&lt;</span> n<span class=\"token punctuation\">;</span> c<span class=\"token operator\">++</span> <span class=\"token punctuation\">&#123;</span></pre></td></tr><tr><td data-num=\"37\"></td><td><pre>         <span class=\"token function\">dfs</span><span class=\"token punctuation\">(</span>r<span class=\"token punctuation\">,</span> c<span class=\"token punctuation\">,</span> <span class=\"token number\">0</span><span class=\"token punctuation\">)</span></pre></td></tr><tr><td data-num=\"38\"></td><td><pre>      <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"39\"></td><td><pre>   <span class=\"token punctuation\">&#125;</span></pre></td></tr><tr><td data-num=\"40\"></td><td><pre>   <span class=\"token keyword\">return</span> found</pre></td></tr><tr><td data-num=\"41\"></td><td><pre><span class=\"token punctuation\">&#125;</span></pre></td></tr></table></figure>",
            "tags": [
                "算法",
                "algorithm",
                "dfs"
            ]
        }
    ]
}