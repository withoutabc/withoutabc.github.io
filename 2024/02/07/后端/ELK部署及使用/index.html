<!-- build time:Thu Feb 15 2024 23:05:21 GMT+0800 (China Standard Time) --><!DOCTYPE html><html lang="zh-CN"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=2"><meta name="theme-color" content="#FFF"><link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png"><link rel="icon" type="image/ico" sizes="32x32" href="/images/favicon.ico"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><link rel="alternate" type="application/rss+xml" title="镜玄的博客" href="http://withoutabc.github.io/rss.xml"><link rel="alternate" type="application/atom+xml" title="镜玄的博客" href="http://withoutabc.github.io/atom.xml"><link rel="alternate" type="application/json" title="镜玄的博客" href="http://withoutabc.github.io/feed.json"><link rel="stylesheet" href="//fonts.googleapis.com/css?family=Mulish:300,300italic,400,400italic,700,700italic%7CFredericka%20the%20Great:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20JP:300,300italic,400,400italic,700,700italic%7CNoto%20Serif%20SC:300,300italic,400,400italic,700,700italic%7CInconsolata:300,300italic,400,400italic,700,700italic&display=swap&subset=latin,latin-ext"><link rel="stylesheet" href="/css/app.css?v=0.2.5"><meta name="keywords" content="elk"><link rel="canonical" href="http://withoutabc.github.io/2024/02/07/%E5%90%8E%E7%AB%AF/ELK%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/"><title>ELK部署及使用 - 后端 | 寄寄菜鸟试飞点 = 镜玄的博客 = 某个INTJ的领域</title><meta name="generator" content="Hexo 6.3.0"></head><body itemscope itemtype="http://schema.org/WebPage"><div id="loading"><div class="cat"><div class="body"></div><div class="head"><div class="face"></div></div><div class="foot"><div class="tummy-end"></div><div class="bottom"></div><div class="legs left"></div><div class="legs right"></div></div><div class="paw"><div class="hands left"></div><div class="hands right"></div></div></div></div><div id="container"><header id="header" itemscope itemtype="http://schema.org/WPHeader"><div class="inner"><div id="brand"><div class="pjax"><h1 itemprop="name headline">ELK部署及使用</h1><div class="meta"><span class="item" title="创建时间：2024-02-07 00:55:21"><span class="icon"><i class="ic i-calendar"></i> </span><span class="text">发表于</span> <time itemprop="dateCreated datePublished" datetime="2024-02-07T00:55:21+08:00">2024-02-07</time> </span><span class="item" title="本文字数"><span class="icon"><i class="ic i-pen"></i> </span><span class="text">本文字数</span> <span>23k</span> <span class="text">字</span> </span><span class="item" title="阅读时长"><span class="icon"><i class="ic i-clock"></i> </span><span class="text">阅读时长</span> <span>21 分钟</span></span></div></div></div><nav id="nav"><div class="inner"><div class="toggle"><div class="lines" aria-label="切换导航栏"><span class="line"></span> <span class="line"></span> <span class="line"></span></div></div><ul class="menu"><li class="item title"><a href="/" rel="start">寄寄菜鸟试飞点</a></li></ul><ul class="right"><li class="item theme"><i class="ic i-sun"></i></li><li class="item search"><i class="ic i-search"></i></li></ul></div></nav></div><div id="imgs" class="pjax"><ul><li class="item" data-background-image="https://s2.loli.net/2023/07/26/nztHGd1wU9IDbJu.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/07/24/xKd198wlCvUYLPh.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/07/24/JFtqCaXRbeDQ5Lx.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/07/26/MLlZraVcWXv1ixp.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/07/24/XBGe7UxEzMFYJ2r.jpg"></li><li class="item" data-background-image="https://s2.loli.net/2023/07/26/Owt3Xs5Q1gPKfNy.jpg"></li></ul></div></header><div id="waves"><svg class="waves" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M-160 44c30 0 58-18 88-18s 58 18 88 18 58-18 88-18 58 18 88 18 v44h-352z"/></defs><g class="parallax"><use xlink:href="#gentle-wave" x="48" y="0"/><use xlink:href="#gentle-wave" x="48" y="3"/><use xlink:href="#gentle-wave" x="48" y="5"/><use xlink:href="#gentle-wave" x="48" y="7"/></g></svg></div><main><div class="inner"><div id="main" class="pjax"><div class="article wrap"><div class="breadcrumb" itemscope itemtype="https://schema.org/BreadcrumbList"><i class="ic i-home"></i> <span><a href="/">首页</a></span><i class="ic i-angle-right"></i> <span class="current" itemprop="itemListElement" itemscope itemtype="https://schema.org/ListItem"><a href="/categories/%E5%90%8E%E7%AB%AF/" itemprop="item" rel="index" title="分类于 后端"><span itemprop="name">后端</span></a><meta itemprop="position" content="1"></span></div><article itemscope itemtype="http://schema.org/Article" class="post block" lang="zh-CN"><link itemprop="mainEntityOfPage" href="http://withoutabc.github.io/2024/02/07/%E5%90%8E%E7%AB%AF/ELK%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/"><span hidden itemprop="author" itemscope itemtype="http://schema.org/Person"><meta itemprop="image" content="/images/avatar.jpg"><meta itemprop="name" content="镜玄"><meta itemprop="description" content="某个INTJ的领域, "></span><span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization"><meta itemprop="name" content="镜玄的博客"></span><div class="body md" itemprop="articleBody"><h1 id="eskibanalogstash部署"><a class="anchor" href="#eskibanalogstash部署">#</a> ES+Kibana+Logstash 部署</h1><h2 id="部署文件"><a class="anchor" href="#部署文件">#</a> 部署文件</h2><p>先创建容器网络（也可以不创建，把 networks 相关的都删了，会自动创建）</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">docker</span> network create elk</pre></td></tr></table></figure><p>一定要一次性弄完再 up, 不然会出现神奇的 bug。。。</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"2"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">:</span>7.13.1</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> elasticsearch</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./elasticsearch_data:/bitnami/elasticsearch"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"9200:9200"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"9300:9300"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token punctuation">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token punctuation">-</span> discovery.type=single<span class="token punctuation">-</span>node</pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token key atrule">ulimits</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>      <span class="token key atrule">nofile</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        <span class="token key atrule">soft</span><span class="token punctuation">:</span> <span class="token number">65536</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token key atrule">hard</span><span class="token punctuation">:</span> <span class="token number">65536</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="21"></td><td><pre>      <span class="token punctuation">-</span> elk</pre></td></tr><tr><td data-num="22"></td><td><pre>  <span class="token key atrule">kibana</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="23"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> kibana<span class="token punctuation">:</span>7.13.1</pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kibana</pre></td></tr><tr><td data-num="25"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token punctuation">-</span> elasticsearch.hosts=http<span class="token punctuation">:</span>//elasticsearch<span class="token punctuation">:</span><span class="token number">9200</span></pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token punctuation">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"5601:5601"</span></pre></td></tr><tr><td data-num="31"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="32"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./kibana_data:/bitnami/kibana"</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token punctuation">-</span> elasticsearch</pre></td></tr><tr><td data-num="35"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>      <span class="token punctuation">-</span> elk</pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token key atrule">logstash</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/logstash/logstash<span class="token punctuation">:</span>7.13.1</pre></td></tr><tr><td data-num="39"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> logstash</pre></td></tr><tr><td data-num="40"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="41"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./logstash.conf:/usr/share/logstash/pipeline/logstash.conf"</span></pre></td></tr><tr><td data-num="42"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/home/elk/log.log:/home/elk/log.log"</span></pre></td></tr><tr><td data-num="43"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="44"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"XPACK_MONITORING_ENABLED=false"</span></pre></td></tr><tr><td data-num="45"></td><td><pre>      <span class="token punctuation">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>      <span class="token punctuation">-</span> elasticsearch</pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="49"></td><td><pre>      <span class="token punctuation">-</span> elk</pre></td></tr><tr><td data-num="50"></td><td><pre><span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>  <span class="token key atrule">elk</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr></table></figure><ul><li>将要挂载的宿主机目录设置为<strong>最高权限</strong></li></ul><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">chmod</span> <span class="token number">777</span> 目录名</pre></td></tr></table></figure><h2 id="重要说明"><a class="anchor" href="#重要说明">#</a> 重要说明</h2><ul><li><p><code>elasticsearch</code> 和 <code>kibana</code> 的宿主机挂载目录都是任意指定的，建议使用一个路径而不是匿名卷（否则重启容器可能出现各种 bug）</p></li><li><p><code>container_name</code> 字段不可省略，否则 <code>kibana</code> 和 <code>logstash</code> 可能会找不到 <code>elasticsearch</code> ，因为自动创建的容器名称自带前缀</p></li><li><p><code>logstash</code> 的 <code>volumes</code> 字段里，第一个用于指定 <code>logstash.conf</code> 的位置，第二个用于确定日志搜集路径</p></li></ul><p><strong>（可以先部署前两个，搞定了再把第三个加进来，结合后面的 logstash 说明）</strong></p><h2 id="验证"><a class="anchor" href="#验证">#</a> 验证</h2><ul><li>访问 <code>http://localhost:9200</code></li></ul><p><img data-src="./img/elk/9200.png" alt=""></p><ul><li>访问 <code>http://localhost:5601</code></li></ul><p><img data-src="./img/elk/5601.png" alt=""></p><p>验证部署成功</p><h1 id="什么是elasticsearch"><a class="anchor" href="#什么是elasticsearch">#</a> 什么是 Elasticsearch?</h1><blockquote><p>Elasticsearch is a real-time, distributed storage, search, and analytics engine.</p></blockquote><p>Elasticsearch 是一个<strong>实时</strong>的<strong>分布式存储、搜索、分析</strong>的引擎。</p><p>相对于数据库，Elasticsearch 的强大之处就是可以<strong>模糊查询</strong>。</p><p>数据库的模糊查询：</p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">select</span> <span class="token operator">*</span> <span class="token keyword">from</span> <span class="token keyword">user</span> <span class="token keyword">where</span> name <span class="token operator">like</span> <span class="token string">'%something%'</span></pre></td></tr></table></figure><p>但这样是不通过<strong>索引</strong>查询的，意味着：只要数据库的量很大（1 亿条），查询肯定会是<strong>秒</strong>级别的。</p><p>而且，即便给你从数据库根据<strong>模糊匹配</strong>查出相应的记录了，那往往会返回<strong>大量的数据</strong>给你，往往你需要的数据量并没有这么多，可能 50 条记录就足够了。</p><p>还有一个就是：用户输入的内容往往并没有这么的<strong>精确</strong>，比如我从 Google 输入 <code>ElastcSeach</code> （打错字），但是 Google 还是能估算我想输入的是 <code>Elasticsearch</code></p><p>而 Elasticsearch 是专门做<strong>搜索</strong>的，就是为了解决上面所讲的问题而生的，换句话说：</p><ul><li>Elasticsearch 对模糊搜索非常擅长（搜索速度很快）</li><li>从 Elasticsearch 搜索到的数据可以根据<strong>评分</strong>过滤掉大部分的，只要返回评分高的给用户就好了（原生就支持排序）</li><li>没有那么准确的关键字也能搜出相关的结果（能匹配有相关性的记录）</li></ul><h1 id="elasticsearch的术语和架构"><a class="anchor" href="#elasticsearch的术语和架构">#</a> Elasticsearch 的术语和架构</h1><p><strong>Index</strong>：Elasticsearch 的 Index 相当于数据库的 Table</p><p><strong>Type</strong>：这个在新的 Elasticsearch 版本已经废除（在以前的 Elasticsearch 版本，一个 Index 下支持多个 Type–有点类似于消息队列一个 topic 下多个 group 的概念）</p><p><strong>Document</strong>：Document 相当于数据库的一行记录</p><p><strong>Field</strong>：相当于数据库的 Column 的概念</p><p><strong>Mapping</strong>：相当于数据库的 Schema 的概念</p><p><strong>DSL</strong>：相当于数据库的 SQL（给我们读取 Elasticsearch 数据的 API）</p><p><img data-src="./img/elk/cmp.png" alt=""></p><p>一个 Elasticsearch 集群会有多个 Elasticsearch 节点，所谓节点实际上就是运行着 Elasticsearch 进程的机器。</p><p>在众多的节点中，其中会有一个 <code>Master Node</code> ，它主要负责维护索引元数据、负责切换主分片和副本分片身份等工作（后面会讲到分片的概念），如果主节点挂了，会选举出一个新的主节点。</p><p><img data-src="./img/elk/struct.awebp" alt=""></p><h1 id="倒排索引"><a class="anchor" href="#倒排索引">#</a> 倒排索引</h1><h2 id="正排索引传统"><a class="anchor" href="#正排索引传统">#</a> 正排索引（传统）</h2><table><thead><tr><th style="text-align:center">id</th><th style="text-align:center">content</th></tr></thead><tbody><tr><td style="text-align:center">1001</td><td style="text-align:center">my name is zhang san</td></tr><tr><td style="text-align:center">1002</td><td style="text-align:center">my name is li si</td></tr></tbody></table><h2 id="倒排索引-2"><a class="anchor" href="#倒排索引-2">#</a> 倒排索引</h2><table><thead><tr><th style="text-align:center">keyword</th><th style="text-align:center">id</th></tr></thead><tbody><tr><td style="text-align:center">name</td><td style="text-align:center">1001,1002</td></tr><tr><td style="text-align:center">zhang</td><td style="text-align:center">1001</td></tr></tbody></table><p>Elasticsearch 是面向文档型数据库，一条数据在这里就是一个文档。 为了方便大家理解，我们将 Elasticsearch 里存储文档数据和关系型数据库 MySQL 存储数据的概念进行一个类比：</p><p><img data-src="./img/elk/map.png" alt=""></p><p>ES 里的 Index 可以看做一个库，而 Types 相当于表， Documents 则相当于表的行。这里 Types 的概念已经被逐渐弱化， Elasticsearch 6.X 中，一个 index 下已经只能包含一个 type， Elasticsearch7.X 中，Type 的概念已经被删除了。</p><h1 id="es-api"><a class="anchor" href="#es-api">#</a> ES API</h1><h2 id="创建索引"><a class="anchor" href="#创建索引">#</a> 创建索引</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> <span class="token parameter variable">-X</span> PUT <span class="token number">192.168</span>.10.100:9200/www</pre></td></tr></table></figure><p>输出:</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"acknowledged"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// 响应结果</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"shards_acknowledged"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span><span class="token comment">// 分片结果</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"index"</span><span class="token operator">:</span> <span class="token string">"www"</span><span class="token comment">// 索引名称</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>重复发送：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"error"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"root_cause"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"resource_already_exists_exception"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                <span class="token property">"reason"</span><span class="token operator">:</span> <span class="token string">"index [shopping/J0WlEhh4R7aDrfIc3AkwWQ] already exists"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token property">"index_uuid"</span><span class="token operator">:</span> <span class="token string">"J0WlEhh4R7aDrfIc3AkwWQ"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token property">"index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"resource_already_exists_exception"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token property">"reason"</span><span class="token operator">:</span> <span class="token string">"index [shopping/J0WlEhh4R7aDrfIc3AkwWQ] already exists"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token property">"index_uuid"</span><span class="token operator">:</span> <span class="token string">"J0WlEhh4R7aDrfIc3AkwWQ"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token property">"index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>    <span class="token property">"status"</span><span class="token operator">:</span> <span class="token number">400</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="查看健康状态"><a class="anchor" href="#查看健康状态">#</a> 查看健康状态</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token number">192.168</span>.10.100:9200/_cat/health?v</pre></td></tr></table></figure><h2 id="查询所有索引"><a class="anchor" href="#查询所有索引">#</a> 查询所有索引</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token number">192.168</span>.10.100:9200/_cat/indices?v</pre></td></tr></table></figure><p>这里请求路径中的_cat 表示查看的意思， indices 表示索引，所以整体含义就是查看当前 ES 服务器中的所有索引，就好像 MySQL 中的 show tables 的感觉，服务器响应结果如下 :</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>health status index                           uuid                   pri rep docs.count docs.deleted store.size pri.store.size</pre></td></tr><tr><td data-num="2"></td><td><pre>green  open   .kibana_task_manager_7.13.1_001 Jp6kivOgSlS3msJfLPptaA   1   0         10            3    119.6kb        119.6kb</pre></td></tr><tr><td data-num="3"></td><td><pre>green  open   .apm-custom-link                lZ8SB-tfT-CZfY6g9aVePA   1   0          0            0       208b           208b</pre></td></tr><tr><td data-num="4"></td><td><pre>yellow open   fund                            kVUWo0J8SEqPe7M4qWBalQ   1   1          0            0       208b           208b</pre></td></tr><tr><td data-num="5"></td><td><pre>yellow open   www                             YcZKzL2hRDiI0RVtdTLj0w   1   1          0            0       208b           208b</pre></td></tr><tr><td data-num="6"></td><td><pre>green  open   .apm-agent-configuration        YBy232SXQKCCBqdPHZhFKw   1   0          0            0       208b           208b</pre></td></tr><tr><td data-num="7"></td><td><pre>green  open   .kibana-event-log-7.13.1-000001 WfHlPuubRJytriWq8ld3mA   1   0          1            0      5.6kb          5.6kb</pre></td></tr><tr><td data-num="8"></td><td><pre>green  open   .kibana_7.13.1_001              Ox-zOiolQ-Wc0StQe9G89A   1   0         10            1      2.1mb          2.1mb</pre></td></tr></table></figure><table><thead><tr><th>表头</th><th>含义</th></tr></thead><tbody><tr><td>health</td><td>当前服务器健康状态：green (集群完整) yellow (单点正常、集群不完整) red (单点不正常)</td></tr><tr><td>status</td><td>索引打开、关闭状态</td></tr><tr><td>index</td><td>索引统一编号</td></tr><tr><td>pri</td><td>主分片数量</td></tr><tr><td>rep</td><td>副本数量</td></tr><tr><td>docs.count</td><td>可用文档数量</td></tr><tr><td>docs.deleted</td><td>文档删除状态（逻辑删除）</td></tr><tr><td>store.size</td><td>主分片和副分片整体占空间大小</td></tr><tr><td>pri.store.size</td><td>主分片占空间大小</td></tr></tbody></table><h2 id="查看单个索引"><a class="anchor" href="#查看单个索引">#</a> 查看单个索引</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token number">192.168</span>.10.100:9200/www</pre></td></tr></table></figure><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"shopping"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token comment">// 索引名</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"aliases"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token comment">// 别名</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token comment">// 映射</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"settings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token comment">// 设置</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token property">"index"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token comment">// 设置 - 索引</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token property">"creation_date"</span><span class="token operator">:</span> <span class="token string">"1617861426847"</span><span class="token punctuation">,</span><span class="token comment">// 设置 - 索引 - 创建时间</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token property">"number_of_shards"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span><span class="token comment">// 设置 - 索引 - 主分片数量</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token property">"number_of_replicas"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span><span class="token comment">// 设置 - 索引 - 主分片数量</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token property">"uuid"</span><span class="token operator">:</span> <span class="token string">"J0WlEhh4R7aDrfIc3AkwWQ"</span><span class="token punctuation">,</span><span class="token comment">// 设置 - 索引 - 主分片数量</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token property">"version"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token comment">// 设置 - 索引 - 主分片数量</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                    <span class="token property">"created"</span><span class="token operator">:</span> <span class="token string">"7080099"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token property">"provided_name"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token comment">// 设置 - 索引 - 主分片数量</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="创建文档"><a class="anchor" href="#创建文档">#</a> 创建文档</h2><p>假设索引已经创建好了，接下来我们来创建文档，并添加数据。这里的文档可以类比为关系型数据库中的表数据，添加的数据格式为 JSON 格式</p><p>在 Postman 中，向 ES 服务器发 POST 请求 : <code>http://192.168.10.100:9200/shopping/_doc</code> ，请求体 JSON 内容为：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"category"</span><span class="token operator">:</span><span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"images"</span><span class="token operator">:</span><span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"price"</span><span class="token operator">:</span><span class="token number">3999.00</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>注意，此处发送请求的方式必须为 POST，不能是 PUT，否则会发生错误 。</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span><span class="token comment">// 索引</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span><span class="token comment">// 类型 - 文档</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"ANQqsHgBaKNfVnMbhZYU"</span><span class="token punctuation">,</span><span class="token comment">// 唯一标识，可以类比为 MySQL 中的主键，随机生成</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// 版本</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token property">"result"</span><span class="token operator">:</span> <span class="token string">"created"</span><span class="token punctuation">,</span><span class="token comment">// 结果，这里的 create 表示创建成功</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token comment">//</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token comment">// 分片 - 总数</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span><span class="token comment">// 分片 - 总数</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token comment">// 分片 - 总数</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property">"_seq_no"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token property">"_primary_term"</span><span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>上面的数据创建后，由于没有指定数据唯一性标识（ID），默认情况下， ES 服务器会随机生成一个。</p><p>如果想要自定义唯一性标识，需要在创建时指定： <code>http://192.168.10.100:9200/shopping/_doc/1</code> ，请求体 JSON 内容为：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"category"</span><span class="token operator">:</span><span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"images"</span><span class="token operator">:</span><span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"price"</span><span class="token operator">:</span><span class="token number">3999.00</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span><span class="token comment">//&lt;------------------ 自定义唯一性标识</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token property">"result"</span><span class="token operator">:</span> <span class="token string">"created"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property">"_seq_no"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token property">"_primary_term"</span><span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><strong>此处需要注意：如果增加数据时明确数据主键，那么请求方式也可以为 PUT。</strong></p><h2 id="查询文档"><a class="anchor" href="#查询文档">#</a> 查询文档</h2><h3 id="主键查询"><a class="anchor" href="#主键查询">#</a> 主键查询</h3><p>查看文档时，需要指明文档的唯一性标识，类似于 MySQL 中数据的主键查询</p><p>在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_doc/1</code> 返回结果如下：</p><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token property">"_seq_no"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token property">"_primary_term"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token property">"found"</span><span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">3999</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>查找不存在的内容，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_doc/1001</code></p><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"1001"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"found"</span><span class="token operator">:</span> <span class="token boolean">false</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="全查询"><a class="anchor" href="#全查询">#</a> 全查询</h3><p>查看索引下所有数据，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code></p><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">133</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token property">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token property">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token property">"max_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"ANQqsHgBaKNfVnMbhZYU"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">3999</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">3999</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="41"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="修改文档"><a class="anchor" href="#修改文档">#</a> 修改文档</h2><h3 id="全量修改"><a class="anchor" href="#全量修改">#</a> 全量修改</h3><p>和新增文档一样，输入相同的 URL 地址请求，如果请求体变化，会将原有的数据内容覆盖</p><p>在 Postman 中，向 ES 服务器发 POST 请求 ： <code>http://192.168.10.100:9200/shopping/_doc/1</code></p><p>请求体 JSON 内容为:</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"华为手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"category"</span><span class="token operator">:</span><span class="token string">"华为"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"images"</span><span class="token operator">:</span><span class="token string">"http://www.gulixueyuan.com/hw.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"price"</span><span class="token operator">:</span><span class="token number">1999.00</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>修改成功后，服务器响应结果：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token property">"result"</span><span class="token operator">:</span> <span class="token string">"updated"</span><span class="token punctuation">,</span><span class="token comment">//&lt;-----------updated 表示数据被更新</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property">"_seq_no"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token property">"_primary_term"</span><span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="局部修改"><a class="anchor" href="#局部修改">#</a> 局部修改</h3><p>修改数据时，也可以只修改某一给条数据的局部信息</p><p>在 Postman 中，向 ES 服务器发 POST 请求 ： <code>http://192.168.10.100:9200/shopping/_update/1</code></p><p>请求体 JSON 内容为:</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"doc"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"title"</span><span class="token operator">:</span><span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token property">"category"</span><span class="token operator">:</span><span class="token string">"小米"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token property">"result"</span><span class="token operator">:</span> <span class="token string">"updated"</span><span class="token punctuation">,</span><span class="token comment">//&lt;-----------updated 表示数据被更新</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property">"_seq_no"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token property">"_primary_term"</span><span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="删除文档"><a class="anchor" href="#删除文档">#</a> 删除文档</h2><p>删除一个文档不会立即从磁盘上移除，它只是被标记成已删除（逻辑删除）。</p><p>在 Postman 中，向 ES 服务器发 <code>DELETE</code> 请求 ： <code>http://192.168.10.100:9200/shopping/_doc/1</code></p><p>返回结果：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"1"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"_version"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token property">"result"</span><span class="token operator">:</span> <span class="token string">"deleted"</span><span class="token punctuation">,</span><span class="token comment">//&lt;--- 删除成功</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">2</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token property">"_seq_no"</span><span class="token operator">:</span> <span class="token number">4</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token property">"_primary_term"</span><span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="14"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="高级查询"><a class="anchor" href="#高级查询">#</a> 高级查询</h2><h3 id="条件查询"><a class="anchor" href="#条件查询">#</a> 条件查询</h3><p>假设有以下文档内容：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">5</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token property">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token property">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token property">"max_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"ANQqsHgBaKNfVnMbhZYU"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">3999</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"A9R5sHgBaKNfVnMb25Ya"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"BNR5sHgBaKNfVnMb7pal"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="49"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="53"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"BtR6sHgBaKNfVnMbX5Y5"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"华为手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"华为"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="65"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="67"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="68"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"B9R6sHgBaKNfVnMbZpZ6"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="69"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="70"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"华为手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="72"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"华为"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="73"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="74"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="75"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="79"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="80"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"CdR7sHgBaKNfVnMbsJb9"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="81"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="82"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"华为手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="84"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"华为"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="85"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="86"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="87"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="90"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="91"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="请求体带参查询"><a class="anchor" href="#请求体带参查询">#</a> 请求体带参查询</h4><p><strong>查找 category 为小米的文档</strong>，在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"match"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token property">"category"</span><span class="token operator">:</span><span class="token string">"小米"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token property">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token property">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token property">"max_score"</span><span class="token operator">:</span> <span class="token number">1.3862942</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"ANQqsHgBaKNfVnMbhZYU"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1.3862942</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">3999</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"A9R5sHgBaKNfVnMb25Ya"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1.3862942</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"BNR5sHgBaKNfVnMb7pal"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1.3862942</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="49"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="53"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="54"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="55"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="查找所有文档内容"><a class="anchor" href="#查找所有文档内容">#</a> 查找所有文档内容</h4><p>在 Postman 中，向 ES 服务器发 GET 请求： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"match_all"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>则返回所有文档内容。</p><h4 id="查询指定字段"><a class="anchor" href="#查询指定字段">#</a> 查询指定字段</h4><p>在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"match_all"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"_source"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token string">"title"</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="分页查询"><a class="anchor" href="#分页查询">#</a> 分页查询</h4><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"match_all"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"from"</span><span class="token operator">:</span><span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token property">"size"</span><span class="token operator">:</span><span class="token number">2</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="查询排序"><a class="anchor" href="#查询排序">#</a> 查询排序</h4><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"match_all"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"sort"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token property">"price"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token property">"order"</span><span class="token operator">:</span><span class="token string">"desc"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="多条件查询"><a class="anchor" href="#多条件查询">#</a> 多条件查询</h3><p>假设想找出小米牌子，价格为 3999 元的。（must 相当于数据库的 &amp;&amp;）</p><p>在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"bool"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token property">"must"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token property">"match"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span><span class="token string">"小米"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token property">"match"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span><span class="token number">3999.00</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>假设想找出小米和华为的牌子。（should 相当于数据库的 ||）</p><p>在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"bool"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token property">"should"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token property">"match"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span><span class="token string">"小米"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token property">"match"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span><span class="token string">"华为"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token property">"filter"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token property">"range"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                <span class="token property">"price"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                    <span class="token property">"gt"</span><span class="token operator">:</span><span class="token number">2000</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="范围查询"><a class="anchor" href="#范围查询">#</a> 范围查询</h3><p>假设想找出小米和华为的牌子，价格大于 2000 元的手机。</p><p>在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"bool"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token property">"should"</span><span class="token operator">:</span><span class="token punctuation">[</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token property">"match"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span><span class="token string">"小米"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                <span class="token property">"match"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span><span class="token string">"华为"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">]</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token property">"filter"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token property">"range"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>                        <span class="token property">"gt"</span><span class="token operator">:</span><span class="token number">2000</span></pre></td></tr><tr><td data-num="17"></td><td><pre>                    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="全文检索"><a class="anchor" href="#全文检索">#</a> 全文检索</h3><p>这功能像搜索引擎那样，如品牌输入 “小华”，返回结果带回品牌有 “小米” 和” 华为” 的。</p><p>在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"match"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token property">"category"</span> <span class="token operator">:</span> <span class="token string">"小华"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="完全匹配"><a class="anchor" href="#完全匹配">#</a> 完全匹配</h3><p>在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"match_phrase"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token property">"category"</span> <span class="token operator">:</span> <span class="token string">"为"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="高亮查询"><a class="anchor" href="#高亮查询">#</a> 高亮查询</h3><p>在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"match_phrase"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token property">"category"</span> <span class="token operator">:</span> <span class="token string">"为"</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token property">"highlight"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"fields"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>            <span class="token property">"category"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span><span class="token comment">//&lt;---- 高亮这字段</span></pre></td></tr><tr><td data-num="10"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">100</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token property">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">3</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token property">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token property">"max_score"</span><span class="token operator">:</span> <span class="token number">0.6931471</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"BtR6sHgBaKNfVnMbX5Y5"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">0.6931471</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"华为手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"华为"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                <span class="token property">"highlight"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                        <span class="token string">"华&lt;em>为&lt;/em>"</span><span class="token comment">//&lt;------ 高亮一个为字。</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                    <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"B9R6sHgBaKNfVnMbZpZ6"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">0.6931471</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"华为手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"华为"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token property">"highlight"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                        <span class="token string">"华&lt;em>为&lt;/em>"</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                    <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="49"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="50"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="51"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="53"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"CdR7sHgBaKNfVnMbsJb9"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">0.6931471</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"华为手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"华为"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                <span class="token property">"highlight"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="64"></td><td><pre>                        <span class="token string">"华&lt;em>为&lt;/em>"</span></pre></td></tr><tr><td data-num="65"></td><td><pre>                    <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="67"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="68"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="70"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="聚合查询"><a class="anchor" href="#聚合查询">#</a> 聚合查询</h3><h4 id="带原始数据"><a class="anchor" href="#带原始数据">#</a> 带原始数据</h4><p>聚合允许使用者对 es 文档进行统计分析，类似与关系型数据库中的 group by，当然还有很多其他的聚合，例如取最大值 max、平均值 avg 等等。</p><p>接下来按 price 字段进行分组：</p><p>在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"aggs"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token comment">// 聚合操作</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"price_group"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token comment">// 名称，随意起名</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token property">"terms"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token comment">// 分组</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token property">"field"</span><span class="token operator">:</span><span class="token string">"price"</span><span class="token comment">// 分组字段</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">63</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token property">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token property">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token property">"max_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="17"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="19"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="20"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"ANQqsHgBaKNfVnMbhZYU"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">3999</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="31"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="32"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"A9R5sHgBaKNfVnMb25Ya"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="33"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="34"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="35"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="36"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="37"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="38"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="39"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="40"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="41"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="43"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="44"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"BNR5sHgBaKNfVnMb7pal"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="45"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="46"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="47"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"小米手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="48"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="49"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="50"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="51"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="52"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="53"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="54"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="55"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="56"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"BtR6sHgBaKNfVnMbX5Y5"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="57"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="58"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="59"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"华为手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="60"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"华为"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="61"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="62"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="63"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="64"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="65"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="66"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="67"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="68"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"B9R6sHgBaKNfVnMbZpZ6"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="69"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="70"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="71"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"华为手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="72"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"华为"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="73"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="74"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="75"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="76"></td><td><pre>            <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="77"></td><td><pre>            <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="78"></td><td><pre>                <span class="token property">"_index"</span><span class="token operator">:</span> <span class="token string">"shopping"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="79"></td><td><pre>                <span class="token property">"_type"</span><span class="token operator">:</span> <span class="token string">"_doc"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="80"></td><td><pre>                <span class="token property">"_id"</span><span class="token operator">:</span> <span class="token string">"CdR7sHgBaKNfVnMbsJb9"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="81"></td><td><pre>                <span class="token property">"_score"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="82"></td><td><pre>                <span class="token property">"_source"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="83"></td><td><pre>                    <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"华为手机"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="84"></td><td><pre>                    <span class="token property">"category"</span><span class="token operator">:</span> <span class="token string">"华为"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="85"></td><td><pre>                    <span class="token property">"images"</span><span class="token operator">:</span> <span class="token string">"http://www.gulixueyuan.com/xm.jpg"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="86"></td><td><pre>                    <span class="token property">"price"</span><span class="token operator">:</span> <span class="token number">1999</span></pre></td></tr><tr><td data-num="87"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="88"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="89"></td><td><pre>        <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="90"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="91"></td><td><pre>    <span class="token property">"aggregations"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="92"></td><td><pre>        <span class="token property">"price_group"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="93"></td><td><pre>            <span class="token property">"doc_count_error_upper_bound"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="94"></td><td><pre>            <span class="token property">"sum_other_doc_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="95"></td><td><pre>            <span class="token property">"buckets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="96"></td><td><pre>                <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="97"></td><td><pre>                    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token number">1999</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="98"></td><td><pre>                    <span class="token property">"doc_count"</span><span class="token operator">:</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="99"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="100"></td><td><pre>                <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="101"></td><td><pre>                    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token number">3999</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="102"></td><td><pre>                    <span class="token property">"doc_count"</span><span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="103"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="104"></td><td><pre>            <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="105"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="106"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="107"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="不带原始数据"><a class="anchor" href="#不带原始数据">#</a> 不带原始数据</h4><p>在 Postman 中，向 ES 服务器发 GET 请求 ： <code>http://192.168.10.100:9200/shopping/_search</code> ，附带 JSON 体如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"aggs"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"price_group"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token property">"terms"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token property">"field"</span><span class="token operator">:</span><span class="token string">"price"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token property">"size"</span><span class="token operator">:</span><span class="token number">0</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">60</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token property">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">6</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token property">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token property">"max_score"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token property">"aggregations"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>        <span class="token property">"price_group"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>            <span class="token property">"doc_count_error_upper_bound"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="21"></td><td><pre>            <span class="token property">"sum_other_doc_count"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="22"></td><td><pre>            <span class="token property">"buckets"</span><span class="token operator">:</span> <span class="token punctuation">[</span></pre></td></tr><tr><td data-num="23"></td><td><pre>                <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>                    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token number">1999</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="25"></td><td><pre>                    <span class="token property">"doc_count"</span><span class="token operator">:</span> <span class="token number">5</span></pre></td></tr><tr><td data-num="26"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="27"></td><td><pre>                <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="28"></td><td><pre>                    <span class="token property">"key"</span><span class="token operator">:</span> <span class="token number">3999</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="29"></td><td><pre>                    <span class="token property">"doc_count"</span><span class="token operator">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="30"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="31"></td><td><pre>            <span class="token punctuation">]</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="34"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h4 id="平均值"><a class="anchor" href="#平均值">#</a> 平均值</h4><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"aggs"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"price_avg"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token comment">// 名称，随意起名</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token property">"avg"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span><span class="token comment">// 求平均</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token property">"field"</span><span class="token operator">:</span><span class="token string">"price"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token property">"size"</span><span class="token operator">:</span><span class="token number">0</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="映射关系"><a class="anchor" href="#映射关系">#</a> 映射关系</h2><p>创建数据库表需要设置字段名称，类型，长度，约束等；索引库也一样，需要知道这个类型下有哪些字段，每个字段有哪些约束信息，这就叫做映射 (mapping)。</p><p>先创建一个索引：</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>PUT http://192.168.10.100:9200/user</pre></td></tr></table></figure><h3 id="创建映射"><a class="anchor" href="#创建映射">#</a> 创建映射</h3><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre># PUT http<span class="token operator">:</span><span class="token comment">//127.0.0.1:9200/user/_mapping</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"name"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>            <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="9"></td><td><pre>        <span class="token property">"sex"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>            <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">true</span></pre></td></tr><tr><td data-num="12"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>        <span class="token property">"tel"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre>            <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h3 id="查询映射"><a class="anchor" href="#查询映射">#</a> 查询映射</h3><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre>GET http<span class="token operator">:</span><span class="token comment">//127.0.0.1:9200/user/_mapping</span></pre></td></tr></table></figure><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"user"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>        <span class="token property">"mappings"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>            <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>                <span class="token property">"name"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="6"></td><td><pre>                    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"text"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>                <span class="token property">"sex"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="9"></td><td><pre>                    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>                <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>                <span class="token property">"tel"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>                    <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"keyword"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>                    <span class="token property">"index"</span><span class="token operator">:</span> <span class="token boolean">false</span></pre></td></tr><tr><td data-num="14"></td><td><pre>                <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="15"></td><td><pre>            <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>增加数据：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre>PUT http<span class="token operator">:</span><span class="token comment">//127.0.0.1:9200/user/_create/1001</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"name"</span><span class="token operator">:</span><span class="token string">"小米"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"sex"</span><span class="token operator">:</span><span class="token string">"男的"</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token property">"tel"</span><span class="token operator">:</span><span class="token string">"1111"</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>设置为 <code>keyword</code> 的只能完全匹配</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre>GET http<span class="token operator">:</span><span class="token comment">//127.0.0.1:9200/user/_search</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"query"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>        <span class="token property">"match"</span><span class="token operator">:</span><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>            <span class="token property">"sex"</span><span class="token operator">:</span><span class="token string">"男"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>返回结果如下：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"took"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token property">"timed_out"</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"_shards"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>        <span class="token property">"successful"</span><span class="token operator">:</span> <span class="token number">1</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="7"></td><td><pre>        <span class="token property">"skipped"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="8"></td><td><pre>        <span class="token property">"failed"</span><span class="token operator">:</span> <span class="token number">0</span></pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>        <span class="token property">"total"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>            <span class="token property">"value"</span><span class="token operator">:</span> <span class="token number">0</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="13"></td><td><pre>            <span class="token property">"relation"</span><span class="token operator">:</span> <span class="token string">"eq"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="15"></td><td><pre>        <span class="token property">"max_score"</span><span class="token operator">:</span> <span class="token null keyword">null</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token property">"hits"</span><span class="token operator">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p><code>index</code> 设置为 false 查询不到</p><h3 id="动态映射"><a class="anchor" href="#动态映射">#</a> 动态映射</h3><p>Elasticsearch 具有一项称为 “动态映射”（Dynamic Mapping）的功能，它允许在插入文档时自动创建映射，而无需预先定义映射。这意味着您可以向索引中插入文档，Elasticsearch 会根据文档的结构自动创建相应的映射。这对于快速开始和灵活的数据处理非常有用。</p><h2 id="删除索引"><a class="anchor" href="#删除索引">#</a> 删除索引</h2><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">curl</span> <span class="token parameter variable">-X</span> DELETE <span class="token number">192.168</span>.10.100:9200/www</pre></td></tr></table></figure><p>输出：</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token property">"acknowledged"</span><span class="token operator">:</span><span class="token boolean">true</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h1 id="kibana"><a class="anchor" href="#kibana">#</a> Kibana</h1><h1 id="logstash"><a class="anchor" href="#logstash">#</a> Logstash</h1><h2 id="实践"><a class="anchor" href="#实践">#</a> 实践</h2><p>创建一个 <code>logstash.conf</code></p><figure class="highlight ruby"><figcaption data-lang="ruby"></figcaption><table><tr><td data-num="1"></td><td><pre>input <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  file <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    path <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"/home/elk/log.log"</span></span> <span class="token comment"># 日志目录 </span></pre></td></tr><tr><td data-num="4"></td><td><pre>    start_position <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"beginning"</span></span> <span class="token comment"># 从开头开始采集数据</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    sincedb_path <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"/dev/null"</span></span> <span class="token comment"># 每次重新启动 Logstash 时，它都会从文件的开头开始读取数据。</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>filter <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token comment"># grok 插件，匹配规则</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  grok <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="12"></td><td><pre>    match <span class="token operator">=></span> <span class="token punctuation">&#123;</span> <span class="token string-literal"><span class="token string">"message"</span></span> <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"%&#123;TIMESTAMP_ISO8601:timestamp&#125; %&#123;LOGLEVEL:loglevel&#125; %&#123;GREEDYDATA:msg&#125;"</span></span> <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span> </pre></td></tr><tr><td data-num="14"></td><td><pre> </pre></td></tr><tr><td data-num="15"></td><td><pre>  mutate <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="16"></td><td><pre>        <span class="token comment"># 删除不想要的字段，某些固定字段无法删除</span></pre></td></tr><tr><td data-num="17"></td><td><pre>        remove_field <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"message"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"path"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"@version"</span></span><span class="token punctuation">,</span><span class="token string-literal"><span class="token string">"host"</span></span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="18"></td><td><pre>        </pre></td></tr><tr><td data-num="19"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="20"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>output <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="23"></td><td><pre>  elasticsearch <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    hosts <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"elasticsearch:9200"</span></span><span class="token punctuation">]</span> <span class="token comment"># es 主机地址</span></pre></td></tr><tr><td data-num="25"></td><td><pre>    index <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"log"</span></span> <span class="token comment"># 需要发送的索引，无需提前创建 index 和 mapping</span></pre></td></tr><tr><td data-num="26"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="27"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><p>然后把这个文件挂载到容器里，在 <code>logstash</code> 的 <code>volumes</code> 字段里加入，宿主机目录可以自定义。</p><figure class="highlight text"><figcaption data-lang="text"></figcaption><table><tr><td data-num="1"></td><td><pre>- "./logstash.conf:/usr/share/logstash/pipeline/logstash.conf"</pre></td></tr></table></figure><p>随便创建一个目录用于存储目录文件</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /home/elk/log.log</pre></td></tr></table></figure><p><code>vim</code> 写一点内容</p><figure class="highlight lua"><figcaption data-lang="lua"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">:</span><span class="token number">45</span> INFO This is an informational log message<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">12</span> ERROR An error occurred <span class="token keyword">in</span> the application<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">05</span> WARNING This is a warning message<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="4"></td><td><pre><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">:</span><span class="token number">20</span> INFO Another informational log entry<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="5"></td><td><pre><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">05</span> DEBUG Debugging information <span class="token keyword">for</span> troubleshooting<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="6"></td><td><pre><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">30</span><span class="token punctuation">:</span><span class="token number">45</span> INFO This is an informational log message<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">31</span><span class="token punctuation">:</span><span class="token number">12</span> ERROR An error occurred <span class="token keyword">in</span> the application<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">32</span><span class="token punctuation">:</span><span class="token number">05</span> WARNING This is a warning message<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">33</span><span class="token punctuation">:</span><span class="token number">20</span> INFO Another informational log entry<span class="token punctuation">.</span></pre></td></tr><tr><td data-num="10"></td><td><pre><span class="token number">2023</span><span class="token operator">-</span><span class="token number">08</span><span class="token operator">-</span><span class="token number">20</span> <span class="token number">15</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">05</span> DEBUG Debugging information <span class="token keyword">for</span> troubleshooting<span class="token punctuation">.</span></pre></td></tr></table></figure><p><code>Discover</code> 里查看一下</p><p><img data-src="./img/elk/discover.png" alt=""></p><p><code>logstash.conf</code> 使用了 <code>ruby</code> 语言，如果不会的话，我们就对 <code>chatgpt</code> 提需求吧！</p><figure class="highlight ruby"><figcaption data-lang="ruby"></figcaption><table><tr><td data-num="1"></td><td><pre>input <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  file <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    path <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"/home/project/GoYin/api/tmp/klog/logs/*.log"</span></span></pre></td></tr><tr><td data-num="4"></td><td><pre>    start_position <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"beginning"</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    sincedb_path <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"/dev/null"</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    codec <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"json"</span></span> <span class="token comment"># 如果日志是 JSON 格式的</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    tags <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"klog"</span></span><span class="token punctuation">]</span>     <span class="token comment"># 为这个输入添加一个标签以区分日志类型</span></pre></td></tr><tr><td data-num="8"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="9"></td><td><pre></pre></td></tr><tr><td data-num="10"></td><td><pre>  file <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    path <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"/home/project/GoYin/api/tmp/hlog/logs/*.log"</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    start_position <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"beginning"</span></span></pre></td></tr><tr><td data-num="13"></td><td><pre>    sincedb_path <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"/dev/null"</span></span></pre></td></tr><tr><td data-num="14"></td><td><pre>    codec <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"json"</span></span> <span class="token comment"># 如果您的日志是 JSON 格式的</span></pre></td></tr><tr><td data-num="15"></td><td><pre>    tags <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"hlog"</span></span><span class="token punctuation">]</span>     <span class="token comment"># 为这个输入添加一个标签以区分日志类型</span></pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="17"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="18"></td><td><pre></pre></td></tr><tr><td data-num="19"></td><td><pre>filter <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="20"></td><td><pre>  <span class="token keyword">if</span> <span class="token string-literal"><span class="token string">"klog"</span></span> <span class="token keyword">in</span> <span class="token punctuation">[</span>tags<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="21"></td><td><pre></pre></td></tr><tr><td data-num="22"></td><td><pre>    <span class="token comment"># 对于以 "klog" 标签标记的日志，您可以在这里进行特定的过滤和处理</span></pre></td></tr><tr><td data-num="23"></td><td><pre></pre></td></tr><tr><td data-num="24"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token string-literal"><span class="token string">"hlog"</span></span> <span class="token keyword">in</span> <span class="token punctuation">[</span>tags<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="25"></td><td><pre></pre></td></tr><tr><td data-num="26"></td><td><pre>    <span class="token comment"># 对于以 "hlog" 标签标记的日志，您可以在这里进行特定的过滤和处理</span></pre></td></tr><tr><td data-num="27"></td><td><pre></pre></td></tr><tr><td data-num="28"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="29"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="30"></td><td><pre></pre></td></tr><tr><td data-num="31"></td><td><pre>output <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="32"></td><td><pre>  <span class="token keyword">if</span> <span class="token string-literal"><span class="token string">"klog"</span></span> <span class="token keyword">in</span> <span class="token punctuation">[</span>tags<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    elasticsearch <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="34"></td><td><pre>      hosts <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"your_elasticsearch_host"</span></span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="35"></td><td><pre>      index <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"klog-%&#123;+YYYY.MM.dd&#125;"</span></span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="37"></td><td><pre>  <span class="token punctuation">&#125;</span> <span class="token keyword">else</span> <span class="token keyword">if</span> <span class="token string-literal"><span class="token string">"hlog"</span></span> <span class="token keyword">in</span> <span class="token punctuation">[</span>tags<span class="token punctuation">]</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="38"></td><td><pre>    elasticsearch <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="39"></td><td><pre>      hosts <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"your_elasticsearch_host"</span></span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="40"></td><td><pre>      index <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"hlog-%&#123;+YYYY.MM.dd&#125;"</span></span></pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="42"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="43"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    </pre></td></tr><tr><td data-num="45"></td><td><pre><span class="token comment"># %&#123;+YYYY.MM.dd&#125; 会自动赋予当前日期</span></pre></td></tr></table></figure><h2 id="conf文件说明"><a class="anchor" href="#conf文件说明">#</a> conf 文件说明</h2><h3 id="input"><a class="anchor" href="#input">#</a> Input</h3><p>事件源可以是从 stdin 屏幕输入读取，可以从 file 指定的文件，也可以从 es，filebeat，kafka，redis 等读取</p><ul><li><p><strong>stdin</strong> 标准输入</p></li><li><p><strong>file</strong> 从文件读取数据</p></li><li><p><strong>syslog</strong> 通过网络将系统日志消息读取为事件</p></li></ul><h3 id="filter"><a class="anchor" href="#filter">#</a> Filter</h3><h3 id="output"><a class="anchor" href="#output">#</a> Output</h3><h2 id="mysql数据库同步"><a class="anchor" href="#mysql数据库同步">#</a> Mysql 数据库同步</h2><p>用 <code>docker-compose</code> 快速部署 <code>MySQL</code> 数据库</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">'3'</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">mysql</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span>latest</pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">224488</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> herbal</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"13306:3306"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./mysql_data:/var/lib/mysql"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./init.sql:/docker-entrypoint-initdb.d/init.sql"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token punctuation">-</span> elk</pre></td></tr><tr><td data-num="16"></td><td><pre><span class="token comment"># 和刚才的放在一个 yml 文件里</span></pre></td></tr></table></figure><p><code>init.sql</code></p><figure class="highlight sql"><figcaption data-lang="SQL"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token keyword">USE</span> herbal<span class="token punctuation">;</span></pre></td></tr><tr><td data-num="2"></td><td><pre></pre></td></tr><tr><td data-num="3"></td><td><pre><span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> herbs <span class="token punctuation">(</span></pre></td></tr><tr><td data-num="4"></td><td><pre>  id <span class="token keyword">INT</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="5"></td><td><pre>  name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="6"></td><td><pre>  botanical_name <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">255</span><span class="token punctuation">)</span></pre></td></tr><tr><td data-num="7"></td><td><pre><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre><span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> herbs <span class="token punctuation">(</span>name<span class="token punctuation">,</span> botanical_name<span class="token punctuation">)</span> <span class="token keyword">VALUES</span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">(</span><span class="token string">'Herb 1'</span><span class="token punctuation">,</span> <span class="token string">'Botanical 1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="11"></td><td><pre>  <span class="token punctuation">(</span><span class="token string">'Herb 2'</span><span class="token punctuation">,</span> <span class="token string">'Botanical 2'</span><span class="token punctuation">)</span><span class="token punctuation">,</span></pre></td></tr><tr><td data-num="12"></td><td><pre>  <span class="token punctuation">(</span><span class="token string">'Herb 3'</span><span class="token punctuation">,</span> <span class="token string">'Botanical 3'</span><span class="token punctuation">)</span><span class="token punctuation">;</span></pre></td></tr></table></figure><p>下载 jar 包</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token function">wget</span> <span class="token parameter variable">-P</span> jdbc_driver https://repo1.maven.org/maven2/mysql/mysql-connector-java/8.0.26/mysql-connector-java-8.0.26.jar</pre></td></tr></table></figure><p><code>logstash</code> 中加上 jar 包的挂载路径</p><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">logstash</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="2"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/logstash/logstash<span class="token punctuation">:</span>7.13.1</pre></td></tr><tr><td data-num="3"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> logstash</pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./logstash.conf:/usr/share/logstash/pipeline/logstash.conf"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/home/elk/log.log:/log/log.log"</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./jdbc_driver/mysql-connector-java-8.0.26.jar:/jdbc_driver/mysql-connector-java-8.0.26.jar"</span></pre></td></tr><tr><td data-num="8"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="9"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"XPACK_MONITORING_ENABLED=false"</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token punctuation">-</span> elasticsearch</pre></td></tr><tr><td data-num="13"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="14"></td><td><pre>      <span class="token punctuation">-</span> elk</pre></td></tr></table></figure><p>修改 <code>logstash.conf</code></p><figure class="highlight ruby"><figcaption data-lang="ruby"></figcaption><table><tr><td data-num="1"></td><td><pre>input <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  jdbc <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    jdbc_connection_string <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"jdbc:mysql://mysql:13306/herbal"</span></span> <span class="token comment"># mysql 更换成你的 mysql 主机 ip</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    jdbc_user <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"root"</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>    jdbc_password <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"224488"</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    jdbc_driver_library <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"/jdbc_driver/mysql-connector-java-8.0.26.jar"</span></span> <span class="token comment"># 容器内的路径</span></pre></td></tr><tr><td data-num="7"></td><td><pre>    jdbc_driver_class <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"com.mysql.cj.jdbc.Driver"</span></span></pre></td></tr><tr><td data-num="8"></td><td><pre>    statement <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"SELECT * FROM herbs"</span></span></pre></td></tr><tr><td data-num="9"></td><td><pre>    schedule <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"* * * * *"</span></span></pre></td></tr><tr><td data-num="10"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="11"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="12"></td><td><pre></pre></td></tr><tr><td data-num="13"></td><td><pre>filter <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="14"></td><td><pre> </pre></td></tr><tr><td data-num="15"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="16"></td><td><pre></pre></td></tr><tr><td data-num="17"></td><td><pre>output <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="18"></td><td><pre>  elasticsearch <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="19"></td><td><pre>    hosts <span class="token operator">=></span> <span class="token punctuation">[</span><span class="token string-literal"><span class="token string">"elasticsearch:9200"</span></span><span class="token punctuation">]</span></pre></td></tr><tr><td data-num="20"></td><td><pre>    index <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"mysql_data"</span></span></pre></td></tr><tr><td data-num="21"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="22"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure><h2 id="geo使用策略"><a class="anchor" href="#geo使用策略">#</a> Geo 使用策略</h2><p>目前只实践成功一个方案，可以让 <code>kibana</code> 的 <code>maps</code> 识别到经纬度的数据，先把 <code>logstash</code> 关闭，1.2 步结束再关。</p><ol><li><p>创建好要导入的索引</p><figure class="highlight bash"><figcaption data-lang="bash"></figcaption><table><tr><td data-num="1"></td><td><pre>PUT http://<span class="token punctuation">&#123;</span>ip<span class="token punctuation">&#125;</span>:<span class="token punctuation">&#123;</span>port<span class="token punctuation">&#125;</span>/<span class="token punctuation">&#123;</span>your_index<span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p>添加 <code>location</code> 字段类型为 <code>geo_point</code> (因为 <code>logstash</code> 自动搜集信息时不支持设置为此字段)</p><figure class="highlight json"><figcaption data-lang="JSON"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment">// PUT http://&#123;ip&#125;:&#123;port&#125;/&#123;your_index&#125;/_mapping</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token property">"properties"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token property">"location"</span><span class="token operator">:</span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token property">"type"</span><span class="token operator">:</span> <span class="token string">"geo_point"</span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre><span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><code>logstash.conf</code> 的 <code>filter</code> 部分</p><figure class="highlight ruby"><figcaption data-lang="ruby"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token comment"># 提前解析出来 "latitude" 和 "longitude" 字段</span></pre></td></tr><tr><td data-num="2"></td><td><pre>  mutate <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="3"></td><td><pre>    convert <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="4"></td><td><pre>      <span class="token string-literal"><span class="token string">"latitude"</span></span> <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"float"</span></span></pre></td></tr><tr><td data-num="5"></td><td><pre>      <span class="token string-literal"><span class="token string">"longitude"</span></span> <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"float"</span></span></pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="7"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="8"></td><td><pre></pre></td></tr><tr><td data-num="9"></td><td><pre>   mutate <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="10"></td><td><pre>    add_field <span class="token operator">=></span> <span class="token punctuation">&#123;</span></pre></td></tr><tr><td data-num="11"></td><td><pre>      <span class="token string-literal"><span class="token string">"location"</span></span> <span class="token operator">=></span> <span class="token string-literal"><span class="token string">"%&#123;[latitude]&#125;,%&#123;[longitude]&#125;"</span></span></pre></td></tr><tr><td data-num="12"></td><td><pre>    <span class="token punctuation">&#125;</span></pre></td></tr><tr><td data-num="13"></td><td><pre>  <span class="token punctuation">&#125;</span></pre></td></tr></table></figure></li><li><p><code>kibana</code> 的 <code>maps</code> 可以自动选择 <code>location</code> 字段</p><p><img data-src="https://s2.loli.net/2023/09/11/IfdVGohip5yRxYD.png" alt="1IEOK@V_9VRENT7DQ_@IJ`0.png"></p></li></ol><h1 id="完整部署参考"><a class="anchor" href="#完整部署参考">#</a> 完整部署参考</h1><figure class="highlight yaml"><figcaption data-lang="YAML"></figcaption><table><tr><td data-num="1"></td><td><pre><span class="token key atrule">version</span><span class="token punctuation">:</span> <span class="token string">"2"</span></pre></td></tr><tr><td data-num="2"></td><td><pre><span class="token key atrule">services</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="3"></td><td><pre>  <span class="token key atrule">mysql</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="4"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> mysql<span class="token punctuation">:</span><span class="token number">5.7</span></pre></td></tr><tr><td data-num="5"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> mysql</pre></td></tr><tr><td data-num="6"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="7"></td><td><pre>      <span class="token key atrule">MYSQL_ROOT_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">224488</span></pre></td></tr><tr><td data-num="8"></td><td><pre>      <span class="token key atrule">MYSQL_DATABASE</span><span class="token punctuation">:</span> herbal</pre></td></tr><tr><td data-num="9"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="10"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"13306:3306"</span></pre></td></tr><tr><td data-num="11"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="12"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./mysql_data:/var/lib/mysql"</span></pre></td></tr><tr><td data-num="13"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./init.sql:/docker-entrypoint-initdb.d/init.sql"</span></pre></td></tr><tr><td data-num="14"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="15"></td><td><pre>      <span class="token punctuation">-</span> elk</pre></td></tr><tr><td data-num="16"></td><td><pre>  <span class="token key atrule">elasticsearch</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="17"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> elasticsearch<span class="token punctuation">:</span>7.13.1</pre></td></tr><tr><td data-num="18"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> elasticsearch</pre></td></tr><tr><td data-num="19"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="20"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./elasticsearch_data:/bitnami/elasticsearch"</span></pre></td></tr><tr><td data-num="21"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="22"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"9200:9200"</span></pre></td></tr><tr><td data-num="23"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"9300:9300"</span></pre></td></tr><tr><td data-num="24"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="25"></td><td><pre>      <span class="token punctuation">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num="26"></td><td><pre>      <span class="token punctuation">-</span> discovery.type=single<span class="token punctuation">-</span>node</pre></td></tr><tr><td data-num="27"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"ES_JAVA_OPTS=-Xms512m -Xmx512m"</span></pre></td></tr><tr><td data-num="28"></td><td><pre>    <span class="token key atrule">privileged</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr><tr><td data-num="29"></td><td><pre>    <span class="token key atrule">ulimits</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="30"></td><td><pre>      <span class="token key atrule">nofile</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="31"></td><td><pre>        <span class="token key atrule">soft</span><span class="token punctuation">:</span> <span class="token number">65536</span></pre></td></tr><tr><td data-num="32"></td><td><pre>        <span class="token key atrule">hard</span><span class="token punctuation">:</span> <span class="token number">65536</span></pre></td></tr><tr><td data-num="33"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="34"></td><td><pre>      <span class="token punctuation">-</span> elk</pre></td></tr><tr><td data-num="35"></td><td><pre>  <span class="token key atrule">kibana</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="36"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> kibana<span class="token punctuation">:</span>7.13.1</pre></td></tr><tr><td data-num="37"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> kibana</pre></td></tr><tr><td data-num="38"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="39"></td><td><pre>      <span class="token punctuation">-</span> elasticsearch.hosts=http<span class="token punctuation">:</span>//elasticsearch<span class="token punctuation">:</span><span class="token number">9200</span></pre></td></tr><tr><td data-num="40"></td><td><pre>      <span class="token punctuation">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num="41"></td><td><pre>    <span class="token key atrule">restart</span><span class="token punctuation">:</span> always</pre></td></tr><tr><td data-num="42"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="43"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"5601:5601"</span></pre></td></tr><tr><td data-num="44"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="45"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./kibana_data:/bitnami/kibana"</span></pre></td></tr><tr><td data-num="46"></td><td><pre>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="47"></td><td><pre>      <span class="token punctuation">-</span> elasticsearch</pre></td></tr><tr><td data-num="48"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="49"></td><td><pre>      <span class="token punctuation">-</span> elk</pre></td></tr><tr><td data-num="50"></td><td><pre>  <span class="token key atrule">logstash</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="51"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> docker.elastic.co/logstash/logstash<span class="token punctuation">:</span>7.13.1</pre></td></tr><tr><td data-num="52"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> logstash</pre></td></tr><tr><td data-num="53"></td><td><pre>    <span class="token key atrule">volumes</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="54"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./logstash.conf:/usr/share/logstash/pipeline/logstash.conf"</span></pre></td></tr><tr><td data-num="55"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"/home/elk/log/:/home/elk/log/"</span></pre></td></tr><tr><td data-num="56"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"./jdbc_driver/mysql-connector-java-8.0.26.jar:/jdbc_driver/mysql-connector-java-8.0.26.jar"</span></pre></td></tr><tr><td data-num="57"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="58"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"XPACK_MONITORING_ENABLED=false"</span></pre></td></tr><tr><td data-num="59"></td><td><pre>      <span class="token punctuation">-</span> TZ=Asia/Shanghai</pre></td></tr><tr><td data-num="60"></td><td><pre>    <span class="token key atrule">depends_on</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="61"></td><td><pre>      <span class="token punctuation">-</span> elasticsearch</pre></td></tr><tr><td data-num="62"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="63"></td><td><pre>      <span class="token punctuation">-</span> elk</pre></td></tr><tr><td data-num="64"></td><td><pre>  <span class="token key atrule">phpmyadmin</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="65"></td><td><pre>    <span class="token key atrule">image</span><span class="token punctuation">:</span> phpmyadmin<span class="token punctuation">:</span>latest</pre></td></tr><tr><td data-num="66"></td><td><pre>    <span class="token key atrule">container_name</span><span class="token punctuation">:</span> phpadmin</pre></td></tr><tr><td data-num="67"></td><td><pre>    <span class="token key atrule">ports</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="68"></td><td><pre>      <span class="token punctuation">-</span> <span class="token string">"3300:80"</span></pre></td></tr><tr><td data-num="69"></td><td><pre>    <span class="token key atrule">environment</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="70"></td><td><pre>      <span class="token key atrule">PMA_ARBITRARY</span><span class="token punctuation">:</span> <span class="token number">1</span></pre></td></tr><tr><td data-num="71"></td><td><pre>      <span class="token key atrule">PMA_HOST</span><span class="token punctuation">:</span> mysql</pre></td></tr><tr><td data-num="72"></td><td><pre>      <span class="token key atrule">PMA_USER</span><span class="token punctuation">:</span> root</pre></td></tr><tr><td data-num="73"></td><td><pre>      <span class="token key atrule">PMA_PASSWORD</span><span class="token punctuation">:</span> <span class="token number">224488</span></pre></td></tr><tr><td data-num="74"></td><td><pre>    <span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="75"></td><td><pre>      <span class="token punctuation">-</span> elk</pre></td></tr><tr><td data-num="76"></td><td><pre><span class="token key atrule">networks</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="77"></td><td><pre>  <span class="token key atrule">elk</span><span class="token punctuation">:</span></pre></td></tr><tr><td data-num="78"></td><td><pre>    <span class="token key atrule">external</span><span class="token punctuation">:</span> <span class="token boolean important">true</span></pre></td></tr></table></figure><h1 id="参考链接"><a class="anchor" href="#参考链接">#</a> 参考链接</h1><p><span class="exturl" data-url="aHR0cHM6Ly9qdWVqaW4uY24vcG9zdC82ODQ0OTA0MDUxOTk0MjYzNTU5">https://juejin.cn/post/6844904051994263559</span></p><p><span class="exturl" data-url="aHR0cHM6Ly93d3cubGl3ZW56aG91LmNvbS9wb3N0cy9Hby9lbGFzdGljc2VhcmNoLw==">https://www.liwenzhou.com/posts/Go/elasticsearch/</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3UwMTE4NjMwMjQvYXJ0aWNsZS9kZXRhaWxzLzExNTcyMTMyOA==">https://blog.csdn.net/u011863024/article/details/115721328</span></p><p><span class="exturl" data-url="aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L0ppbmVEL2FydGljbGUvZGV0YWlscy8xMTQ0NDQyMzk=">https://blog.csdn.net/JineD/article/details/114444239</span></p><div class="tags"><a href="/tags/elk/" rel="tag"><i class="ic i-tag"></i> elk</a></div></div><footer><div class="meta"><span class="item"><span class="icon"><i class="ic i-calendar-check"></i> </span><span class="text">更新于</span> <time title="修改时间：2024-02-14 16:38:12" itemprop="dateModified" datetime="2024-02-14T16:38:12+08:00">2024-02-14</time></span></div><div class="reward"><button><i class="ic i-heartbeat"></i> 赞赏</button><p>请我喝[茶]~(￣▽￣)~*</p><div id="qr"><div><img data-src="/images/wechatpay.png" alt="镜玄 微信支付"><p>微信支付</p></div><div><img data-src="/images/alipay.png" alt="镜玄 支付宝"><p>支付宝</p></div><div><img data-src="/images/paypal.png" alt="镜玄 贝宝"><p>贝宝</p></div></div></div><div id="copyright"><ul><li class="author"><strong>本文作者： </strong>镜玄 <i class="ic i-at"><em>@</em></i>镜玄的博客</li><li class="link"><strong>本文链接：</strong> <a href="http://withoutabc.github.io/2024/02/07/%E5%90%8E%E7%AB%AF/ELK%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/" title="ELK部署及使用">http://withoutabc.github.io/2024/02/07/后端/ELK部署及使用/</a></li><li class="license"><strong>版权声明： </strong>本站所有文章除特别声明外，均采用 <span class="exturl" data-url="aHR0cHM6Ly9jcmVhdGl2ZWNvbW1vbnMub3JnL2xpY2Vuc2VzL2J5LW5jLXNhLzQuMC9kZWVkLnpo"><i class="ic i-creative-commons"><em>(CC)</em></i>BY-NC-SA</span> 许可协议。转载请注明出处！</li></ul></div></footer></article></div><div class="post-nav"><div class="item left"><a href="/2024/02/07/%E5%90%8E%E7%AB%AF/Traefik%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/" itemprop="url" rel="prev" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;07&#x2F;24&#x2F;TNOEkIz9tnH3rjY.jpg" title="Traefik部署及使用"><span class="type">上一篇</span> <span class="category"><i class="ic i-flag"></i> 后端</span><h3>Traefik部署及使用</h3></a></div><div class="item right"><a href="/2024/02/12/%E5%90%8E%E7%AB%AF/Rabbitmq/" itemprop="url" rel="next" data-background-image="https:&#x2F;&#x2F;s2.loli.net&#x2F;2023&#x2F;07&#x2F;24&#x2F;JFtqCaXRbeDQ5Lx.jpg" title="Rabbitmq"><span class="type">下一篇</span> <span class="category"><i class="ic i-flag"></i> 后端</span><h3>Rabbitmq</h3></a></div></div><div class="wrap" id="comments"></div></div><div id="sidebar"><div class="inner"><div class="panels"><div class="inner"><div class="contents panel pjax" data-title="文章目录"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#eskibanalogstash%E9%83%A8%E7%BD%B2"><span class="toc-number">1.</span> <span class="toc-text">ES+Kibana+Logstash 部署</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%83%A8%E7%BD%B2%E6%96%87%E4%BB%B6"><span class="toc-number">1.1.</span> <span class="toc-text">部署文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%87%8D%E8%A6%81%E8%AF%B4%E6%98%8E"><span class="toc-number">1.2.</span> <span class="toc-text">重要说明</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AA%8C%E8%AF%81"><span class="toc-number">1.3.</span> <span class="toc-text">验证</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BB%80%E4%B9%88%E6%98%AFelasticsearch"><span class="toc-number">2.</span> <span class="toc-text">什么是 Elasticsearch?</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#elasticsearch%E7%9A%84%E6%9C%AF%E8%AF%AD%E5%92%8C%E6%9E%B6%E6%9E%84"><span class="toc-number">3.</span> <span class="toc-text">Elasticsearch 的术语和架构</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="toc-number">4.</span> <span class="toc-text">倒排索引</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%AD%A3%E6%8E%92%E7%B4%A2%E5%BC%95%E4%BC%A0%E7%BB%9F"><span class="toc-number">4.1.</span> <span class="toc-text">正排索引（传统）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95-2"><span class="toc-number">4.2.</span> <span class="toc-text">倒排索引</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#es-api"><span class="toc-number">5.</span> <span class="toc-text">ES API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95"><span class="toc-number">5.1.</span> <span class="toc-text">创建索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%81%A5%E5%BA%B7%E7%8A%B6%E6%80%81"><span class="toc-number">5.2.</span> <span class="toc-text">查看健康状态</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%89%80%E6%9C%89%E7%B4%A2%E5%BC%95"><span class="toc-number">5.3.</span> <span class="toc-text">查询所有索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E7%9C%8B%E5%8D%95%E4%B8%AA%E7%B4%A2%E5%BC%95"><span class="toc-number">5.4.</span> <span class="toc-text">查看单个索引</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%96%87%E6%A1%A3"><span class="toc-number">5.5.</span> <span class="toc-text">创建文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3"><span class="toc-number">5.6.</span> <span class="toc-text">查询文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%BB%E9%94%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.6.1.</span> <span class="toc-text">主键查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.6.2.</span> <span class="toc-text">全查询</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BF%AE%E6%94%B9%E6%96%87%E6%A1%A3"><span class="toc-number">5.7.</span> <span class="toc-text">修改文档</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E9%87%8F%E4%BF%AE%E6%94%B9"><span class="toc-number">5.7.1.</span> <span class="toc-text">全量修改</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%80%E9%83%A8%E4%BF%AE%E6%94%B9"><span class="toc-number">5.7.2.</span> <span class="toc-text">局部修改</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-number">5.8.</span> <span class="toc-text">删除文档</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E9%AB%98%E7%BA%A7%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.9.</span> <span class="toc-text">高级查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.9.1.</span> <span class="toc-text">条件查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%AF%B7%E6%B1%82%E4%BD%93%E5%B8%A6%E5%8F%82%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.9.1.1.</span> <span class="toc-text">请求体带参查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E6%89%BE%E6%89%80%E6%9C%89%E6%96%87%E6%A1%A3%E5%86%85%E5%AE%B9"><span class="toc-number">5.9.1.2.</span> <span class="toc-text">查找所有文档内容</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%8C%87%E5%AE%9A%E5%AD%97%E6%AE%B5"><span class="toc-number">5.9.1.3.</span> <span class="toc-text">查询指定字段</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.9.1.4.</span> <span class="toc-text">分页查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%8E%92%E5%BA%8F"><span class="toc-number">5.9.1.5.</span> <span class="toc-text">查询排序</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.9.2.</span> <span class="toc-text">多条件查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%8C%83%E5%9B%B4%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.9.3.</span> <span class="toc-text">范围查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2"><span class="toc-number">5.9.4.</span> <span class="toc-text">全文检索</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%AE%8C%E5%85%A8%E5%8C%B9%E9%85%8D"><span class="toc-number">5.9.5.</span> <span class="toc-text">完全匹配</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E9%AB%98%E4%BA%AE%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.9.6.</span> <span class="toc-text">高亮查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-number">5.9.7.</span> <span class="toc-text">聚合查询</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B8%A6%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE"><span class="toc-number">5.9.7.1.</span> <span class="toc-text">带原始数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E5%B8%A6%E5%8E%9F%E5%A7%8B%E6%95%B0%E6%8D%AE"><span class="toc-number">5.9.7.2.</span> <span class="toc-text">不带原始数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%B9%B3%E5%9D%87%E5%80%BC"><span class="toc-number">5.9.7.3.</span> <span class="toc-text">平均值</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%98%A0%E5%B0%84%E5%85%B3%E7%B3%BB"><span class="toc-number">5.10.</span> <span class="toc-text">映射关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E6%98%A0%E5%B0%84"><span class="toc-number">5.10.1.</span> <span class="toc-text">创建映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%9F%A5%E8%AF%A2%E6%98%A0%E5%B0%84"><span class="toc-number">5.10.2.</span> <span class="toc-text">查询映射</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E6%98%A0%E5%B0%84"><span class="toc-number">5.10.3.</span> <span class="toc-text">动态映射</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%88%A0%E9%99%A4%E7%B4%A2%E5%BC%95"><span class="toc-number">5.11.</span> <span class="toc-text">删除索引</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#kibana"><span class="toc-number">6.</span> <span class="toc-text">Kibana</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#logstash"><span class="toc-number">7.</span> <span class="toc-text">Logstash</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E8%B7%B5"><span class="toc-number">7.1.</span> <span class="toc-text">实践</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#conf%E6%96%87%E4%BB%B6%E8%AF%B4%E6%98%8E"><span class="toc-number">7.2.</span> <span class="toc-text">conf 文件说明</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#input"><span class="toc-number">7.2.1.</span> <span class="toc-text">Input</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter"><span class="toc-number">7.2.2.</span> <span class="toc-text">Filter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#output"><span class="toc-number">7.2.3.</span> <span class="toc-text">Output</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#mysql%E6%95%B0%E6%8D%AE%E5%BA%93%E5%90%8C%E6%AD%A5"><span class="toc-number">7.3.</span> <span class="toc-text">Mysql 数据库同步</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#geo%E4%BD%BF%E7%94%A8%E7%AD%96%E7%95%A5"><span class="toc-number">7.4.</span> <span class="toc-text">Geo 使用策略</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%AE%8C%E6%95%B4%E9%83%A8%E7%BD%B2%E5%8F%82%E8%80%83"><span class="toc-number">8.</span> <span class="toc-text">完整部署参考</span></a></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5"><span class="toc-number">9.</span> <span class="toc-text">参考链接</span></a></li></ol></div><div class="related panel pjax" data-title="系列文章"><ul><li><a href="/2023/12/18/%E5%90%8E%E7%AB%AF/Minio%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/" rel="bookmark" title="Minio部署及使用">Minio部署及使用</a></li><li><a href="/2023/12/18/%E5%90%8E%E7%AB%AF/Nginx/" rel="bookmark" title="Nginx">Nginx</a></li><li><a href="/2024/02/07/%E5%90%8E%E7%AB%AF/Apollo%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/" rel="bookmark" title="Apollo部署及使用">Apollo部署及使用</a></li><li><a href="/2024/02/07/%E5%90%8E%E7%AB%AF/Traefik%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/" rel="bookmark" title="Traefik部署及使用">Traefik部署及使用</a></li><li class="active"><a href="/2024/02/07/%E5%90%8E%E7%AB%AF/ELK%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/" rel="bookmark" title="ELK部署及使用">ELK部署及使用</a></li><li><a href="/2024/02/12/%E5%90%8E%E7%AB%AF/Rabbitmq/" rel="bookmark" title="Rabbitmq">Rabbitmq</a></li><li><a href="/2024/02/13/%E5%90%8E%E7%AB%AF/Sentinel/" rel="bookmark" title="Sentinel">Sentinel</a></li><li><a href="/2024/02/13/%E5%90%8E%E7%AB%AF/viper/" rel="bookmark" title="viper">viper</a></li></ul></div><div class="overview panel" data-title="站点概览"><div class="author" itemprop="author" itemscope itemtype="http://schema.org/Person"><img class="image" itemprop="image" alt="镜玄" data-src="/images/avatar.jpg"><p class="name" itemprop="name">镜玄</p><div class="description" itemprop="description"></div></div><nav class="state"><div class="item posts"><a href="/archives/"><span class="count">14</span> <span class="name">文章</span></a></div><div class="item categories"><a href="/categories/"><span class="count">4</span> <span class="name">分类</span></a></div><div class="item tags"><a href="/tags/"><span class="count">13</span> <span class="name">标签</span></a></div></nav><div class="social"><span class="exturl item github" data-url="aHR0cHM6Ly9naXRodWIuY29tL3dpdGhvdXRhYmM=" title="https:&#x2F;&#x2F;github.com&#x2F;withoutabc"><i class="ic i-github"></i></span> <span class="exturl item email" data-url="bWFpbHRvOmZ3NTVmZnd3QG91dGxvb2suY29t" title="mailto:fw55ffww@outlook.com"><i class="ic i-envelope"></i></span></div><ul class="menu"><li class="item"><a href="/" rel="section"><i class="ic i-home"></i>首页</a></li><li class="item"><a href="/about/" rel="section"><i class="ic i-user"></i>关于</a></li><li class="item dropdown"><a href="javascript:void(0);"><i class="ic i-feather"></i>文章</a><ul class="submenu"><li class="item"><a href="/archives/" rel="section"><i class="ic i-list-alt"></i>归档</a></li><li class="item"><a href="/categories/" rel="section"><i class="ic i-th"></i>分类</a></li><li class="item"><a href="/tags/" rel="section"><i class="ic i-tags"></i>标签</a></li></ul></li><li class="item"><a href="/links/" rel="section"><i class="ic i-magic"></i>友链</a></li></ul></div></div></div><ul id="quick"><li class="prev pjax"><a href="/2024/02/07/%E5%90%8E%E7%AB%AF/Traefik%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/" rel="prev" title="上一篇"><i class="ic i-chevron-left"></i></a></li><li class="up"><i class="ic i-arrow-up"></i></li><li class="down"><i class="ic i-arrow-down"></i></li><li class="next pjax"><a href="/2024/02/12/%E5%90%8E%E7%AB%AF/Rabbitmq/" rel="next" title="下一篇"><i class="ic i-chevron-right"></i></a></li><li class="percent"></li></ul></div></div><div class="dimmer"></div></div></main><footer id="footer"><div class="inner"><div class="widgets"><div class="rpost pjax"><h2>随机文章</h2><ul><li class="item"><div class="breadcrumb"><a href="/categories/%E8%BF%90%E7%BB%B4/" title="分类于 运维">运维</a></div><span><a href="/2024/02/13/%E8%BF%90%E7%BB%B4/NFS%E9%85%8D%E7%BD%AE/" title="NFS配置">NFS配置</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/golang%E5%9F%BA%E7%A1%80/" title="分类于 golang基础">golang基础</a></div><span><a href="/2024/02/06/golang%E5%9F%BA%E7%A1%80/container%E5%8C%85/" title="container包">container包</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a></div><span><a href="/2024/02/12/%E5%90%8E%E7%AB%AF/Rabbitmq/" title="Rabbitmq">Rabbitmq</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a></div><span><a href="/2024/02/07/%E5%90%8E%E7%AB%AF/Apollo%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/" title="Apollo部署及使用">Apollo部署及使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a></div><span><a href="/2023/12/18/%E5%90%8E%E7%AB%AF/Minio%E9%83%A8%E7%BD%B2%E5%8F%8A%E4%BD%BF%E7%94%A8/" title="Minio部署及使用">Minio部署及使用</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E5%90%8E%E7%AB%AF/" title="分类于 后端">后端</a></div><span><a href="/2023/12/18/%E5%90%8E%E7%AB%AF/Nginx/" title="Nginx">Nginx</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a></div><span><a href="/2023/12/16/%E7%AE%97%E6%B3%95/DFS/" title="DFS">DFS</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%BF%90%E7%BB%B4/" title="分类于 运维">运维</a></div><span><a href="/2024/02/13/%E8%BF%90%E7%BB%B4/NFS%E5%8A%A8%E6%80%81%E5%8D%B7%E9%83%A8%E7%BD%B2yaml%E6%96%87%E4%BB%B6/" title="NFS动态卷部署yaml文件">NFS动态卷部署yaml文件</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E8%BF%90%E7%BB%B4/" title="分类于 运维">运维</a></div><span><a href="/2024/02/13/%E8%BF%90%E7%BB%B4/Kubernetes%E5%9F%BA%E7%A1%80/" title="Kubernetes基础">Kubernetes基础</a></span></li><li class="item"><div class="breadcrumb"><a href="/categories/%E7%AE%97%E6%B3%95/" title="分类于 算法">算法</a></div><span><a href="/2023/12/17/%E7%AE%97%E6%B3%95/%E4%BA%8C%E5%8F%89%E6%A0%91/" title="二叉树">二叉树</a></span></li></ul></div><div><h2>最新评论</h2><ul class="leancloud-recent-comment"></ul></div></div><div class="status"><div class="copyright">&copy; 2023 – <span itemprop="copyrightYear">2024</span> <span class="with-love"><i class="ic i-sakura rotate"></i> </span><span class="author" itemprop="copyrightHolder">镜玄 @ 寄寄菜鸟试飞点</span></div><div class="count"><span class="post-meta-item-icon"><i class="ic i-chart-area"></i> </span><span title="站点总字数">146k 字</span> <span class="post-meta-divider">|</span> <span class="post-meta-item-icon"><i class="ic i-coffee"></i> </span><span title="站点阅读时长">2:12</span></div><div class="powered-by">基于 <span class="exturl" data-url="aHR0cHM6Ly9oZXhvLmlv">Hexo</span> & Theme.<span class="exturl" data-url="aHR0cHM6Ly9naXRodWIuY29tL2FtZWhpbWUvaGV4by10aGVtZS1zaG9rYQ==">Shoka</span></div></div></div></footer></div><script data-config type="text/javascript">var LOCAL={path:"2024/02/07/后端/ELK部署及使用/",favicon:{show:"（●´3｀●）やれやれだぜ",hide:"(´Д｀)大変だ！"},search:{placeholder:"文章搜索",empty:"关于 「 ${query} 」，什么也没搜到",stats:"${time} ms 内找到 ${hits} 条结果"},valine:!0,fancybox:!0,copyright:'复制成功，转载请遵守 <i class="ic i-creative-commons"></i>BY-NC-SA 协议。',ignores:[function(e){return e.includes("#")},function(e){return new RegExp(LOCAL.path+"$").test(e)}]}</script><script src="https://cdn.polyfill.io/v2/polyfill.js"></script><script src="//cdn.jsdelivr.net/combine/npm/pace-js@1.0.2/pace.min.js,npm/pjax@0.2.8/pjax.min.js,npm/whatwg-fetch@3.4.0/dist/fetch.umd.min.js,npm/animejs@3.2.0/lib/anime.min.js,npm/algoliasearch@4/dist/algoliasearch-lite.umd.js,npm/instantsearch.js@4/dist/instantsearch.production.min.js,npm/lozad@1/dist/lozad.min.js,npm/quicklink@2/dist/quicklink.umd.js"></script><script src="/js/app.js?v=0.2.5"></script></body></html><!-- rebuild by hrmmi -->